/*
 *
 * Wijmo Library 3.20131.6
 * http://wijmo.com/
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 * 
 * Licensed under the Wijmo Commercial License. Also available under the GNU GPL Version 3 license.
 * licensing@wijmo.com
 * http://wijmo.com/widgets/license/
 *
 *
 */
var wijmo; (function (e) { e.expando = ".wijmo"; var t = function () { function e(e) { this.message = e, this.stack = "Wijmo" + (new Error).stack, this.name = "WijmoError" } return e }(); e.WijmoError = t; var n = t; n.prototype = new Error, n.prototype.constructor = n })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { var n = function () { function t(e) { this.object = e } return t.getFrom = function (r, i) { typeof i == "undefined" && (i = !0); var s = e.expando, o; if (Object(r) !== r) return null; o = r[s], o && o.object !== r && (o = null); if (i && !(o instanceof t && Object.prototype.hasOwnProperty.call(r, s))) { o = new t(r); try { Object.defineProperty(r, s, { value: o, configurable: !1, enumerable: !1, writable: !1 }) } catch (u) { r[s] = o } } return o }, t }(); t.Expando = n })(e.data || (e.data = {})); var t = e.data })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (e) { (function (e) { function t(e) { return function () { var t = function () { return e.prototype._call.apply(t, arguments) }; return $.extend(t, e.prototype), e.apply(t, arguments), t } } e.funcClass = t })(e.util || (e.util = {})); var t = e.util })(e.data || (e.data = {})); var t = e.data })(wijmo || (wijmo = {})); var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { (function (e) { function i(e) { return t.isFunction(e.subscribe) } function l(e) { return typeof e == "undefined" && (e = null), new f(e) } function c(e) { return typeof e == "undefined" && (e = null), new f(e, !0) } function h(e) { return t.isFunction(e) && i(e) } var t = jQuery, n = function () { function e(e, t) { this.handler = e, this.context = t } return e.prototype.trigger = function (e) { return this.handler.apply(this.context, e) }, e }(); e.SubscriberEntry = n; var r = function () { function r(e) { this.defaultContext = e, this._entries = [] } return r.prototype.subscribe = function (t, r) { typeof r == "undefined" && (r = this.defaultContext); var i = this, s = new n(t, r); return this._entries.push(s), { dispose: function () { return e.util.remove(i._entries, s) } } }, r.prototype.trigger = function () { var t = []; for (var n = 0; n < arguments.length - 0; n++) t[n] = arguments[n + 0]; e.util.each(this._entries, function (e, n) { return n.trigger(t) }) }, r.makeSubscribable = function (n) { var i = new r(n); return n.subscribe = t.proxy(i.subscribe, i), i }, r }(); e.Subscribable = r, e.isSubscriptable = i; var s = function () { function e() { } return e.prototype.subscribe = function (e, t) { return this._subscribable = this._subscribable || new r(this), this._subscribable.subscribe(e, t) }, e.prototype._trigger = function () { var e = []; for (var t = 0; t < arguments.length - 0; t++) e[t] = arguments[t + 0]; this._subscribable && this._subscribable.trigger.apply(this._subscribable, arguments) }, e }(); e.BaseObservable = s; var o = function (e) { function t(t) { e.call(this), this.mutable = t } return __extends(t, e), t.prototype._call = function () { return this.mutable.value }, t }(s); e._ReadOnlyObservable = o; var u = e.util.funcClass(o), a = function (e) { function t(t, n) { typeof n == "undefined" && (n = !1), e.call(this), this.value = t, this.checkNewValue = n } return __extends(t, e), t.prototype._call = function (e) { return arguments.length > 0 && (!this.checkNewValue || e !== this.value) && (this.value = e, this._trigger(e), this._readOnly && this._readOnly._trigger(e)), this.value }, t.prototype.read = function () { return this._readOnly = this._readOnly || new u(this), this._readOnly }, t }(s); e._MutableObservable = a; var f = e.util.funcClass(a); e.observable = l, e.observableWithNewValueCheck = c, e.isObservable = h })(e.data || (e.data = {})); var t = e.data })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { (function (n) { function i(e, t) { return typeof t == "undefined" && (t = !1), r.isArray(e) ? e = e.slice(0) : r.isPlainObject(e) && (e = r.extend(!!t, {}, e)), e } function s(e) { return typeof e == "string" || e instanceof String } function o(e) { return typeof e == "number" } function u(t) { return t === e.expando || t === r.expando } function a(e, t) { var n = this; r.each(e, function (e, r) { if (!u(e)) return t.call(n, e, r) }) } function f(t, n) { var i = r.map(t, n); return delete i[e.expando], i } function l(e) { var t; return e && r.isFunction(e.toString) && e.toString !== Object.prototype.toString ? t = e.toString() : t = JSON.stringify(e), t != null && t.length > 2 && t[0] === '"' && t[t.length - 1] === '"' && (t = t.substr(1, t.length - 2)), t } function c(e) { var t = []; for (var n = 0; n < arguments.length - 1; n++) t[n] = arguments[n + 1]; return e.replace(/{(\d+)}/g, function (e, n) { return l(t[parseInt(n, 10)]) }) } function h(e, t) { var n = !0; return a(e, function (e, r) { n = r, t && (n = t.call(n, n, e)); if (!n) return !1 }), n } function p(e, t) { var n = !1; return a(e, function (e, r) { n = r, t && (n = t.call(n, n, e)); if (n) return !1 }), n } function d(e, t) { var n, i, o; if (e == null) return t == null ? 0 : -1; if (t == null) return 1; if (r.isArray(e) && r.isArray(t)) { i = Math.min(e.length, t.length); for (n = 0; n < i; n++) { o = d(e[n], t[n]); if (o !== 0) return o } return e.length - t.length } return s(e) && s(t) ? e < t ? -1 : e > t ? 1 : 0 : (o = e - t, isNaN(o) ? 0 : o) } function v(e, t) { return r.inArray(t, e) >= 0 } function m(e, t) { var n = 0, r; for (r = 0; r < e.length;) e[r] !== t ? r++ : (e.splice(r, 1), n++); return n } function g(e, t) { return e == -1 ? -1 : e == 0 ? 0 : t ? Math.ceil(e / t) : 1 } function y(e, t) { function i() { return e.apply(t, n) } var n = []; for (var r = 0; r < arguments.length - 2; r++) n[r] = arguments[r + 2]; if (typeof setTimeout == typeof undefined) return i(); setTimeout(i, 10) } function b(e) { if (!console) return; console.error ? console.error(e) : console.log && console.log(e) } function w(e, n) { var r = 0, i = e, s; for (; ;) { var o = n.indexOf(".", r); o >= 0 ? (s = n.substring(r, o), r = o + 1) : r > 0 ? s = n.substring(r) : s = n, i = i[s], t.isObservable(i) && (i = i()); if (o < 0) break } return i } function E(e, n, r) { var i = 0, s; for (; ;) { var o = n.indexOf(".", i); o >= 0 ? (s = n.substring(i, o), i = o + 1) : i > 0 ? s = n.substring(i) : s = n; var u = e[s]; if (!(o >= 0)) { t.isObservable(u) ? u(r) : e[s] = r; break } t.isObservable(u) && (u = u()), e = u } } function S(e) { return typeof e == "object" && !r.isArray(e) && !r.isPlainObject(e) && e.constructor !== Object.prototype.constructor } function x(e) { t.util.each(e, function (e, n) { if (!n || typeof n != "object") return; t.util.each(n, function (e, r) { var i; if (!t.util.isString(r)) return; i = /\/Date\((-?\d+)\)\//.exec(r); if (!i) return; n[e] = new Date(parseInt(i[1], 10)) }) }) } var r = jQuery; n.clone = i, n.isString = s, n.isNumeric = o, n.isInternalProperty = u, n.each = a, n.map = f, n.toStr = l, n.format = c, n.every = h, n.some = p, n.compare = d, n.contains = v, n.remove = m, n.pageCount = g, n.executeDelayed = y, n.logError = b, n.getProperty = w, n.setProperty = E, n.isClassInstance = S, n.convertDateProperties = x })(t.util || (t.util = {})); var n = t.util })(e.data || (e.data = {})); var t = e.data })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { t.errors = {}, t.errors._register = function (n) { t.util.each(n, function (n, r) { function i() { var n = []; for (var i = 0; i < arguments.length - 0; i++) n[i] = arguments[i + 0]; var s; return $.isFunction(r) ? r = r.apply(this, arguments) : arguments.length > 0 && (n.unshift(r), r = t.util.format.apply(this, n)), r = $.trim(r), s = r[r.length - 1], s !== "." && s !== "!" && s !== "?" && (r += "."), new e.WijmoError(r) } t.errors[n] = function () { throw i.apply(this, arguments) }, t.errors[n].create = i }) }, t.errors._register({ indexOutOfBounds: "Index is outside the bounds of the array.", notImplemented: "The operation is not implemented", unsupprtedOperation: "Unsupported operation", unsupportedFilterOperator: "Unsupported filter operator: {0}", unsupportedDataSource: "Unsupported data source", argument: function (e) { var t = "Unexpected argument value."; return e && (t += "\nParameter name: " + e), t }, argumentNull: "Argument '{0}' is null/undefined", noParser: "There is no parser for type '{0}'", noUrl: "Url is not specified", cantConvert: "Value can't be converted to type '{0}': '{1}'", noGlobalize: "Globalize is not defined. Make sure you include globalize.js", itemNotInView: "Item {0} is not in the data view", unsupportedFilterFormat: "The filter format is not supported", multiPropertyKeysNotSupported: "Entities with multiple properties in the primary key are not supported. Entity type: {0}", keyPropertyNotFound: "Key property not found in {0} entity type" }) })(e.data || (e.data = {})); var t = e.data })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (e) { (function (t) { function r(n, r) { typeof r == "undefined" && (r = !1), n = n.toLowerCase(); var i = t.ops[n]; if (!i) { var s = t.opMap[n]; s && (i = t.ops[s]) } return !i && r && e.errors.unsupportedOperator(n), i } function i(i) { var s; if (!n.isPlainObject(i)) return { operator: "==", op: t.ops.equals, value: i }; var o = i.operator || t.ops.equals; if (e.util.isString(i.operator)) { if (i.operator.toLowerCase() === "nofilter") return null; o = r(i.operator, !0) } else n.isFunction(o.apply) || e.errors.unsupportedOperator(o); return { operator: i.operator, op: o, value: i.value } } function s(t) { var r = { original: t, func: null, normalized: null }; if (n.isFunction(t)) r.func = t; else if (n.isArray(t)) e.errors.unsupportedFilterFormat(t); else if (t) { r.normalized = {}; var s = !1; e.util.each(t, function (t, o) { n.isArray(o) && e.errors.unsupportedFilterFormat(), o = i(o), o && (r.normalized[t] = o, s = !0) }), s ? r.func = function (t) { return e.util.every(r.normalized, function (n, r) { var i = e.util.getProperty(t, r); return n.op.apply(i, n.value) }) } : r.normalized = null } return !r.normalized && !r.func && (r.func = function (e) { return !0 }), r } var n = jQuery; t.opMap = { "==": "equals", doesnotcontain: "notcontain", "!=": "notequal", ">": "greater", "<": "less", ">=": "greaterorequal", "<=": "lessorequal", isnotempty: "notisempty", isnotnull: "notisnull" }, t.normalizeCondition = i, t.compile = s, t.ops = function () { function r(e, n, r, i) { return t[e.toLowerCase()] = { name: e, arity: n, applicableTo: r, apply: i } } function i(t) { return t instanceof Date && (t = t.getTime()), e.util.isString(t) && (t = t.toLowerCase()), t } function s(e, t, n) { r(e, 2, t, function (e, t) { return n(i(e), i(t)) }) } function o(e, t, n) { r(e, 1, t, n) } function u(e, t) { s(e, n.prim, t) } function a(e, t) { s(e, n.str, t) } var t = {}, n = { str: ["string"], prim: ["string", "number", "datetime", "currency", "boolean"] }; return u("Equals", function (e, t) { return e == t }), u("NotEqual", function (e, t) { return e != t }), u("Greater", function (e, t) { return e > t }), u("Less", function (e, t) { return e < t }), u("GreaterOrEqual", function (e, t) { return e >= t }), u("LessOrEqual", function (e, t) { return e <= t }), a("Contains", function (e, t) { return e == t || e && e.indexOf && e.indexOf(t) >= 0 }), a("NotContain", function (e, t) { return e != t && (!e || !e.indexOf || e.indexOf(t) < 0) }), a("BeginsWith", function (e, t) { return e == t || e && e.indexOf && e.indexOf(t) == 0 }), a("EndsWith", function (t, n) { var r; return !e.util.isString(t) || !e.util.isString(n) ? !1 : (r = t.lastIndexOf(n), r >= 0 && t.length - r === n.length) }), o("IsEmpty", n.str, function (e) { return !e && e !== 0 && e !== !1 }), o("NotIsEmpty", n.str, function (e) { return !!e || e === 0 || e === !1 }), o("IsNull", n.prim, function (e) { return e == null }), o("NotIsNull", n.prim, function (e) { return e != null }), t }() })(e.filtering || (e.filtering = {})); var t = e.filtering })(e.data || (e.data = {})); var t = e.data })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (e) { (function (t) { function n(t) { var n = []; return t = e.util.isString(t) ? t.split(/,\s*/) : $.isArray(t) ? t.slice(0) : [t], t = $.isArray(t) ? t.slice(0) : [t], e.util.each(t, function (t, r) { var i = !0, s; if (r == null) return; if (!e.util.isString(r)) { r.property != null && n.push(r); return } if (r[0] === "-") i = !1, r = r.substr(1); else { var o = /\s(asc|desc)\s*$/.exec(r); o && (r = r.substr(0, o.index), i = o[1] !== "desc") } n.push({ property: r, asc: i }) }), n } function r(t, r) { typeof r == "undefined" && (r = e.util.compare); var i = n(t), s = { original: t, propertyCompareTo: r, compare: null, normalized: i }; return i != null && (s.compare = function (t, n) { var s = 0, o, u; for (s = 0; s < i.length; s++) { u = i[s], o = r(e.util.getProperty(t, u.property), e.util.getProperty(n, u.property)); if (o !== 0) return u.asc || (o = -o), o } return 0 }), s } t.compile = r })(e.sorting || (e.sorting = {})); var t = e.sorting })(e.data || (e.data = {})); var t = e.data })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (e) { function r(r) { return t.isFunction(r) || e.errors.argument("factory"), n.push(r), { dispose: function () { e.util.remove(n, r) } } } function i(t) { if (s(t)) return t; var r = e.util.some(n, function (e) { return e(t) }); return r || e.errors.unsupportedDataSource() } function s(e) { return e && t.isFunction(e.count) && t.isFunction(e.item) && t.isFunction(e.getProperty) } var t = jQuery, n = []; e.registerDataViewFactory = r, r(function (e) { return s(e) && e }), r(function (n) { return t.isArray(n) && new e.ArrayDataView(n) }), e.asDataView = i, e.isDataView = s })(e.data || (e.data = {})); var t = e.data })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (e) { var t = jQuery, n = function () { function n(n) { function i(e) { return function () { if (r) return; r = !0; try { e.apply(this, arguments) } finally { r = !1 } } } this.array = n, this.currentItem = e.observableWithNewValueCheck(null), this.currentPosition = e.observableWithNewValueCheck(-1); var r = !1; this.currentItem.subscribe(i(function (e) { this.currentPosition(e == null ? -1 : t.inArray(e, this.array)) }), this), this.currentPosition.subscribe(i(function (t) { e.util.isNumeric(t) || e.errors.argument("value"), (t < -1 || t >= this.array.length) && e.errors.indexOutOfBounds(), this.currentItem(t < 0 ? null : this.array[t]) }), this) } return n.prototype.update = function () { var e = this.currentItem(), n = this.currentPosition(), r = t.inArray(e, this.array); r < 0 && e == null && this._recentlyRemovedItem != null && (r = t.inArray(this._recentlyRemovedItem, this.array)), r >= 0 ? (e && (this._recentlyRemovedItem = e), this.currentPosition(r)) : n >= 0 && n < this.array.length ? this.currentItem(this.array[n]) : (this.currentPosition(-1), this.currentItem(null)) }, n.prototype.updateDelayed = function () { e.util.executeDelayed(this.update, this) }, n }(); e.CurrencyManager = n })(e.data || (e.data = {})); var t = e.data })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (e) { var t = jQuery, n = function () { function t(t) { function n() { this.pageSize() > 0 && this.pageIndex() >= 0 ? (this._skip = this.pageSize() * this.pageIndex(), this._take = this.pageSize()) : (this._skip = 0, this._take = -1), t(!0) } this.onChanged = t, this.filter = e.observable(), this.sort = e.observable(), this.pageIndex = e.observable(0), this.pageSize = e.observable(0), this._skip = 0, this._take = -1, this.filter.subscribe(function (e) { this.onFilterChanged(e), t() }, this), this.sort.subscribe(function () { this._compiledSort = e.sorting.compile(this.sort()), t() }, this), this.pageIndex.subscribe(n, this), this.pageSize.subscribe(n, this) } return t.prototype.onFilterChanged = function (t) { this._compiledFilter = e.filtering.compile(t) }, t.prototype.setFilter = function (e) { this.filter(e) }, t.prototype.update = function (e) { "filter" in e && this.setFilter(e.filter), "sort" in e && this.sort(e.sort), "pageSize" in e && this.pageSize(e.pageSize), "pageIndex" in e && this.pageIndex(e.pageIndex) }, t.prototype.apply = function (t, n) { typeof n == "undefined" && (n = !0); var r = this, i = []; e.util.each(t, function (e, t) { if (r._compiledFilter && !r._compiledFilter.func(t)) return; i.push(t) }), this._compiledSort && i.sort(this._compiledSort.compare); var s = i.length; return n && this._take > 0 && (this._skip > 0 && i.splice(0, Math.min(this._skip, i.length)), this._take < i.length && (i.length = this._take)), { results: i, totalCount: s } }, t.prototype.toObj = function () { return { filter: this._compiledFilter && this._compiledFilter.normalized, sort: this._compiledSort && this._compiledSort.normalized, pageSize: this.pageSize(), pageIndex: this.pageIndex() } }, t }(); e.Shape = n; var r = function () { function r(t) { this.isRemote = !1, this.localPaging = !0, this.local = [], this._updatingShape = !1, this._pageCount = e.observable(1), this._totalItemCount = e.observable(0), this._isLoaded = e.observable(!1), this._isLoading = e.observable(!1), this._currentEditItem = e.observable(), this._isCurrentEditItemNew = !1, this._currentEditItemSnapshot = null, this.isLoading = this._isLoading.read(), this.isLoaded = this._isLoaded.read(), this._changed = new e.Subscribable(this), this.currentEditItem = this._currentEditItem.read(), this._initCurrency(), this._initShape(t) } return r.prototype.dispose = function () { }, r.prototype.count = function () { return this.local.length }, r.prototype.item = function (t) { return (t < 0 || t >= this.local.length) && e.errors.indexOutOfBounds(), this.local[t] }, r.prototype.indexOf = function (e) { return t.inArray(e, this.local) }, r.prototype.getSource = function () { return this.sourceArray }, r.prototype.toObservableArray = function () { return this._koArray || (this._koArray = ko.observableArray(this.local)), this._koArray }, r.prototype._getProps = function (n) { var r = []; return e.util.each(n, function (e, n) { e = String(e); if (e.match(/^_/)) return; if (t.isFunction(n) && !n.subscribe) return; r.push({ name: e }) }), r }, r.prototype.getProperties = function () { return this.count() ? this._getProps(this.item(0)) : [] }, r.prototype._readProperty = function (t, n) { return e.util.getProperty(t, n) }, r.prototype.getProperty = function (e, t) { var n = this._resolve(e, !0); return this._readProperty(n.item, t) }, r.prototype._writeProperty = function (t, n, r) { e.util.setProperty(t, n, r) }, r.prototype.setProperty = function (e, t, n) { var r = this._resolve(e, !0); return r.item === this.currentEditItem() && this._currentEditItemSnapshot && !(t in this._currentEditItemSnapshot) && (this._currentEditItemSnapshot[t] = this.getProperty(e, t)), this._writeProperty(r.item, t, n), this }, r.prototype.subscribe = function (e, t) { return this._changed.subscribe(e, t) }, r.prototype.trigger = function () { this._currencyManager.updateDelayed(), this._changed.trigger(this.local), this._koArray && this._koArray.notifySubscribers(this.local) }, r.prototype.canFilter = function () { return !0 }, r.prototype.canSort = function () { return !0 }, r.prototype._updateShape = function (e) { this._updatingShape = !0; try { this._shape.update(e) } finally { this._updatingShape = !1 } }, r.prototype.prevPage = function () { return this.pageIndex() < 1 ? !1 : (this.pageIndex(this.pageIndex() - 1), !0) }, r.prototype.nextPage = function () { return this.pageCount() > 0 && this.pageIndex() + 1 >= this.pageCount() ? !1 : (this.pageIndex(this.pageIndex() + 1), !0) }, r.prototype._createShape = function (e) { return new n(e) }, r.prototype._initShape = function (e) { var t = this, n = function (e) { typeof e == "undefined" && (e = !1), t._updatingShape || t.refresh(null, e && t.localPaging) }; this._shape = this._createShape(n), e && this._updateShape(e), this.filter = this._shape.filter, this.sort = this._shape.sort, this.pageIndex = this._shape.pageIndex, this.pageSize = this._shape.pageSize, this.pageCount = this._pageCount.read(), this.totalItemCount = this._totalItemCount.read() }, r.prototype._localRefresh = function (n) { typeof n == "undefined" && (n = this.localPaging); var r = this, i = this._shape.apply(this.sourceArray, n); return this.local.length = 0, t.each(i.results, function (e, t) { return r.local.push(t) }), n && this._totalItemCount(i.totalCount), this._pageCount(e.util.pageCount(this.totalItemCount(), this.pageSize())), this.trigger(), t.Deferred().resolve().promise() }, r.prototype._remoteRefresh = function () { return this._localRefresh() }, r.prototype.refresh = function (e, t) { typeof t == "undefined" && (t = !1); var n = this; this.cancelRefresh(), e && this._updateShape(e), this._isLoading(!0); var r = t ? this._localRefresh() : this._remoteRefresh(); return r.then(function () { n._isLoaded(!0), n._isLoading(!1) }) }, r.prototype.cancelRefresh = function () { }, r.prototype._initCurrency = function () { this._currencyManager = new e.CurrencyManager(this.local), this.currentItem = this._currencyManager.currentItem, this.currentPosition = this._currencyManager.currentPosition }, r.prototype.isCurrentEditItemNew = function () { return this._isCurrentEditItemNew }, r.prototype._beginEdit = function (e, t) { this.commitEdit(), this._currentEditItemSnapshot = {}, this._isCurrentEditItemNew = t, this._currentEditItem(e) }, r.prototype.canAdd = function () { return !0 }, r.prototype.add = function (t) { t || e.errors.argument("item"), this.commitEdit(), this.local.push(t), this._beginEdit(t, !0), this.trigger() }, r.prototype.canAddNew = function () { return !1 }, r.prototype.addNew = function () { return e.errors.unsupportedOperation() }, r.prototype.editItem = function (e) { typeof e == "undefined" && (e = this.currentItem()), this.commitEdit(); var t = this._resolve(e); t && this._beginEdit(t.item, !1) }, r.prototype.canRemove = function () { return !0 }, r.prototype._remove = function (t) { this.local.splice(t.index, 1), e.util.remove(this.sourceArray, t.item), this.trigger() }, r.prototype.remove = function (e) { typeof e == "undefined" && (e = this.currentItem()), this.commitEdit(); var t = this._resolve(e); return t ? (this._remove(t), !0) : !1 }, r.prototype.canCancelEdit = function () { return !0 }, r.prototype.cancelEdit = function () { var n = this, r; if (!this.currentEditItem()) return; var i = this.currentEditItem(); this._currentEditItem(null), this._isCurrentEditItemNew ? e.util.remove(this.local, this.item) : this._currentEditItemSnapshot && t.each(this._currentEditItemSnapshot, function (e, t) { return n._writeProperty(i, e, t) }), this.trigger() }, r.prototype.canCommitEdit = function () { return !0 }, r.prototype.commitEdit = function () { if (!this.currentEditItem()) return; var t = this.currentEditItem; this._currentEditItem(null), this._isCurrentEditItemNew && this.sourceArray.push(t); var n = this._shape._compiledFilter && this._shape._compiledFilter.func; n && !n(t) && e.util.remove(this.local, t), this.trigger() }, r.prototype._resolve = function (t, n) { typeof n == "undefined" && (n = !1); var r; return e.util.isNumeric(t) ? { index: t, item: this.item(t) } : (r = this.indexOf(t), r < 0 ? (n && e.errors.itemNotInView(t), null) : { index: r, item: t }) }, r }(); e.ArrayDataViewBase = r; var i = function (e) { function t(t, n) { e.call(this, n), this.sourceArray = t, this.refresh() } return __extends(t, e), t }(r); e.ArrayDataView = i })(e.data || (e.data = {})); var t = e.data })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (e) { var t = jQuery, n = function (e) { function n(t) { e.call(this), this.isRemote = !0, this.sourceArray = [], t && this._construct(t) } return __extends(n, e), n.prototype._construct = function (e) { this.options = e = t.extend({ localPaging: !1 }, e), this.localPaging = e.localPaging, this._updateShape(e) }, n }(e.ArrayDataViewBase); e.RemoteDataView = n })(e.data || (e.data = {})); var t = e.data })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { (function (e) { var t = jQuery, n = function () { function e(e) { this._originalReader = e } return e.prototype.read = function (e) { e.items = null, this._originalReader && t.isFunction(this._originalReader.read) && this._originalReader.read(e), t.isArray(e.items) || (t.isArray(e.data) ? e.items = e.data : e.data && t.isArray(e.data.rows) ? e.items = e.data.rows : e.items = []); if (e.dynamic) if (!e.data || isNaN(e.data.totalRows)) throw "totalRows value is missing" }, e }(), r = function (r) { function i(e) { var i = this; r.call(this), this.dataSource = e, this.isRemote = !0, this.localPaging = !0, this._origLoaded = e.loaded, this._origReader = e.reader, e.loaded = function (e, n) { i._loaded(), t.isFunction(i._origLoaded) && i._origLoaded.apply(i, arguments) }, e.reader = new n(e.reader) } return __extends(i, r), i.prototype.dispose = function () { this.dataSource.loaded = this._origLoaded, this.dataSource.reader = this._origReader, r.prototype.dispose.call(this) }, i.prototype.getProperties = function () { return this.sourceArray && this.sourceArray.length ? this._getProps(this.sourceArray[0]) : [] }, i.prototype._loaded = function () { this.sourceArray = this.dataSource.items, this.dataSource.data && e.util.isNumeric(this.dataSource.data.totalRows) && this._totalItemCount(this.dataSource.data.totalRows); var t = r.prototype._localRefresh.call(this, !this.dataSource.dynamic); this._currentDeferred && t.then(this._currentDeferred.resolve) }, i.prototype._remoteRefresh = function () { this._currentDeferred && this._currentDeferred.state() === "pending" && this._currentDeferred.fail(), this._currentDeferred = t.Deferred(); var e = {}, n = !1; return this.dataSource.dynamic && (n = !0, e.data = this._prepareRequest(), this.dataSource.proxy && (this._origDataOption || (this._origDataOption = t.extend({}, this.dataSource.proxy.options.data)), this.dataSource.proxy.options.data = t.extend({}, this._origDataOption, e.data))), this.dataSource.load(e, n), this._currentDeferred }, i.prototype._prepareRequest = function () { return { filtering: this._prepareFilterRequest(), paging: this._preparePageRequest(), sorting: this._prepareSortRequest() } }, i.prototype._prepareFilterRequest = function () { var e = []; return this._shape._compiledFilter && this._shape._compiledFilter.normalized && t.each(this._shape._compiledFilter.normalized, function (t, n) { e.push({ dataKey: t, filterOperator: n.op.Name, filterValue: n.value }) }), e }, i.prototype._preparePageRequest = function () { return { pageIndex: this._shape.pageIndex(), pageSize: this._shape.pageSize() } }, i.prototype._prepareSortRequest = function () { return !this._shape._compiledSort || !this._shape._compiledSort.normalized || this._shape._compiledSort.normalized.length == 0 ? [] : t.map(this._shape._compiledSort.normalized, function (e) { return { dataKey: e.property, sortDirection: e.asc ? "ascending" : "descending" } }) }, i }(e.ArrayDataViewBase); e.registerDataViewFactory(function (e) { if (typeof wijdatasource == "function" && e instanceof wijdatasource) return new r(e); return }) })(e.data || (e.data = {})); var t = e.data })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; var t = jQuery, n = function (e) { function n() { e.apply(this, arguments) } return __extends(n, e), n.prototype._create = function () { window.wijmoApplyWijTouchUtilEvents && (t = window.wijmoApplyWijTouchUtilEvents(t)), this.element.addClass(this.options.wijCSS.widget + " wijmo-wijpager " + this.options.wijCSS.helperClearFix), this.options.disabled && this.disable(), this._refresh() }, n.prototype._destroy = function () { this.element.removeClass(this.options.wijCSS.widget + " wijmo-wijpager " + this.options.wijCSS.helperClearFix), this.$ul.remove() }, n.prototype._setOption = function (e, t) { this._super(e, t), this._refresh() }, n.prototype._refresh = function () { this._validate(), this.$ul && this.$ul.remove(), this.element.append(this.$ul = t('<ul class="ui-list ' + this.options.wijCSS.cornerAll + " " + this.options.wijCSS.content + " " + this.options.wijCSS.helperClearFix + '" role="tablist"></ul>')); switch ((this.options.mode || "").toLowerCase()) { case "nextprevious": this._createNextPrev(!1); break; case "nextpreviousfirstlast": this._createNextPrev(!0); break; case "numeric": this._createNumeric(!1); break; case "numericfirstlast": this._createNumeric(!0) } }, n.prototype._validate = function () { var e = this.options; if (isNaN(e.pageCount) || e.pageCount < 1) e.pageCount = 1; isNaN(e.pageIndex) || e.pageIndex < 0 ? e.pageIndex = 0 : e.pageIndex >= e.pageCount && (e.pageIndex = e.pageCount - 1); if (isNaN(e.pageButtonCount) || e.pageButtonCount < 1) e.pageButtonCount = 1 }, n.prototype._createNextPrev = function (e) { var t = this.options; e && t.pageIndex && this.$ul.append(this._createPagerItem(!1, t.firstPageText, 1, t.firstPageClass)), t.pageIndex && this.$ul.append(this._createPagerItem(!1, t.previousPageText, t.pageIndex, t.previousPageClass)), t.pageIndex + 1 < t.pageCount && this.$ul.append(this._createPagerItem(!1, t.nextPageText, t.pageIndex + 2, t.nextPageClass)), e && t.pageIndex + 1 < t.pageCount && this.$ul.append(this._createPagerItem(!1, t.lastPageText, t.pageCount, t.lastPageClass)) }, n.prototype._createNumeric = function (e) { var t = this.options, n = t.pageIndex + 1, r = 1, i = Math.min(t.pageCount, t.pageButtonCount), s; n > i && (r = Math.floor(t.pageIndex / t.pageButtonCount) * t.pageButtonCount + 1, i = r + t.pageButtonCount - 1, i = Math.min(i, t.pageCount), i - r + 1 < t.pageButtonCount && (r = Math.max(1, i - t.pageButtonCount + 1))), r !== 1 && (e && this.$ul.append(this._createPagerItem(!1, t.firstPageText, 1, t.firstPageClass)), this.$ul.append(this._createPagerItem(!1, "...", r - 1, ""))); for (s = r; s <= i; s++) this.$ul.append(this._createPagerItem(s === n, s.toString(), s, "")); t.pageCount > i && (this.$ul.append(this._createPagerItem(!1, "...", i + 1, "")), e && this.$ul.append(this._createPagerItem(!1, t.lastPageText, t.pageCount, t.lastPageClass))) }, n.prototype._createPagerItem = function (e, n, r, i) { var s, o = this.options.wijCSS, u = this, a = t("<li />").addClass("wijmo-wijpager-button " + o.cornerAll).attr({ role: "tab", "aria-label": n, title: n }); return e ? a.addClass(o.stateActive).attr("aria-selected", "true") : a.addClass(o.stateDefault).hover(function () { u.options.disabled || t(this).removeClass(o.stateDefault).addClass(o.stateHover) }, function () { u.options.disabled || t(this).removeClass(o.stateHover).addClass(o.stateDefault) }).bind("click." + this.widgetName, { newPageIndex: r - 1 }, t.proxy(this._onClick, this)), e ? s = t("<span />") : s = i ? t("<span />").addClass(o.icon + " " + i) : t("<a/>").attr("href", "#"), s.text(n), a.append(s), a }, n.prototype._onClick = function (e) { if (this.options.disabled) return !1; var t = { newPageIndex: e.data.newPageIndex, handled: !1 }; if (this._trigger("pageIndexChanging", null, t) !== !1 && this.options.pageIndex !== t.newPageIndex) { this.options.pageIndex = t.newPageIndex, t.handled || this._refresh(); var n = { newPageIndex: t.newPageIndex }; this._trigger("pageIndexChanged", null, n) } return !1 }, n }(e.wijmoWidget); e.wijpager = n, n.prototype.widgetEventPrefix = "wijpager"; var r = function () { function e() { this.wijMobileCSS = { header: "ui-header ui-bar-a", content: "ui-body-c", stateDefault: "ui-btn-up-c", stateHover: "ui-btn-down-b", stateActive: "ui-btn-down-c" }, this.firstPageClass = t.wijmo.widget.prototype.options.wijCSS.iconSeekFirst, this.firstPageText = "First", this.lastPageClass = t.wijmo.widget.prototype.options.wijCSS.iconSeekEnd, this.lastPageText = "Last", this.mode = "numeric", this.nextPageClass = t.wijmo.widget.prototype.options.wijCSS.iconSeekNext, this.nextPageText = "Next", this.pageButtonCount = 10, this.previousPageClass = t.wijmo.widget.prototype.options.wijCSS.iconSeekPrev, this.previousPageText = "Previous", this.pageCount = 1, this.pageIndex = 0, this.pageIndexChanging = null, this.pageIndexChanged = null } return e }(); n.prototype.options = t.extend(!0, {}, e.wijmoWidget.prototype.options, new r), t.wijmo.registerWidget("wijpager", n.prototype) })(wijmo || (wijmo = {})); var wijmo; (function (e) { })(wijmo || (wijmo = {}));;
(function (e) { "use strict"; e.fn.extend({ wijtextselection: function () { var t, n, r = this[0], i = this.val(); if (arguments.length === 0) { var s, o, u, a; if (e.browser.msie && e.browser.version < 9) try { var f = document.selection; r.tagName.toLowerCase() != "textarea" ? (s = f.createRange().duplicate(), s.moveEnd("character", i.length), u = s.text === "" ? i.length : i.lastIndexOf(s.text), s = f.createRange().duplicate(), s.moveStart("character", -i.length), a = s.text.length) : (s = f.createRange(), o = s.duplicate(), o.moveToElementText(r), o.setEndPoint("EndToEnd", s), u = o.text.length - s.text.length, a = u + s.text.length) } catch (a) { } else u = r.selectionStart, a = r.selectionEnd; var l = i.substring(u, a); return { start: u, end: a, text: l, replace: function (e) { return i.substring(0, u) + e + i.substring(a, i.length) } } } if (arguments.length === 1) { if (typeof arguments[0] == "object" && typeof arguments[0].start == "number" && typeof arguments[0].end == "number") t = arguments[0].start, n = arguments[0].end; else if (typeof arguments[0] == "string") (t = i.indexOf(arguments[0])) > -1 && (n = t + arguments[0].length); else if (Object.prototype.toString.call(arguments[0]) === "[object RegExp]") { var c = arguments[0].exec(i); c != null && (t = c.index, n = t + c[0].length) } } else arguments.length === 2 && typeof arguments[0] == "number" && typeof arguments[1] == "number" && (t = arguments[0], n = arguments[1]); typeof t == "undefined" && (t = 0, n = i.length); if (e.browser.msie) { var h = r.createTextRange(); h.collapse(!0), h.moveStart("character", t), h.moveEnd("character", n - t), h.select() } else r.selectionStart = t, r.selectionEnd = n } }) })(jQuery);;
(function (e) { "use strict"; var t, n, r; t = function (e) { var t = this; t.data = {}, t.reader = null, t.proxy = null, t.items = [], t.loading = null, t.loaded = null, t._constructor(e) }, window.wijdatasource = t, e.extend(t.prototype, { _constructor: function (t) { e.extend(this, t) }, load: function (t, n) { var r = this, i = r.proxy; if (e.isFunction(r.loading) && r.loading(r, t) === !1) return; i ? i.request(r, r.loaded, t) : ((r.items.length === 0 || n) && this.read(), e.isFunction(r.loaded) && r.loaded(r, t)) }, read: function () { var e = this, t = e.data; t && e.reader ? e.reader.read(e) : e.items = e.data } }), n = function (t) { e.isFunction(window.wijmoASPNetParseOptions) && wijmoASPNetParseOptions(t), e.isArray(t) && (this.fields = t) }, window.wijarrayreader = n, e.extend(n.prototype, { read: function (t) { e.isArray(t.data) ? t.items = this._map(t.data) : t.items = [] }, _map: function (t) { var n = this, r = []; return n.fields === undefined || n.fields.length === 0 ? (e.extend(!0, r, t), r) : (e.each(t, function (t, i) { var s = {}; e.each(n.fields, function (t, n) { n.mapping && typeof n.mapping && window[n.mapping] && (n.mapping = window[n.mapping]); if (e.isFunction(n.mapping)) return s[n.name] = n.mapping(i), !0; var r = n.mapping !== undefined ? n.mapping : n.name, o = i[r]; o === undefined && (n.defaultValue !== undefined ? o = n.defaultValue : o = i), s[n.name] = o }), r.push(s) }), r) } }), r = function (t) { this.options = t, e.isFunction(window.wijmoASPNetParseOptions) && wijmoASPNetParseOptions(t) }, window.wijhttpproxy = r, e.extend(r.prototype, { request: function (t, n, r) { var i = this, s = e.extend({}, this.options), o = s.success; s.success = function (u) { e.isFunction(o) && o(u), i._complete(u, t, n, s, r) }, e.ajax(s) }, _complete: function (t, n, r, i, s) { n.data = i.key !== undefined ? t[i.key] : t, n.read(), e.isFunction(r) && r(n, s) } }) })(jQuery);;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; var t = jQuery, n = "wijcombobox", r = "wijmo-wijcombobox-input", i = function (e) { function n() { e.apply(this, arguments) } return __extends(n, e), n.prototype._create = function () { var e = this, n; e.selectedItem = null, e.selectedItems = [], n = document.activeElement, window.wijmoApplyWijTouchUtilEvents && (t = window.wijmoApplyWijTouchUtilEvents(t)), e._initInnerData(), e._createDOMElements(), e._bindInputEvents(), e._initDropDownList(), e.repaint(), e._checkSelectIndex(), e._usingRemoteData() && e.options.data && (e.originalDataSourceLoaded = e.options.data.loaded), n === e._input[0] && e.options.isEditable && t(function () { e._input.focus() }), e.element.is(":hidden") && e.element.wijAddVisibilityObserver && e.element.wijAddVisibilityObserver(function () { e.repaint(), e.element.wijRemoveVisibilityObserver && e.element.wijRemoveVisibilityObserver() }, "wijcombobox") }, n.prototype._initInnerData = function () { var e = this, t = e.options, n; t.datasource !== null && (n = e._isBind(), n ? e.innerData = e._getMappingItems() : e.innerData = t.data), e.listHasCreated = !1 }, n.prototype._checkSelectIndex = function () { var e = this, n, r = e.options, i = e.innerData; r.selectedIndex === -1 && r.selectedValue && t.each(i, function (t, n) { if (i[t].value === r.selectedValue) return e.options.selectedIndex = t, !1 }), n = r.selectedIndex, !e._usingRemoteData() && (n >= 0 || t.isArray(n)) && e.search(null, "checkindex"), r.selectedIndex === -1 && r.text && (!r.forceSelectionText || r.forceSelectionText && e._checkTextInItems(r.text) !== -1) && e._input.val(r.text) }, n.prototype.repaint = function () { var e = this.options, t = this; if (t.element.is(":visible") || t._comboDiv || t._select !== undefined && t._input.is(":visible")) { t._showTrigger(); if (e.disabledState) { var n = e.disabled; t.disable(), e.disabled = n } return e.disabled && t.disable(), !0 } return !1 }, n.prototype._bindInputEvents = function () { var e = this, n = this.options.wijCSS, r, i, s, o, u; r = e._input, i = e.options, r.bind("keydown.wijcombobox", function (n) { if (i.disabledState === !0 || i.disabled) return; s = n.keyCode, o = e._getKeyCodeEnum(); switch (s) { case o.UP: e._move("previous", n), n.preventDefault(); break; case o.DOWN: e._move("next", n), n.preventDefault(); break; case o.ENTER: e.menu.active && (n.preventDefault(), i.selectionMode === "multiple" && e.menu && e.menu.items && e.menu.items.length === 1 && t.each(e.selectedItems, function (t, n) { n !== e.menu.items[0] && (n.selected = !1) }), e.menu.select(n)), n.preventDefault(); break; case o.TAB: r.trigger("wijcomboblur"); if (!e.menu.active || i.selectionMode === "multiple" && o.TAB === s) return; e.menu.select(n); var u = r.val().length; e._selectText(u, u, r); break; case o.ESCAPE: e.close(n, undefined); break; case o.LEFT: case o.RIGHT: case o.SHIFT: case 16: case 17: case o.CONTROL: case o.HOME: case o.END: case o.DELETE: case o.PAGE_UP: case o.PAGE_DOWN: break; case 18: r.trigger("wijcomboblur"); break; default: window.clearTimeout(e.searching), i.isEditable === !1 && (e._cacheKey === undefined && (e._cacheKey = ""), e._cacheKey += String.fromCharCode(s)), e.searching = window.setTimeout(function () { var t; i.isEditable === !1 ? (t = e._cacheKey, e._cacheKey = undefined) : t = r.val(), e.search(t, n) }, i.delay) } }).bind("wijcomboblur.wijcombobox", function (t) { window.clearTimeout(e.searching), e._addInputFocus(!1, n.stateFocus), e.closing = window.setTimeout(function () { e.close(t, !0) }, 150) }).bind("focus.wijcombobox", function () { e._addInputFocus(!0, n.stateFocus) }).bind("blur.wijcombobox", function () { e.menu.element.is(":visible") || r.trigger("wijcomboblur"), u = r.val(), i.text !== u && e._trigger("textChanged", null, { oldText: i.text, newText: u }), e._change() }) }, n.prototype._addInputFocus = function (e, t) { var n = this, r, i, s; r = n._input.parent(), i = e ? "addClass" : "removeClass", s = n._triggerArrow, r[i](t), s !== undefined && s[i](t) }, n.prototype._renderColumnsHeader = function (e) { var n = this, r = t("<ul class='wijmo-wijcombobox-rowheader'></ul>"); t.each(this.options.columns, function (e, i) { var s = t("<li class='wijmo-wijcombobox-cell " + n.options.wijCSS.header + "'></li>"); s.html(i.name), i.width !== undefined && s.width(i.width), s.appendTo(r) }), e.append(r) }, n.prototype._hasSameValueText = function (e, t) { return e.label === t.label && e.value === t.value }, n.prototype._initDropDownList = function () { var e = this, n, r, i, s, o, u = this.options.wijCSS, a = parseInt(e._input.css("zIndex"), 10), f; n = e.element[0].ownerDocument, isNaN(a) && (a = 0), e._comboDiv ? r = e._oriList : r = t("<div class='wijmo-wijcombobox-list'></div>"), i = e.options, i.columns.length > 0 && (r.addClass("wijmo-wijcombobox-multicolumn"), s = t("<div class='wijmo-wijsuperpanel-header " + u.stateDefault + "'></div>"), e._renderColumnsHeader(s), r.append(s)), o = { keepHightlightOnMouseLeave: !0, selectionMode: i.selectionMode, addHoverItemClass: i.columns.length === 0, focus: function (t, n) { var r = n; i.selectOnItemFocus && e.menu.select(null, { notCloseAfterSelected: !0 }), i.columns.length > 0 && r.element && (r.element.prev().addClass("wijmo-wijcombobox-active-prev"), r.element.find(".wijmo-wijcombobox-row>.wijmo-wijcombobox-cell").addClass(u.stateHover)) }, selected: function (n, r) { window.clearTimeout(e.closing); var s = i.selectionMode, o, u, a = !1, f, l, c; o = r.item; if (e._trigger("select", n, o)) if (s === "single") { if (!e._usingRemoteData()) { u = t.inArray(o, e.items), u === undefined && (u = r.selectedIndex); if (u !== i.selectedIndex) { l = i.selectedIndex, c = e.selectedItem, a = e._triggerSelectedIndexChanging(c, o, l, u); if (a) return; e._setInputText(o.label), c !== null && (c.selected = !1), e.selectedItem = o, i.selectedIndex = u, i.selectedValue = e.selectedItem.value, e._select !== undefined && (e._select[0].selectedIndex = i.selectedIndex, e._select.trigger("change")), i.inputTextInDropDownList = !0, i.text = e._input.val(), c && c.element && c.element.removeClass("wijmo-wijcombobox-selecteditem"), e._trigger("changed", null, { oldItem: c, selectedItem: e.selectedItem, newIndex: i.selectedIndex, oldIndex: l }), e._triggerSelectedIndexChanged(c, e.selectedItem, l, i.selectedIndex) } else e.selectedItem && e._input.val() !== e.selectedItem.label && (r.data === undefined || !r.data.notCloseAfterSelected) && e._input.val(o.label) } else if (e.selectedItem === null || !e._hasSameValueText(o, e.selectedItem)) { c = e.selectedItem, l = i.selectedIndex, a = e._triggerSelectedIndexChanging(c, o, l, r.selectedIndex); if (a) return; e._setInputText(o.label), i.text = e._input.val(), e.selectedItem = o, u = t.inArray(o, e.items), u === undefined && (u = r.selectedIndex), u !== i.selectedIndex && (i.selectedIndex = u, i.selectedValue = e.selectedItem.value), i.inputTextInDropDownList = !0, e._trigger("changed", null, { selectedItem: o }), e._triggerSelectedIndexChanged(c, o, l, i.selectedIndex) } } else if (!e._usingRemoteData()) { a = e._triggerSelectedIndexChanging(null, o, l, r.selectedIndex); if (a) return; e.selectedItems = r.selectedItems, e._selectedItemsToInputVal(e.selectedItems), i.inputTextInDropDownList = !0, i.selectedIndex = r.selectedIndex, e._trigger("changed", null, { selectedItem: o, selectedItems: e.selectedItems }), e._triggerSelectedIndexChanged(null, o, null, i.selectedIndex) } (r.data === undefined || !r.data.notCloseAfterSelected) && s === "single" && (e.close(n), e._input.focus()) }, blur: function (e, t) { var n = t.element; i.columns.length > 0 && n && (n.find(".wijmo-wijcombobox-row>.wijmo-wijcombobox-cell").removeClass(u.stateHover), n.prev().removeClass("wijmo-wijcombobox-active-prev")) }, itemRendering: function (e, t) { var n = t, r; r = "", n.isSeparator && (r += " wijmo-wijcombobox-separator"), n.selected && (r += " wijmo-wijcombobox-selecteditem"), r.length > 0 && n.element.addClass(r) }, itemRendered: function (e, n) { var r = n, s, o; if (r.cells === undefined) return; s = r.element, s.empty(), o = t("<ul class='wijmo-wijcombobox-row'></ul>"), t.each(r.cells, function (e, n) { var r = t("<li class='wijmo-wijcombobox-cell " + u.stateDefault + "'></li>"); i.columns && i.columns.length > e && typeof i.columns[e].width != "undefined" && r.width(i.columns[e].width), r.append(n), r.attr("title", n), o.append(r) }), s.append(o) }, superPanelOptions: { resized: function (t) { var n = e.menu, r = n.element; i.dropdownWidth = r.outerWidth(), i.dropdownHeight = r.outerHeight(), e._positionList(), e.menu.refreshSuperPanel() } } }, o = t.extend(!0, o, i.listOptions), f = i.ensureDropDownOnBody ? t("body") : e._comboElement, e.menu = r.appendTo(f, n).wijlist(o).css({ zIndex: a + 1, top: 0, left: 0 }).hide().data("wijmoWijlist"), e._createDropDownList(), e._menuUL = e.menu.ul }, n.prototype._setInputText = function (e, t) { var n = this, r = n._input.val(); n._input.val(e), r !== e && n._trigger("textChanged", null, { oldText: r, newText: e }) }, n.prototype._triggerSelectedIndexChanged = function (e, n, r, i) { var s = this.options, o; s.selectionMode === "single" ? this._trigger("selectedIndexChanged", null, { oldItem: e, selectedItem: n, newIndex: i, oldIndex: r }) : (o = t.inArray(n, this.items), this._trigger("selectedIndexChanged", null, { selectedItem: n, selectedIndex: o, selectedItems: this.selectedItems })) }, n.prototype._triggerSelectedIndexChanging = function (e, n, r, i) { var s = this.options, o, u, a = !0; return s.selectionMode === "single" ? (u = { oldItem: e, selectedItem: n, newIndex: i, oldIndex: r }, a = this._trigger("selectedIndexChanging", null, u)) : (o = t.inArray(n, this.items), u = { selectedItem: n, selectedIndex: o, selectedItems: this.selectedItems }, a = this._trigger("selectedIndexChanging", null, u)), a || (n.selected = !1, n.element && n.element.removeClass("wijmo-wijcombobox-selecteditem")), !a }, n.prototype._createDropDownList = function (e) { var n = this, r, i = n.options, s = e; s || (s = n.innerData), s === null ? r = null : r = t.isArray(s) ? s : s.items, n._comboDiv ? !n.listHasCreated && r && r.length > 0 && (n.menu.setTemplateItems(i.data), n.menu.renderList(), n.listHasCreated = !0) : !n.listHasCreated && r && r.length > 0 && (n.menu.setItems(r), n.menu.renderList(), n.listHasCreated = !0) }, n.prototype._getSelectedItemsText = function (e) { var n = "", r, i; return r = this, i = r.options.multipleSelectionSeparator, r.selectedItems = e, t.each(e, function (e, t) { t && (n += t.label + i) }), n.length > 0 && (n = n.substr(0, n.lastIndexOf(i))), n }, n.prototype._selectedItemsToInputVal = function (e) { var t = this; t._setInputText(t._getSelectedItemsText(e)), t.options.text = t._input.val() }, n.prototype._createDOMElements = function () { var e = this, n, i = this.options.wijCSS, s, o, u; u = t("<div class='wijmo-wijcombobox-wrapper " + i.stateDefault + " " + i.cornerAll + "'>" + "</div>"), s = e.element, s.is("select") ? (n = t("<div role='combobox' class='wijmo-wijcombobox " + i.widget + " " + i.helperClearFix + "'>" + "</div>"), n.append(u), e._comboElement = n, e._select = s, s.addClass(i.widget), o = e._input = t("<input role='textbox' aria-autocomplete='list' aria-haspopup='true' />").insertAfter(s), e.options.data || (e.options.data = e._convertSelectOptions(), e._initInnerData())) : s.is("div") && t(s.children()[0]).is("input[type='text']") && t(s.children()[1]).is("div") ? (e._comboElement = e._comboDiv = n = s, e._oriList = t(s.children()[1]), o = e._input = t(s.children()[0]), u.prependTo(n).append(o), s.addClass("wijmo-wijcombobox " + i.widget + " " + i.helperClearFix), s.attr("role", "combobox")) : (n = t("<div role='combobox' class='wijmo-wijcombobox " + i.widget + " " + i.helperClearFix + "'>" + "</div>"), n.append(u), e._comboElement = n, o = e._input = s), e._comboDiv || (n.insertBefore(o), e.element.is(":visible") && o.width(o.width()), n.children(".wijmo-wijcombobox-wrapper").append(o)), s.attr("title") && e._comboElement.attr("title", s.attr("title")), o.attr({ autocomplete: "off", role: "textbox", "aria-wijcombobox": "list", "aria-haspopup": "true" }).addClass(r), e._oldWidth = s.css("width"), e.options.isEditable === !1 && (o.attr("readonly", "readonly"), u.bind("click", function () { if (e.options.disabledState === !0 || e.options.disabled) return; e._triggerClick() })), (e.options.disabledState === !0 || e.options.disabled === !0) && o.attr("disabled", "disabled"), n.bind("mouseenter", function () { if (e.options.disabledState === !0 || e.options.disabled) return; e._addInputFocus(!0, i.stateHover) }).bind("mouseleave", function () { e._addInputFocus(!1, i.stateHover) }) }, n.prototype._convertSelectOptions = function () { var e = [], n, r; return n = this, r = n._select.get(0).options, t.each(r, function (t, n) { e.push({ label: n.text, value: n.value }) }), n.options.selectedIndex === -1 && n.options.selectedValue === null && n.options.text === null && (n.options.selectedIndex = n._select[0].selectedIndex), e }, n.prototype.getComboElement = function () { return this._comboElement }, n.prototype._showTrigger = function () { var e = this, n, r, i, s, o = this.options.wijCSS, u, a = 0, f, l, c, h, p, d, v = "<label class='wijmo-wijcombobox-label " + o.content + "'></label>", m = "<div class='wijmo-wijcombobox-trigger " + o.stateDefault + " " + o.cornerRight + "'>" + "<span class='" + o.icon + " " + o.iconArrowDown + "'></span>" + "</div>"; n = e.options, r = e._input, i = r.parent(), s = e._comboElement, f = e._triggerArrow, l = e._label, e._select !== undefined && (t.browser.msie ? (u = e._select.clone(), e._select.after(u), a = u.width(), u.remove()) : a = e._select.width(), r.width(a + (e.innerData.length > 20 ? n.selectElementWidthFix : 0)), e._select.hide()), r.css("margin-left", ""), r.css("margin-right", ""), s.width(i[0].offsetWidth), n.labelText !== null ? (l = e._label = t(v), i.append(l.html(n.labelText))) : l !== undefined && (l.remove(), e._label = undefined), n.showTrigger ? (r.removeClass(o.cornerAll), f === undefined && (f = e._triggerArrow = t(m), s.append(f), f.bind("mouseover.triggerevent", e, function (e) { if (n.disabledState === !0 || n.disabled) return; var r = t(e.currentTarget); r.addClass(o.stateHover) }).bind("mousedown.triggerevent", e, function (e) { if (n.disabledState === !0 || n.disabled) return; var r = t(e.currentTarget); r.addClass(o.stateActive) }).bind("mouseup.triggerevent", e, function (e) { var n = t(e.currentTarget); n.removeClass(o.stateActive) }).bind("click.triggerevent", e, function () { if (n.disabledState === !0 || n.disabled) return; e._triggerClick() })), n.triggerPosition === "right" ? (f.css({ left: "", right: "0px" }), f.removeClass(o.cornerLeft), f.addClass(o.cornerRight)) : (f.css({ right: "", left: "0px" }), f.removeClass(o.cornerRight), f.addClass(o.cornerLeft)), f.setOutHeight(s.innerHeight()), c = f.find("span"), c.css("margin-left", (f.innerWidth() - c[0].offsetWidth) / 2), c.css("margin-top", (f.innerHeight() - c[0].offsetHeight) / 2)) : (f !== undefined && (f.unbind(".triggerevent"), f.remove(), e._triggerArrow = undefined), r.removeClass(o.cornerLeft), r.removeClass(o.cornerRight), r.addClass(o.cornerAll)), h = p = d = 0, l !== undefined && (p += l[0].offsetWidth), f !== undefined && (d = f[0].offsetWidth), h = p + d, r.setOutWidth(i.innerWidth() - h), h = h === 0 ? "" : h, n.triggerPosition === "right" ? (r.css("margin-left", ""), r.css("margin-right", h), l !== undefined && (l.css("left", ""), l.css("right", d))) : (r.css("margin-right", ""), r.css("margin-left", h), l !== undefined && (l.css("right", ""), l.css("left", d))) }, n.prototype._triggerClick = function (e) { var t = this, n = ""; window.clearTimeout(t.closing), t.menu.element.is(":visible") ? t.close() : (t._usingRemoteData() && (n = t._input.val()), t.search(n, e)) }, n.prototype.destroy = function () { var e = this, n = this.options.wijCSS, i = e.element; e.options.isEditable === !1 && i.removeAttr("readonly"), e._select !== undefined ? (e._select.removeClass(n.widget), e._select.show(), e._input.remove()) : e._comboDiv ? (e._comboDiv.removeClass("wijmo-wijcombobox " + n.widget + " " + n.helperClearFix), e._comboDiv.removeAttr("role"), e._input.insertBefore(e._comboDiv), e._comboDiv.children(".wijmo-wijcombobox-wrapper").remove()) : (i.css("width", e._oldWidth), i.removeClass(r), i.removeAttr("autocomplete").removeAttr("role").removeAttr("aria-wijcombobox").removeAttr("aria-haspopup"), i.insertBefore(e._comboElement), i.css("padding", "")), e._comboElement.remove(), e.menu.destroy(), e.menu.element.remove(), t.wijmo.widget.prototype.destroy.call(e) }, n.prototype._setOption = function (e, n) { var r = this, i, s, o, u, a, f = this.options.wijCSS, l = r._label, c, h, p, d = null, v = 0, m = "<label class='wijmo-wijcombobox-label " + f.content + "'></label>", g = r.options; i = r._comboElement, s = r.element, u = s.parent(), h = g.selectedIndex, r._triggerArrow && (v = r._triggerArrow.outerWidth()), t.wijmo.widget.prototype._setOption.apply(r, arguments); if (e === "disabled") n ? (i.addClass("wijmo-wijcombobox-disabled " + f.stateDisabled), r._input.attr("disabled", "disabled"), r._comboDiv && r._input.addClass("wijmo-wijcombobox-disabled " + f.stateDisabled).attr("disabled", "disabled"), r._triggerArrow && r._triggerArrow.unbind("click.triggerevent"), r.close()) : (i.removeClass("wijmo-wijcombobox-disabled " + f.stateDisabled), r._input.removeAttr("disabled"), r._comboDiv && r._input.removeClass("wijmo-wijcombobox-disabled " + f.stateDisabled).removeAttr("disabled"), r._triggerArrow && r._triggerArrow.bind("click.triggerevent", r, function () { if (g.disabledState === !0) return; r._triggerClick() })); else if (e === "labelText") g.labelText !== null ? (l = r._label = t(m), r._input.parent().append(l.html(g.labelText)), r._triggerArrow !== undefined && (c = r._triggerArrow[0].offsetWidth), g.triggerPosition === "right" ? l !== undefined && (l.css("left", ""), l.css("right", c)) : l !== undefined && (l.css("right", ""), l.css("left", c)), r.repaint()) : l !== undefined && (l.remove(), r._label = undefined); else if (e === "showTrigger") r._showTrigger(), !g.showTrigger && r.element.is("select") && s.width(s.width() + v); else if (e === "triggerPosition") s.width(s.width() + v), r._showTrigger(); else if (e === "selectionMode") r.menu._setOption("selectionMode", n); else if (e === "isEditable") n ? (r._input.removeAttr("readonly"), t(".wijmo-wijcombobox-wrapper", r._comboElement[0]).bind("click", function () { r._triggerClick() })) : (r._input.attr("readonly", "readonly"), t(".wijmo-wijcombobox-wrapper", r._comboElement[0]).unbind("click")); else if (e === "data" || e === "dataSource") { r._initInnerData(), r._setSelectedIndex(g.selectedIndex); if (t.isArray(r.innerData)) r.listHasCreated = !1, r._createDropDownList(); else try { r.innerData.loaded = function (e, n) { e === null ? r.items = null : r.items = t.isArray(e) ? e : e.items, r.listHasCreated = !1, r._createDropDownList() }, r.innerData.load(null) } catch (y) { } g.selectedIndex !== -1 && (d = o ? o[h] : null, o = r.innerData, r._trigger("changed", null, { oldItem: d, selectedItem: r.selectedItem, newIndex: g.selectedIndex, oldIndex: h }), r._triggerSelectedIndexChanged(d, r.selectedItem, h, g.selectedIndex)), r._keypress = !1 } else if (e === "selectedIndex") { if (n === h) return; r.selectedItem = null, r.innerData === null ? o = null : o = t.isArray(r.innerData) ? r.innerData : r.innerData.items, d = o ? o[h] : null; if (n > -1) { o && o[n] !== null && (p = o[n]), a = r._triggerSelectedIndexChanging(d, p, h, n); if (a) { g.selectedIndex = h; return } h !== null && h !== -1 && h !== undefined && d && (d.selected = !1, d.element && d.element.removeClass("wijmo-wijcombobox-selecteditem")), o && o[n] !== null && (r.selectedItem = o[n], r.selectedItem && (r.selectedItem.selected = !0, r._setInputText(r.selectedItem.label), g.selectedValue = r.selectedItem.value, g.inputTextInDropDownList = !0, g.text = r._input.val())) } else if (n <= -1 || !n) { a = r._triggerSelectedIndexChanging(d, null, h, n); if (a) { g.selectedIndex = h; return } g.inputTextInDropDownList = !1, r._clearSelection() } r._trigger("changed", null, { oldItem: d, selectedItem: r.selectedItem, newIndex: g.selectedIndex, oldIndex: h }), r._triggerSelectedIndexChanged(d, r.selectedItem, h, g.selectedIndex) } else if (e === "selectedValue") n ? (r.selectedItem && r.selectedItem.selected !== undefined && (r.selectedItem.selected = !1), o = r.items, o || (o = r.innerData), t.each(o, function (e, t) { if (o[e].value === n) return r.selectedItem = o[e], r.selectedItem.selected = !0, r._setInputText(r.selectedItem.label), r.options.selectedIndex = e, g.inputTextInDropDownList = !0, g.text = r._input.val(), !1 })) : (g.inputTextInDropDownList = !1, r._clearSelection()); else if (e === "text") { if (g.forceSelectionText && r._checkTextInItems(n) === -1) return; r._setInputText(n) } }, n.prototype._setSelectedIndex = function (e) { var n = this, r = n.options; if (e === null || e === undefined) return; e === -1 ? (n.selectedItem = null, r.selectedIndex = -1, r.selectedValue = null, r.text ? n._input.val(r.text) : n._input.val("")) : n.innerData && n.innerData[e] !== null && n.innerData[e] !== undefined ? (n.innerData[e].selected = !0, n._input.val(n.innerData[e].label), n.selectedItem = n.innerData[e]) : n.innerData && t.isArray(n.innerData) && e > n.innerData.length - 1 && (r.selectedIndex = -1, n._input.val("")), r.text = n._input.val() }, n.prototype.search = function (e, n) { var r = this, i, s, o, u; i = r.options, s = r.innerData, window.clearTimeout(r.closing), o = { value: e, e: n, self: r }; if (s !== null || r._comboDiv) { u = r._isBind(); if (n !== "checkindex" && r._trigger("search", n, { datasrc: s, term: o }) === !1) return; if (t.isArray(s) || u || r._comboDiv) r._hideShowArrow(!1), r._onListLoaded(s, o); else { if (!u && t.isArray(i.dataSource)) return; if (r._usingRemoteData() && n !== undefined && e.length < i.minLength) return; r._hideShowArrow(!1), s.loaded = function (e, t) { r.listHasCreated = !1, r._createDropDownList(e), r._onListLoaded(e, t), r.originalDataSourceLoaded && r.originalDataSourceLoaded(e, t) }, s.load(o) } } }, n.prototype.getSelectedItems = function () { var e = this.options; return e.selectionMode === "single" ? this.selectedItem : this.selectedItems }, n.prototype._isBind = function () { var e = this.options, t = e.data; return t !== null && t.label && t.label.bind ? !0 : !1 }, n.prototype._getMappingItems = function () { var e = this.options, n = e.dataSource, r = e.data, i, s, o; return !n || !r ? null : !r.label || !r.label.bind || !r.value || !r.value.bind ? null : (s = r.label.bind, o = r.value.bind, n && n.length !== 0 ? (i = [], t.each(n, function (e, t) { i.push({ label: t[s], value: t[o] }) }), i) : null) }, n.prototype._clearSelection = function () { var e = this, n = e.options; n.selectionMode === "single" ? (e.selectedItem !== null && (e.selectedItem.selected = !1), e.selectedItem = null) : e.selectedItems && (t.each(e.selectedItems, function (e, t) { t.selected && (t.selected = !1) }), e.selectedItem = null, e.selectedItems = null), n.selectedValue = null, e._setInputText(""), n.text = e._input.val() }, n.prototype._usingRemoteData = function () { var e = this.options.data, n = !1; return !t.isArray(e) && e !== null && e.proxy && (n = !0), n }, n.prototype._hideShowArrow = function (e) { var t = this, n, r; n = t.element, r = t._triggerArrow, r !== undefined && r[e ? "show" : "hide"](), n[e ? "removeClass" : "addClass"]("wijmo-wijcombobox-loading") }, n.prototype._onListLoaded = function (e, n) { var r = n.self, i, s, o = this.options.wijCSS, u, a, f, l; i = r._input, s = r.options, u = n.value, e === null ? a = null : a = t.isArray(e) ? e : e.items, r.items = a; if (n.e === "checkindex") { f = s.selectedIndex, s.selectionMode === "multiple" && t.isArray(f) ? (t.each(f, function (e, t) { var n = a[t]; n.selected = !0, r.selectedItems.push(n) }), r._selectedItemsToInputVal(r.selectedItems)) : (a[f].selected = !0, r.selectedItem = a[f], i.val(r.selectedItem.label)), r._hideShowArrow(!0); return } !r._usingRemoteData() && a ? l = a : (r._topHit = null, l = a), l && l.length > 0 || r._comboDiv ? (r._openlist(l, n, u), r._addInputFocus(!0, o.stateFocus)) : r.close(null, !0), r._hideShowArrow(!0) }, n.prototype.close = function (e, n) { var r = this, i, s = this.options.wijCSS, o, u; i = r.menu, r._dropDownHeight = i.element.outerHeight(), r._dropDownWidth = i.element.outerWidth(), window.clearTimeout(r.closing), i.element.is(":visible") && !i.element.is(":animated") && !i.element.parent().is(":animated") && (r._trigger("close", e), i.deactivate(), o = r.options.hidingAnimation, o && (o.effect === "size" || o.animated === "size") && (o.options = t.extend({ to: { width: 0, height: 0 } }, o.options)), u = i.element.attr("style"), n !== !0 && o ? i.element.hide(o.effect || o.animated, o.options, o.speed || o.duration, function () { i.element.removeAttr("style").attr("style", u).hide(), o.callback && o.callback.apply(this, arguments) }) : i.element.hide(), r._addInputFocus(!1, s.stateFocus), t(document).unbind("mouseup", r.closeOnClick)) }, n.prototype._getKeyCodeEnum = function () { if (t.ui && t.ui.keyCode) return t.ui.keyCode; if (t.mobile && t.mobile.keyCode) return t.mobile.keyCode; throw "keyCode object is not found" }, n.prototype._change = function () { var e = this, t, n, r, i, s, o, u, a, f, l = -1; t = e.options, n = t.forceSelectionText, r = t.selectionMode, i = e._input, s = i.val(), o = e.selectedItem, u = e.selectedItems, a = t.selectedIndex ? t.selectedIndex : -1, f = e.innerData, n ? r === "single" && (o !== null ? o.label !== s && i.val(o.label) : i.val("")) : r === "single" && (!o && s !== "" || o !== null && o.label !== s) && (e.selectedItem !== null && (e.selectedItem.selected = !1), l = e._checkTextInItems(s), l === -1 ? (e.selectedItem = null, t.selectedIndex = -1, t.selectedValue = null, t.inputTextInDropDownList = !1) : f && (e.selectedItem = f[l], t.selectedIndex = l, t.selectedValue = e.selectedItem.value, t.inputTextInDropDownList = !0), t.text = e._input.val(), e._trigger("changed", null, { oldItem: o, selectedItem: e.selectedItem, newIndex: t.selectedIndex, oldIndex: a }), a !== l && e._triggerSelectedIndexChanged(o, e.selectedItem, a, t.selectedIndex)); if (r === "multiple") { if (!e.selectedItems || e.selectedItems.length === 0) u = [o]; e._selectedItemsToInputVal(u) } }, n.prototype._checkTextInItems = function (e) { var n = this, r = -1, i = n.innerData; return e && t.each(i, function (t, n) { if (i[t] && i[t].label && i[t].label === e) return r = t, !1 }), r }, n.prototype._openlist = function (e, n, r) { var i = n.self, s = n.e, o, u, a, f, l, c = 2, h = 0, p, d, v, m, g, y, b = t.trim(i._input.val()).length, w = i._getKeyCodeEnum(), E, S = !1; o = i._keypress = !!s, f = i.options, a = i.menu.element, t.ui ? a.zIndex(i.element.zIndex() + 100) : (E = parseInt(i.element.css("zIndex"), 10), isNaN(E) && (E = 0), a.css("zIndex", E + 100)), i.listHasCreated || i._createDropDownList(); if (!i._usingRemoteData() && r !== null && r !== undefined) { S = i._keypress && f.isEditable && f.columns.length === 0 && f.highlightMatching && b > 0, s && s.keyCode === t.ui.keyCode.DOWN && r.length === 0 && b > 0 ? i._topHit = i.menu.filterItems(i._input.val(), !1, S) : i._topHit = i.menu.filterItems(r, f.autoFilter, S); if (i._topHit === null && i.innerData && t("li[wijhidden]", i.menu.element).length === i.innerData.length) return i.close(null, !0), !1 } return i.menu.element.show(), f.dropdownWidth === "auto" ? u = i._comboElement.outerWidth() : u = f.dropdownWidth, l = a.css("padding"), a.css("padding", "0px"), a.setOutWidth(u), a.css("padding", l), p = f.dropdownHeight, a.children(".wijmo-wijsuperpanel-header") && (h = a.children(".wijmo-wijsuperpanel-header").outerHeight() || 0), v = Math.min(i._menuUL.outerHeight() + c + h, p), a.setOutHeight(v), i.menu.refreshSuperPanel(), i._positionList(), !o && i.selectedItem !== undefined && i.menu.activate(null, i.selectedItem, !0), o && s.keyCode !== t.ui.keyCode.BACKSPACE ? f.isEditable ? i._runAutoComplete() : i.menu.activate(null, i._topHit, !0) : (m = i.options.showingAnimation, f.showingAnimation !== null && (s === undefined || s.keyCode !== t.ui.keyCode.BACKSPACE) && (i.menu.element.hide(), y = { from: { width: 0, height: 0 }, to: { width: i._dropDownWidth || a.outerWidth(), height: i._dropDownHeight || a.outerHeight() } }, m && (m.effect === "size" || m.animated === "size") && (m.options = t.extend(y, m.options)), g = a.attr("style"), a.show(m.effect || m.animated, m.options, m.speed || m.duration, function () { a.removeAttr("style").attr("style", g).show(), m.callback && m.callback.apply(this, arguments), t.browser.msie && a.css("filter", "") }))), i.hasOwnProperty("closeOnClick") || (d = i.closeOnClick, i.closeOnClick = function (e) { return d(e) }), i._trigger("open"), t(document).bind("mouseup", i, i.closeOnClick), !0 }, n.prototype.closeOnClick = function (e) { var n = e.data, r = n.options.wijCSS, i, s = e.target; !t.contains(n._comboElement[0], s) && !t.contains(n.menu.element[0], s) && (n._isMobile ? (i = n.menu.element.offset(), (e.pageX < i.left || e.pageX > i.left + n.menu.element.width() || e.pageY < i.top || e.pageY > i.top + n.menu.element.height()) && n.close()) : n.close(), t(".wijmo-wijcombobox-wrapper", n._comboElement[0]).removeClass(r.stateHover).removeClass(r.stateFocus), t(".wijmo-wijcombobox-trigger", n._comboElement[0]).removeClass(r.stateHover).removeClass(r.stateFocus)) }, n.prototype._positionList = function () { var e = this, n, r; n = e.options.dropDownListPosition, r = { my: "left top", at: "left bottom", of: e._comboElement, collision: "none" }, r = t.extend(r, n), e.menu.element.position(r) }, n.prototype._runAutoComplete = function () { var e = this, t, n, r, i, s, o; t = e._input, n = e._topHit; if (!e.options.autoComplete || n === null || n === undefined) return; e.menu.activate(null, n, !0), r = t.val(), i = n.label, t.val(i), s = r.length, o = i.length, e._selectText(s, o, t) }, n.prototype._selectText = function (e, t, n) { var r = n.val(), i = n.get(0), s; r.length > 0 && (i.setSelectionRange !== undefined ? i.setSelectionRange(e, t) : i.createTextRange !== undefined && (s = i.createTextRange(), s.moveStart("character", e), s.moveEnd("character", t - r.length), s.select())) }, n.prototype._move = function (e, t) { if (!this.menu.element.is(":visible")) { this.search("", t); return } if (this.menu.first() && /^previous/.test(e) || this.menu.last() && /^next/.test(e)) return; this.menu[e](t) }, n.prototype._escapeRegex = function (e) { return e === undefined ? e : e.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi, "\\$1") }, n.prototype._filter = function (e, n) { var r = this._escapeRegex(n), i, s = null; return e ? (i = new RegExp(r, "i"), t.each(e, function (e, t) { if (r === undefined || r.length === 0) { t.match = !0; return } var n = i.exec(t.label); n === null ? t.match = !1 : (s === null && n.index === 0 && (s = t), t.match = n.index >= 0) }), this._topHit = s, e) : null }, n }(e.wijmoWidget); e.wijcombobox = i; var s = function () { function e() { this.initSelector = ":jqmData(role='wijcombobox')", this.dataSource = null, this.data = null, this.labelText = null, this.minLength = 4, this.delay = 300, this.showingAnimation = null, this.hidingAnimation = null, this.showTrigger = !0, this.triggerPosition = "right", this.dropdownHeight = 300, this.dropdownWidth = "auto", this.selectOnItemFocus = !1, this.autoFilter = !0, this.autoComplete = !0, this.highlightMatching = !0, this.dropDownListPosition = {}, this.columns = [], this.selectionMode = "single", this.multipleSelectionSeparator = ",", this.forceSelectionText = !1, this.select = null, this.isEditable = !0, this.selectedIndex = -1, this.selectedValue = null, this.inputTextInDropDownList = !1, this.text = null, this.ensureDropDownOnBody = !0, this.open = null, this.close = null, this.selectElementWidthFix = 6, this.search = null, this.changed = null, this.textChanged = null, this.selectedIndexChanged = null, this.selectedIndexChanging = null, this.listOptions = null } return e }(); i.prototype.options = t.extend(!0, {}, e.wijmoWidget.prototype.options, new s), t.wijmo.registerWidget("wijcombobox", i.prototype) })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; var t = jQuery, n = (t.ui || t.mobile).keyCode, r = function (e) { function r() { e.apply(this, arguments), this._boundMouseWheel = !1, this._wasPopupShowing = !1 } return __extends(r, e), r.prototype._elemWithClasses = function (e, n) { return typeof n == "undefined" && (n = []), t(e).addClass(n.join(" ")) }, r.prototype._divWithClasses = function () { var e = []; for (var t = 0; t < arguments.length - 0; t++) e[t] = arguments[t + 0]; return this._elemWithClasses("<div/>", e) }, r.prototype._spanWithClasses = function () { var e = []; for (var t = 0; t < arguments.length - 0; t++) e[t] = arguments[t + 0]; return this._elemWithClasses("<span/>", e) }, r.prototype._horizontalBorderWidth = function (e) { return e.leftBorderWidth() + e.rightBorderWidth() }, r.prototype._verticalBorderWidth = function (e) { return e.topBorderWidth() + e.bottomBorderWidth() }, r.prototype._create = function () { var e = this, n = document.activeElement == this.element[0], r = this._horizontalBorderWidth(this.element), i = this._verticalBorderWidth(this.element); if (this.element[0].tagName.toLowerCase() !== "input") throw "Target element is not a INPUT"; this._creationDate = new Date, window.wijmoApplyWijTouchUtilEvents && (t = window.wijmoApplyWijTouchUtilEvents(t)), this.element.is(":hidden") && this.element.wijAddVisibilityObserver && this.element.wijAddVisibilityObserver(function () { e._destroy(), e._create(), e.element.wijRemoveVisibilityObserver && e.element.wijRemoveVisibilityObserver() }, "wijinput"), this.element.data("widgetName", this.widgetName), t.effects && t.effects.save ? t.effects.save(this.element, ["width", "height"]) : t.save && t.save(this.element, ["width", "height"]); var s = this.options.wijCSS; this.element.wrap("<div><span/></div"), this.wrapper = this.element.parent(), this.outerDiv = this.wrapper.parent(), this.outerDiv.addClass([s.wijinput, s.widget, s.helperClearFix, s.stateDefault, s.cornerAll].join(" ")), this.wrapper.addClass(s.wijinputWrapper), this.element.addClass(s.wijinputInput).addClass(s.cornerAll).attr("role", "textbox"); if (!(t.browser.msie && parseFloat(t.browser.version) <= 7)) try { this.element.attr("aria-multiline", !1) } catch (o) { this.element[0].setAttribute("aria-multiline", "false") } var u = this.options.buttonAlign === "left"; this.options.showTrigger && (this.triggerBtn = this._divWithClasses(s.wijinputTrigger, s.stateDefault, u ? s.cornerLeft : s.cornerRight).append(this._spanWithClasses(s.icon, s.iconArrowDown)).attr("role", "button").appendTo(this.outerDiv), this.element.attr({ role: "combobox", "aria-expanded": !1 })), this.options.showSpinner && (this.spinner = this._divWithClasses(s.wijinputSpinner, s.wijinputButton), this.spinUp = this._divWithClasses(s.stateDefault, s.wijinputSpinUp).append(this._spanWithClasses(s.icon, s.iconArrowUp)).attr("role", "button"), this.spinDown = this._divWithClasses(s.stateDefault, s.wijinputSpinDown).append(this._spanWithClasses(s.icon, s.iconArrowDown)).attr("role", "button"), this.options.showTrigger || (this.spinUp.addClass(u ? s.cornerTL : s.cornerTR), this.spinDown.addClass(u ? s.cornerBL : s.cornerBR)), this.spinner.append(this.spinUp).append(this.spinDown).appendTo(this.outerDiv), this.element.attr("role", "spinner")), this.options.showTrigger && this.options.showSpinner ? this.outerDiv.addClass(u ? s.inputSpinnerTriggerLeft : s.inputSpinnerTriggerRight) : (this.options.showTrigger && this.outerDiv.addClass(u ? s.inputTriggerLeft : s.inputTriggerRight), this.options.showSpinner && this.outerDiv.addClass(u ? s.inputSpinnerLeft : s.inputSpinnerRight)), this._initialize(), n && t(function () { return e.element.focus().wijtextselection(0, e.element.val().length) }); var a = this.element[0].style; a.width && (this._isInPercents(a.width) ? this.outerDiv.width(a.width) : this.outerDiv.width(this.element.width() + r - this._horizontalBorderWidth(this.outerDiv)), this.element.width("")), a.height && (this._isInPercents(a.height) ? this.outerDiv.height(a.height) : this.outerDiv.height(this.element.height() + i - this._verticalBorderWidth(this.outerDiv)), this.element.height("")) }, r.prototype._isInPercents = function (e) { return e.match(/%$/) }, r.prototype._createTextProvider = function () { return undefined }, r.prototype._beginUpdate = function () { }, r.prototype._endUpdate = function () { var e = this; this.element.mousewheel && !this._boundMouseWheel && (this.element.mousewheel(function (t, n) { e.isFocused() && e._doSpin(n > 0, !1) && t.preventDefault() }), this._boundMouseWheel = !0) }, r.prototype._isPopupShowing = function () { return !!this._comboDiv && this._comboDiv.wijpopup("isVisible") }, r.prototype._onTriggerMouseUp = function () { this._wasPopupShowing = this._isPopupShowing() }, r.prototype._onTriggerClicked = function () { this._wasPopupShowing ? this._hidePopup() : (this._showPopup(), this._wasPopupShowing = !0) }, r.prototype._showPopup = function () { this._popupComboList() }, r.prototype._hidePopup = function () { this._comboDiv.wijpopup("hide") }, r.prototype._initialize = function () { var e = this; this.element.data("initializing", !0), this._trigger("initializing"), this.element.data("preText", this.element.val()), this.element.data("elementValue", this.element.val()), this.element.data("errorstate", !1), this.element.data("breakSpinner", !0), this.element.data("prevCursorPos", -1), this.element.data("simulating", !1), this._createTextProvider(), this._beginUpdate(); var n = this.options, r = function (e) { return (e.which ? e.which : e.button) === 1 }, i = function (i) { if (e.options.disabled) return; if (!r(i)) return; e._trySetFocus(), e.element.data("breakSpinner", !1), e._addState("active", t(e)), e._doSpin(t(i.currentTarget).hasClass(n.wijCSS.wijinputSpinUp), !0) }, s = function (n) { if (e.options.disabled) return; if (!r(n)) return; e._stopSpin(), e._removeState("active", t(e)) }, o; this.triggerBtn && !n.disabledState && this.triggerBtn.bind({ mouseover: function () { if (e.options.disabled) return; e._addState("hover", t(e)) }, mouseout: function () { if (e.options.disabled) return; e._removeState("hover", t(e)) }, mousedown: function (n) { if (e.options.disabled) return; if (!r(n)) return; e._stopEvent(n), e._addState("active", t(e)), e._trigger("triggerMouseDown") }, mouseup: function (t) { e._onTriggerMouseUp() }, click: function (n) { if (e.options.disabled) return; e._stopEvent(n), e._stopSpin(), e._removeState("active", t(e)), e._trigger("triggerMouseUp"), e._onTriggerClicked(), e._trySetFocus() } }), this.spinUp && !n.disabledState && this.spinUp.bind({ mouseover: function () { if (e.options.disabled) return; e._addState("hover", t(e)) }, mouseout: function () { if (e.options.disabled) return; e._removeState("hover", t(e)), e._removeState("active", t(e)), e._stopSpin() }, mousedown: i, mouseup: s }), this.spinDown && !n.disabledState && this.spinDown.bind({ mouseover: function () { if (e.options.disabled) return; e._addState("hover", t(e)) }, mouseout: function () { if (e.options.disabled) return; e._removeState("hover", t(e)), e._removeState("active", t(e)), e._stopSpin() }, mousedown: i, mouseup: s }), this.element.bind({ "focus.wijinput": t.proxy(this._onFocus, this), "blur.wijinput": t.proxy(this._onBlur, this), "mouseup.wijinput": t.proxy(this._onMouseUp, this), "keypress.wijinput": t.proxy(this._onKeyPress, this), "keydown.wijinput": t.proxy(this._onKeyDown, this), "keyup.wijinput": t.proxy(this._onKeyUp, this), "compositionstart.wijinput": t.proxy(this._onCompositionStart, this), "compositionend.wijinput": t.proxy(this._onCompositionEnd, this), "change.wijinput": t.proxy(this._onChange, this), "paste.wijinput": t.proxy(this._onPaste, this), "drop.wijinput": t.proxy(this._onDrop, this) }), this.element.bind("propertychange.wijinput input.wijinput", t.proxy(this._onInput, this)), this.element.data("initializing", !1), this._resetData(), this._endUpdate(), this._updateText(), this.options.disabledState && (o = n.disabled, this.disable(), n.disabled = o), this.options.disabled && this.disable(), this.element.data("initialized", !0), this._trigger("initialized") }, r.prototype._init = function () { }, r.prototype._setOption = function (e, t) { this._super(e, t); switch (e) { case "buttonAlign": case "showTrigger": case "showSpinner": this._destroy(), this._create(); break; case "showNullText": this._updateText(); break; case "disabled": this.element.attr("disabled", t); var n = t ? "addClass" : "removeClass", r = this.options.wijCSS.stateDisabled; this.element[n](r), this.triggerBtn && this.triggerBtn[n](r), this.spinUp && this.spinUp[n](r), this.spinDown && this.spinDown[n](r) } }, r.prototype.destroy = function () { this._super(), this._destroy() }, r.prototype.isDestroyed = function () { return !this.outerDiv }, r.prototype._destroy = function () { if (this.isDestroyed()) return; this.wrapper = undefined, this.outerDiv = undefined, this.element.unbind(".wijinput"), this.element.removeData("errorstate").removeData("breakSpinner").removeData("prevCursorPos").removeData("simulating").removeData("isPassword").removeClass(this.options.wijCSS.wijinputInput).removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow").removeAttr("aria-expanded"), this.element.parent().replaceWith(this.element), this.element.parent().replaceWith(this.element), t.effects && t.effects.restore ? t.effects.restore(this.element, ["width", "height"]) : t.restore && t.restore(this.element, ["width", "height"]) }, r.prototype.widget = function () { return this.outerDiv || this._super() }, r.prototype._getCulture = function (e) { return typeof e == "undefined" && (e = this.options.culture), Globalize.findClosestCulture(e || this.options.culture) }, r.prototype._addState = function (e, t) { t.is(":not(.ui-state-disabled)") && t.addClass(this.options.wijCSS.getState(e)) }, r.prototype._removeState = function (e, t) { t.removeClass(this.options.wijCSS.getState(e)) }, r.prototype._isInitialized = function () { return !this.element.data("initializing") }, r.prototype._setData = function (e) { this.setText(e) }, r.prototype._resetData = function () { }, r.prototype._validateData = function () { }, r.prototype.getText = function () { return this._isInitialized() ? this._textProvider.toString(!0, !1, !1) : this.element.val() }, r.prototype.setText = function (e) { this._isInitialized() ? (this._textProvider.set(e), this._updateText()) : this.element.val(e) }, r.prototype.getPostValue = function () { return this._isInitialized() ? this._textProvider.toString(!0, !1, !0) : this.element.val() }, r.prototype.selectText = function (e, t) { typeof e == "undefined" && (e = 0), typeof t == "undefined" && (t = this.getText().length); if (this.element.is(":disabled")) return; this.element.wijtextselection(e, t) }, r.prototype.focus = function () { if (this.element.is(":disabled")) return; this.element.get(0).focus() }, r.prototype.isFocused = function () { return this.outerDiv.hasClass(this.options.wijCSS.stateFocus) }, r.prototype._raiseTextChanged = function () { var e = this.element.val(), t = this.element.data("preText"); !!this.element.data("initialized") && t !== e && (this._trigger("textChanged", null, { text: e }), this.element.data("changed", !0)), this.element.data("preText", e) }, r.prototype._raiseDataChanged = function () { }, r.prototype._allowEdit = function () { return !this.element.attr("readOnly") && !this.element.is(":disabled") }, r.prototype._updateText = function (e) { typeof e == "undefined" && (e = !1); if (!this._isInitialized()) return; e = !!e; var t = this.element.wijtextselection(), n = this.options; this.isDeleteAll && n.showNullText ? (this.isDeleteAll = !1, n.date = null, this.element.val(n.nullText)) : (this.element.val(this._textProvider.toString()), this.options.text = this._textProvider.toString(!0, !1, !1)); if (this.element.is(":disabled")) return; e && this.selectText(t.start, t.end), this.element.data("prevCursorPos", t.start), this._raiseTextChanged(), this._raiseDataChanged() }, r.prototype._trySetFocus = function () { if (!this.isFocused()) try { this.options.disableUserInput || this.element.focus() } catch (e) { } }, r.prototype._deleteSelText = function (e) { typeof e == "undefined" && (e = !1); if (!this._allowEdit()) return; var t = this.element.wijtextselection(), n; if (e) { if (t.end < 1) return; t.end === t.start && t.start-- } t.end--, t.end < t.start && (t.end = t.start), n = new u, this._textProvider.removeAt(t.start, t.end, n), this._updateText(), this.selectText(n.testPosition, n.testPosition) }, r.prototype._fireIvalidInputEvent = function (e) { var n = this, r; if (t.isFunction(this.options.invalidInput) && this._trigger("invalidInput", null, { widget: this, "char": e }) === !0) return; this.element.data("errorstate") || (r = this.options.invalidClass || this.options.wijCSS.stateError, this.element.data("errorstate", !0), window.setTimeout(function () { n.outerDiv && n.outerDiv.removeClass(r), n.element.data("errorstate", !1) }, 200), this.outerDiv.addClass(r)) }, r.prototype._onInput = function (e) { if (!this._isSimulating() || !this.element.data("ime") || this.element.data("isComposingIME")) { this.element.data("isComposingIME") && this.element.data("simulationPending", !0); return } this._simulate() }, r.prototype._keyDownPreview = function (e) { return !1 }, r.prototype._onDoubleByteCharacter = function () { var e = this.element.data("lastDbsState"), t = this.element.wijtextselection(), n = this.element.val(); this.element.data("isComposingIME") && e && e.selection.start === t.start && e.Text === n ? (this.element.removeData("lastDbsState"), this._onCompositionEnd()) : (this.element.data("lastDbsState", { selection: t, text: n }), this._onCompositionStart()) }, r.prototype._onCompositionStart = function () { if (this.element.data("isComposingIME")) return; this.element.data("isComposingIME", !0), this._beforeSimulate(!0) }, r.prototype._onCompositionEnd = function () { if (!this.element.data("isComposingIME")) return; this.element.data("isComposingIME", !1), this._isInitialized() && (!this._textProvider || !this._textProvider.noMask) && this._simulateIfPending() }, r.prototype._simulateIfPending = function () { this.element.data("simulationPending") && this.element.data("lastSelection") && this._simulate() }, r.prototype._beforeSimulate = function (e) { typeof e == "undefined" && (e = !1), this.element.data("lastSelection") || (this.element.data("lastSelection", this.element.wijtextselection()), this.element.data("lastValue", this.element.val())), this.element.data("ime", e), this.element.data("simulating", !0) }, r.prototype._isSimulating = function () { return this.element.data("simulating") }, r.prototype._simulate = function (e) { var t = this, n = null, r, i, s; this.element.data("simulationPending", !1), typeof e == "string" ? n = e : (r = this.element.wijtextselection(), i = this.element.data("lastSelection").start, s = r.end, s >= i && (n = this.element.val().substring(i, s))), n && window.setTimeout(function () { if (!t.element.data("lastValue")) return; t.element.val(t.element.data("lastValue")); var e = t.element.data("lastSelection"), r, i; t.element.wijtextselection(e), t.element.data("batchKeyPress", !0), t.element.data("simulating", !1), r = jQuery.Event("keypress"), r.ctrlKey = r.altKey = !1; for (i = 0; i < n.length; i++) r.which = r.charCode = r.keyCode = n.charCodeAt(i), t._onKeyPress(r); t.element.data("batchKeyPress", !1), t._endSimulate() }, 1) }, r.prototype._endSimulate = function () { this._simulateIfPending(), this.element.removeData("ime"), this.element.removeData("lastSelection"), this.element.removeData("lastValue") }, r.prototype._onKeyDown = function (e) { this.element.data("prevCursorPos", -1); if (!this._isInitialized() || this._textProvider && !!this._textProvider.noMask) return; var r = this._getKeyCode(e); if (r === 229) { this._onDoubleByteCharacter(); return } this._onCompositionEnd(); if (this.options.disableUserInput) { this._stopEvent(e); return } if (this._keyDownPreview(e)) { this._stopEvent(e); return } switch (r) { case n.UP: this._doSpin(!0, !1), this._stopEvent(e); return; case n.DOWN: this._doSpin(!1, !1), this._stopEvent(e); return } if (e.ctrlKey) switch (r) { case n.INSERT: case 67: return; default: } if (e.ctrlKey || e.altKey) return; switch (r) { case 112: case 113: case 114: case 115: case 116: case 117: case n.TAB: case n.CAPSLOCK: case n.END: case n.HOME: case n.CTRL: case n.SHIFT: return; case n.BACKSPACE: this._deleteSelText(!0), this._stopEvent(e); return; case n.DELETE: this._deleteSelText(!1), this._stopEvent(e); return; case n.ENTER: this._onEnterDown(e); break; case n.ESCAPE: this._stopEvent(e), window.setTimeout(t.proxy(this._resetData, this), 1); return; case n.PAGE_UP: case n.PAGE_DOWN: case n.ALT: this._stopEvent(e); return } }, r.prototype._onEnterDown = function (e) { this.options.hideEnter && this._stopEvent(e) }, r.prototype._onKeyUp = function (e) { if (this._textProvider && !!this._textProvider.noMask) return; var t = this._getKeyCode(e); if (this._isSimulating()) { t === n.ENTER && this._onCompositionEnd(); return } if (!this._isInitialized()) return; if (t === n.ENTER || t === n.ESCAPE) return; if (this.options.disableUserInput) { this._raiseTextChanged(), this._raiseDataChanged(); return } this._stopEvent(e) }, r.prototype._getKeyCode = function (e) { var t = window.navigator.userAgent; return t.indexOf("iPod") === -1 && t.indexOf("iPhone") === -1 || e.which !== 127 ? e.keyCode || e.which : 8 }, r.prototype._keyPressPreview = function (e) { return !1 }, r.prototype._onKeyPress = function (e) { if (this._isSimulating() || this._textProvider && !!this._textProvider.noMask) return; this.element.data("prevCursorPos", -1); if (this.options.disableUserInput) return; if (!this._allowEdit()) return; if (e.ctrlKey && e.keyCode === 119) { this._onPaste(e); return } var t = e.keyCode || e.which, r, i; switch (t) { case 0: case n.TAB: case n.UP: case n.DOWN: case n.LEFT: case n.RIGHT: return; case n.BACKSPACE: this._stopEvent(e); return; case n.ENTER: this.options.hideEnter && this._stopEvent(e); return } if (e.ctrlKey || e.altKey) if (t !== n.SPACE) return; if (this._keyPressPreview(e)) return; i = String.fromCharCode(t), r = this._textProvider.replaceWith(this.element.wijtextselection(), i), r ? (this._updateText(), this.selectText(r.testPosition + 1, r.testPosition + 1)) : this._fireIvalidInputEvent(i), this.element.data("batchKeyPress") || this._stopEvent(e) }, r.prototype._isNullText = function (e) { return e = e || this.element.val(), this.options.showNullText && e === this.options.nullText }, r.prototype._doFocus = function () { var e = this.element.wijtextselection(), n = e.start, r; this._updateText(), r = this.element.val(), r.length === n && (n = 0), t.browser.safari || this.selectText(n, n) }, r.prototype._afterFocused = function () { this._isNullText() && this._doFocus() }, r.prototype._onFocus = function (e) { if (this.options.disableUserInput) return; this._addState("focus", this.outerDiv); if (!this.element.data("breakSpinner")) return; if (!this._isInitialized()) return; if (!this._allowEdit()) return; this.element.data("focusNotCalledFirstTime") || this.element.data("focusNotCalledFirstTime", (new Date).getTime()), this._afterFocused() }, r.prototype._onBlur = function (e) { var t = this; if (this.options.disableUserInput) return; this._onCompositionEnd(); if (this._isComboListVisible()) return; var n = this.isFocused(), r; this._removeState("focus", this.outerDiv); if (!this.element.data("breakSpinner")) { this.element.get(0).focus(), r = this.element.data("prevCursorPos"), r !== undefined && r !== -1 && this.selectText(r, r); return } if (!this._isInitialized() || !n) return; this.element.data("value", this.element.val()), window.setTimeout(function () { t._updateText(), t._validateData(), t.element.data("changed") && (t.element.data("changed", !1), t._popupVisible() || (t._trigger("change"), t.element.change())) }, 100) }, r.prototype._popupVisible = function () { return this._isComboListVisible() }, r.prototype._onMouseUp = function (e) { if (!this._isInitialized()) return; if (this.element.is(":disabled")) return; var t = this.element.wijtextselection(); this.element.data("prevCursorPos", t.start) }, r.prototype._onChange = function () { if (!this.element) return; var e = this.element.val(), t = this.getText(); t !== e && this.setText(e) }, r.prototype._onPaste = function (e) { if (this._textProvider && !!this._textProvider.noMask) return; this._beforeSimulate(); var t = this; window.setTimeout(function () { t._simulate() }, 1) }, r.prototype._onDrop = function (e) { this._beforeSimulate(); if (e.originalEvent && e.originalEvent.dataTransfer) { var t = e.originalEvent.dataTransfer.getData("Text"); t && this._simulate(t) } }, r.prototype._stopEvent = function (e) { e.stopPropagation(), e.preventDefault() }, r.prototype._calcSpinInterval = function () { return this._repeatingCount++, this._repeatingCount > 10 ? 50 : this._repeatingCount > 4 ? 100 : this._repeatingCount > 2 ? 200 : 400 }, r.prototype._doSpin = function (e, t) { return !1 }, r.prototype._stopSpin = function () { this.element.data("breakSpinner", !0), this._repeatingCount = 0 }, r.prototype._hasComboItems = function () { return !!this.options.comboItems && this.options.comboItems.length }, r.prototype._isComboListVisible = function () { return this._comboDiv ? this._comboDiv.wijpopup("isVisible") : !1 }, r.prototype._popupComboList = function () { var e = this; if (!this._hasComboItems()) return; if (!this._allowEdit()) return; var n; this._comboDiv === undefined && (this._comboDiv = t("<div></div>").appendTo(document.body).css("position", "absolute"), n = this._normalize(this.options.comboItems), this._comboDiv.wijlist({ maxItemsCount: 5, selected: function (t, n) { e._setData(n.item.value), e._comboDiv.wijpopup("hide"), e._trySetFocus() } }), this._comboDiv.wijlist("setItems", n), this._comboDiv.wijlist("renderList")), this._comboDiv.width(this.outerDiv.width()), this._comboDiv.wijlist("option", "autoSize", !this.options.comboHeight), this.options.comboHeight && this._comboDiv.height(this.options.comboHeight), this._comboDiv.wijlist("refreshSuperPanel"), this._comboDiv.wijpopup({ autoHide: !0 }), this.outerDiv.attr("aria-expanded", !0), this._comboDiv.wijpopup("show", { of: this.outerDiv, offset: "0 4", hidden: function () { e.outerDiv.attr("aria-expanded", !1) } }) }, r.prototype._normalize = function (e) { return e.length && e[0].label && e[0].value ? e : t.map(e, function (e) { return typeof e == "string" ? { label: e, value: e } : t.extend({ label: e.label || e.value, value: e.value || e.label }, e) }) }, r }(e.wijmoWidget); e.wijinputcore = r; var i = "wijmo-wijinput", s = i + "-", o = function () { function e() { this.wijCSS = { wijinput: i, wijinputInput: s + "input", wijinputWrapper: s + "wrapper", wijinputTrigger: s + "trigger", wijinputSpinner: s + "spinner", wijinputButton: s + "button", wijinputSpinUp: s + "spinup", wijinputSpinDown: s + "spindown" }, this.culture = "", this.invalidClass = t.wijmo.wijCSS.stateError, this.nullText = "", this.showNullText = !1, this.hideEnter = !1, this.disableUserInput = !1, this.buttonAlign = "right", this.showTrigger = !1, this.showSpinner = !1, this.comboItems = undefined, this.comboWidth = undefined, this.comboHeight = undefined, this.initializing = null, this.initialized = null, this.triggerMouseDown = null, this.triggerMouseUp = null, this.textChanged = null, this.invalidInput = null } return e }(); r.prototype.options = t.extend(!0, {}, e.wijmoWidget.prototype.options, new o); var u = function () { function e() { this.characterEscaped = 1, this.noEffect = 2, this.sideEffect = 3, this.success = 4, this.unknown = 0, this.hint = 0, this.alphanumericCharacterExpected = -2, this.asciiCharacterExpected = -1, this.digitExpected = -3, this.invalidInput = -51, this.letterExpected = -4, this.nonEditPosition = -54, this.positionOutOfRange = -55, this.promptCharNotAllowed = -52, this.signedDigitExpected = -5, this.unavailableEditPosition = -53, this.testPosition = -1 } return e.prototype.clone = function () { var t = new e; return t.hint = this.hint, t.testPosition = this.testPosition, t }, e }(); e.wijInputResult = u; var a = function () { function e() { } return e.prototype.set = function (e, t) { }, e.prototype.toString = function (e, t, n, r, i) { return "" }, e.prototype.insertAt = function (e, t, n) { return !1 }, e.prototype.removeAt = function (e, t, n, r) { }, e.prototype.replaceWith = function (e, t) { var n = e.start, r = new u; return e.start < e.end && (this.removeAt(e.start, e.end - 1, r, !0), n = r.testPosition), this.insertAt(t, n, r) ? r : null }, e }(); e.wijTextProvider = a })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; function r(e, t) { typeof t == "undefined" && (t = 2); var n = "" + e + ""; if (n.length > t) n = n.substr(n.length - t); else while (n.length < t) n = "0" + n; return n } var t = jQuery, n = (t.ui || t.mobile).keyCode, i = function (r) { function i() { r.apply(this, arguments) } return __extends(i, r), i.prototype._createTextProvider = function () { this._textProvider = new o(this, this.options.dateFormat) }, i.prototype._strToDate = function (e) { return this._textProvider.parseDate(e) }, i.prototype._beginUpdate = function () { var e = this.options, t, n = null; r.prototype._beginUpdate.call(this), e.minDate && typeof e.minDate == "string" && (e.minDate = this._strToDate(e.minDate)), e.maxDate && typeof e.maxDate == "string" && (e.maxDate = this._strToDate(e.maxDate)), e.date ? typeof e.date == "string" ? t = e.date : n = e.date : !this.element.data("elementValue") || (t = this.element.data("elementValue")), t && (n = this._strToDate(t)), this._safeSetDate(n), this.element.data({ defaultDate: n === null ? n : new Date(e.date.getTime()), preDate: n === null ? n : new Date(e.date.getTime()) }), this._resetTimeStamp(), e.showTrigger && !this._hasComboItems() && this._initCalendar(), this.element.addClass(e.wijCSS.wijinputdate).attr({ "aria-valuemin": new Date(1900, 1, 1), "aria-valuemax": new Date(2099, 1, 1), "aria-valuenow": e.date }) }, i.prototype._endUpdate = function () { var e = this; r.prototype._endUpdate.call(this), this.element.bind("click.wijinput", function () { e._highLightCursor() }) }, i.prototype._isValidDate = function (e, t) { var n = this.options; if (e === undefined) return !1; if (isNaN(e)) return !1; if (e.getFullYear() < 1 || e.getFullYear() > 9999) return !1; if (t) { if (n.minDate && e < n.minDate) return !1; if (n.maxDate && e > n.maxDate) return !1 } return !0 }, i.prototype._checkRange = function (e) { var t = this.options; return e && (t.minDate && e < t.minDate && (e = new Date(Math.max(t.minDate, e))), t.maxDate && e > t.maxDate && (e = new Date(Math.min(t.maxDate, e)))), e }, i.prototype._safeSetDate = function (e) { var t = this.options, n = e; return e = this._checkRange(e), isNaN(e) && (e = n), t.date = e, !0 }, i.prototype._safeGetDate = function () { var e = this.options.date || this._creationDate; return e = this._checkRange(e), e }, i.prototype._setOption = function (e, t) { r.prototype._setOption.call(this, e, t); switch (e) { case "date": !t || (typeof t == "string" ? t = this._strToDate(t) : typeof t == "object" ? t = new Date(t.getTime()) : t = new Date(t), isNaN(t) && (t = new Date)), this._safeSetDate(t), this._updateText(), this._highLightField(); break; case "dateFormat": case "culture": this._textProvider._setFormat(this.options.dateFormat), this._updateText(); var n = this.element.data("calendar"); n && n.wijcalendar("option", e, t); break; case "activeField": t = Math.min(t, this._textProvider.getFieldCount() - 1), t = Math.max(t, 0), this.options.activeField = t, this._highLightField(), this._resetTimeStamp(); break; case "nextTooltip": case "prevTooltip": case "titleFormat": case "toolTipFormat": var n = this.element.data("calendar", n); n && n.wijcalendar("option", e, t) } }, i.prototype._setData = function (e) { this.option("date", e) }, i.prototype._resetData = function () { var e = this.element.data("defaultDate"); e === undefined || e === null ? (e = this.element.data("elementValue"), e !== undefined && e !== null && e !== "" ? this.setText(e) : this._setData(null)) : this._setData(e) }, i.prototype._resetTimeStamp = function () { this.element.data("cursorPos", 0), this.element.data("timeStamp", new Date("1900/1/1")) }, i.prototype.getPostValue = function () { if (!this._isInitialized()) return this.element.val(); if (this.options.showNullText && this.isDateNull()) return ""; var e = this._textProvider.toString(); return e === this.options.nullText ? "" : e }, i.prototype._highLightField = function (e) { typeof e == "undefined" && (e = this.options.activeField); if (this.isFocused()) { var t = this._textProvider.getFieldRange(e); t && this.element.wijtextselection(t) } }, i.prototype._highLightCursor = function (e) { if (this._isNullText()) return; e === undefined && (e = Math.max(0, this.element.wijtextselection().start)); var t = this._textProvider.getCursorField(e); if (t < 0) return; this._setOption("activeField", t) }, i.prototype._toNextField = function () { this._setOption("activeField", this.options.activeField + 1) }, i.prototype._toPrevField = function () { this._setOption("activeField", this.options.activeField - 1) }, i.prototype._toFirstField = function () { this._setOption("activeField", 0) }, i.prototype._toLastField = function () { this._setOption("activeField", this._textProvider.getFieldCount()) }, i.prototype._clearField = function (t) { typeof t == "undefined" && (t = this.options.activeField); var n = this._textProvider.getFieldRange(t), r, i = this; n && (r = new e.wijInputResult, this._textProvider.removeAt(n.start, n.end, r), this._updateText(), window.setTimeout(function () { i._highLightField() }, 1)) }, i.prototype._doSpin = function (e, t) { var n = this; return this._allowEdit() ? t && this.element.data("breakSpinner") ? !1 : (this._textProvider[e ? "incEnumPart" : "decEnumPart"]() && (this._updateText(), this._highLightField()), t && !this.element.data("breakSpinner") && window.setTimeout(function () { return n._doSpin(e, !0) }, this._calcSpinInterval()), !0) : !1 }, i.prototype._onChange = function () { }, i.prototype._afterFocused = function () { this._isNullText() && this._doFocus() }, i.prototype._keyDownPreview = function (e) { var t = e.keyCode || e.which, r; switch (t) { case n.LEFT: return this._toPrevField(), !0; case n.RIGHT: return this._toNextField(), !0; case n.TAB: case n.SPACE: case 188: case 190: case 110: case 191: if (e.shiftKey) { if (this.options.activeField > 0) return this._toPrevField(), !0 } else if (this.options.activeField < this._textProvider.getFieldCount() - 1) return this._toNextField(), !0; break; case n.HOME: return e.ctrlKey ? this._setOption("date", new Date) : this._toFirstField(), !0; case n.END: return e.ctrlKey ? this._setOption("date", new Date("1970/1/1")) : this._toLastField(), !0; case n.DELETE: if (this._allowEdit()) return r = this.element.wijtextselection(), r.end - r.start === this.element.val().length ? (this.isDeleteAll = !0, this._setOption("date", new Date("1970/1/1"))) : this._clearField(), !0 } return !1 }, i.prototype._autoMoveToNextField = function (e, t) { if (!this.options.autoNextField) return; this._textProvider.needToMove(this.options.activeField, e, t) && this._toNextField() }, i.prototype._keyPressPreview = function (e) { var t = e.keyCode || e.which, r, i, s, o, u, a, f, l, c, h, p; if (t === n.ENTER) return this.isDateNull() && (this.options.date = new Date), !1; r = this._textProvider.getFieldRange(this.options.activeField); if (r) { if (t === n.TAB) return !0; if (t === n.SPACE) return this._stopEvent(e), !0; i = String.fromCharCode(t), s = this._textProvider.isFieldSep(i, this.options.activeField); if (s) return this._toNextField(), this._stopEvent(e), !0; o = this.element.data("cursorPos"), u = new Date, f = this.element.data("timeStamp"), p = this.element.data("lastInput"), a = u.getTime() - f.getTime() > this.options.keyDelay; var h = i; return a ? o = 0 : p && (h = p + h), this.element.data({ timeStamp: u, lastInput: h }), l = r.start + o, this.element.data("cursorPos", ++o), c = this._textProvider.addToField(h, this.options.activeField, l), c ? (this._updateText(), this._autoMoveToNextField(o, i), this._highLightField()) : (this._resetTimeStamp(), this._fireIvalidInputEvent()), this._stopEvent(e), !0 } return !1 }, i.prototype._raiseDataChanged = function () { var e = this.options.date, t = this.element.data("preDate"); this.element.data("preDate", e ? new Date(e.getTime()) : null); if (!t && e || t && !e || t && e && t.getTime() !== e.getTime()) this._syncCalendar(), this.element.attr("aria-valuenow", e), this._trigger("dateChanged", null, { date: e }) }, i.prototype.isDateNull = function () { return this.options.date === null || this.options.date === undefined }, i.prototype._isMinDate = function (e) { return e.getFullYear() === 1 && e.getMonth() === 0 && e.getDate() === 1 }, i.prototype._initCalendar = function () { var e = this, n = this.options, r = n.calendar, i; if (r === undefined || r === null) return; if (typeof r == "boolean" || r === "default") r = t("<div/>"), r.appendTo(document.body); i = t(r); if (i.length !== 1) return; this.element.data("calendar", i), n.localization && (n.nextTooltip = n.localization.nextTooltip, n.prevTooltip = n.localization.prevTooltip, n.titleFormat = n.localization.titleFormat, n.toolTipFormat = n.localization.toolTipFormat), i.wijcalendar({ popupMode: !0, culture: n.culture, nextTooltip: n.nextTooltip || "Next", prevTooltip: n.prevTooltip || "Previous", titleFormat: n.titleFormat || "MMMM yyyy", toolTipFormat: n.toolTipFormat || "dddd, MMMM dd, yyyy", selectedDatesChanged: function () { var t = i.wijcalendar("getSelectedDate"), n = e.option("date"); i.wijcalendar("close"), t && (n && (t.setHours(n.getHours()), t.setMinutes(n.getMinutes()), t.setSeconds(n.getSeconds()), t.setMilliseconds(n.getMilliseconds())), e.option("date", t), e.selectText()), e._trySetFocus() } }), this._syncCalendar() }, i.prototype._syncCalendar = function () { var e = this.element.data("calendar"), t, n; if (!e) return; t = this.options, n = this._safeGetDate(), this._isMinDate(n) && (n = new Date), e.wijcalendar("option", "displayDate", n), t.minDate && e.wijcalendar("option", "minDate", t.minDate), t.maxDate && e.wijcalendar("option", "maxDate", t.maxDate), e.wijcalendar("unSelectAll"), e.wijcalendar("selectDate", n), e.wijcalendar("refresh") }, i.prototype._isPopupShowing = function () { var e = this.element.data("calendar"); return e ? e.wijcalendar("isPopupShowing") : r.prototype._isPopupShowing.call(this) }, i.prototype._showPopup = function () { var e = this.element.data("calendar"); if (!e) return r.prototype._showPopup.call(this); if (!this._allowEdit()) return; this._syncCalendar(), e.wijcalendar("popup", t.extend({}, this.options.popupPosition, { of: this.outerDiv })) }, i.prototype._hidePopup = function () { var e = this.element.data("calendar"); if (!e) return r.prototype._hidePopup.call(this); e.wijcalendar("close") }, i.prototype._isCalendarVisible = function () { if (!this._allowEdit()) return !1; var e = this.element.data("calendar"); return e ? e.wijcalendar("isPopupShowing") : !1 }, i.prototype._popupVisible = function () { return this._hasComboItems() ? this._isComboListVisible() : this._isCalendarVisible() }, i }(e.wijinputcore); e.wijinputdate = i; var s = function () { function t() { this.wijCSS = { wijinputdate: e.wijinputcore.prototype.options.wijCSS.wijinput + "-date" }, this.date = null, this.minDate = null, this.maxDate = null, this.dateFormat = "d", this.startYear = 1950, this.smartInputMode = !0, this.activeField = 0, this.keyDelay = 800, this.autoNextField = !0, this.calendar = "default", this.popupPosition = { offset: "0 4" }, this.dateChanged = null } return t }(); i.prototype.options = t.extend(!0, {}, e.wijinputcore.prototype.options, new s), t.wijmo.registerWidget("wijinputdate", i.prototype); var o = function (n) { function i(e, t) { n.call(this), this.inputWidget = e, this.maskPartsCount = 0, this.pattern = "M/d/yyyy", this._disableSmartInputMode = !1, this.paddingZero = r, this.descriptors = new Array(0), this.desPostions = new Array(0), this.fields = new Array(0), this._setFormat(t) } return __extends(i, n), i.prototype.initialize = function () { }, i.prototype.getFieldCount = function () { return this.fields.length }, i.prototype.getFieldRange = function (e) { var t = this.fields[e]; return { start: t.startIndex, end: t.startIndex + t.getText().length } }, i.prototype.getCursorField = function (e) { e = Math.min(e, this.desPostions.length - 1), e = Math.max(e, 0); var n = this.desPostions[e].desc, r; if (n.type === -1) { r = t.inArray(n, this.descriptors); if (!(r > 0 && this.descriptors[r - 1].type !== -1)) return -1; n = this.descriptors[r - 1] } return t.inArray(n, this.fields) }, i.prototype.needToMove = function (e, t, n) { if (!this.inputWidget._isValidDate(this.inputWidget._safeGetDate(), !0)) return !1; var r = this.fields[e], i = parseInt(n, 10); if (t === r.maxLen) return !0; if (isNaN(i)) return !1; switch (r.type) { case 20: case 25: case 45: case 46: return i > 1; case 47: case 48: return i > 2; case 30: case 31: return i > 3; case 50: case 51: case 60: case 61: return i > 6 } return !1 }, i.prototype._getCulture = function () { return this.inputWidget._getCulture() }, i.prototype._isDigitString = function (e) { e = t.trim(e); if (e.length === 0) return !0; var n = e.charAt(0), r, i; if (n === "+" || n === "-") e = e.substr(1), e = t.trim(e); if (e.length === 0) return !0; try { return r = parseFloat(e), i = r.toString(), i === e } catch (s) { return !1 } }, i.prototype._setFormat = function (e) { this.descriptors = []; var n = "", r = "", i = !1, s = !1, o, u; this.pattern = this._parseFormatToPattern(e); for (o = 0; o < this.pattern.length; o++) { u = this.pattern.charAt(o); if (s) { this.descriptors.push(this.createDescriptor(-1, u)), n = "", s = !1; continue } if (u === "\\") { s = !0, n.length > 0 && (this.handlePattern(n) || this.descriptors.push(this.createDescriptor(-1, r)), n = ""); continue } if (u === "'") { i ? (i = !1, n = "") : (i = !0, n.length > 0 && (this.handlePattern(n) || this.descriptors.push(this.createDescriptor(-1, r)), n = "")); continue } if (i) { this.descriptors.push(this.createDescriptor(-1, u)), n = ""; continue } o || (r = u), r !== u && n.length > 0 && (this.handlePattern(n) || this.descriptors.push(this.createDescriptor(-1, r)), n = ""), n += u, r = u } n.length > 0 && (this.handlePattern(n) || this.descriptors.push(this.createDescriptor(-1, r))), this.fields = t.grep(this.descriptors, function (e) { return e.type !== -1 }) }, i.prototype._parseFormatToPattern = function (e) { var t = this.inputWidget._getCulture().calendars.standard, n = t.patterns.d; if (e.length <= 1) switch (e) { case "": case "d": n = t.patterns.d; break; case "D": n = t.patterns.D; break; case "f": n = t.patterns.D + " " + t.patterns.t; break; case "F": n = t.patterns.D + " " + t.patterns.T; break; case "g": n = t.patterns.d + " " + t.patterns.t; break; case "G": n = t.patterns.d + " " + t.patterns.T; break; case "m": n = t.patterns.M; break; case "M": n = t.patterns.M; break; case "s": n = t.patterns.S; break; case "t": n = t.patterns.t; break; case "T": n = t.patterns.T; break; case "u": n = t.patterns.S; break; case "U": n = t.patterns.D + " " + t.patterns.T; break; case "y": n = t.patterns.Y; break; case "Y": n = t.patterns.Y } else n = e; return n }, i.prototype.getDate = function () { return this.inputWidget ? new Date(this.inputWidget._safeGetDate().getTime()) : undefined }, i.prototype.setDate = function (e) { this.inputWidget && this.inputWidget._setData(e) }, i.prototype._internalSetDate = function (e) { if (this.inputWidget) { var t = this, n = this.inputWidget.options, r = this.inputWidget.element, i = !!r.data("typing"), s; i ? (n.date = e, s = function () { var e = new Date, i = r.data("timeStamp"); e.getTime() - i.getTime() > n.keyDelay ? (t.inputWidget._safeSetDate(n.date), t.inputWidget._updateText(), t.inputWidget._highLightField()) : window.setTimeout(s, n.keyDelay) }, window.setTimeout(s, n.keyDelay)) : this.inputWidget._safeSetDate(e) } }, i.prototype.daysInMonth = function (e, t) { e -= 1; var n = (new Date(t, ++e, 1, -1)).getDate(); return n }, i.prototype.setYear = function (e, t, n) { try { t && t.isfullreset && (t.offset = 1, e = "1970"); if (typeof e == "string" && !this._isDigitString(e)) return !1; e *= 1; var r = this.inputWidget.options, i = 1, s = 9999, o, u, a; n && (r.minDate && (i = Math.max(i, r.minDate.getFullYear())), r.maxDate && (s = Math.min(s, r.maxDate.getFullYear()))), t && t.isreset && (e = i), e < i && (e = i), e > s && (e = s), o = this.getDate(), u = new Date(o.getTime()), u.setFullYear(e); if (this._isValidDate(u)) return a = this.daysInMonth(this.getMonth(), this.getYear()), a === o.getDate() ? (u = new Date(o.getTime()), u.setDate(1), u.setFullYear(e), a = this.daysInMonth(u.getMonth() + 1, u.getFullYear()), u.setDate(a), this._isValidDate(u) ? (this._internalSetDate(u), !0) : !1) : (o.setFullYear(e), this._internalSetDate(o), !0); return t && t.isreset ? (o.setFullYear(1), this._internalSetDate(o), !0) : !1 } catch (f) { return !1 } }, i.prototype.getYear = function () { return this.getDate().getFullYear() }, i.prototype.setMonth = function (e, t, n) { try { n && n.isfullreset && (e = "1"), e *= 1; var r = this.getDate(), i, s; if (typeof t != "undefined" && !t) if (e > 12 || e < 1) { if (!n || !n.isreset) return !1; e = 1 } return i = this.daysInMonth(this.getMonth(), this.getYear()), i === this.getDate().getDate() ? (s = new Date(r.getTime()), s.setDate(1), s.setMonth(e - 1), i = this.daysInMonth(s.getMonth() + 1, s.getFullYear()), s.setDate(i), this._isValidDate(s) ? (this._internalSetDate(s), !0) : !1) : (s = new Date(r.getTime()), s.setMonth(e - 1), this._isValidDate(s) ? (this._internalSetDate(s), !0) : !1) } catch (o) { return !1 } }, i.prototype.getMonth = function () { return this.getDate().getMonth() + 1 }, i.prototype.setDayOfMonth = function (e, t, n) { try { if (n && n.isfullreset) return this.setDayOfMonth(1, t); var r = this.getDate(), i, s; e *= 1; if (typeof t != "undefined" && !t) { i = this.daysInMonth(this.getMonth(), this.getYear()); if (e > i || e < 1) return n && n.isreset ? this.setDayOfMonth(1, t, n) : !1 } return s = new Date(r.getTime()), s.setDate(e), this._isValidDate(s) ? (this._internalSetDate(s), !0) : !1 } catch (o) { return !1 } }, i.prototype.getDayOfMonth = function () { return this.getDate().getDate() }, i.prototype.setHours = function (e, t) { try { e *= 1; if (typeof t != "undefined" && !t && e > 24) return !1; var n = new Date(this.getDate().getTime()); return n.setHours(e), this._isValidDate(n) ? (this._internalSetDate(n), !0) : !1 } catch (r) { return !1 } }, i.prototype.getHours = function () { return this.getDate().getHours() }, i.prototype.setMinutes = function (e, t) { try { e *= 1; if (typeof t != "undefined" && !t && e > 60) return !1; var n = new Date(this.getDate().getTime()); return n.setMinutes(e), this._isValidDate(n) ? (this._internalSetDate(n), !0) : !1 } catch (r) { return !1 } }, i.prototype.getMinutes = function () { return this.getDate().getMinutes() }, i.prototype.setSeconds = function (e, t) { try { e *= 1; if (typeof t != "undefined" && !t && e > 60) return !1; var n = new Date(this.getDate().getTime()); return n.setSeconds(e), this._isValidDate(n) ? (this._internalSetDate(n), !0) : !1 } catch (r) { return !1 } }, i.prototype.getSeconds = function () { return this.getDate().getSeconds() }, i.prototype.setDayOfWeek = function (e) { try { e *= 1; var t = e - this.getDayOfWeek(); return this.setDayOfMonth(this.getDayOfMonth() + t, !0) } catch (n) { return !1 } }, i.prototype.getDayOfWeek = function () { return this.getDate().getDay() + 1 }, i.prototype.handlePattern = function (e) { var t = new RegExp("y{3,4}"), n = t.test(e); return n ? (this.descriptors.push(this.createDescriptor(10)), !0) : (t = new RegExp("y{2,2}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(2)), !0) : (t = new RegExp("y{1,1}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(1)), !0) : (t = new RegExp("d{4,4}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(101)), !0) : (t = new RegExp("d{3,3}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(100)), !0) : (t = new RegExp("d{2,2}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(30)), !0) : (t = new RegExp("d{1,1}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(31)), !0) : (t = new RegExp("M{4,4}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(27)), !0) : (t = new RegExp("M{3,3}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(26)), !0) : (t = new RegExp("M{2,2}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(20)), !0) : (t = new RegExp("M{1,1}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(25)), !0) : (t = new RegExp("h{2,2}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(46)), !0) : (t = new RegExp("h{1,1}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(45)), !0) : (t = new RegExp("H{2,2}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(48)), !0) : (t = new RegExp("H{1,1}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(47)), !0) : (t = new RegExp("m{2,2}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(50)), !0) : (t = new RegExp("m{1,1}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(51)), !0) : (t = new RegExp("s{2,2}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(60)), !0) : (t = new RegExp("s{1,1}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(61)), !0) : (t = new RegExp("t{2,2}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(251)), !0) : (t = new RegExp("t{1,1}"), n = t.test(e), n ? (this.descriptors.push(this.createDescriptor(250)), !0) : !1)))))))))))))))))))) }, i.prototype.createDescriptor = function (e, t) { var n = null, r = this.maskPartsCount++; switch (e) { case -1: n = new f(this, r), n.liternal = t; break; case 20: n = new c(this, r); break; case 25: n = new h(this, r); break; case 26: n = new p(this, r); break; case 27: n = new d(this, r); break; case 30: n = new m(this, r); break; case 31: n = new g(this, r); break; case 100: n = new y(this, r); break; case 101: n = new b(this, r); break; case 10: n = new E(this, r); break; case 1: n = new x(this, r); break; case 2: n = new T(this, r); break; case 45: n = new k(this, r); break; case 46: n = new L(this, r); break; case 47: n = new O(this, r); break; case 48: n = new M(this, r); break; case 250: n = new D(this, r); break; case 251: n = new P(this, r); break; case 50: n = new B(this, r); break; case 51: n = new j(this, r); break; case 60: n = new I(this, r); break; case 61: n = new q(this, r); break; default: } return n }, i.prototype.toString = function () { if (this.inputWidget.options.showNullText && !this.inputWidget.isFocused() && this.inputWidget.isDateNull()) return this.inputWidget.options.nullText; var e = "", t = 0, n, r, i; this.desPostions = new Array(0); for (n = 0; n < this.descriptors.length; n++) { this.descriptors[n].startIndex = e.length, r = this.descriptors[n].getText(), e += r; for (i = 0; i < r.length; i++) { this.desPostions.push({ desc: this.descriptors[n], pos: i, text: r, length: r.length }), t++; if (this.desPostions.length !== t) throw "Fatal Error !!!!!!!!!!!!!!!" } } return e }, i.prototype.parseDate = function (e) { var t; if (this.pattern === "dddd" || this.pattern === "ddd" || typeof e == "object") try { t = new Date(e), isNaN(t) && (t = new Date) } catch (n) { t = new Date } else t = Globalize.parseDate(e, this.pattern, this._getCulture()), t || (t = this._tryParseDate(e, this.pattern)), t || (t = new Date); return t }, i.prototype.set = function (e) { return this._internalSetDate(new Date(this.parseDate(e))), !0 }, i.prototype.haveEnumParts = function () { return !1 }, i.prototype.removeLiterals = function (e) { return e = "" + e + "", e = e.replace(new RegExp("[+]", "g"), ""), e = e.replace(new RegExp("[.]", "g"), ""), e = e.replace(new RegExp("[:]", "g"), ""), e = e.replace(new RegExp("[-]", "g"), ""), e = e.replace(new RegExp("[()=]", "g"), ""), e }, i.prototype.getFirstDelimiterPos = function (e, t) { var n = 0, r = 0, i, s; while (n < t.length && r < e.length) { i = t.charAt(n), s = e.charAt(r); if (i !== s) return r - 1; r++, n++ } return e.length - 1 }, i.prototype.findAlikeArrayItemIndex = function (e, t) { var n = -1, r = 99999, i, s; for (i = 0; i < e.length; i++) s = e[i].toLowerCase().indexOf(t.toLowerCase()), s !== -1 && s < r && (r = s, n = i); return n }, i.prototype._isValidDate = function (e) { return this.inputWidget._isValidDate(e) }, i.prototype.isFieldSep = function (e, t) { var n = t++, r; return n < this.descriptors.length ? (r = this.descriptors[n], r.type !== -1 ? !1 : e === r.text) : !1 }, i.prototype.getPositionType = function (e) { var t = this.desPostions[e]; return t.desc.type }, i.prototype.addToField = function (e, t, n) { var r = this.fields[t], i, s, o; return i = e, s = { val: e, pos: 0, offset: 0, isreset: !1 }, this.inputWidget.element.data("typing", !0), o = r.setText(i, e.length === 1 ? !1 : !0, s), this.inputWidget.element.data("typing", !1), o }, i.prototype.insertAt = function (t, n, r) { typeof r == "undefined" && (r = new e.wijInputResult), r.testPosition = -1; var i, s, o, u, a, f, l, c, h, p, d, v, m, g, y, b, w; if (t.length === 1) { i = this.desPostions[n]; if (i && i.desc.type === -1 && i.text === t) return r.testPosition = n, r.hint = r.characterEscaped, !0 } s = t, o = n, t = this.removeLiterals(t), u = t, a = !1, l = !1, o > 0 && u.length === 1 && (o--, n = o, i = this.desPostions[o], a = !0, i && (i.desc.type === -1 || i.desc.getText().length !== 1) && (n++, o++, a = !1)), f = !1; while (u.length > 0 && o < this.desPostions.length) { i = this.desPostions[o]; if (i.desc.type === -1) { o += i.length; continue } if (i.desc.needAdjustInsertPos()) { c = u.substr(0, i.length - i.pos), c = i.text.slice(0, i.pos) + c + i.text.slice(i.pos + c.length, i.length), a && (c = i.text + c), l && (c += i.text), p = i.desc.getText().length, v = ""; try { t.length === 1 && (i.pos ? i.pos > 0 && (v = c.substring(0, i.pos + 1)) : v = t) } catch (E) { } p === 1 && c.length > 1 && t.length === 1 && (i.desc.type === 31 || i.desc.type === 25) && (this._disableSmartInputMode = !0), h = { val: t, pos: i.pos, offset: 0, isreset: !1 }, f = i.desc.setText(c, t.length === 1 ? !1 : !0, h), this._disableSmartInputMode = !1, !f && typeof v != "undefined" && v.length > 0 && (i.desc.type === 26 || i.desc.type === 27 || i.desc.type === 100 || i.desc.type === 101 || i.desc.type === 250 || i.desc.type === 251) && (f = i.desc.setText(v, t.length === 1 ? !1 : !0, h)); if (f) r.hint = r.success, r.testPosition = o + h.offset, t.length === 1 && (m = i.desc.getText().length, d = i.pos, i.pos > m - 1 && (d = m), g = m - p, g > 0 && i.pos === p - 1 && (d = m - 1), y = this.toString(), r.testPosition = i.desc.startIndex + d + h.offset), u = u.slice(i.length - i.pos, u.length); else { r.hint = r.invalidInput, r.testPosition !== -1 && (r.testPosition = n); if (i.desc.type !== -1 && t.length === 1) return !1 } o += i.length } else b = this.getFirstDelimiterPos(u, s), b < 0 && (b = 0), c = u.substring(0, b + 1), h = { val: t, pos: i.pos, offset: 0, isreset: !1 }, f = i.desc.setText(c, t.length === 1 ? !1 : !0, h), f ? (r.hint = r.success, r.testPosition = o + h.offset, u = u.slice(b + 1, u.length)) : (r.hint = r.invalidInput, r.testPosition !== -1 && (r.testPosition = n)), b < 0 && (b = 0), w = b + 1, o += w } return f }, i.prototype.removeAt = function (e, t, n) { try { var r = this.desPostions[e], i, s, o, u, a = this.inputWidget, f = a.element, l = f.val().length; return l === t + 1 && e === 0 && (a.isDeleteAll = !0), r.desc.needAdjustInsertPos() && (i = "0", s = e, r.text = r.desc.getText(), i = r.text.slice(0, r.pos) + i + r.text.slice(r.pos + i.length, r.length), o = { val: i, pos: r.pos, offset: 0, isreset: !0, isfullreset: !1 }, t - e + 1 >= r.length && (o.isfullreset = !0, e += r.length, s = e), u = r.desc.setText(i, !1, o), u ? (n.hint = n.success, n.testPosition = s) : (n.hint = n.invalidInput, n.testPosition === -1 && (n.testPosition = e))), e < t && this.removeAt(e + 1, t, n), !0 } catch (c) { return !1 } }, i.prototype.incEnumPart = function () { var e = this.fields[this.inputWidget.options.activeField]; return e && e.inc(), !0 }, i.prototype.decEnumPart = function (e) { var t = this.fields[this.inputWidget.options.activeField]; return t && t.dec(), !0 }, i.prototype.setValue = function (e) { return this.setDate(new Date(e instanceof Date ? e.getTime() : e)), !0 }, i.prototype.getValue = function () { return this.getDate() }, i.prototype._isSmartInputMode = function () { return this._disableSmartInputMode ? !1 : this.inputWidget ? this.inputWidget.options.smartInputMode : !0 }, i.prototype._getInt = function (e, n, r, i) { var s, o; for (s = i; s >= r; s--) { o = e.substring(n, n + s); if (o.length < r) return null; if (t.wij.charValidator.isDigit(o)) return o } return null }, i.prototype._tryParseDate = function (e, t) { var n = this._getCulture().calendars, r, i, s, o; return t = t || n.standard.patterns.d, t && (t.indexOf("MMM") === -1 && t.indexOf("MMMM") === -1 && (t = t.replace("MM", "M")), t = t.replace("dd", "d"), t = t.replace("tt", "a")), r = t.replace("yyyy", "yy"), i = n.standard["/"], s = [t, r, t.replace(new RegExp(i, "g"), "-"), r.replace(new RegExp(i, "g"), "-"), t.replace(new RegExp(i, "g"), "."), r.replace(new RegExp(i, "g"), ".")], o = Globalize.parseDate(e, s, this._getCulture()), o ? o : (o = new Date(e), o.toString() !== "Invalid Date" && e && e !== "" ? o : 0) }, i.prototype._formatDate = function (e, t, n) { var i = this; if (!e.valueOf()) return "&nbsp;"; var s = this.inputWidget._getCulture().calendars.standard, o = t.replace(new RegExp("yyyy|MMMM|MMM|MM|M|mm|m|dddd|ddd|dd|d|hh|h|HH|H|ss|s|tt|t|a/p", "gi"), function (t) { var o; switch (t) { case "yyyy": return r(e.getFullYear(), 4); case "MMMM": return n.dateTimeFormat.monthNames[e.getMonth()]; case "MMM": return n.dateTimeFormat.abbreviatedMonthNames[e.getMonth()]; case "MM": return i.paddingZero(e.getMonth() + 1, 2); case "M": return i.paddingZero(e.getMonth() + 1, 1); case "mm": return i.paddingZero(e.getMinutes(), 2); case "m": return i.paddingZero(e.getMinutes(), 1); case "dddd": return n.dateTimeFormat.dayNames[e.getDay()]; case "ddd": return n.dateTimeFormat.abbreviatedDayNames[e.getDay()]; case "dd": return i.paddingZero(e.getDate(), 2); case "d": return i.paddingZero(e.getDate(), 1); case "hh": return o = e.getHours() % 12, i.paddingZero(o ? o : 12, 2); case "h": return o = e.getHours() % 12, i.paddingZero(o ? o : 12, 1); case "HH": return i.paddingZero(e.getHours(), 2); case "H": return i.paddingZero(e.getHours(), 1); case "ss": return i.paddingZero(e.getSeconds(), 2); case "s": return i.paddingZero(e.getSeconds(), 1); case "tt": return e.getHours() < 12 ? s.AM[0] : s.PM[0]; case "t": return e.getHours() < 12 ? s.AM[0].length > 0 ? s.AM[0].charAt(0) : "" : s.PM[0].length > 0 ? s.PM[0].charAt(0) : ""; case "a/p": return e.getHours() < 12 ? "a" : "p" } return "N" }); return o }, i }(e.wijTextProvider); e.wijDateTextProvider = o, function (e) { e._map = [], e.liternal = -1, e.OneDigitYear = 1, e.TwoDigitYear = 2, e.FourDigitYear = 10, e.TwoDigitMonth = 20, e.Month = 25, e.AbbreviatedMonthNames = 26, e.MonthNames = 27, e.TwoDigityDayOfMonth = 30, e.DayOfMonth = 31, e.AbbreviatedDayNames = 100, e.DayNames = 101, e.h = 45, e.hh = 46, e.H = 47, e.HH = 48, e.ShortAmPm = 250, e.AmPm = 251, e.mm = 50, e.m = 51, e.ss = 60, e.s = 61 }(e.DescriptorType || (e.DescriptorType = {})); var u = e.DescriptorType, a = function () { function e(e, t) { this.id = t, this.startIndex = 0, this.name = null, this.type = u.liternal, this.maxLen = 2, this._txtProvider = e, this.startIndex = 0 } return e.prototype.getText = function () { return null }, e.prototype.setText = function (e, t, n) { return !1 }, e.prototype.inc = function () { }, e.prototype.dec = function () { }, e.prototype.needAdjustInsertPos = function () { return !0 }, e.prototype.reachMaxLen = function () { var e = this.getText(); do { if (e.charAt(0) !== "0") break; e = e.slice(1) } while (e.length > 0); return e.length >= this.maxLen }, e }(); e._iDateDescriptor = a; var f = function (e) { function t(t, n) { e.call(this, t, n), this.liternal = "", this.maxLen = 100 } return __extends(t, e), t.prototype.getText = function () { return this.liternal }, t }(a), l = function (e) { function t(t, n) { e.call(this, t, n) } return __extends(t, e), t.prototype.inc = function () { this._txtProvider.setMonth(this._txtProvider.getMonth() + 1, !0) }, t.prototype.dec = function () { this._txtProvider.setMonth(this._txtProvider.getMonth() - 1, !0) }, t.prototype.setText = function (e, t, n) { return this._txtProvider.setMonth(e, t, n) }, t }(a), c = function (e) { function t(t, n) { e.call(this, t, n), this.name = "Two-digit month", this.type = u.TwoDigitMonth } return __extends(t, e), t.prototype.getText = function () { var e = "" + this._txtProvider.getMonth() + ""; return e.length === 1 ? "0" + e : e }, t }(l), h = function (e) { function t(t, n) { e.call(this, t, n), this.name = "month", this.type = u.Month } return __extends(t, e), t.prototype.getText = function () { var e = "" + this._txtProvider.getMonth() + ""; return e }, t }(l), p = function (e) { function t(t, n) { e.call(this, t, n), this.name = "AbbreviatedMonthNames", this.type = u.AbbreviatedMonthNames, this.maxLen = u.AbbreviatedMonthNames } return __extends(t, e), t.prototype.getText = function () { var e = this._txtProvider.getMonth(), t = this._txtProvider._getCulture(); return t.calendars.standard.months.namesAbbr[e - 1] }, t.prototype.setText = function (e, t, n) { var r = -1, i = this._txtProvider.inputWidget._getCulture().calendars.standard; return r = this._txtProvider.findAlikeArrayItemIndex(i.months.namesAbbr, e), r === -1 ? !1 : this._txtProvider.setMonth(r + 1, t, n) }, t }(l), d = function (e) { function t(t, n) { e.call(this, t, n), this.name = "MonthNames", this.type = u.MonthNames, this.maxLen = 100 } return __extends(t, e), t.prototype.getText = function () { var e = this._txtProvider.getMonth(), t = this._txtProvider._getCulture(); return t.calendars.standard.months.names[e - 1] }, t.prototype.setText = function (e, t, n) { var r = -1, i; if (n && n.isfullreset) r = 1; else { i = this._txtProvider._getCulture(), r = this._txtProvider.findAlikeArrayItemIndex(i.calendars.standard.months.names, e); if (r === -1) return !1 } return this._txtProvider.setMonth(r + 1, t, n) }, t }(l), v = function (e) { function t(t, n) { e.call(this, t, n) } return __extends(t, e), t.prototype.inc = function () { this._txtProvider.setDayOfMonth(this._txtProvider.getDayOfMonth() + 1, !0) }, t.prototype.dec = function () { this._txtProvider.setDayOfMonth(this._txtProvider.getDayOfMonth() - 1, !0) }, t.prototype.setText = function (e, t, n) { return this._txtProvider.setDayOfMonth(e, t, n) }, t }(a), m = function (e) { function t(t, n) { e.call(this, t, n), this.name = "Two-digit day of month", this.type = u.TwoDigityDayOfMonth } return __extends(t, e), t.prototype.getText = function () { return r(this._txtProvider.getDayOfMonth()) }, t }(v), g = function (e) { function t(t, n) { e.call(this, t, n), this.name = "Day of month", this.type = u.DayOfMonth } return __extends(t, e), t.prototype.getText = function () { var e = this._txtProvider.getDayOfMonth(); return "" + e + "" }, t }(v), y = function (e) { function t(t, n) { e.call(this, t, n), this.name = "AbbreviatedDayNames", this.type = u.AbbreviatedDayNames, this.maxLen = 100 } return __extends(t, e), t.prototype.getText = function () { var e = this._txtProvider.getDayOfWeek(), t = this._txtProvider._getCulture(); return t.calendars.standard.days.namesShort[e - 1] }, t.prototype.setText = function (e, t, n) { var r = -1, i = this._txtProvider._getCulture(); return r = this._txtProvider.findAlikeArrayItemIndex(i.calendars.standard.days.namesShort, e), r === -1 ? !1 : this._txtProvider.setDayOfWeek(r + 1) }, t.prototype.needAdjustInsertPos = function () { return !1 }, t }(v), b = function (e) { function t(t, n) { e.call(this, t, n), this.name = "DayNames", this.type = u.DayNames, this.maxLen = 100 } return __extends(t, e), t.prototype.getText = function () { var e = this._txtProvider.getDayOfWeek(), t = this._txtProvider._getCulture(); return t.calendars.standard.days.names[e - 1] }, t.prototype.setText = function (e, t, n) { var r = -1, i = this._txtProvider._getCulture(); return r = this._txtProvider.findAlikeArrayItemIndex(i.calendars.standard.days.names, e), r === -1 ? !1 : this._txtProvider.setDayOfWeek(r + 1) }, t.prototype.needAdjustInsertPos = function () { return !1 }, t }(v), w = function (e) { function t(t, n) { e.call(this, t, n) } return __extends(t, e), t.prototype.inc = function () { this._txtProvider.setYear(this._txtProvider.getYear() + 1, null, !0) }, t.prototype.dec = function () { this._txtProvider.setYear(this._txtProvider.getYear() - 1, null, !0) }, t }(a), E = function (e) { function t(t, n) { e.call(this, t, n), this.name = "Four-digit year", this.type = u.FourDigitYear, this.maxLen = 4 } return __extends(t, e), t.prototype.getText = function () { return r(this._txtProvider.getYear(), 4) }, t.prototype.setText = function (e, t, n) { if (this._txtProvider._isSmartInputMode() && n) { var r = 2e3, i, s, o, u, a, f, l, c; this._txtProvider.inputWidget.options.startYear && (r = this._txtProvider.inputWidget.options.startYear), s = r + 100 - 1, i = this._txtProvider.paddingZero(r, 4), s = this._txtProvider.paddingZero(s, 4); if (n.pos === 0 || n.pos === 1) { o = new Date, u = this._txtProvider.paddingZero(this._txtProvider.getYear(), 4); if (u.charAt(0) === "0" && u.charAt(1) === "0" && n.pos <= 1) return a = n.val, f = "00", a >= 5 ? f = i.slice(0, 2) : f = s.slice(0, 2), l = n.val + u.slice(3, 4), c = f + l, n.offset = 2 - n.pos, this._txtProvider.setYear(c, n), !0 } } return this._txtProvider.setYear(e, n) }, t }(w), S = function (e) { function t(t, n) { e.call(this, t, n) } return __extends(t, e), t.prototype.setText = function (e, t, n) { e = r(e); var i = r(this._txtProvider.getYear(), 4), s, o, u, a, f; return e === "00" && (s = this._txtProvider.getMonth(), o = this._txtProvider.getDayOfMonth(), u = this._txtProvider.getHours(), a = this._txtProvider.getMinutes(), f = this._txtProvider.getSeconds(), s === 1 && o === 1 && !u && !a && !f && (i = "0001", e = "01")), i.length >= 2 && (i = i.substr(0, 2) + e.substr(0, 2)), this._txtProvider.setYear(i, n) }, t }(w), x = function (e) { function t(t, n) { e.call(this, t, n), this.name = "One-digit year", this.type = u.OneDigitYear } return __extends(t, e), t.prototype.getText = function () { var e = r(this._txtProvider.getYear()); return e[0] === "0" && (e = e[1]), e }, t }(S), T = function (e) { function t(t, n) { e.call(this, t, n), this.name = "Two-digit year", this.type = u.TwoDigitYear } return __extends(t, e), t.prototype.getText = function () { return r(this._txtProvider.getYear(), 2) }, t }(S), N = function (e) { function t(t, n) { e.call(this, t, n) } return __extends(t, e), t.prototype.inc = function () { this._txtProvider.setHours(this._txtProvider.getHours() + 1, !0) }, t.prototype.dec = function () { this._txtProvider.setHours(this._txtProvider.getHours() - 1, !0) }, t }(a), C = function (e) { function t(t, n) { e.call(this, t, n) } return __extends(t, e), t.prototype.setText = function (e, t, n) { var r = this._txtProvider.getHours(); return r > 12 && (e = e * 1 + 12), this._txtProvider.setHours(e, t) }, t }(N), k = function (e) { function t(t, n) { e.call(this, t, n), this.name = "h", this.type = u.h } return __extends(t, e), t.prototype.getText = function () { var e = this._txtProvider.getHours(); return e > 12 ? e -= 12 : e === 0 && (e = 12), "" + e + "" }, t }(C), L = function (e) { function t(t, n) { e.call(this, t, n), this.name = "hh", this.type = u.hh } return __extends(t, e), t.prototype.getText = function () { var e = this._txtProvider.getHours(); if (e > 12) e -= 12; else if (e === 0) return "12"; return r(e) }, t }(C), A = function (e) { function t(t, n) { e.call(this, t, n) } return __extends(t, e), t.prototype.setText = function (e, t, n) { return this._txtProvider.setHours(e, t) }, t }(N), O = function (e) { function t(t, n) { e.call(this, t, n), this.name = "H", this.type = u.H } return __extends(t, e), t.prototype.getText = function () { var e = this._txtProvider.getHours(); return "" + e + "" }, t }(A), M = function (e) { function t(t, n) { e.call(this, t, n), this.name = "HH", this.type = u.HH } return __extends(t, e), t.prototype.getText = function () { return r(this._txtProvider.getHours()) }, t }(A), _ = function (e) { function t(t, n) { e.call(this, t, n) } return __extends(t, e), t.prototype.inc = function () { var e = (this._txtProvider.getHours() + 12) % 24; this._txtProvider.setHours(e, !0) }, t.prototype.dec = function () { var e = (this._txtProvider.getHours() + 12) % 24; this._txtProvider.setHours(e, !0) }, t.prototype.setText = function (e, t, n) { var r; return e.toLowerCase().indexOf("a") >= 0 ? (r = this._txtProvider.getHours() % 12, this._txtProvider.setHours(r, !0)) : e.toLowerCase().indexOf("p") >= 0 && (r = this._txtProvider.getHours() % 12 + 12, this._txtProvider.setHours(r, !0)), !0 }, t }(a), D = function (e) { function t(t, n) { e.call(this, t, n), this.name = "t", this.type = u.ShortAmPm } return __extends(t, e), t.prototype.getText = function () { var e = this._txtProvider.getHours(), t = this._txtProvider._getCulture(), n = t.calendars.standard[e < 12 ? "AM" : "PM"][0]; return n.charAt(0) || " " }, t }(_), P = function (e) { function t(t, n) { e.call(this, t, n), this.name = "tt", this.type = u.AmPm } return __extends(t, e), t.prototype.getText = function () { var e = this._txtProvider.getHours(), t = "", n = this._txtProvider._getCulture(); return e < 12 ? t = n.calendars.standard.AM[0] : t = n.calendars.standard.PM[0], t.length <= 0 && (t = " "), t }, t }(_), H = function (e) { function t(t, n) { e.call(this, t, n), this.delta = 1 } return __extends(t, e), t.prototype.inc = function () { this._txtProvider.setMinutes(this._txtProvider.getMinutes() + this.delta, !0) }, t.prototype.dec = function () { this._txtProvider.setMinutes(this._txtProvider.getMinutes() - this.delta, !0) }, t.prototype.setText = function (e, t, n) { return n && n.isfullreset && (e = "0"), this._txtProvider.setMinutes(e, t) }, t }(a), B = function (e) { function t(t, n) { e.call(this, t, n), this.name = "mm", this.type = u.mm } return __extends(t, e), t.prototype.getText = function () { return r(this._txtProvider.getMinutes()) }, t }(H), j = function (e) { function t(t, n) { e.call(this, t, n), this.name = "m", this.type = u.m, this.delta = 12 } return __extends(t, e), t.prototype.getText = function () { return this._txtProvider.getMinutes().toString() }, t }(H), F = function (e) { function t(t, n) { e.call(this, t, n) } return __extends(t, e), t.prototype.inc = function () { this._txtProvider.setSeconds(this._txtProvider.getSeconds() + 12, !0) }, t.prototype.dec = function () { this._txtProvider.setSeconds(this._txtProvider.getSeconds() - 12, !0) }, t.prototype.setText = function (e, t, n) { return n && n.isfullreset && (e = "0"), this._txtProvider.setSeconds(e, t) }, t }(a), I = function (e) { function t(t, n) { e.call(this, t, n), this.name = "ss", this.type = u.ss } return __extends(t, e), t.prototype.getText = function () { return r(this._txtProvider.getSeconds()) }, t }(F), q = function (e) { function t(t, n) { e.call(this, t, n), this.name = "s", this.type = u.s } return __extends(t, e), t.prototype.getText = function () { return this._txtProvider.getSeconds().toString() }, t }(F) })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; var t = jQuery; (function (e) { e._map = [], e.editOptional = 1, e.editRequired = 2, e.separator = 4, e.literal = 8 })(e.wijchartype || (e.wijchartype = {})); var n = e.wijchartype, r = function (e) { function t() { e.apply(this, arguments) } return __extends(t, e), t.prototype._createTextProvider = function () { this._textProvider = new s(this, this.options.mask, !1) }, t.prototype._checkMaskAndPassword = function () { var e = !this.options.mask || this.options.mask.length < 0; if (e && this._isPassword()) throw 'Option "passwordChar" requires a mask' }, t.prototype._updateIsPassword = function () { var e = this.options.passwordChar.length > 0 && this.element.attr("type") !== "password"; this.element.data("isPassword", e), this._checkMaskAndPassword() }, t.prototype._beginUpdate = function () { this.element.addClass(this.options.wijCSS.wijinputmask), this._updateIsPassword(), this.element.data("defaultText", this.options.text) }, t.prototype._setOption = function (t, n) { e.prototype._setOption.call(this, t, n); switch (t) { case "text": this.setText(n); break; case "mask": case "culture": if (typeof n == "undefined" || n.length <= 0) return; this._checkMaskAndPassword(); var r = this.getText(); t === "mask" && (this._textProvider.mask = n, this._textProvider.initialMask = n), this._textProvider.initialize(), this._textProvider.set(r), this._updateText(); break; case "promptChar": this._textProvider && (this._textProvider.updatePromptChar(), this._updateText()); break; case "hidePromptOnLeave": case "resetOnPrompt": this._updateText(); break; case "passwordChar": this._updateIsPassword(), this._updateText() } }, t.prototype._resetData = function () { var e = this.element.data("defaultText"); if (e === undefined || e === null) e = this.element.data("elementValue"); if (e === undefined || e === null) e = ""; this.setText(e) }, t.prototype._isPassword = function () { return !!this.element.data("isPassword") }, t.prototype._getTextWithPrompts = function () { return this._isInitialized() ? this._textProvider.toString(!0, !0, !1) : this.element.val() }, t.prototype._getTextWithLiterals = function () { return this._isInitialized() ? this._textProvider.toString(!0, !1, !0) : this.element.val() }, t.prototype._getTextWithPromptAndLiterals = function () { return this._isInitialized() ? this._textProvider.toString(!0, !0, !0) : this.element.val() }, t.prototype._getTextWithPromptAndLiteralsAndPassword = function () { return this._isInitialized() ? this._textProvider.toString(!1, !0, !0) : this.element.val() }, t.prototype._onChange = function () { if (!this.element) return; var e = this.element.val(), t = this.getText(); this.getText() !== e && this._getTextWithPrompts() !== e && this._getTextWithPromptAndLiterals() !== e && this._getTextWithPromptAndLiteralsAndPassword() !== e && this.setText(e) }, t.prototype._afterFocused = function () { (this._isNullText() || !!this.options.hidePromptOnLeave) && this._doFocus() }, t }(e.wijinputcore); e.wijinputmask = r; var i = function () { function t() { this.wijCSS = { wijinputmask: e.wijinputcore.prototype.options.wijCSS.wijinput + "-mask" }, this.text = null, this.mask = "", this.promptChar = "_", this.hidePromptOnLeave = !1, this.resetOnPrompt = !0, this.allowPromptAsInput = !1, this.passwordChar = "", this.resetOnSpace = !0, this.skipLiterals = !0 } return t }(); r.prototype.options = t.extend(!0, {}, e.wijinputcore.prototype.options, new i), t.wijmo.registerWidget("wijinputmask", r.prototype); var s = function (r) { function i(e, t, n) { r.call(this), this.inputWidget = e, this.mask = t, this.asciiOnly = n, this.testString = "", this.assignedCharCount = 0, this.requiredCharCount = 0, this.noMask = !1, this.descriptors = [], this.initialize() } return __extends(i, r), i.prototype.initialize = function () { this.noMask = !this.mask || this.mask.length <= 0; if (this.noMask) return; this.testString = "", this.assignedCharCount = 0, this.requiredCharCount = 0, this.descriptors = new Array(0); var e = "none", t = !1, r = 0, i, s, u, a = n.literal, f = "", l, c, h, p, d = this.inputWidget._getCulture(); for (i = 0; i < this.mask.length; i++) { u = !1, l = this.mask.charAt(i), t && (t = !1, u = !0); if (!u) { h = l; if (h <= "C") { switch (h) { case "#": case "9": case "?": case "C": l = this.getPromtChar(), a = n.editOptional, u = !0; break; case "$": f = d.numberFormat.currency.symbol, a = n.separator, u = !0; break; case "%": case "-": case ";": case "=": case "@": case "B": a = n.literal, u = !0; break; case "&": case "0": case "A": l = this.getPromtChar(), a = n.editRequired, u = !0; break; case ",": f = d.numberFormat[","], a = n.separator, u = !0; break; case ".": f = d.numberFormat["."], a = n.separator, u = !0; break; case "/": f = d.calendars.standard["/"], a = n.separator, u = !0; break; case ":": f = d.calendars.standard[":"], a = n.separator, u = !0; break; case "<": e = "lower"; continue; case ">": e = "upper"; continue } u || (a = n.literal, u = !0) } if (!u) { if (h <= "\\") { switch (h) { case "L": l = this.getPromtChar(), a = n.editRequired, u = !0; break; case "\\": t = !0, a = n.literal; continue } u || (a = n.literal, u = !0) } if (!u) { h === "a" && (l = this.getPromtChar(), a = n.editOptional, u = !0); if (!u) { h !== "|" && (a = n.literal, u = !0); if (!u) { e = "none"; continue } } } } } if (u) { p = new o(i, a), this.isEditDesc(p) && (p.caseConversion = e), a !== n.separator && (f = l); for (s = 0; s < f.length; s++) c = f.charAt(s), this.testString = this.testString + c, this.descriptors[this.descriptors.length] = p, r++ } } this.testString.Capacity = this.testString.length }, i.prototype.getAllowPromptAsInput = function () { return this.inputWidget ? this.inputWidget.options.allowPromptAsInput : !1 }, i.prototype.getPasswordChar = function () { return this.inputWidget ? this.inputWidget.options.passwordChar : "*" }, i.prototype.isPassword = function () { return this.inputWidget ? this.inputWidget._isPassword() : !1 }, i.prototype.getResetOnPrompt = function () { return this.inputWidget ? this.inputWidget.options.resetOnPrompt : !0 }, i.prototype.getResetOnSpace = function () { return this.inputWidget ? this.inputWidget.options.resetOnSpace : !0 }, i.prototype.getSkipLiterals = function () { return this.inputWidget ? this.inputWidget.options.skipLiterals : !0 }, i.prototype.getHidePromptOnLeave = function () { return this.inputWidget ? this.inputWidget.options.hidePromptOnLeave : !1 }, i.prototype._trueOR = function (e, t) { return (e >>> 1 | t >>> 1) * 2 + (e & 1 | t & 1) }, i.prototype.setValue = function (e) { return !1 }, i.prototype.getValue = function () { return null }, i.prototype.getPromtChar = function () { return this.inputWidget ? this.inputWidget.options.promptChar : "_" }, i.prototype.updatePromptChar = function () { if (this.noMask) return; var e, r; for (e = 0; e < this.descriptors.length; e++) { r = this.descriptors[e]; if (r.charType === n.editOptional || r.charType === n.editRequired) r.isAssigned || (this.testString = t.wij.charValidator.setChar(this.testString, this.getPromtChar(), e)) } }, i.prototype.resetChar = function (e) { var r = this.descriptors[e]; this.isEditPos(e) && r.isAssigned && (r.isAssigned = !1, this.testString = t.wij.charValidator.setChar(this.testString, this.getPromtChar(), e), this.assignedCharCount--, r.charType === n.editRequired && this.requiredCharCount--) }, i.prototype.getAdjustedPos = function (e) { return this.noMask ? e >= this.testString.length && (e = this.testString.length - 1) : e >= this.descriptors.length && (e -= 1), Math.max(0, e) }, i.prototype.incEnumPart = function (e, t, n) { return !this.noMask }, i.prototype.decEnumPart = function (e, t, n) { return !this.noMask }, i.prototype.findNonEditPositionInRange = function (e, t, r) { return this.findPositionInRange(e, t, r, this._trueOR(n.literal, n.separator)) }, i.prototype.findPositionInRange = function (e, t, n, r) { e = Math.max(0, e), t = Math.min(t, this.testString.length - 1); if (e <= t) while (e <= t) { var i = n ? e++ : t--, s = this.descriptors[i]; if ((s.charType & 4294967295 & (r & 4294967295)) === s.charType) return i } return -1 }, i.prototype.findAssignedEditPositionInRange = function (e, t, r) { return this.assignedCharCount === 0 ? -1 : this.findEditPositionInRange(e, t, r, n.editRequired) }, i.prototype.findEditPositionInRange = function (e, t, r, i) { do { var s, o; s = this.findPositionInRange(e, t, r, this._trueOR(n.editRequired, n.editOptional)); if (s === -1) break; o = this.descriptors[s]; switch (i) { case n.editOptional: if (!o.isAssigned) return s; break; case n.editRequired: if (o.isAssigned) return s; break; default: return s } r ? e++ : t-- } while (e <= t); return -1 }, i.prototype.findAssignedEditPositionFrom = function (e, t) { if (!this.assignedCharCount) return -1; var n, r; return t ? (n = e, r = this.testString.length - 1) : (n = 0, r = e), this.findAssignedEditPositionInRange(n, r, t) }, i.prototype.findEditPositionFrom = function (e, t) { var n, r; return t ? (n = e, r = this.testString.length - 1) : (n = 0, r = e), this.findEditPositionInRange(n, r, t, 0) }, i.prototype.setChar = function (e, r, i) { r = r < 0 ? 0 : r, i || (i = this.descriptors[r]), this.testEscapeChar(e, r, i) ? this.resetChar(r) : (t.wij.charValidator.isLetter(e) && (t.wij.charValidator.isUpper(e) ? i.caseConversion === "lower" && (e = e.toLowerCase()) : i.caseConversion === "upper" && (e = e.toUpperCase())), this.testString = t.wij.charValidator.setChar(this.testString, e, r), i.isAssigned || (i.isAssigned = !0, this.assignedCharCount++, i.charType === n.editRequired && this.requiredCharCount++)) }, i.prototype.internalInsertAt = function (t, n, r, i) { if (t.length === 0) return r.testPosition = n, r.hint = r.noEffect, !0; if (!this._testString(t, n, r)) return !1; var s = this.findEditPositionFrom(n, !0), o = this.findAssignedEditPositionInRange(s, r.testPosition, !0) !== -1, u = this.findAssignedEditPositionFrom(this.testString.length - 1, !1), a, f, l, c, h; if (o && r.testPosition === this.testString.length - 1) return r.hint = r.unavailableEditPosition, r.testPosition = this.testString.length, !1; a = this.findEditPositionFrom(r.testPosition + 1, !0); if (o) { f = new e.wijInputResult, f.hint = f.unknown, l = !0; while (l) { l = !1; if (a === -1) return r.hint = r.unavailableEditPosition, r.testPosition = this.testString.length, !1; c = this.descriptors[s]; if (c.isAssigned && !this.testChar(this.testString.charAt(s), a, f)) return r.hint = f.hint, r.testPosition = a, !1; if (s !== u) { s = this.findEditPositionFrom(s + 1, !0), a = this.findEditPositionFrom(a + 1, !0), l = !0; continue } } f.hint > r.hint && (r.hint = f.hint) } if (!i) { if (o) while (s >= n) h = this.descriptors[s], h.isAssigned ? this.setChar(this.testString.charAt(s), a) : this.resetChar(a), a = this.findEditPositionFrom(a - 1, !1), s = this.findEditPositionFrom(s - 1, !1); this.setString(t, n) } return !0 }, i.prototype.insertAt = function (t, n, r) { typeof r == "undefined" && (r = new e.wijInputResult); if (t === undefined) throw "InsertAt: input"; return this.noMask ? (this.testString = this.testString.substring(0, n) + t + this.testString.substring(n, this.testString.length), r.testPosition = n + t.length - 1, !0) : n >= 0 && n < this.testString.length ? this.internalInsertAt(t, n, r, !1) : (r.testPosition = n, r.hint = r.positionOutOfRange, !1) }, i.prototype.clear = function (e) { if (this.noMask) { this.testString = "", e.hint = e.success; return } if (!this.assignedCharCount) e.hint = e.noEffect; else { e.hint = e.success; for (var t = 0; t < this.testString.length; t++) this.resetChar(t) } }, i.prototype.isLiteral = function (e) { return e ? e.charType !== n.literal ? e.charType === n.separator : !0 : !1 }, i.prototype.testEscapeChar = function (e, t, n) { return t = t < 0 ? 0 : t, n || (n = this.descriptors[t]), this.isLiteral(n) ? this.getSkipLiterals() ? e === this.testString.charAt(t) : !1 : !!this.getResetOnPrompt() && e === this.getPromtChar() || !!this.getResetOnSpace() && e === " " ? !0 : !1 }, i.prototype.testChar = function (e, n, r) { if (!t.wij.charValidator.isPrintableChar(e)) return r.hint = r.invalidInput, !1; var i = this.descriptors[n]; if (!i) return !1; if (this.isLiteral(i)) return this.getSkipLiterals() && e === this.testString.charAt(n) ? (r.hint = r.characterEscaped, !0) : (r.hint = r.nonEditPosition, !1); if (e === this.getPromtChar()) { if (this.getResetOnPrompt()) return this.isEditDesc(i) && i.isAssigned ? r.hint = r.sideEffect : r.hint = r.characterEscaped, !0; if (!this.getAllowPromptAsInput()) return r.hint = r.promptCharNotAllowed, !1 } if (e === " " && this.getResetOnSpace()) return this.isEditDesc(i) && i.isAssigned ? r.hint = r.sideEffect : r.hint = r.characterEscaped, !0; switch (this.mask.charAt(i.maskPosition)) { case "L": if (!t.wij.charValidator.isLetter(e)) return r.hint = r.letterExpected, !1; if (!t.wij.charValidator.isAsciiLetter(e) && this.asciiOnly) return r.hint = r.asciiCharacterExpected, !1; break; case "a": if (!t.wij.charValidator.isAlphanumeric(e) && e !== " ") return r.hint = r.alphanumericCharacterExpected, !1; if (!t.wij.charValidator.isAciiAlphanumeric(e) && this.asciiOnly) return r.hint = r.asciiCharacterExpected, !1; break; case "?": if (!t.wij.charValidator.isLetter(e) && e !== " ") return r.hint = r.letterExpected, !1; if (t.wij.charValidator.isAsciiLetter(e) || !this.asciiOnly) break; return r.hint = r.asciiCharacterExpected, !1; case "A": if (!t.wij.charValidator.isAlphanumeric(e)) return r.hint = r.alphanumericCharacterExpected, !1; if (t.wij.charValidator.isAciiAlphanumeric(e) || !this.asciiOnly) break; return r.hint = r.asciiCharacterExpected, !1; case "C": if (!t.wij.charValidator.isAscii(e) && this.asciiOnly && e !== " ") return r.hint = r.asciiCharacterExpected, !1; break; case "9": if (!t.wij.charValidator.isDigit(e) && e !== " ") return r.hint = r.digitExpected, !1; break; case "#": if (!t.wij.charValidator.isDigit(e) && e !== "-" && e !== "+" && e !== " ") return r.hint = r.digitExpected, !1; break; case "&": if (!t.wij.charValidator.isAscii(e) && this.asciiOnly) return r.hint = r.asciiCharacterExpected, !1; break; case "0": if (!t.wij.charValidator.isDigit(e)) return r.hint = r.digitExpected, !1 } return e === this.testString.charAt(n) && i.isAssigned ? r.hint = r.noEffect : r.hint = r.success, !0 }, i.prototype._testString = function (t, n, r) { r.hint = r.unknown, r.testPosition = n; if (t.length) { var i = new e.wijInputResult, s, o; i.testPosition = r.testPosition, i.hint = r.hint; for (s = 0; s < t.length; s++) { o = t.charAt(s); if (r.testPosition > this.testString.length) return r.hint = r.unavailableEditPosition, !1; if (!this.testEscapeChar(o, r.testPosition)) { r.testPosition = this.findEditPositionFrom(r.testPosition, !0); if (r.testPosition === -1) return r.testPosition = this.testString.length, r.hint = r.unavailableEditPosition, !1 } if (!this.testChar(o, r.testPosition, i)) return r.hint = i.hint, !1; i.hint > r.hint && (r.hint = i.hint), r.testPosition += 1; if (r.testPosition === this.testString.length) break } r.testPosition -= 1 } return !0 }, i.prototype.set = function (t, n) { typeof n == "undefined" && (n = new e.wijInputResult); if (t === undefined) throw "SetFromPos: input parameter is null or undefined."; n.hint = n.unknown, n.testPosition = 0; if (!t.length) return this.clear(n), !0; if (this.noMask) return this.testString = t, !0; if (!this.testSetString(t, n.testPosition, n)) return !1; var r = this.findAssignedEditPositionFrom(n.testPosition + 1, !0); return r !== -1 && this.resetString(r, this.testString.length - 1), !0 }, i.prototype.resetString = function (e, t) { if (this.noMask) { this.testString = ""; return } e = this.findAssignedEditPositionFrom(e, !0); if (e !== -1) { t = this.findAssignedEditPositionFrom(t, !1); while (e <= t) e = this.findAssignedEditPositionFrom(e, !0), this.resetChar(e), e++ } }, i.prototype.setString = function (e, t) { var n, r; for (n = 0; n < e.length; n++) { r = e.charAt(n), this.testEscapeChar(r, t) || (t = this.findEditPositionFrom(t, !0)); if (t < 0 || t >= this.testString.length) return; this.setChar(r, t), t++ } }, i.prototype.testSetString = function (e, t, n) { return e.length > this.testString.length && (e = e.substring(0, this.testString.length)), this._testString(e, t, n) ? (this.setString(e, t), !0) : !1 }, i.prototype.toString = function (e, r, i, s, o) { var u = this.inputWidget.options.text || "", a, f, l, c, h, p, d, v, m; u = t.trim(u); if (this.inputWidget.options.showNullText && !this.inputWidget.isFocused() && (u === "" || u === this.inputWidget.options.nullText)) return this.inputWidget.options.nullText; e = e === undefined ? !this.isPassword() : e, r = r === undefined ? this.getHidePromptOnLeave() ? this.inputWidget.isFocused() : !0 : r, i = i === undefined ? !0 : i; if (this.noMask) { if (!e) { a = ""; for (f = 0; f < this.testString.length; f++) a += this.getPasswordChar(); return a } return this.testString } s = s === undefined ? 0 : s, o = o === undefined ? this.testString.length : o; if (o <= 0) return ""; s < 0 && (s = 0); if (s >= this.testString.length) return ""; l = this.testString.length - s, o > l && (o = l); if ((!this.isPassword() || e) && r && i) return c = this.testString.substring(s, o - s), c; h = "", p = s + o - 1; for (d = s; d <= p; d++) { v = this.testString.charAt(d), m = this.descriptors[d]; switch (m.charType) { case n.editOptional: case n.editRequired: if (!m.isAssigned) break; if (!this.isPassword() || e) { h += v; continue } h += this.getPasswordChar(); continue; case n.editRequired | n.editOptional: h += v; continue; case n.separator: case n.literal: if (!i) continue; h += v; continue; default: h += v; continue } if (r) { h += v; continue } h += " "; continue } return h }, i.prototype.isEditDesc = function (e) { return this.noMask ? !0 : e.charType !== n.editRequired ? e.charType === n.editOptional : !0 }, i.prototype.isEditPos = function (e) { if (this.noMask) return !0; if (e < 0 || e >= this.testString.length) return !1; var t = this.descriptors[e]; return this.isEditDesc(t) }, i.prototype.internalRemoveAt = function (t, n, r, i) { typeof i == "undefined" && (i = !1); if (this.noMask) { try { this.testString = this.testString.substring(0, t) + this.testString.substring(n + 1, this.testString.length), r.testPosition = t } catch (s) { } return !0 } var o = new e.wijInputResult, u, a, f, l, c, h, p, d, v, m, g = this.findAssignedEditPositionFrom(this.testString.length - 1, !1); f = this.findEditPositionInRange(t, n, !0, 0), r.hint = r.noEffect; if (f === -1 || f > g) return r.testPosition = t, !0; r.testPosition = t, l = n < g, this.findAssignedEditPositionInRange(t, n, !0) !== -1 && (r.hint = r.success); if (l) { c = this.findEditPositionFrom(n + 1, !0), h = c, t = f, p = !0; while (p) { p = !1, u = this.testString.charAt(c), d = this.descriptors[c]; if ((u !== this.getPromtChar() || d.isAssigned) && !this.testChar(u, f, o)) return r.hint = o.hint, r.testPosition = f, !1; if (c !== g) { c = this.findEditPositionFrom(c + 1, !0), f = this.findEditPositionFrom(f + 1, !0), p = !0; continue } } r.sideEffect > r.hint && (r.hint = r.sideEffect); if (i) return !0; c = h, f = t, v = !0; while (v) { v = !1, a = this.testString.charAt(c), m = this.descriptors[c], a === this.getPromtChar() && !m.isAssigned ? this.resetChar(f) : (this.setChar(a, f), this.resetChar(c)); if (c !== g) { c = this.findEditPositionFrom(c + 1, !0), f = this.findEditPositionFrom(f + 1, !0), v = !0; continue } } t = f + 1 } return t <= n && this.resetString(t, n), !0 }, i.prototype.removeAt = function (t, n, r) { typeof n == "undefined" && (n = t), typeof r == "undefined" && (r = new e.wijInputResult); if (n >= this.testString.length) return r.testPosition = n, r.hint = r.positionOutOfRange, !1; if (t >= 0 && t <= n) { var i = this.internalRemoveAt(t, n, r, !1); return i } return r.testPosition = t, r.hint = r.positionOutOfRange, !1 }, i }(e.wijTextProvider); e.wijMaskedTextProvider = s; var o = function () { function e(e, t) { this.maskPos = e, this.charType = t, this.caseConversion = "none", this.isAssigned = !1, this.maskPosition = 0, this.maskPosition = e, this.charType = t } return e }(); e.wijCharDescriptor = o })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; var t = jQuery, n = function (n) { function r() { n.apply(this, arguments) } return __extends(r, n), r.prototype._createTextProvider = function () { this._textProvider = new i(this, this.options.type), this._textProvider._nullvalue = this.element.val() === "" && this.options.value === null }, r.prototype._beginUpdate = function () { var e = this.options; this.element.addClass(e.wijCSS.wijinputnumber), this.element.data({ defaultValue: e.value, preValue: e.value }).attr({ "aria-valuemin": e.minValue, "aria-valuemax": e.maxValue, "aria-valuenow": e.value || 0 }) }, r.prototype._setOption = function (e, t) { n.prototype._setOption.call(this, e, t); switch (e) { case "minValue": this.element.attr("aria-valuemin", t), this._updateText(); break; case "maxValue": this.element.attr("aria-valuemax", t), this._updateText(); break; case "value": this.setValue(t), this._updateText(); break; case "showGroup": case "decimalPlaces": case "culture": this._textProvider.updateStringFormat(), this._updateText() } }, r.prototype._setData = function (e) { this.setValue(e) }, r.prototype._resetData = function () { var e = this.element.data("defaultValue"); if (e === undefined || e === null) { e = this.element.data("elementValue"); if (e === undefined || e === null && e === "") e = 0 } this.setValue(e) }, r.prototype._validateData = function () { this._textProvider.checkAndRepairBounds(!0, !1) || this._updateText() }, r.prototype._raiseDataChanged = function () { var e = this.options.value, t = this.element.data("preValue"); this.element.data("preValue", e), t !== e && (this.element.attr("aria-valuenow", e), this._trigger("valueChanged", null, { value: e })) }, r.prototype.getValue = function () { var e = this._textProvider.getValue(); if (e === undefined || e === null) e = this.getText(); return e }, r.prototype.setValue = function (e, t) { typeof t == "undefined" && (t = !1); try { t = !!t, typeof e == "boolean" ? e = e ? "1" : "0" : typeof e == "string" && (e = this._textProvider.tryParseValue(e)); if (this._textProvider.setValue(e)) this._updateText(); else if (t) { var n = "", r; n = this.getText(), this.setText(e), e = e.trim(), r = this.getText().trim(), r !== e && this.setText(n) } else this.setText(e); return !0 } catch (i) { return !1 } }, r.prototype.isValueNull = function () { try { return this._textProvider.isValueNull() } catch (e) { return !0 } }, r.prototype.getPostValue = function () { if (!this._isInitialized()) return this.element.val(); if (this.options.showNullText && this.isValueNull()) return "0"; var e = this.options.value ? this.options.value : 0; return this.options.type === "percent" && (e = (e / 100).toFixed(10)), e.toString() }, r.prototype._updateText = function (e) { typeof e == "undefined" && (e = !1); if (!this._isInitialized()) return; this.options.value = this._textProvider.getValue(), n.prototype._updateText.call(this, e), this._textProvider.checkAndRepairBounds(!1, !1) || this._trigger("valueBoundsExceeded") }, r.prototype._doSpin = function (n, r) { if (!this._allowEdit()) return !1; if (r && this.element.data("breakSpinner")) return !1; var i = this.element.wijtextselection(), s = new e.wijInputResult; return this.element.data("focusNotCalledFirstTime") !== -9 && (new Date).getTime() - this.element.data("focusNotCalledFirstTime") < 600 && (this.element.data("focusNotCalledFirstTime", -9), this.element.data("prevCursorPos", 0)), this.element.data("prevCursorPos") === -1 ? this.element.data("prevCursorPos", i.start) : i.start = this.element.data("prevCursorPos"), s.testPosition = i.start, this._textProvider[n ? "incEnumPart" : "decEnumPart"](i.start, s, this.options.increment), this._updateText(), this.element.data("prevCursorPos", s.testPosition), this.selectText(s.testPosition, s.testPosition), r && !this.element.data("breakSpinner") && window.setTimeout(t.proxy(function () { this._doSpin(n, !0) }, this), this._calcSpinInterval()), !0 }, r.prototype._deleteSelText = function (e) { typeof e == "undefined" && (e = !1); var t = this.element.wijtextselection(), r = t.start === 0 && t.end === this.element.val().length, i; if (t.start === t.end && !e) { i = this._textProvider._stringFormat._currentText; if (i.charAt(t.end) === this._textProvider.getGroupSeparator() || i.charAt(t.end) === this._textProvider.getDecimalSeparator()) { t.start++, t.end++, this.element.wijtextselection(t); return } } n.prototype._deleteSelText.call(this, e), r && (this._textProvider._nullvalue = !0, this._updateText(!0)) }, r }(e.wijinputcore); e.wijinputnumber = n; var r = function () { function t() { this.wijCSS = { wijinputnumber: e.wijinputcore.prototype.options.wijCSS.wijinput + "-numeric" }, this.type = "numeric", this.value = null, this.minValue = -1e9, this.maxValue = 1e9, this.showGroup = !1, this.decimalPlaces = 2, this.increment = 1, this.valueChanged = null, this.valueBoundsExceeded = null } return t }(); n.prototype.options = t.extend(!0, {}, e.wijinputcore.prototype.options, new r), t.wijmo.registerWidget("wijinputnumber", n.prototype); var i = function (n) { function r(e, t) { n.call(this), this._type = "numeric", this._stringFormat = null, this._nullvalue = !1, this.inputWidget = e, this._type = t, this._stringFormat = new s(this._type, this.inputWidget.options.decimalPlaces, this.inputWidget.options.showGroup, this._getCulture()), this._stringFormat._setValueFromJSFloat(this.getValue()) } return __extends(r, n), r.prototype._getCulture = function () { return this.inputWidget._getCulture() }, r.prototype.getDecimalSeparator = function () { return this._getCulture().numberFormat["."] }, r.prototype.getGroupSeparator = function () { return this._getCulture().numberFormat[","] }, r.prototype.tryParseValue = function (e) { return this._stringFormat.tryParseValue(e) }, r.prototype.toString = function () { return this.inputWidget.options.showNullText && !this.inputWidget.isFocused() && this.isValueNull() ? this.inputWidget.options.nullText : this._stringFormat.getFormattedValue() }, r.prototype.isValueNull = function () { var e = this.inputWidget.options, t = e.minValue; return null === e.value || undefined === e.value || t === e.value || this._nullvalue }, r.prototype.set = function (e, t) { return this.clear(), this.insertAt(e, 0, t), !0 }, r.prototype.clear = function () { this._stringFormat.clear() }, r.prototype.checkAndRepairBounds = function (e, t) { var n = !0, r, i; return typeof e == "undefined" && (e = !1), r = this.inputWidget.options.minValue, i = this.inputWidget.options.maxValue, typeof t != "undefined" && t ? this._stringFormat.checkMinValue(r, !1, !0) : (this._stringFormat.checkMinValue(r, e, !1) || (n = !1), this._stringFormat.checkMaxValue(i, e) || (n = !1), this.inputWidget.options.decimalPlaces >= 0 && this._stringFormat.checkDigitsLimits(this.inputWidget.options.decimalPlaces), n) }, r.prototype.countSubstring = function (e, t) { var n = 0, r = e.indexOf(t); while (r !== -1) n++, r = e.indexOf(t, r + 1); return n }, r.prototype.getAdjustedPositionFromLeft = function (e) { var n = this._stringFormat._currentText, r, i; for (r = 0; r < n.length; r++) { i = n.charAt(r); if (!(!t.wij.charValidator.isDigit(i) && i !== this.getGroupSeparator() && i !== this.getDecimalSeparator() || i === "0")) break; this._stringFormat.isZero() ? e < r && e++ : e <= r && e++ } return e }, r.prototype.getDecimalSeparatorPos = function () { var e = this._stringFormat._currentText; return e.indexOf(this.getDecimalSeparator()) }, r.prototype.removeLeadingZero = function (e) { var t = 0; (e.charAt(t) === " " || e.charAt(t) === this._getCulture().numberFormat.currency.symbol) && t++; while (e.charAt(t) === "0") e = e.substr(0, t) + e.substr(t + 1); return e }, r.prototype.insertAt = function (n, r, i) { var s = this._getCulture().numberFormat, o, u, a, f, l, c, h, p, d, v; i ? this._nullvalue = !1 : i = new e.wijInputResult; if (n.length === 1) { if (n === "+") return this._stringFormat.setPositiveSign(), this.checkAndRepairBounds(!0, !1), !0; if (n === "-" || n === ")" || n === "(") return this._stringFormat.invertSign(), this.checkAndRepairBounds(!0, !1), i.testPosition = r, this._stringFormat.isNegative() ? i.testPosition = r : i.testPosition = r - 2, !0; if (!t.wij.charValidator.isDigit(n)) { if (n === this.getDecimalSeparator()) { o = this.getDecimalSeparatorPos(); if (o >= 0) return i.testPosition = o, !0 } if (n !== this.getGroupSeparator() && n !== this.getDecimalSeparator() && n !== ")" && n !== "+" && n !== "-" && n !== "(" && n !== this.getDecimalSeparator()) return this._type === "percent" && n === s.percent.symbol ? (i.testPosition = r, !0) : this._type === "currency" && n === s.currency.symbol ? (i.testPosition = r, !0) : !1 } } r = this.getAdjustedPositionFromLeft(r), u = r, a = this._stringFormat._currentText, u > a.length && (u = a.length - 1), f = this.removeLeadingZero(a.substring(0, u)), l = a.substring(u, a.length), this._stringFormat.isZero() && (l = l.replace(/0/, "")), i.testPosition = f.length + n.length - 1, this._stringFormat.deFormatValue(f + n + l), c = this._stringFormat._currentText; try { this.inputWidget.options.showGroup ? (h = this.countSubstring(f, this._stringFormat._groupSeparator), p = this.countSubstring(c.substring(0, f.length + n.length), this._stringFormat._groupSeparator), i.testPosition += p - h) : n.length === 1 && (d = f.charAt(f.length - 1), v = c.charAt(i.testPosition - 1), v !== d && i.testPosition--) } catch (m) { } return !0 }, r.prototype.removeAt = function (t, n, r, i) { typeof r == "undefined" && (r = new e.wijInputResult), typeof i == "undefined" && (i = !1); var s = this._getCulture().numberFormat, o, u, a, f, l, c; r.testPosition = t; try { o = this._stringFormat._currentText; if (t === n && o.substring(t, n + 1) === this.getDecimalSeparator()) return !1; u = o.slice(0, t), a = u, f = o.slice(t, n + 1).indexOf(this.getDecimalSeparator()) >= 0, f && (a += this.getDecimalSeparator()), a += o.slice(n + 1), a = a || "0", this._stringFormat.deFormatValue(a), a = this._stringFormat._currentText, this._nullvalue = !1; if (this.inputWidget.options.showGroup) if (f) r.testPosition = a.indexOf(this.getDecimalSeparator()); else try { l = this.countSubstring(u, this._stringFormat._groupSeparator), c = this.countSubstring(a.substring(0, Math.max(0, t - 1)), this._stringFormat._groupSeparator), r.testPosition -= l - c, (o.indexOf(s.currency.symbol) === r.testPosition || o.indexOf(s.percent.symbol) === r.testPosition) && r.testPosition++ } catch (h) { } return !0 } catch (p) { } return !0 }, r.prototype.incEnumPart = function (t, n, r) { return n || (n = new e.wijInputResult), this._stringFormat.increment(r), this._nullvalue = !1, this.checkAndRepairBounds(!0, !1) }, r.prototype.decEnumPart = function (t, n, r) { return n || (n = new e.wijInputResult), this._stringFormat.decrement(r), this._nullvalue = !1, this.checkAndRepairBounds(!0, !1) }, r.prototype.getValue = function () { return this._stringFormat.getJSFloatValue() }, r.prototype.setValue = function (e) { try { return this._stringFormat._setValueFromJSFloat(e), this.checkAndRepairBounds(!0, !1), !0 } catch (t) { return !1 } }, r.prototype.updateStringFormat = function () { var e = "0"; typeof this._stringFormat != "undefined" && (e = this._stringFormat._currentValueInString), this._stringFormat = new s(this._type, this.inputWidget.options.decimalPlaces, this.inputWidget.options.showGroup, this._getCulture()), this._stringFormat._currentValueInString = e }, r }(e.wijTextProvider); e.wijNumberTextProvider = i; var s = function () { function e(e, t, n, r) { this.type = e, this.digitsPlaces = t, this.showGroup = n, this.culture = r, this._currentValueInString = "0", this._currentText = "0", this._groupSeparator = " " } return e.prototype.decimalSeparator = function () { return this.culture.numberFormat["."] }, e.prototype.isNegtive = function (e) { return e.indexOf("-") !== -1 || e.indexOf("(") !== -1 }, e.prototype.stripValue = function (e) { var t = this.culture.numberFormat, n = t[this.type] || t, r = this.isNegtive(e), i = n[","], s = n["."], o = new RegExp("[" + i + t.percent.symbol + t.currency.symbol + " ]", "g"), u; return this._groupSeparator = i, e = this._removeNegativeSign(e), e = e.replace(o, ""), e = e.replace(s, "."), u = /([\d\.])+/.exec(e), u && (e = u[0]), r && (e = "-" + e), e }, e.prototype.tryParseValue = function (e) { try { var t = parseFloat(this.stripValue(e)); return isNaN(t) && (t = 0), t } catch (n) { return 0 } }, e.prototype.deFormatValue = function (e) { e = this.stripValue(e), this._currentValueInString = e, this._currentText = this.formatValue(e) }, e.prototype.formatValue = function (e) { var t = this.culture.numberFormat, n = t[this.type] || t, r = this.digitsPlaces, i = this.isNegtive(e), s = n.pattern[i ? 0 : 1] || "n", o = n[","], u = n["."], a = r !== -2 ? r : n.decimals, f = this.showGroup ? n.groupSizes : [0], l; return e = this._removeLeadingZero(e), l = this.formatDigit(e, o, u, a, f), l = this._removeLeadingZero(l), l.indexOf(u) === 0 && (l = "0" + l), l === "" && (l = "0"), this._currentValueInString = e, this._currentText = this.applyFormatPattern(s, l, t.percent.symbol, t.currency.symbol), this._currentText }, e.prototype.getFormattedValue = function () { return this.formatValue(this._currentValueInString) }, e.prototype.getJSFloatValue = function () { try { return this._currentValueInString === "" ? 0 : parseFloat(this._currentValueInString) } catch (e) { return Number.NaN } }, e.prototype.clear = function () { this._currentValueInString = "0", this._currentText = "0" }, e.prototype._setValueFromJSFloat = function (e) { var t = "" + e; try { return this._currentValueInString = t, this.formatValue(t), !0 } catch (n) { return !1 } }, e.prototype.isZero = function (e) { typeof e == "undefined" && (e = this._currentValueInString); var t = this._removeNegativeSign(e), n; return t ? (n = parseFloat(t), !isNaN(n) && !n) : !0 }, e.prototype.setPositiveSign = function () { this._currentValueInString = this._removeNegativeSign(this._currentValueInString) }, e.prototype._removeNegativeSign = function (e) { return e.replace(/[()\-]/g, "") }, e.prototype._removeLeadingZero = function (e) { return e.replace(/^0+/, "") }, e.prototype.isNegative = function () { return this._currentValueInString.indexOf("-") !== -1 || this._currentValueInString.indexOf("(") !== -1 }, e.prototype.invertSign = function () { var e = this.isNegative(); e ? this.setPositiveSign() : this._currentValueInString = this._currentValueInString.length ? "-" + this._currentValueInString : "0", this.isZero() && (this._currentValueInString = e ? "0" : "-0"), this.formatValue(this._currentValueInString) }, e.prototype.parseNumber = function (e) { typeof e == "undefined" && (e = this._currentValueInString); var t = e.split(".", 2); return { decimal: parseInt(t[0], 10) || 0, fraction: (t.length > 1 ? parseInt(t[1], 10) : 0) || 0 } }, e.prototype._change = function (e) { var t = this.parseNumber(); this._currentValueInString = "" + (t.decimal + e) + "." + t.fraction }, e.prototype.increment = function (e) { typeof e == "undefined" && (e = 1), this._change(e) }, e.prototype.decrement = function (e) { typeof e == "undefined" && (e = 1), this._change(-e) }, e.prototype.checkDigitsLimits = function (e) { var t = this._currentValueInString.split("."), n = ""; if (!t.length || t.length === 1 && t[0] === "") return; t.length > 1 && (n = t[1]), n = n.substring(0, e); while (n.length < e) n += "0"; this._currentValueInString = t[0], n && (this._currentValueInString += "." + n) }, e.prototype.checkMinValue = function (e, t, n) { typeof n == "undefined" && (n = !1); var r = !0, i, s, o, u, a; try { i = this._currentValueInString.split("."), s = parseFloat(i[0] === "" || i[0] === "-" ? "0" : i[0]), o = 0, i.length > 1 && parseFloat(i[1]) > 0 && (o = parseFloat("1." + i[1])); if (s < 0 || i[0] === "-") o *= -1; e = "" + e + "", i = e.split("."), u = parseFloat(i[0]), a = 0, i.length > 1 && parseFloat(i[1]) > 0 && (a = parseFloat("1." + i[1])); if (s > u) return !0; s < u || n && s === u && o <= a ? r = !1 : s === u && s < 0 && o > a ? r = !1 : s === u && s >= 0 && o < a && (r = !1), !r && t && (this._currentValueInString = "" + e + "") } catch (f) { } return r }, e.prototype.checkMaxValue = function (e, t) { var n = !0, r, i, s, o, u; try { r = this._currentValueInString.split("."), i = parseFloat(r[0] === "" || r[0] === "-" ? "0" : r[0]), s = 0, r.length > 1 && parseFloat(r[1]) > 0 && (s = parseFloat("1." + r[1])); if (i < 0 || r[0] === "-") s *= -1; e = "" + e + "", r = e.split("."), o = parseFloat(r[0]), u = 0, r.length > 1 && parseFloat(r[1]) > 0 && (u = parseFloat("1." + r[1])); if (i < o) return !0; i > o && (n = !1), i === o && i >= 0 && s > u && (n = !1), i === o && i < 0 && s < u && (n = !1), !n && t && (this._currentValueInString = "" + e + "") } catch (a) { } return n }, e.prototype.applyFormatPattern = function (e, t, n, r) { return e.replace(/n/g, t).replace(/%/g, n).replace(/\$/g, r) }, e.prototype.formatDigit = function (e, t, n, r, i) { var s = this._removeNegativeSign(e), o, u, a, f, l, c; o = s.indexOf("."), o === -1 && (o = s.length), u = "", a = 0, f = 0; for (c = s.length - 1; c >= 0; c--) l = s.charAt(c), c < o && (u = l + u, f++, f === i[a] * 1 && i[a] * 1 && c && (u = t + u, f = 0, i.length - 1 > a && a++)); if (r > 0) { u += n; for (c = 0; c < r; c++) l = "0", c + o + 1 < s.length && (l = s.charAt(c + o + 1)), u += l } return r === -1 && o < s.length - 1 && (u += n, u += s.substr(o + 1)), u }, e }(); e.wijNumberFormat = s })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { (function (e) { "use strict"; function n(e, n) { var r = t.extend(!0, {}, e, n); return delete r.constructor, r } var t = jQuery; e.extendWidgetOptions = n })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { "use strict"; var t = jQuery, n = function (n) { function r() { n.apply(this, arguments), this._dataOffset = 0, this._scrollingState = { x: null, y: null, index: 0 }, this._windowResizeTimer = 0 } return __extends(r, n), r.prototype._createWidget = function (t, r) { var i = t && e.data.util.isClassInstance(t.data) && !(typeof wijdatasource == "function" && t.data instanceof wijdatasource) && t.data; i && delete t.data, n.prototype._createWidget.apply(this, arguments), i && this.option("data", i) }, r.prototype._create = function () { var n = this; if (!this.element.is("table")) throw "invalid markup"; this._windowResizeTimer = 0, this._dataOffset = 0, this._scrollingState = { x: null, y: null, index: 0 }, this._initialized = !1, this._destroyed = !1, this._rendered = !1, this._eventUID = undefined, this._dataViewWrapper = undefined, this._originalHtml = undefined, this._originalAttr = undefined, this._originalCssText = undefined, this._autoHeight = undefined, this._autoWidth = undefined, this._renderCounter = 0, this.$superPanelHeader = undefined, this.$topPagerDiv = undefined, this.$bottomPagerDiv = undefined, this.$groupArea = undefined, this.__uid = undefined, this._wijDataView = undefined, this.outerDiv = undefined, this.sketchTable = undefined, this.cellFormatter = undefined, this.rowStyleFormatter = undefined, this.cellStyleFormatter = undefined, this._eventUID = e.grid.getUID(), this._spinnerIsActivated = !1, this.options = t.extend(!0, {}, this.options), window.wijmoApplyWijTouchUtilEvents && (t = window.wijmoApplyWijTouchUtilEvents(t)), t.isFunction(window.wijmoASPNetParseOptions) && window.wijmoASPNetParseOptions(this.options), this._initialized = !1, this._destroyed = !1; var r = this.element[0].style.height, i = this.element[0].style.width; this._dataViewWrapper = new e.grid.dataViewWrapper(this), this._originalHtml = this.element.html(), this._originalAttr = {}, this._originalCssText = this.element[0].style.cssText, this.element.addClass("wijmo-wijgrid-root"), this.element.wrap('<div class="' + this.options.wijCSS.widget + " wijmo-wijgrid " + this.options.wijCSS.content + " " + this.options.wijCSS.cornerAll + '"></div>'), this.outerDiv = this.element.parent(), r && this.outerDiv.css("height", this.element[0].style.height), r !== "" && r !== "auto" ? this._autoHeight = !1 : this._autoHeight = !0, i && this.outerDiv.css("width", this.element[0].style.width), i !== "" && i !== "auto" ? this._autoWidth = !1 : this._autoWidth = !0, this.element.css({ height: "", width: "" }), this.options.disabled && this.disable(), this.cellFormatter = new e.grid.cellFormatterHelper, this.rowStyleFormatter = new e.grid.rowStyleFormatterHelper(this), this.cellStyleFormatter = new e.grid.cellStyleFormatterHelper(this), this._field("viewRenderBounds", { start: 0, end: 0 }), this._allowVirtualScrolling() && (this._field("viewRenderBounds").start = this._scrollingState.index, this._serverSideVirtualScrolling() && (this._dataOffset = this._scrollingState.index)), this.element.wijAddVisibilityObserver && this.element.wijAddVisibilityObserver(function () { n._initialized && !n._destroyed && n.setSize() }, "wijgrid"), this._renderCounter = 0 }, r.prototype._destroy = function () { var n, r = this; try { this._view().dispose(), this._detachEvents(!0), (n = this._field("resizer")) && n.dispose(), (n = this._field("frozener")) && n.dispose(), (n = this._field("selectionui")) && n.dispose(), (n = this._field("dragndrop")) && n.dispose(), this._dataViewWrapper.dispose(), e.grid.remove$dataByPrefix(this.element, this._data$prefix), this.element.wijRemoveVisibilityObserver && this.element.wijRemoveVisibilityObserver(), this.element.insertBefore(this.outerDiv), this.outerDiv.remove(), this.element.html(this._originalHtml), t.each(this._originalAttr, function (e, t) { t === undefined ? r.element.removeAttr(e) : r.element.attr(e, t) }), this.element.removeClass("wijmo-wijgrid-root"), this.element[0].style.cssText = this._originalCssText } finally { this._destroyed = !0 } }, r.prototype._init = function () { this.$superPanelHeader = null, this.$topPagerDiv = null, this.$bottomPagerDiv = null, this.$groupArea = null, this._field("closestCulture", Globalize.findClosestCulture(this.options.culture) || Globalize.findClosestCulture("default")), this.options.data || (this._field("thead") || this._field("thead", e.grid.readTableSection(this.element, 1)), this._field("tfoot") || this._field("tfoot", e.grid.readTableSection(this.element, 3))), this._initialized = this._initialized || !1, this.ensureControl(!0) }, r.prototype._setOption = function (e, t) { var r = this["_preset_" + e], i = this.options[e], s, o; r !== undefined && (t = r.apply(this, [t, i])), s = t !== i, n.prototype._setOption.apply(this, [e, t]), s && (o = this["_postset_" + e], o !== undefined && o.apply(this, [t, i])) }, r.prototype.columns = function () { return this._field("columns") || [] }, r.prototype.currentCell = function (t, n) { var r, i = this._view(), s = this._rows(); if (arguments.length === 0) return r = this._field("currentCell"), r || this._field("currentCell", r = e.grid.cellInfo.outsideValue), r; r = arguments.length === 1 ? t._clone() : new e.grid.cellInfo(t, n); if (!r.isEqual(e.grid.cellInfo.outsideValue)) { if (!r._isValid()) throw "invalid arguments"; r._clip(this._getDataCellsRange()); if (r.rowIndex() >= 0 && !(i._getRowInfo(s.item(r.rowIndex())).type & e.grid.rowType.data)) return } return r._setGridView(this), this._changeCurrentCell(null, r), this._field("currentCell") }, r.prototype.data = function () { return this._dataViewWrapper.dataView().getSource() }, r.prototype.dataView = function () { return this._dataViewWrapper.dataView() }, r.prototype.doRefresh = function (n) { t.isPlainObject(n) || (n = {}); var r, i = this, s = e.grid.EXPANDO, o = n && n.virtualScrollData; if (!this._initialized) try { this._prepareColumnOptions(!0, !0) } catch (u) { throw u } finally { this._ownerise(!0), this._initialized = !0 } if (!o) { this._rebuildLeaves(); var a = this._dataViewWrapper.data(), f = this._dataViewWrapper.dataView(); t.each(this._field("leaves"), function () { this._totalsValue = a.totals ? a.totals[this.dataKey] : undefined }), this.sketchTable = [], a.data && a.data.length ? (r = this._field("leaves"), t.each(a.data, function (e, t) { i.sketchTable.push(i._buildSketchRow(t, r)) })) : a.emptyData && (r = this._field("visibleLeaves"), t.each(a.emptyData, function (e, t) { i.sketchTable.push(i._buildSketchRowEmptyDataItem(t, r, e === a.emptyData.length - 1)) })) } this._onRendering(n), o ? this._refreshVirtual(n) : this._refresh(n), this._onRendered(n), n && t.isFunction(n.afterRefresh) && n.afterRefresh.apply(this, [n]) }, r.prototype.beginEdit = function () { return this._beginEditInternal(null) }, r.prototype.endEdit = function () { return this._endEditInternal(null) }, r.prototype.ensureControl = function (n, r) { this._loading(), t.isPlainObject(r) || (r = { data: null, afterRefresh: null, beforeRefresh: null }), r._wijgridMarker = !0, this._initialized ? this._convertWidgetsToOptions() : (this._prepareColumnOptions(this._dataViewWrapper.isDataLoaded(), !1), this._dataViewWrapper.isOwnDataView() || (new e.grid.settingsManager(this)).MapDVToWG()), this._ownerise(!0), this._initialized && r && t.isFunction(r.beforeRefresh) && r.beforeRefresh.apply(this), this._field("allowVirtualScrolling", null), n === !0 ? this._dataViewWrapper.load(r) : (this.doRefresh(r), this._loaded()) }, r.prototype.getCellInfo = function (e) { var t = null; return e && (e = this._findUntilOuterDiv(e, { td: !0, th: !0 })) && (t = this._view().getAbsoluteCellInfo(e)), t }, r.prototype.getFilterOperatorsByDataType = function (t) { return (new e.grid.filterOperatorsCache(this)).getByDataType(t || "string") }, r.prototype.pageCount = function () { return this._customPagingEnabled() ? Math.ceil(this.options.totalRows / this.options.pageSize) || 1 : this.options.allowPaging ? this._dataViewWrapper.dataView().pageCount() : 1 }, r.prototype._serverShaping = function () { return !1 }, r.prototype._pageIndexForDataView = function () { return this.options.pageIndex }, r.prototype.setSize = function (e, n) { var r = this._view(), i = { type: "", hScrollValue: null, vScrollValue: null }, s = this.outerDiv, o = this._field("frozener"), u = this._field("visibleLeaves"), a = []; r && r.getScrollValue && (i = r.getScrollValue()); if (e || e === 0) this._autoWidth = !1, s.width(e); if (n || n === 0) this._autoHeight = !1, s.height(n); t.each(u, function (e, n) { var i = r.getHeaderCell(e), s = r.getJoinedCols(e); t(i).css("width", ""), t.each(s, function (e, n) { t(n).css("width", "") }) }), this._view().updateSplits(i), o && o.refresh() }, r.prototype.selection = function () { var t = this._field("selection"); return t || this._field("selection", t = new e.grid.selection(this)), t }, r.prototype._onDataViewCurrentPositionChanged = function (t, n) { var r = this._dataViewWrapper.currentPosition(), i = new e.grid.cellInfo(this.currentCell().cellIndex(), this._dataViewDataRowIndexToGrid(r), null), s = this.selection(); i.rowIndex() < 0 ? i.cellIndex(-1) : i.cellIndex() < 0 && i.cellIndex(0), i = this.currentCell(i), s.beginUpdate(), s.clear(), i && i._isValid() && s._selectRange(new e.grid.cellInfoRange(i, i), !1, !1, 0, null), s.endUpdate() }, r.prototype._resetDataProperties = function () { this.options.pageIndex = 0; var e = this._field("viewRenderBounds"); e.start = e.end = 0 }, r.prototype._onDataViewLoading = function () { this._activateSpinner(), this._trigger("dataLoading") }, r.prototype._onDataViewReset = function (t) { (new e.grid.settingsManager(this)).MapDVToWG(), this._trigger("dataLoaded"), this.doRefresh(t), this._loaded() }, r.prototype._onDataViewLoaded = function () { }, r.prototype._loading = function () { this._activateSpinner(), this._trigger("loading") }, r.prototype._loaded = function () { this._deactivateSpinner(), this._trigger("loaded") }, r.prototype._buildSketchRow = function (t, n) { var r, i, s, o, u, a, f = [], l = e.data.Expando.getFrom(t.values, !1), c = l ? l[e.grid.EXPANDO] : null; for (r = 0, i = n.length; r < i; r++) s = n[r], e.grid.validDataKey(s.dataKey) && (o = c && c.cellsAttributes ? c.cellsAttributes[s.dataKey] : {}, u = this._dataViewWrapper.getValue(t.values, s.dataKey), f.push({ value: this._parse(s, u), __attr: o || {}, __style: {} })); return f.originalRowIndex = t.originalRowIndex, f.rowType = e.grid.rowType.data, t.originalRowIndex % 2 !== 0 && (f.rowType |= e.grid.rowType.dataAlt), f.__style = {}, f.__attr = c && c.rowAttributes ? c.rowAttributes : {}, f }, r.prototype._buildSketchRowEmptyDataItem = function (t, n, r) { var i, s, o = [], u = n.length; for (i = 0, s = t.length; i < s; i++) o.push({ html: t[i], __attr: { colSpan: u > 0 && r ? u : 1 }, __style: {} }); return o.rowType = e.grid.rowType.emptyDataRow, o.__style = {}, o.__attr = {}, o }, r.prototype._prepareColumnOptions = function (n, r) { e.grid.traverse(this.options.columns, function (e) { e.isBand = t.isArray(e.columns) || e.clientType === "c1band", e._originalDataKey = e.dataKey, e._originalHeaderText = e.headerText }), (new e.grid.bandProcessor).getVisibleHeight(this.options.columns, !0); var i = [], s = this._originalHeaderRowData(), o = this._originalFooterRowData(), u = (this.options.columnsAutogenerationMode || "").toLowerCase(); n && e.grid.columnsGenerator.generate(u, this._dataViewWrapper.getFieldsInfo(), this.options.columns), e.grid.setTraverseIndex(this.options.columns), e.grid.traverse(this.options.columns, function (n) { n.isBand = t.isArray(n.columns) || n.clientType === "c1band", e.grid.shallowMerge(n, e.c1basefield.prototype.options), n.isBand ? n.clientType = "c1band" : (e.grid.shallowMerge(n, e.c1field.prototype.options), n.groupInfo = n.groupInfo || {}, e.grid.shallowMerge(n.groupInfo, e.c1field.prototype.options.groupInfo), n.clientType || (n.clientType = "c1field")), n.isLeaf && !n.isBand && i.push(n) }), this._field("leaves", i), n && t.each(i, t.proxy(function (n, r) { var i = typeof r.dataKey == "number" ? r.dataKey : n; (u === "merge" || r.dynamic === !0) && r.headerText === undefined && (this._dataViewWrapper.isBoundedToDOM() && s && i < s.length ? r.headerText = t.trim(s[i]) : e.grid.validDataKey(r.dataKey) && (r.headerText = "" + r.dataKey)), this._dataViewWrapper.isBoundedToDOM() && o && i < o.length && (r._footerTextDOM = t.trim(o[i])) }, this)) }, r.prototype._rebuildLeaves = function () { var n = [], r = [], i; this.options.showRowHeader && (i = e.grid.createDynamicField({ clientType: "c1basefield", dataIndex: -1, travIdx: -1, parentVis: !0, allowMoving: !1, allowSizing: !1, allowSort: !1, isRowHeader: !0 }), i.owner = this, n.push(i)), t.each(this.options.columns, function (e, t) { n.push(t) }), this._columnsHeadersTable((new e.grid.bandProcessor).generateSpanTable(n, r)), this._field("leaves", r), this._onLeavesCreated() }, r.prototype._onLeavesCreated = function () { var n = this._field("leaves"), r = this._dataViewWrapper.getFieldsInfo(), i, s = 0, o = 0, u = this; this._field("visibleLeaves", t.grep(n, function (n, u) { return n.leavesIdx = u, e.grid.validDataKey(n.dataKey) ? n.dataIndex = s++ : n.dataIndex = -1, n.isBand || (i = r[n.dataKey], i && (n._underlyingDataType = i.type, n._underlyingDataFormatString = i.format), t.isFunction(n.dataParser) && (n.dataParser = new n.dataParser)), n.parentVis ? (n.visLeavesIdx = o++, !0) : !1 })) }, r.prototype._allowVirtualScrolling = function () { var e = this._field("allowVirtualScrolling"); return e || (e = this._field("allowVirtualScrolling", !this.options.allowPaging && this.options.allowVirtualScrolling && this.options.staticRowIndex < 0 && this.options.scrollMode !== "none" && !this._hasMerging())), e }, r.prototype._dragndrop = function (t) { typeof t == "undefined" && (t = !1); var n = this._field("dragndrop"); return !n && t && this._field("dragndrop", n = new e.grid.uiDragndrop(this)), n }, r.prototype._headerRows = function () { return this._view().headerRows() }, r.prototype._filterRow = function () { return this._view().filterRow() }, r.prototype._rows = function () { return this._view().bodyRows() }, r.prototype._localizeFilterOperators = function (n) { var r = this, i = new e.grid.filterOperatorsCache(this); t.each(n, function (e, t) { if (t.name) { var n = i.getByName(t.name); n && (n.displayName = t.displayName) } }) }, r.prototype._selectionui = function (t) { var n = this._field("selectionui"); return !n && t && this._field("selectionui", n = new e.grid.uiSelection(this)), n }, r.prototype._postset_allowColMoving = function (e, n) { var r = this; t.each(this.columns(), function (t, n) { e ? r._dragndrop(!0).attach(n) : r._dragndrop(!0).detach(n) }), t.each(this._field("groupedWidgets"), function (t, n) { e ? r._dragndrop(!0).attach(n) : r._dragndrop(!0).detach(n) }) }, r.prototype._postset_allowSorting = function (e, t) { this.ensureControl(!1) }, r.prototype._postset_columns = function (e, t) { this._initialized = !1, this.ensureControl(!0) }, r.prototype._postset_allowPaging = function (e, t) { this.ensureControl(!0) }, r.prototype._postset_culture = function (e, t) { throw "read-only" }, r.prototype._postset_customFilterOperators = function (e, t) { var n = this._dataViewWrapper.dataView() }, r.prototype._postset_data = function (n, r) { this._ownerise(!1), e.grid.traverse(this.options.columns, function (e, n) { if (e.dynamic) { var r = t.inArray(e, n); r >= 0 && n.splice(r, 1) } else e.dataKey = e._originalDataKey, e.headerText = e._originalHeaderText }), this._initialized = !1, this._dataViewWrapper && this._dataViewWrapper.dispose(), this._dataViewWrapper = new e.grid.dataViewWrapper(this), this.ensureControl(!0) }, r.prototype._postset_disabled = function (t, n) { var r = this, i = this._view(); e.grid.iterateChildrenWidgets(this.outerDiv, function (e, n) { n !== r && n.option("disabled", t) }), i && i.ensureDisabledState() }, r.prototype._postset_groupIndent = function (e, t) { this.ensureControl(!1) }, r.prototype._postset_groupAreaCaption = function (e, t) { var n = this._field("groupedColumns"); this.$groupArea && (!n || !n.length) && this.$groupArea.html(e || "&nbsp;") }, r.prototype._postset_highlightCurrentCell = function (e, t) { var n = this.currentCell(); n && n._isValid() && this._highlightCellPosition(n, e) }, r.prototype._preset_pageIndex = function (e, t) { if (isNaN(e)) throw "out of range"; var n = this.pageCount(), r = function (e) { return e > n - 1 && (e = n - 1), e < 0 && (e = 0), e }, i; return e = r(e), this.options.allowPaging && e !== t && (i = { newPageIndex: e }, this._onPageIndexChanging(i) ? e = r(i.newPageIndex) : e = t), e }, r.prototype._postset_pageIndex = function (e, t) { if (this.options.allowPaging) { var n = { newPageIndex: e }; this._customPagingEnabled() ? (this._convertWidgetsToOptions(), this._onPageIndexChanged(n)) : this.ensureControl(!0, { afterRefresh: function () { this._onPageIndexChanged(n) } }) } }, r.prototype._preset_pageSize = function (e, t) { if (isNaN(e)) throw "out of range"; return e <= 0 && (e = 1), e }, r.prototype._postset_pageSize = function (e, t) { this._resetDataProperties(), this.options.allowPaging && !this._customPagingEnabled() && this.ensureControl(!0) }, r.prototype._postset_pagerSettings = function (e, t) { this.ensureControl(!1) }, r.prototype._postset_scrollMode = function (e, t) { this.ensureControl(!1) }, r.prototype._postset_selectionMode = function (t, n) { var r = this.selection(), i = this.currentCell(), s = this.selection().selectedCells().length(); r.beginUpdate(), r.clear(), i && i._isValid() && s && r._selectRange(new e.grid.cellInfoRange(i, i), !1, !1, 0, null), r.endUpdate(), this._view().toggleDOMSelection(t === "none") }, r.prototype._postset_showFilter = function (e, t) { this.ensureControl(!1) }, r.prototype._postset_showGroupArea = function (e, t) { this.ensureControl(!1) }, r.prototype._postset_showRowHeader = function (e, t) { this.ensureControl(!1) }, r.prototype._postset_staticRowIndex = function () { this.options.scrollMode !== "none" && this.ensureControl(!1) }, r.prototype._postset_staticColumnIndex = function () { this.options.scrollMode !== "none" && this.ensureControl(!1) }, r.prototype._postset_allowVirtualScrolling = function (e, t) { this.ensureControl(!1) }, r.prototype._preset_allowVirtualScrolling = function (e, t) { if (isNaN(e) || e < 0) throw "out of range"; return e }, r.prototype._activateSpinner = function () { if (!this._spinnerIsActivated) { var e = this.options.wijCSS, t = this.outerDiv.append('<div class="wijmo-wijgrid-overlay ' + e.overlay + '"></div>' + '<span class="wijmo-wijgrid-loadingtext ' + e.content + " " + e.cornerAll + '">' + '<span class="' + e.icon + ' ui-icon-clock"></span>' + this.options.loadingText + "</span>").find("> .wijmo-wijgrid-loadingtext"); t.position({ my: "center", at: "center center", of: this.outerDiv, collision: "none" }), this._spinnerIsActivated = !0 } }, r.prototype._customPagingEnabled = function () { return this.options.allowPaging && this.options.totalRows >= 0 }, r.prototype._deactivateSpinner = function () { if (this._spinnerIsActivated) try { this.outerDiv.find("> .wijmo-wijgrid-overlay, > .wijmo-wijgrid-loadingtext").remove() } finally { this._spinnerIsActivated = !1 } }, r.prototype._columnWidgetsFactory = function (e, n) { var r, i = n.clientType; !i && n.isBand && (i = "c1band"), n = t.extend({}, n, { disabled: this.options.disabled }); try { t.data(e[0], "wijgridowner", this); switch (i) { case "c1basefield": r = e.c1basefield(n); break; case "c1band": r = e.c1band(n); break; default: r = e.c1field(n) } } finally { t.removeData(e[0], "wijgridowner") } return r }, r.prototype._convertWidgetsToOptions = function () { this._initialized && this._mergeWidgetsWithOptions && (this._ownerise(!1), this._widgetsToOptions(), this._ownerise(!0)) }, r.prototype._field = function (t, n) { return e.grid.dataPrefix(this.element, this._data$prefix, t, n) }, r.prototype._removeField = function (e) { var t = this._data$prefix + e; this.element.removeData(t) }, r.prototype._prepareTotalsRequest = function (n) { var r = this._field("leaves"), i, s; return !r || !this.options.showFooter ? [] : (i = t.map(r, function (t, r) { return !t.isBand && e.grid.validDataKey(t.dataKey) && t.aggregate && t.aggregate !== "none" ? n ? [{ column: t, aggregate: t.aggregate }] : [{ dataKey: t.dataKey, aggregate: t.aggregate }] : null }), i) }, r.prototype._widgetsToOptions = function () { var n = e.grid.flatten(this.options.columns); t.each(this.columns(), function (e, r) { delete r.options.columns; var i = n[r.options.travIdx]; t.extend(!0, i, r.options), i.filterValue = r.options.filterValue, i.filterOperator = r.options.filterOperator }) }, r.prototype._recreateColumnWidgets = function () { t.each(this.columns(), function (e, t) { t.destroy() }); var n = [], r = this._headerRows(), i, s, o, u, a, f, l; if (r && r.length()) { i = [], e.grid.traverse(this.options.columns, function (e) { e.parentVis && i.push(e) }); for (s = 0, o = i.length; s < o; s++) u = i[s], a = r.item(u.thY), f = e.grid.rowAccessor.getCell(a, u.thX), l = this._columnWidgetsFactory(t(f), u), n.push(l.data(e.grid.widgetName(l))) } this._field("columns", n) }, r.prototype._ownerise = function (t) { if (t) { var n = this; e.grid.traverse(this.options.columns, function (e) { e.owner = n; var t, r, i; if (t = e.groupInfo) { t.owner = e; if (t.expandInfo) for (r = 0, i = t.expandInfo.length; r < i; r++) t.expandInfo[r].owner = t } }) } else e.grid.traverse(this.options.columns, function (e) { delete e.owner; var t, n, r; if (t = e.groupInfo) { delete t.owner; if (t.expandInfo) for (n = 0, r = t.expandInfo.length; n < r; n++) delete t.expandInfo[n].owner } }) }, r.prototype._ensureRenderBounds = function (e) { var t = this._totalRowsCount(); return e.start < 0 && (e.start = 0), e.start = Math.min(e.start, t - 1), e.end < 0 && (e.end = 0), e.end = Math.min(e.end, t - 1), e }, r.prototype._refresh = function (t) { (new e.grid.grouper).group(this, this.sketchTable, this._field("leaves")), (new e.grid.merger).merge(this.sketchTable, this._field("visibleLeaves")); var n = this._field("viewRenderBounds"); this._ensureRenderBounds(n), this.options.scrollMode !== "none" ? this._field("view", new e.grid.fixedView(this, this._field("viewRenderBounds"))) : this._field("view", new e.grid.flatView(this, this._field("viewRenderBounds"))), this._render(), this._ownerise(!1), this._recreateColumnWidgets(), this._ownerise(!0), this.options.allowPaging && (this.$topPagerDiv && this.$topPagerDiv.wijpager(this._pagerSettings2PagerWidgetSettings()).css("zIndex", 5), this.$bottomPagerDiv && this.$bottomPagerDiv.wijpager(this._pagerSettings2PagerWidgetSettings()).css("zIndex", 5)) }, r.prototype._refreshVirtual = function (e) { var t = e.virtualScrollData, n = { top: 0, bottom: 0 }; t.data && (n = this._processVirtualData(t)), this._updateRowInfos(t, n), this._renderVirtualIntoView(t) }, r.prototype._updateRowInfos = function (e, t) { var n = this._field("viewRenderBounds"), r = this._view(), i = e.newBounds, s = this._view().bodyRows(), o, u, a, f; switch (e.mode) { case "reset": break; case "overlapBottom": o = { start: i.start - n.start, end: n.end - n.start }, a = i.start - n.start; for (u = o.start; u <= o.end; u++) f = r._getRowInfo(s.item(u)), f.sectionRowIndex -= a, f.dataItemIndex += t.top, r._setRowInfo(f.$rows, f); break; case "overlapTop": o = { start: n.start - n.start, end: i.end - n.start }, a = n.start - i.start; for (u = o.start; u <= o.end; u++) f = r._getRowInfo(s.item(u)), f.sectionRowIndex += a, f.dataItemIndex += t.top, r._setRowInfo(f.$rows, f) } }, r.prototype._renderVirtualIntoView = function (t) { var n = this._field("viewRenderBounds"), r = this._view(), i = function (t) { return t.rowType & e.grid.rowType.data ? t.originalRowIndex : -1 }, s, o, u, a; switch (t.mode) { case "reset": r._clearBody(); for (o = t.newBounds.start; o <= t.newBounds.end; o++) u = this.sketchTable[o - this._dataOffset], r._insertBodyRow(u, -1, i(u), o); r._rebuildOffsets(); break; case "overlapBottom": s = { start: t.newBounds.start, end: n.end }; for (o = 0; o < s.start - n.start; o++) r._removeBodyRow(0, !1); for (o = s.end + 1; o <= t.newBounds.end; o++) u = this.sketchTable[o - this._dataOffset], r._insertBodyRow(u, -1, i(u), o); break; case "overlapTop": s = { start: n.start, end: t.newBounds.end }; for (o = 0; o < n.end - t.newBounds.end; o++) r._removeBodyRow(s.end - s.start + 1, !1); a = 0; for (o = t.newBounds.start; o < n.start; o++) u = this.sketchTable[o - this._dataOffset], r._insertBodyRow(u, a++, i(u), o); break; default: } }, r.prototype._processVirtualData = function (e) { var t = this._dataViewWrapper, n = t.dataView().getSource(), r, i = this._field("leaves"), s, o, u, a = 0, f = { top: 0, bottom: 0 }, l, c = this._serverSideVirtualScrollingMargin(); switch (e.mode) { case "reset": this.sketchTable.splice(0, this.sketchTable.length), t._unsafeSplice(0, n.length), this._dataOffset = e.request.index; for (s = 0; s < e.data.length; s++) t._unsafePush(r = e.data[s]), this.sketchTable.push(this._buildSketchRow(t._wrapDataItem(r, s), i)); break; case "overlapBottom": for (s = 0; s < e.data.length; s++) t._unsafePush(r = e.data[s]), this.sketchTable.push(this._buildSketchRow(t._wrapDataItem(r, n.length - 1), i)); f.bottom = e.data.length; break; case "overlapTop": for (s = e.data.length - 1; s >= 0; s--) t._unsafeSplice(0, 0, r = e.data[s]), this.sketchTable.splice(0, 0, this._buildSketchRow(t._wrapDataItem(r, s), i)); this._dataOffset = e.request.index, f.top = e.data.length } o = this._ensureRenderBounds({ start: e.newBounds.start, end: e.newBounds.end }), u = { start: this._dataOffset, end: this._dataOffset + n.length - 1 }, a = u.end - o.end - c, a > 0 && (f.bottom -= a, t._unsafeSplice(n.length - a, a), this.sketchTable.splice(this.sketchTable.length - a, a)), a = o.start - u.start - c, a > 0 && (f.top -= a, t._unsafeSplice(0, a), this.sketchTable.splice(0, a), this._dataOffset += a); for (s = 0; s < this.sketchTable.length; s++) this.sketchTable[s].originalRowIndex = s; return t._refreshSilent(), f }, r.prototype._needToCreatePagerItem = function () { return this.options.allowPaging === !0 }, r.prototype._render = function () { var e = this._view(), n = this.options, r = this.options.wijCSS, i; e.render(), i = this.outerDiv, n.scrollMode !== "none" && (i = this.outerDiv.find("div.wijmo-wijgrid-scroller:first")), this.$superPanelHeader = null, this.$topPagerDiv && (this.$topPagerDiv.data("wijmo-wijpager") && this.$topPagerDiv.wijpager("destroy"), this.$topPagerDiv.remove()), this.$topPagerDiv = null, this._needToCreatePagerItem() && (n.pagerSettings.position === "top" || n.pagerSettings.position === "topAndBottom") && (this.$topPagerDiv || (i.prepend(this.$superPanelHeader = t('<div class="wijmo-wijsuperpanel-header"></div>')), this.$superPanelHeader.prepend(this.$topPagerDiv = t('<div class="wijmo-wijgrid-header ' + r.header + " " + r.cornerTop + '"></div>')))), n.showGroupArea ? this._processGroupArea(i) : this.$groupArea = null, this.$bottomPagerDiv && (this.$bottomPagerDiv.data("wijmo-wijpager") && this.$bottomPagerDiv.wijpager("destroy"), this.$bottomPagerDiv.remove()), this.$bottomPagerDiv = null, this._needToCreatePagerItem() && (n.pagerSettings.position === "bottom" || n.pagerSettings.position === "topAndBottom") && (this.$bottomPagerDiv || i.append(this.$bottomPagerDiv = t('<div class="wijmo-wijgrid-footer wijmo-wijsuperpanel-footer ' + r.stateDefault + " " + r.cornerBottom + '"></div>'))) }, r.prototype._processGroupArea = function (e) { var n = this, r = this._field("groupedColumns"), i = []; this.$groupArea = t('<div class="' + this.options.wijCSS.content + " " + this.options.wijCSS.helperClearFix + '"></div>'), r.length > 0 ? t.each(r, function (e, r) { var s = t('<a href="#"></a>').appendTo(n.$groupArea); try { t.data(s[0], "wijgridowner", n), s.c1groupedfield(t.extend({}, { allowMoving: r.allowMoving, allowSort: r.allowSort, dataIndex: r.dataIndex, headerText: r.headerText, isBand: r.isBand, isLeaf: r.isLeaf, linearIdx: r.linearIdx, parentIdx: r.parentIdx, sortDirection: r.sortDirection, travIdx: r.travIdx, groupedIndex: r.groupedIndex }, { disabled: n.options.disabled })) } finally { t.removeData(s[0], "wijgridowner") } i.push(s.data("wijmo-c1groupedfield")) }) : this.$groupArea.addClass("wijmo-wijgrid-group-area").css("padding", 0).html(this.options.groupAreaCaption || "&nbsp;"), this._field("groupedWidgets", i), this.$superPanelHeader || e.prepend(this.$superPanelHeader = t('<div class="wijmo-wijsuperpanel-header"></div>')), this.$superPanelHeader.prepend(this.$groupArea), this._dragndrop(!0).attachGroupArea(this.$groupArea) }, r.prototype._attachEvents = function () { var e = this._view(), n = e.focusableElement(), r = this; n.bind("keydown." + this.widgetName, t.proxy(this._onKeyDown, this)), n.bind("keypress." + this.widgetName, t.proxy(this._onKeyPress, this)), t.each(e.subTables(), function (e, n) { var i = n.element(); i && (i.tHead && t(i.tHead).bind("click." + r.widgetName, t.proxy(r._onClick, r)), i.tBodies.length && t(i.tBodies[0]).bind("click." + r.widgetName, t.proxy(r._onClick, r)).bind("dblclick." + r.widgetName, t.proxy(r._onDblClick, r)).bind("mousemove." + r.widgetName, t.proxy(r._onMouseMove, r)).bind("mouseout." + r.widgetName, t.proxy(r._onMouseOut, r))) }), t(window).bind("resize." + this.widgetName + "." + this._eventUID, t.proxy(this._onWindowResize, this)) }, r.prototype._detachEvents = function (e) { var n = this._view(), r = this, i; this._windowResizeTimer = 0, t(window).unbind("resize." + this.widgetName + "." + this._eventUID), n && (i = n.focusableElement(), i.unbind("keydown." + this.widgetName), i.unbind("keypress." + this.widgetName), t.each(n.subTables(), function () { var e = this.element(); e && (e.tHead && t(e.tHead).unbind("." + r.widgetName), e.tBodies.length && t(e.tBodies[0]).unbind("." + r.widgetName)) })) }, r.prototype._handleSort = function (n, r) { var i = this.options.columns, s = n.travIdx, o, u; n && this.options.allowSorting && (o = n.sortDirection === "none" ? "ascending" : n.sortDirection === "ascending" ? "descending" : "ascending", u = { column: n, sortDirection: o, sortCommand: n.dataKey + " " + (o === "ascending" ? "asc" : "desc") }, this._onColumnSorting(u) && (n.sortDirection = u.sortDirection, r ? n.sortOrder = this._customSortOrder++ : (this._customSortOrder = 1e3, t.each(this.columns(), function (e, t) { t.options.sortOrder = 0, t.options.travIdx !== s && (!t.options.groupInfo || t.options.groupInfo.position === "none") && (t.options.sortDirection = "none") }), e.grid.traverse(i, function (e) { e.sortOrder = 0, e.travIdx !== s && (!e.groupInfo || e.groupInfo.position === "none") && (e.sortDirection = "none") })), u = { column: n, sortDirection: n.sortDirection, sortCommand: n.dataKey + " " + (n.sortDirection === "ascending" ? "asc" : "desc") }, this._customPagingEnabled() ? (this._convertWidgetsToOptions(), this._onColumnSorted(u)) : this.ensureControl(!0, { afterRefresh: function () { this._onColumnSorted(u) } }))) }, r.prototype._pagerSettings2PagerWidgetSettings = function () { return t.extend({}, this.options.pagerSettings, { disabled: this.options.disabled, pageCount: this.pageCount(), pageIndex: this.options.pageIndex, pageIndexChanging: t.proxy(this._onPagerWidgetPageIndexChanging, this), pageIndexChanged: t.proxy(this._onPagerWidgetPageIndexChanged, this) }) }, r.prototype._handleDragnDrop = function (n, r, i, s, o) { var u = e.grid.getColumnByTravIdx(this.options.columns, n), a = e.grid.getColumnByTravIdx(this.options.columns, r), f = s ? "groupArea" : "columns", l = o ? "groupArea" : "columns"; o ? this._onColumnGrouping({ drag: u.found, drop: a ? a.found : null, dragSource: f, dropSource: l, at: i }) && this.ensureControl(!0, { beforeRefresh: function () { if (!a) u.found.groupedIndex = 0; else switch (i) { case "left": u.found.groupedIndex = a.found.groupedIndex - .5; break; case "right": u.found.groupedIndex = a.found.groupedIndex + .5 } s || t.extend(!0, u.found, { groupInfo: { position: "header" } }) }, afterRefresh: function () { this._onColumnGrouped({ drag: u.found, drop: a ? a.found : null, dragSource: f, dropSource: l, at: i }) } }) : this._onColumnDropping({ drag: u.found, drop: a.found, at: i }) && this.ensureControl(!1, { beforeRefresh: function () { u.at.splice(u.found.linearIdx, 1); switch (i) { case "left": u.at === a.at && u.found.linearIdx < a.found.linearIdx ? a.at.splice(a.found.linearIdx - 1, 0, u.found) : a.at.splice(a.found.linearIdx, 0, u.found); break; case "right": u.at === a.at && u.found.linearIdx < a.found.linearIdx ? a.at.splice(a.found.linearIdx, 0, u.found) : a.at.splice(a.found.linearIdx + 1, 0, u.found); break; case "center": a.found.columns.push(u.found) } e.grid.setTraverseIndex(this.options.columns) }, afterRefresh: function () { this._onColumnDropped({ drag: u.found, drop: a.found, at: i }) } }) }, r.prototype._handleFilter = function (t, n, r) { var i = (new e.grid.filterOperatorsCache(this)).getByName(n), s, o, u; i && (i.arity > 1 ? (s = this._parse(t.options, r), o = s !== null && (e.grid.getDataType(t.options) === "string" || !isNaN(s))) : o = !0, o && (u = { column: t.options, operator: i.name, value: s }, this._onColumnFiltering(u) && (t.options.filterValue = u.value, t.options.filterOperator = u.operator, this._resetDataProperties(), this._customPagingEnabled() ? (this._convertWidgetsToOptions(), this._onColumnFiltered({ column: t.options })) : this.ensureControl(!0, { afterRefresh: function () { this._onColumnFiltered({ column: t.options }) } })))) }, r.prototype._handleUngroup = function (n) { var r = e.grid.getColumnByTravIdx(this.options.columns, n), i; r && r.found && (i = r.found, this._onColumnUngrouping({ column: i }) && this.ensureControl(!1, { beforeRefresh: function () { delete i.groupedIndex, t.extend(!0, i, { groupInfo: { position: "none" } }) }, afterRefresh: function () { this._onColumnUngrouped({ column: i }) } })) }, r.prototype._onVirtualScrolling = function (e, n, r, i, s, o) { this.ensureControl(!0, { virtualScrollData: { newBounds: e, request: n, mode: r, data: o }, afterRefresh: function (e) { var n = this._field("viewRenderBounds"); t.extend(n, e.virtualScrollData.newBounds), this._view()._adjustRowsHeights(), s(i) } }) }, r.prototype._handleVirtualScrolling = function (e, t) { var n = this._field("viewRenderBounds"), r = this._ensureRenderBounds({ start: e, end: e + this.options.pageSize - 1 }), i = this._ensureRenderBounds({ start: this._dataOffset, end: this._dataOffset + this._dataViewWrapper.dataView().count() - 1 }), s = null, o; r.start > n.end || r.end < n.start ? o = "reset" : r.start > n.start ? o = "overlapBottom" : r.start < n.start && (o = "overlapTop"); if (this._serverSideVirtualScrolling()) switch (o) { case "reset": s = { index: e, maxCount: this.options.pageSize }; break; case "overlapBottom": r.end > i.end && (s = { index: i.end + 1, maxCount: this.options.pageSize }); break; case "overlapTop": r.start < i.start && (s = { index: Math.max(0, i.start - this.options.pageSize), maxCount: 0 }, s.maxCount = i.start - s.index) } o !== "none" && this._onVirtualScrolling(r, s, o, e, t) }, r.prototype._serverSideVirtualScrolling = function () { return !1 }, r.prototype._serverSideVirtualScrollingMargin = function () { return this.options.pageSize * 2 }, r.prototype._onColumnDropping = function (e) { return this._trigger("columnDropping", null, e) }, r.prototype._onColumnDropped = function (e) { this._trigger("columnDropped", null, e) }, r.prototype._onColumnGrouping = function (e) { return this._trigger("columnGrouping", null, e) }, r.prototype._onColumnGrouped = function (e) { this._trigger("columnGrouped", null, e) }, r.prototype._onColumnUngrouping = function (e) { return this._trigger("columnUngrouping", null, e) }, r.prototype._onColumnUngrouped = function (e) { this._trigger("columnUngrouped", null, e) }, r.prototype._onColumnFiltering = function (e) { return this._trigger("filtering", null, e) }, r.prototype._onColumnFiltered = function (e) { this._trigger("filtered", null, e) }, r.prototype._onFilterOperatorsListShowing = function (e) { this._trigger("filterOperatorsListShowing", null, e) }, r.prototype._onColumnSorting = function (e) { return this._trigger("sorting", null, e) }, r.prototype._onColumnSorted = function (e) { this._trigger("sorted", null, e) }, r.prototype._onCurrentCellChanged = function (t) { var n = this.options, r = this._field("currentCell"); this._dataViewWrapper.currentPosition(this._gridDataRowIndexToDataView(r.rowIndex())), n.scrollMode !== "none" && r && !r.isEqual(e.grid.cellInfo.outsideValue) && this._view().scrollTo(r), this._trigger("currentCellChanged"), t && (t.type || "").toLowerCase() === "click" && this._editBySingleClick() && this._beginEditInternal(t) }, r.prototype._onPageIndexChanging = function (e) { return this._trigger("pageIndexChanging", null, e) }, r.prototype._onPageIndexChanged = function (e) { this._trigger("pageIndexChanged", null, e) }, r.prototype._onPagerWidgetPageIndexChanging = function (e, t) { t.handled = !0 }, r.prototype._onPagerWidgetPageIndexChanged = function (e, t) { this._setOption("pageIndex", t.newPageIndex) }, r.prototype._onRendering = function (e) { var t = this._view(); this._rendered = !1, e.virtualScrollData ? (this.selection().clear(), this.options.highlightCurrentCell && this._highlightCellPosition(this.currentCell(), !1)) : (t && t.dispose(), this._detachEvents(!1), this.element.detach(), this.element.empty(), this.outerDiv.empty(), this.outerDiv.append(this.element), this._field("selectionui") && (this._field("selectionui").dispose(), this._field("selectionui", null)), this._field("resizer") && (this._field("resizer").dispose(), this._field("resizer", null)), this._field("frozener") && (this._field("frozener").dispose(), this._field("frozener", null))), this._trigger("rendering") }, r.prototype._onRendered = function (n) { var r = this._view(), i, s, o = this.selection().selectedCells().length() > 0; this._rendered = !0, this._setAttr(r.focusableElement(), "tabIndex", 0), i = this.currentCell(), i._isValid() && (i = this.currentCell(i)) ? i._isEdit(!1) : i = this.currentCell(this._getFirstDataRowCell(0)), this._field("selection", null), i = this.currentCell(), i._isValid() && (o || this.options.showSelectionOnRender) && (this.selection()._startNewTransaction(i), this.selection()._selectRange(new e.grid.cellInfoRange(i, i), !1, !1, 0, null)), n.virtualScrollData || (this._attachEvents(), this._selectionui(!0), s = new e.grid.uiResizer(this), t.each(this.columns(), function (e, t) { var n = t.options; n.visible && n.parentVis && n.isLeaf && s.addElement(t) }), this._field("resizer", s), r.updateSplits(this._scrollingState), this.options.scrollMode !== "none" && this._field("frozener", new e.grid.uiFrozener(this))), this._renderCounter++, this._trigger("rendered") }, r.prototype._onClick = function (n) { if (!this._canInteract() || !n.target) return; var r = this._view(), i = this._findUntilOuterDiv(n.target, { td: !0, th: !0 }), s, o, u = 0, a, f; if (i) { if (t(n.target).hasClass("wijmo-wijgrid-grouptogglebtn")) return this._onGroupBtnClick(n), n.stopPropagation(), !1; s = t(i).closest("tr"); if (!s.length) return; o = r.getAbsoluteCellInfo(i); if (s.hasClass("wijmo-wijgrid-datarow") || s.hasClass("wijmo-wijgrid-headerrow")) { if (o.cellIndex() < 0 || o.rowIndex() < 0) o.rowIndex() >= 0 ? (o = new e.grid.cellInfo(0, o.rowIndex()), u = 2) : (o = this._getFirstDataRowCell(o.cellIndex()), u = 1); this._changeCurrentCell(n, o, !t(n.target).is(":focus")), a = this.currentCell(), f = this.selection(), (!n.shiftKey || !f._multipleRangesAllowed() && this.options.selectionMode.toLowerCase() !== "singlerange") && f._startNewTransaction(a), f.beginUpdate(), n.shiftKey && n.ctrlKey ? f._clearRange(new e.grid.cellInfoRange(a, a), u) : f._selectRange(new e.grid.cellInfoRange(f._anchorCell(), a), n.ctrlKey, n.shiftKey, u, null), f.endUpdate() } var l = { cell: o }; this._trigger("cellClicked", null, l) } }, r.prototype._onDblClick = function (e) { this._editBySingleClick() || this._beginEditInternal(e) }, r.prototype._onGroupBtnClick = function (n) { if (!this._canInteract()) return; var r = t(n.target).closest("tr"), i = e.grid.groupHelper, s = i.getGroupInfo(r[0]), o, u; s && (o = i.getColumnByGroupLevel(this._field("leaves"), s.level), o && (u = o.groupInfo.expandInfo[s.index], u.isExpanded ? u.collapse() : u.expand(n.shiftKey), this._view().ensureHeight())) }, r.prototype._onKeyDown = function (n) { if (!this._canInteract()) return !0; var r = n.target.tagName.toLowerCase(), i = !1, s, o, u, a = e.grid.getKeyCodeEnum(); if (r !== "input" && r !== "option" && r !== "select" && r !== "textarea" || t(n.target).closest("tr.wijmo-wijgrid-datarow").length !== 0) { if (this.options.allowEditing) { if ((n.which === a.ESCAPE || n.which === 113) && this.currentCell()._isValid() && this.currentCell()._isEdit()) return this._endEditInternal(n), !1; if (n.which === 113) return this._beginEditInternal(n), !1 } if (!this.options.allowKeyboardNavigation || n.which === a.TAB) return !0; switch (n.which) { case a.LEFT: case a.RIGHT: case a.DOWN: case a.UP: case a.PAGE_DOWN: case a.PAGE_UP: case a.HOME: case a.END: case a.TAB: s = this._getNextCurrencyPos(this._getDataCellsRange(), this.currentCell(), n.keyCode, n.shiftKey), i = this._canMoveToAnotherCell(n.target, n.which) } return i ? (this._changeCurrentCell(n, new e.grid.cellInfo(s.cellIndex, s.rowIndex), !0), o = this.currentCell(), u = this.selection(), (!n.shiftKey || !u._multipleRangesAllowed() && this.options.selectionMode.toLowerCase() !== "singlerange") && u._startNewTransaction(o), u.beginUpdate(), u._selectRange(new e.grid.cellInfoRange(u._anchorCell(), o), !1, n.shiftKey, 0, null), u.endUpdate(), !1) : !0 } return !0 }, r.prototype._onKeyPress = function (e) { if (this._canInteract() && this.options.allowEditing) { var n = e.which, r = this.currentCell(), i, s, o; if (n && r._isValid() && !r._isEdit()) { i = e.target.tagName.toLowerCase(); if (i !== "input" && i !== "option" && i !== "select" && i !== "textarea") { s = t(e.target).closest(".wijmo-wijgrid-table"); if (s.length) { o = t.map(this._view().subTables(), function (e, t) { return e.element() }); if (t.inArray(s[0], o) >= 0 && t.wij.charValidator.isPrintableChar(String.fromCharCode(n))) return this._beginEditInternal(e), !1 } } } } }, r.prototype._onMouseMove = function (n) { var r = this._view(), i = this._field("frozener"), s, o, u, a, f, l, c = e.grid.renderState; if (!this.options.highlightOnHover || !this._canInteract() || i && i.inProgress()) return; s = this._findUntilOuterDiv(n.target, { td: !0, th: !0 }); if (s) { o = t(s).closest("tr"); if (!o.length || !o.hasClass("wijmo-wijgrid-datarow") && !o.hasClass("wijmo-wijgrid-headerrow")) return; u = r.getAbsoluteCellInfo(s), a = this._field("hoveredRow"), u.rowIndex() !== a && (a !== undefined && (f = this._rows().item(a), f && (l = r._getRowInfo(f), r._changeRowRenderState(l, c.hovered, !1), this.rowStyleFormatter.format(l))), a = u.rowIndex(), this._field("hoveredRow", a), a >= 0 && (f = this._rows().item(a), f && (l = r._getRowInfo(f), r._changeRowRenderState(l, c.hovered, !0), this.rowStyleFormatter.format(l)))) } }, r.prototype._onMouseOut = function (n) { if (!this._canInteract()) return; if (t(n.relatedTarget).closest(".wijmo-wijgrid-data").length === 0) { var r = this._field("hoveredRow"), i, s, o = this._view(); r >= 0 && (i = this._rows().item(r), i && (s = o._getRowInfo(i), o._changeRowRenderState(s, e.grid.renderState.hovered, !1), this.rowStyleFormatter.format(s))) } }, r.prototype._onWindowResize = function (e) { var t = this; this._windowResizeTimer > 0 && (window.clearTimeout(this._windowResizeTimer), this._windowResizeTimer = 0), this._windowResizeTimer !== -1 && (this._windowResizeTimer = window.setTimeout(function () { t._windowResizeTimer = -1; try { !t._destroyed && t._initialized && t.element.parent().length && t.setSize() } finally { t._windowResizeTimer = 0 } }, 50)) }, r.prototype._fieldResized = function (e, t, n) { t < 0 && (t = 0), n <= 0 && (n = 1); var r = { column: e.options, oldWidth: t, newWidth: n }; if (this._trigger("columnResizing", null, r) !== !1) { if (isNaN(r.newWidth) || r.newWidth < 0) r.newWidth = 1; e.option("width", r.newWidth); var i = { column: e.options }; this._trigger("columnResized", null, i) } }, r.prototype._changeCurrentCell = function (n, r, i) { var s = this.currentCell(), o = this._getDataCellsRange(), u, a, f = this.options.highlightCurrentCell, l; if (o._isValid() && o._containsCellInfo(r) || r.isEqual(e.grid.cellInfo.outsideValue)) if (s.cellIndex() !== r.cellIndex() || s.rowIndex() !== r.rowIndex()) { u = { cellIndex: r.cellIndex(), rowIndex: r.rowIndex(), oldCellIndex: s.cellIndex(), oldRowIndex: s.rowIndex() }; if (this._trigger("currentCellChanging", null, u)) { a = !1; if (!this.options.allowEditing || !s._isEdit() || (a = this._endEditInternal(null))) { o._containsCellInfo(s) && (f && this._highlightCellPosition(s, !1), (l = s.tableCell()) && t(l).removeAttr("tabIndex")), s = r._clone(), s._setGridView(this), f && this._highlightCellPosition(s, !0); if (l = s.tableCell()) t(l).attr("tabIndex", 0), i && !s._isEdit() && t(l).focus(); this._field("currentCell", s), this._onCurrentCellChanged(n) } } } else f && this._highlightCellPosition(s, !0), (l = s.tableCell()) && t(l).attr("tabIndex", 0) }, r.prototype._highlightCellPosition = function (n, r) { if (n && n._isValid()) { var i = n.cellIndexAbs(), s = n.rowIndexAbs(), o = e.grid.renderState, u = this._view(), a, f, l; f = u.getHeaderCell(i), f && (a = u._getRowInfo(this._headerRows().item(n.column().thY)), f = t(f), l = u._changeCellRenderState(f, o.current, r), this.cellStyleFormatter.format(f, i, n.column(), a, l)), f = u.getJoinedRows(s, 0), f && (a = u._getRowInfo(f), u._changeRowRenderState(a, o.current, r), this.rowStyleFormatter.format(a)), f = u.getCell(i, s), f && (f = t(f), l = u._changeCellRenderState(f, o.current, r), this.cellStyleFormatter.format(f, i, n.column(), a, l)) } }, r.prototype._beginEditInternal = function (t) { if (this._canInteract() && this.options.allowEditing) { var n = this.currentCell().column(), r; if (n && !n.readOnly) return r = (new e.grid.cellEditorHelper).currentCellEditStart(this, t), r, r } return !1 }, r.prototype._endEditInternal = function (t) { if (this._canInteract() && this.options.allowEditing) { var n = (new e.grid.cellEditorHelper).currentCellEditEnd(this, t); return n && !this._allowVirtualScrolling() && this._view().ensureHeight(this.currentCell().rowIndex()), n } return !1 }, r.prototype._onViewInsertEmptyRow = function (e, t, n, r, i) { return null }, r.prototype._onViewCreateEmptyCell = function (e, t, n) { return null }, r.prototype._onViewCellRendered = function (e, t, n, r) { }, r.prototype._onViewRowRendered = function (e) { }, r.prototype._getDataParser = function (t) { return t.dataParser || e.data.defaultParsers[t.dataType] || e.data.defaultParsers.string }, r.prototype._parse = function (n, r) { var i = this._dataViewWrapper.dataView(), s = e.grid.getDataType(n), o = e.grid.getDataType(n); return t.isFunction(r) && (r = r()), r = e.data.convert(r, s, o, { culture: this._field("closestCulture"), format: n.dataFormatString || n._underlyingDataFormatString, nullString: this.options.nullString, parser: n.dataParser }), r }, r.prototype._toStr = function (t, n) { var r = this._dataViewWrapper.dataView(), i = e.grid.getDataType(t), s = "string"; return n = e.data.convert(n, i, s, { culture: this._field("closestCulture"), format: t.dataFormatString || t._underlyingDataFormatString, nullString: this.options.nullString, parser: t.dataParser }), n }, r.prototype._funcOptions = function () { return ["cellStyleFormatter", "rowStyleFormatter", "afterCellEdit", "afterCellUpdate", "beforeCellEdit", "beforeCellUpdate", "cellClicked", "columnDragging", "columnDragged", "columnDropping", "columnDropped", "columnResizing", "columnResized", "columnGrouping", "columnGrouped", "columnUngrouping", "columnUngrouped", "currentCellChanging", "currentCellChanged", "filtering", "filtered", "filterOperatorsListShowing", "groupAggregate", "groupText", "invalidCellValue", "pageIndexChanging", "pageIndexChanged", "selectionChanged", "sorting", "sorted", "dataLoading", "dataLoaded", "loading", "loaded", "rendering", "rendered"] }, r.prototype._canInteract = function () { return !this.options.disabled }, r.prototype._canMoveToAnotherCell = function (n, r) { var i = n.tagName.toLowerCase(), s, o, u, a; switch (i) { case "input": if (t(n).hasClass("wijgridinput")) { var f = n; return f.type === "text" ? (s = f.value.length, o = (new e.grid.domSelection(f)).getSelection(), u = e.grid.getKeyCodeEnum(), a = r === u.UP || r === u.DOWN || r === u.PAGE_DOWN || r === u.PAGE_UP || o.length === 0 && (o.start === 0 && (r === u.LEFT || r === u.HOME) || o.end >= s && (r === u.RIGHT || r === u.END)), a) : !0 } return !1; case "textarea": case "select": return !1 } return !0 }, r.prototype._editBySingleClick = function () { var e = (this.options.editingInitOption || "").toLowerCase(); switch (e) { case "click": case "doubleclick": break; case "auto": default: e = this._isMobile ? "click" : "doubleclick" } return e === "click" }, r.prototype._getDataToAbsOffset = function () { var e = 0, t = 0, n = this._headerRows(); return this.options.showRowHeader && e++, n && (t += n.length()), this._filterRow() && t++, { x: e, y: t } }, r.prototype._gridDataRowIndexToDataView = function (t) { var n = -1, r = e.grid.rowType, i; return t < 0 ? n : (i = this._view()._getRowInfo(this._rows().item(t)), i.type & e.grid.rowType.data ? i.dataItemIndex : -1) }, r.prototype._dataViewDataRowIndexToGrid = function (t) { var n = e.grid.rowType, r = this._view(), i = this._rows(), s, o, u; if (t < 0) return -1; for (s = 0, o = i.length() ; s < o; s++) { u = r._getRowInfo(i.item(s)); if (u.type & n.data && u.dataItemIndex === t) return u.sectionRowIndex } return -1 }, r.prototype._getDataCellsRange = function () { var t = 0, n = 0, r = this._field("visibleLeaves").length - 1, i = this._rendered ? this._rows().length() - 1 : this.sketchTable.length - 1; this.options.showRowHeader && r--; if (r < 0 || i < 0) t = n = r = i = -1; return new e.grid.cellInfoRange(new e.grid.cellInfo(t, n, null), new e.grid.cellInfo(r, i, null)) }, r.prototype._getDataItem = function (e) { return this.dataView().item(e) }, r.prototype._getFirstDataRowCell = function (t) { var n, r, i, s = this._view(), o = this._rows(), u = e.grid.rowType; for (n = 0, r = o.length() ; n < r; n++) { i = s._getRowInfo(o.item(n)); if (i.type & u.data) return new e.grid.cellInfo(t, n) } return e.grid.cellInfo.outsideValue }, r.prototype._getNextCurrencyPos = function (t, n, r, i) { var s = n.cellIndex(), o = n.rowIndex(), u, a = e.grid.getKeyCodeEnum(); switch (r) { case a.PAGE_UP: this._reverseKey && o === t.topLeft().rowIndex() ? o = t.bottomRight().rowIndex() : (o -= this._pageSizeKey, o < (u = t.topLeft().rowIndex()) && (o = u)); break; case a.PAGE_DOWN: this._reverseKey && o === t.bottomRight().rowIndex() ? o = t.topLeft().rowIndex() : (o += this._pageSizeKey, o > (u = t.bottomRight().rowIndex()) && (o = u)); break; case a.END: s = this._reverseKey && s === t.bottomRight().cellIndex() ? t.topLeft().cellIndex() : t.bottomRight().cellIndex(); break; case a.HOME: s = this._reverseKey && s === t.topLeft().cellIndex() ? t.bottomRight().cellIndex() : t.topLeft().cellIndex(); break; case a.LEFT: s > t.topLeft().cellIndex() ? s-- : this._reverseKey && (s = t.bottomRight().cellIndex()); break; case a.UP: o > t.topLeft().rowIndex() ? o-- : this._reverseKey && (o = t.bottomRight().rowIndex()); break; case a.RIGHT: s < t.bottomRight().cellIndex() ? s++ : this._reverseKey && (s = t.topLeft().cellIndex()); break; case a.ENTER: case a.DOWN: o < t.bottomRight().rowIndex() ? o++ : this._reverseKey && (o = t.topLeft().rowIndex()); break; case a.TAB: } return { cellIndex: s, rowIndex: o } }, r.prototype._findUntilOuterDiv = function (e, t) { var n = e, r, i, s = null; for (; n; n = n.parentNode) { i = n.nodeName.toLowerCase(); if (i) { if (n === this.outerDiv[0]) { r = n; break } t[i] && (s = n) } } return r ? s : null }, r.prototype._getStaticIndex = function (e) { var t, n = this._getDataCellsRange(); return this._hasSpannedCells() ? -1 : (e ? t = Math.min(this.options.staticRowIndex, n.bottomRight().rowIndex()) : t = Math.min(this.options.staticColumnIndex, n.bottomRight().cellIndex()), t < -1 && (t = -1), t) }, r.prototype._getStaticOffsetIndex = function (e) { var t = 0; return e ? this.options.showRowHeader === !0 && t++ : (t = this._columnsHeadersTable().length, this.options.showFilter && t++), t }, r.prototype._getRealStaticColumnIndex = function () { var e, t, n = this._getStaticOffsetIndex(!0), r = this._getStaticIndex(!1), i, s; i = r + n; if (r >= 0) { e = this._field("visibleLeaves"), t = e.length, s = i; for (; i < t; i++) if (e[i].parentIdx === -1) { i > s && i--; break } i >= t && (i = t - 1) } return i }, r.prototype._getRealStaticRowIndex = function () { var e = this._getStaticOffsetIndex(!1); return this._getStaticIndex(!0) + e }, r.prototype._hasMerging = function () { var e = this._field("leaves"), t, n, r, i = !1; if (e) for (t = 0, n = e.length; t < n && !i; t++) r = e[t], i = i || r.parentVis && r.rowMerge !== "none"; return i }, r.prototype._hasGrouping = function () { var e = this._field("leaves"), t, n, r, i = !1; for (t = 0, n = e.length; t < n && !i; t++) r = e[t], i = r.groupInfo && r.groupInfo.position !== "none"; return i }, r.prototype._hasSpannedCells = function () { return this._hasGrouping() || this._hasMerging() }, r.prototype._columnsHeadersTable = function (e) { return arguments.length && this._field("columnsHeadersTable", e), this._field("columnsHeadersTable") }, r.prototype._view = function () { return this._field("view") }, r.prototype._originalFooterRowData = function () { var e = this._field("tfoot"); return e && e.length ? e[0] : null }, r.prototype._originalHeaderRowData = function () { var e = this._field("thead"); return e && e.length ? e[0] : null }, r.prototype._setAttr = function (e, n, r) { var i = this; return e === this.element ? arguments.length === 2 ? (t.each(n, function (t, n) { t in i._originalAttr || (i._originalAttr[t] = e.attr(t)) }), e.attr(n)) : (n in this._originalAttr || (this._originalAttr[n] = e.attr(n)), e.attr(n, r)) : arguments.length === 3 ? e.attr(n, r) : e.attr(n) }, r.prototype._totalRowsCount = function () { return this.sketchTable.length }, r.prototype._trackScrollingPosition = function (e, t) { this._scrollingState.x = e, this._scrollingState.y = t }, r.prototype._trackScrollingIndex = function (e) { this._scrollingState.index = e }, r.prototype._uid = function () { return this.__uid === undefined && (this.__uid = e.grid.getUID()), "wijgrid" + this.__uid }, r }(e.wijmoWidget); e.wijgrid = n, n.prototype.widgetEventPrefix = "wijgrid", n.prototype._data$prefix = "wijgrid", n.prototype._customSortOrder = 1e3, n.prototype._reverseKey = !1, n.prototype._pageSizeKey = 10, n.prototype._mergeWidgetsWithOptions = !0; var r = function () { function e() { this.wijMobileCSS = { header: "ui-header ui-bar-a", content: "ui-body-c", stateHover: "ui-btn-down-c", stateActive: "ui-btn-down-c" }, this.allowColMoving = !1, this.allowColSizing = !1, this.allowEditing = !1, this.allowKeyboardNavigation = !0, this.allowPaging = !1, this.allowSorting = !1, this.allowVirtualScrolling = !1, this.cellStyleFormatter = undefined, this.columns = [], this.columnsAutogenerationMode = "merge", this.culture = "", this.customFilterOperators = [], this.data = null, this.editingInitOption = "auto", this.ensureColumnsPxWidth = !1, this.filterOperatorsSortMode = "alphabeticalCustomFirst", this.groupAreaCaption = "Drag a column here to group by that column.", this.groupIndent = 10, this.highlightCurrentCell = !1, this.highlightOnHover = !0, this.loadingText = "Loading...", this.nullString = "", this.pageIndex = 0, this.pageSize = 10, this.pagerSettings = { mode: "numeric", pageButtonCount: 10, position: "bottom" }, this.readAttributesFromData = !1, this.rowStyleFormatter = undefined, this.scrollMode = "none", this.selectionMode = "singleRow", this.showFilter = !1, this.showFooter = !1, this.showGroupArea = !1, this.showSelectionOnRender = !0, this.showRowHeader = !1, this.staticColumnIndex = -1, this.staticRowIndex = -1, this.totalRows = -1, this.afterCellEdit = null, this.afterCellUpdate = null, this.beforeCellEdit = null, this.beforeCellUpdate = null, this.cellClicked = null, this.columnDragging = null, this.columnDragged = null, this.columnDropping = null, this.columnDropped = null, this.columnGrouping = null, this.columnGrouped = null, this.columnResizing = null, this.columnResized = null, this.columnUngrouping = null, this.columnUngrouped = null, this.currentCellChanging = null, this.currentCellChanged = null, this.filterOperatorsListShowing = null, this.filtering = null, this.filtered = null, this.groupAggregate = null, this.groupText = null, this.invalidCellValue = null, this.pageIndexChanging = null, this.pageIndexChanged = null, this.selectionChanged = null, this.sorting = null, this.sorted = null, this.dataLoading = null, this.dataLoaded = null, this.loading = null, this.loaded = null, this.rendering = null, this.rendered = null } return e }(); n.prototype.options = e.grid.extendWidgetOptions(e.wijmoWidget.prototype.options, new r), t.wijmo.registerWidget("wijgrid", n.prototype) })(wijmo || (wijmo = {})); var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; var t = jQuery, n = function (n) { function r() { n.apply(this, arguments) } return __extends(r, n), r.prototype._create = function () { var n = t.data(this.element[0], "wijgridowner"); this._field("owner", n), e.grid.widgetName(this.element[0], this.widgetFullName), this._destroyed = !1, this.element.addClass(n.options.wijCSS.widget + " wijmo-c1basefield " + n.options.wijCSS.stateDefault), this.options.disabled && this.disable(), n.options.allowColMoving && n._dragndrop(!0).attach(this) }, r.prototype._init = function () { this.element.wrapInner("<div class='wijmo-wijgrid-innercell'></div>"), this._refreshHeaderCell() }, r.prototype.destroy = function () { try { n.prototype.destroy.apply(this, arguments) } finally { this._destroyed = !0 } }, r.prototype._destroy = function () { if (this._isDestroyed()) return; var t = this._owner(); t && t._dragndrop(!1) && t._dragndrop(!1).detach(this), e.grid.remove$dataByPrefix(this.element, this._data$prefix), this.element.removeClass(t.options.wijCSS.widget + " wijmo-c1basefield " + t.options.wijCSS.stateDefault).html(this.element.find(".wijmo-wijgrid-headertext").html()) }, r.prototype._field = function (t, n) { return e.grid.dataPrefix(this.element, this._data$prefix, t, n) }, r.prototype._removeField = function (e) { var t = this._data$prefix + e; this.element.removeData(t) }, r.prototype._setOption = function (e, t) { var r = this["_preset_" + e], i = this.options[e], s, o; r !== undefined && (t = r.apply(this, [t, i])), s = t !== i, n.prototype._setOption.apply(this, [e, t]); if (s) { if (this.options.groupedIndex !== undefined) { var u = this._owner()._field("groupedWidgets")[this.options.groupedIndex]; u && e in u.options && u._setOption(e, t) } o = this["_postset_" + e], o !== undefined && o.apply(this, [t, i]) } }, r.prototype._postset_allowMoving = function (e, t) { }, r.prototype._preset_clientType = function (e, t) { throw "read-only" }, r.prototype._postset_headerText = function (e, t) { this._refreshHeaderCell() }, r.prototype._postset_visible = function (e, t) { this._owner().ensureControl(!1) }, r.prototype._postset_width = function (t, n) { var r = this._owner(); if (r) { this.options.ensurePxWidth = !0; var i = e.grid.getColumnByTravIdx(r.options.columns, this.options.travIdx); i && (i.found.width = t, i.found.ensurePxWidth = !0), r.setSize() } }, r.prototype._owner = function () { return this._field("owner") }, r.prototype._canSize = function () { return this.options.allowSizing && this._owner().options.allowColSizing }, r.prototype._canDrag = function () { return this.options.allowMoving === !0 }, r.prototype._canDropTo = function (t) { return e.grid.isChildOf(this._owner().options.columns, t, this) ? !1 : !0 }, r.prototype._createHeaderContent = function (e) { return e.html(this.options.headerText || "") }, r.prototype._decorateHeaderContent = function (e) { return e.wrapInner('<span class="wijmo-wijgrid-headertext" />') }, r.prototype._refreshHeaderCell = function () { var e = this.element.children(".wijmo-wijgrid-innercell").empty(); this._createHeaderContent(e), this._decorateHeaderContent(e) }, r.prototype._isDestroyed = function () { return this._destroyed }, r }(e.wijmoWidget); e.c1basefield = n, n.prototype._data$prefix = "c1basefield"; var r = function () { function e() { this.allowMoving = !0, this.allowSizing = !0, this.cellFormatter = undefined, this.dataKey = undefined, this.ensurePxWidth = undefined, this.footerText = undefined, this.headerText = undefined, this.textAlignment = undefined, this.visible = !0, this.width = undefined } return e }(); e.c1basefield_options = r, n.prototype.options = e.grid.extendWidgetOptions(e.wijmoWidget.prototype.options, new r), t.wijmo.registerWidget("c1basefield", n.prototype) })(wijmo || (wijmo = {})); var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; var t = jQuery, n = function (n) { function r() { n.apply(this, arguments) } return __extends(r, n), r.prototype._create = function () { n.prototype._create.apply(this, arguments); var e = this._owner(); this.element.addClass(e.options.wijCSS.widget + " wijmo-c1field") }, r.prototype._destroy = function () { if (this._isDestroyed()) return; var e = this._owner(); this.element.find("*").unbind("." + this.widgetName); if (this.$filterEditor) { this.$filterEditor.closest("td").find("*").unbind("." + this.widgetName); switch (this._getInputEditorType(this.options)) { case "date": this.$filterEditor.data("wijmo-wijinputdate") && this.$filterEditor.wijinputdate("destroy"); break; case "mask": this.$filterEditor.data("wijmo-wijinputmask") && this.$filterEditor.wijinputmask("destroy"); break; case "numberCurrency": case "numberNumber": case "numberPercent": this.$filterEditor.data("wijmo-wijinputnumber") && this.$filterEditor.wijinputnumber("destroy") } this.$filterEditor = null } this.element.removeClass(e.options.wijCSS.widget + " wijmo-c1field").find(".wijmo-wijgrid-headertext > span." + e.options.wijCSS.icon).remove(), this._removeDropDownFilterList(), n.prototype._destroy.apply(this, arguments) }, r.prototype._init = function () { n.prototype._init.apply(this, arguments), this.$filterEditor = null; var e = this._owner(); this.filterRow = e._filterRow(), e.options.showFilter && this.options.showFilter && this.options.dataIndex >= 0 && this._prepareFilterCell() }, r.prototype._postset_aggregate = function (e, t) { this._owner().ensureControl(!1) }, r.prototype._postset_allowSort = function (e, t) { this._refreshHeaderCell() }, r.prototype._postset_dataType = function (e, t) { throw "read-only" }, r.prototype._postset_dataParser = function (e, t) { this._owner().ensureControl(!1) }, r.prototype._postset_dataFormatString = function (e, t) { this._owner().ensureControl(!1) }, r.prototype._postset_filterOperator = function (e, t) { this._owner().ensureControl(!0) }, r.prototype._postset_filterValue = function (e, t) { this._owner().ensureControl(!0) }, r.prototype._postset_groupInfo = function (e, t) { this._owner().ensureControl(!0) }, r.prototype._postset_rowMerge = function (e, t) { this._owner().ensureControl(!1) }, r.prototype._postset_showFilter = function (e, t) { this._owner().ensureControl(!1) }, r.prototype._postset_sortDirection = function (e, t) { this.options.sortOrder = 0, this._owner().ensureControl(!0) }, r.prototype._postset_width = function (e, t) { n.prototype._postset_width.apply(this, arguments) }, r.prototype._canDropTo = function (e) { return n.prototype._canDropTo.apply(this, arguments) ? this.options.groupedIndex !== undefined && e instanceof t.wijmo.c1groupedfield ? !1 : !0 : !1 }, r.prototype._canSort = function () { var e = this._owner(); return e && e.options.allowSorting && this.options.allowSort && this.options.dataIndex >= 0 }, r.prototype._decorateHeaderContent = function (e) { if (this._canSort()) { var r = this._owner(), i = e.wrapInner('<a class="wijmo-wijgrid-headertext" href="#" role="button" />').children("a"); i.bind("click." + this.widgetName, this, t.proxy(this._onHrefClick, this)); switch (this.options.sortDirection) { case "ascending": i.append(t('<span class="' + r.options.wijCSS.icon + " " + r.options.wijCSS.iconArrowUp + '">ascending</span>')); break; case "descending": i.append(t('<span class="' + r.options.wijCSS.icon + " " + r.options.wijCSS.iconArrowDown + '">descending</span>')) } } else n.prototype._decorateHeaderContent.apply(this, arguments) }, r.prototype._prepareFilterCell = function () { var n = this.options.visLeavesIdx, r = null, i = null, s, o, u = this, a; if (n >= 0) { r = this._owner(); if (!this.filterRow) throw "exception"; i = t(e.grid.rowAccessor.getCell(this.filterRow, n)), this.$filterEditor = i.find("input"), i.bind(t.support.selectstart ? "selectstart" : "mousedown", function (e) { e.stopPropagation() }), s = r._parse(this.options, e.grid.filterHelper.getSingleValue(this.options.filterValue)); if (s === null || s === "undefined") switch (e.grid.getDataType(this.options)) { case "boolean": s = !1; break; case "number": case "currency": case "datetime": s = 0; break; default: s = "" } o = { culture: r.options.culture, disabled: r.options.disabled, decimalPlaces: function (e) { var t = /^(n|p|c){1}(\d*)$/.exec(e); return t && t[2] ? parseInt(t[2], 10) : 2 }(this.options.dataFormatString) }; switch (a = this._getInputEditorType(this.options)) { case "date": this.$filterEditor.wijinputdate(t.extend(o, { date: s, dateFormat: this.options.dataFormatString || undefined })); break; case "mask": this.$filterEditor.wijinputmask({ text: s + "" }); break; case "numberCurrency": this.$filterEditor.wijinputnumber(t.extend(o, { type: "currency", value: s })); break; case "numberNumber": this.$filterEditor.wijinputnumber(t.extend(o, { value: s })); break; case "numberPercent": this.$filterEditor.wijinputnumber(t.extend(o, { type: "percent", value: s * 100 })); break; default: throw e.grid.stringFormat('Unsupported editor type: "{0}"', a) } i.find(".wijmo-wijgrid-filter-trigger").attr({ role: "button", "aria-haspopup": "true" }).bind("mouseenter." + this.widgetName, function (e) { u.options.disabled || t(this).addClass(r.options.wijCSS.stateHover) }).bind("mouseleave." + this.widgetName, function (e) { u.options.disabled || t(this).removeClass(r.options.wijCSS.stateHover + " " + r.options.wijCSS.stateActive) }).bind("mouseup." + this.widgetName, this, function (e) { u.options.disabled || t(this).removeClass(r.options.wijCSS.stateActive) }).bind("mousedown." + this.widgetName, { column: this }, this._onFilterBtnClick).bind("click." + this.widgetName, function (e) { e.preventDefault() }) } }, r.prototype._onFilterBtnClick = function (n) { var r = n.data.column, i = 8, s, o, u, a, f, l, c, h, p, d; if (r.options.disabled) return !1; if (r.$dropDownFilterList) return r._removeDropDownFilterList(), !1; n.target.focus(), s = r._owner(), o = e.grid.filterHelper.getSingleOperatorName(r.options.filterOperator).toLowerCase(), u = s.getFilterOperatorsByDataType(e.grid.getDataType(r.options)), a = { operators: u, column: r.options }, s._onFilterOperatorsListShowing(t.extend(!0, {}, a)), f = [], a.operators && t.each(a.operators, function (e, t) { f.push({ label: t.displayName || t.name, value: t.name, selected: t.name.toLowerCase() === o }) }), r.$dropDownFilterList = t('<div class="wijmo-wijgrid-filterlist"></div').appendTo(document.body).wijlist({ autoSize: !0, maxItemsCount: i, selected: function (e, t) { var n, i; switch (i = r._getInputEditorType(r.options)) { case "date": n = r.$filterEditor.wijinputdate("option", "date") || new Date; break; case "mask": n = r.$filterEditor.wijinputmask("option", "text"); break; case "numberCurrency": case "numberNumber": case "numberPercent": n = r.$filterEditor.wijinputnumber("option", "value"), i === "numberPercent" && (n /= 100) } r._removeDropDownFilterList(), s._handleFilter(r, t.item.value, n) } }), t.ui && t.fn.zIndex && (d = s.outerDiv.zIndex(), d && d++), r.$dropDownFilterList.css("z-index", Math.max(d || 0, 9999)), r.$dropDownFilterList.wijlist("setItems", f).wijlist("renderList"), h = r.$dropDownFilterList.width() | 150, r.$dropDownFilterList.width(f.length > i ? h + 20 : h).wijlist("refreshSuperPanel").position({ of: t(this), my: "left top", at: "left bottom" }), r.$dropDownFilterList.$button = t(this), p = r.$dropDownFilterList.eventUID = e.grid.getUID(), t(document).bind("mousedown." + r.widgetName + "." + p, { column: r }, r._onDocMouseDown) }, r.prototype._onDocMouseDown = function (e) { var n = t(e.target), r = n.parents(".wijmo-wijgrid-filterlist:first"), i = n.is(".wijmo-wijgrid-filter-trigger") ? n : n.parents(".wijmo-wijgrid-filter-trigger:first"); i.length && i[0] === e.data.column.$dropDownFilterList.$button[0] || r.length && r[0] === e.data.column.$dropDownFilterList[0] || e.data.column._removeDropDownFilterList() }, r.prototype._onHrefClick = function (e) { return e.data.options.disabled ? !1 : (e.data.options.allowSort && e.data._owner()._handleSort(e.data.options, e.ctrlKey), !1) }, r.prototype._removeDropDownFilterList = function () { if (this.$dropDownFilterList) { var e = this.$dropDownFilterList.eventUID; this.$dropDownFilterList.remove(), this.$dropDownFilterList = null, t(document).unbind("mousedown." + this.widgetName + "." + e, this._onDocMouseDown) } }, r.prototype._getInputEditorType = function (t) { switch (e.grid.getDataType(t)) { case "number": return t.dataFormatString && t.dataFormatString.indexOf("p") === 0 ? "numberPercent" : "numberNumber"; case "currency": return "numberCurrency"; case "datetime": return "date"; default: return "mask" } }, r }(e.c1basefield); e.c1field = n; var r = function (e) { function n() { e.apply(this, arguments), this.aggregate = "none", this.allowSort = !0, this.dataType = undefined, this.dataParser = undefined, this.dataFormatString = undefined, this.filterOperator = "nofilter", this.filterValue = undefined, this.groupInfo = { expandInfo: [], level: undefined, groupSingleRow: !0, collapsedImageClass: t.wijmo.wijCSS.iconArrowRight, expandedImageClass: t.wijmo.wijCSS.iconArrowRightDown, position: "none", outlineMode: "startExpanded", headerText: undefined, footerText: undefined }, this.readOnly = !1, this.rowMerge = "none", this.showFilter = !0, this.sortDirection = "none", this.valueRequired = !1 } return __extends(n, e), n }(e.c1basefield_options); e.c1field_options = r, n.prototype.options = e.grid.extendWidgetOptions(e.c1basefield.prototype.options, new r), t.wijmo.registerWidget("c1field", t.wijmo.c1basefield, n.prototype) })(wijmo || (wijmo = {})); var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; var t = jQuery, n = function (e) { function n() { e.apply(this, arguments) } return __extends(n, e), n.prototype._create = function () { e.prototype._create.apply(this, arguments); var t = this._owner(); this.element.addClass(t.options.wijCSS.widget + " wijmo-c1band") }, n.prototype._canDropTo = function (n) { return e.prototype._canDropTo.apply(this, arguments) ? !(n instanceof t.wijmo.c1groupedfield) : !1 }, n }(e.c1basefield); e.c1band = n; var r = function (e) { function t() { e.apply(this, arguments), this.columns = [] } return __extends(t, e), t }(e.c1field_options); n.prototype.options = e.grid.extendWidgetOptions(e.c1basefield.prototype.options, new r), t.wijmo.registerWidget("c1band", t.wijmo.c1basefield, n.prototype) })(wijmo || (wijmo = {})); var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; var t = jQuery, n = function (n) { function r() { n.apply(this, arguments) } return __extends(r, n), r.prototype._create = function () { var n = t.data(this.element[0], "wijgridowner"); this._field("owner", n), e.grid.widgetName(this.element[0], this.widgetFullName), this._destroyed = !1, this.element.addClass("wijmo-wijgrid-group-button " + n.options.wijCSS.stateDefault + " " + n.options.wijCSS.cornerAll), this.options.disabled && this.disable(), n.options.allowColMoving && n._dragndrop(!0).attach(this) }, r.prototype._init = function () { this._refreshHeaderCell() }, r.prototype.destroy = function () { try { n.prototype.destroy.apply(this, arguments) } finally { this._destroyed = !0 } }, r.prototype._destroy = function () { if (this._isDestroyed()) return; this.element.find("*").unbind("." + this.widgetName); var t = this._owner(); t && t._dragndrop(!1) && t._dragndrop(!1).detach(this), e.grid.remove$dataByPrefix(this.element, this._data$prefix) }, r.prototype._field = function (t, n) { return e.grid.dataPrefix(this.element, this._data$prefix, t, n) }, r.prototype._removeField = function (e) { var t = this._data$prefix + e; this.element.removeData(t) }, r.prototype._setOption = function (e, t) { var r = this["_preset_" + e], i = this.options[e], s, o; r !== undefined && (t = r.apply(this, [t, i])), s = t !== i, n.prototype._setOption.apply(this, [e, t]), s && (o = this["_postset_" + e], o !== undefined && o.apply(this, [t, i])) }, r.prototype._postset_headerText = function (e, t, n) { this._refreshHeaderCell() }, r.prototype._postset_allowSort = function (e, t, n) { this._refreshHeaderCell() }, r.prototype._owner = function () { return this._field("owner") }, r.prototype._canSize = function () { return this.options.allowSizing && this._owner().options.allowColSizing }, r.prototype._canDrag = function () { return this.options.allowMoving === !0 }, r.prototype._canDropTo = function (n) { return n instanceof t.wijmo.c1groupedfield ? e.grid.isChildOf(this._owner().options.columns, n, this) ? !1 : !0 : !1 }, r.prototype._canSort = function () { var e = this._owner(); return e && e.options.allowSorting && this.options.allowSort && this.options.dataIndex >= 0 }, r.prototype._refreshHeaderCell = function () { var e = this._owner().options.wijCSS, n = t('<span class="wijmo-wijgrid-group-button-close ' + e.stateDefault + " " + e.cornerAll + '"><span class="' + e.icon + " " + e.iconClose + '"></span></span>').bind("click." + this.widgetName, this, this._onCloseClick); this.element.html(this.options.headerText || "").prepend(n).bind("click." + this.widgetName, this, t.proxy(this._onHrefClick, this)); if (this._canSort()) switch (this.options.sortDirection) { case "ascending": this.element.append(t('<span class="wijmo-wijgrid-group-button-sort ' + e.icon + " " + e.iconArrowUp + '"></span>')); break; case "descending": this.element.append(t('<span class="wijmo-wijgrid-group-button-sort ' + e.icon + " " + e.iconArrowDown + '"></span>')) } }, r.prototype._onCloseClick = function (e) { var t = e.data.options; return t.disabled || e.data._owner()._handleUngroup(e.data.options.travIdx), !1 }, r.prototype._onHrefClick = function (t) { var n = t.data._owner(), r = t.data.options, i; return !r.disabled && r.allowSort && (i = e.grid.search(n.columns(), function (e) { return e.options.travIdx === r.travIdx }), i = i.found ? i.found.options : e.grid.getColumnByTravIdx(n.options.columns, r.travIdx).found, i && n._handleSort(i, t.ctrlKey)), !1 }, r.prototype._isDestroyed = function () { return this._destroyed }, r }(e.wijmoWidget); e.c1groupedfield = n, n.prototype._data$prefix = "c1groupedfield", n.prototype.options = t.extend(!0, {}, e.wijmoWidget.prototype.options, { wijMobileCSS: { header: "ui-header ui-bar-a", content: "ui-body-c", stateDefault: "ui-btn-up-c", stateHover: "ui-btn-down-c", stateActive: "ui-btn-down-c" }, allowMoving: !0, allowSort: !0, headerText: undefined, sortDirection: "none" }), t.wijmo.registerWidget("c1groupedfield", n.prototype) })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; function i(e) { var t = []; return s(e, t), t } function s(e, t) { var n, r, i, o; if (e) for (n = 0, r = e.length; n < r; n++) i = e[n], i.options && (i = i.options), o = i.columns, o && o.length ? s(o, t) : t.push(i) } function o(e, t) { var n, r, i, s = null; if (e && t >= 0) for (n = 0, r = e.length; n < r && !s; n++) { i = e[n], i.options && (i = i.options); if (i.travIdx === t) return { found: i, at: e }; i.columns && (s = this.getColumnByTravIdx(i.columns, t)) } return s } function u(e, t, n) { t.options && (t = t.options), n.options && (n = n.options); if (n.isBand && t.parentIdx >= 0) { if (t.parentIdx === n.travIdx) return !0; if (t.parentIdx > n.travIdx) { var r = this.flatten(e); for (; ;) { t = r[t.parentIdx]; if (t.travIdx === n.travIdx) return !0; if (t.parentIdx === -1) break } } } return !1 } function a(e) { var t = []; return f(e, t), t } function f(e, t) { var n, r, i; if (e) for (n = 0, r = e.length; n < r; n++) i = e[n], i.isLeaf && t.push(i), i.columns && f(i.columns, t) } function l(e) { return c(e, 0, -1) } function c(e, t, n) { var r, i, s; if (e) for (r = 0, i = e.length; r < i; r++) s = e[r], s.options && (s = s.options), s.linearIdx = r, s.travIdx = t++, s.parentIdx = n, s.columns && (t = c(s.columns, t, t - 1)); return t } function h(t) { var n = []; return e.grid.traverse(t, function (e) { n.push(e) }), n } function p(t, r) { var i, s, o; if (t && n.isFunction(r)) for (i = 0; i < t.length; i++) { o = t[i], o.options && (o = o.options), s = t.length, r(o, t); if (t.length !== s) { i--; continue } o.columns && e.grid.traverse(o.columns, r) } } var n = jQuery, r = function () { function t() { } return t.prototype.generateSpanTable = function (e, t) { this._height = this._width = this._inc = this._shift = 0, this._table = [], this._traverseList = [], this._savedXPos = []; var n = this._generateSpanTable(e, t, !0); return n }, t.prototype._generateSpanTable = function (t, n, r) { var i, s, o = this; this._height = this.getVisibleHeight(t, r), n = n || [], e.grid.traverse(t, function (e) { e.isLeaf && n.push(e), o._traverseList.push(e) }), this._width = n.length; for (i = 0; i < this._height; i++) { this._table[i] = []; for (s = 0; s < this._width; s++) this._table[i][s] = { column: null, colSpan: 0, rowSpan: 0 } } return this._setTableValues(t, 0, 0), this._table }, t.prototype.getVisibleHeight = function (e, t) { var r, i, s, o, u = 0; if (n.isArray(e)) for (r = 0, i = e.length; r < i; r++) o = this.getVisibleHeight(e[r], t), u = Math.max(u, o); else { s = e.visible === undefined ? !0 : e.visible, e.parentVis = s && t; if (e.isBand) { for (r = 0, i = e.columns.length; r < i; r++) o = this.getVisibleHeight(e.columns[r], e.parentVis), u = Math.max(u, o); if (!e.parentVis) return u; e.isLeaf = u === 0, u++ } else e.isLeaf = !0, e.parentVis && (u = 1) } return u }, t.prototype._getVisibleParent = function (e) { while (e) { e = this._traverseList[e.parentIdx]; if (e && (e.parentVis || e.parentVis === undefined)) return e } return null }, t.prototype._setTableValues = function (e, t, r) { var i, s, o, u, a, f; if (n.isArray(e)) for (i = 0, s = e.length; i < s; i++) this._setTableValues(e[i], t, r); else { if (e.travIdx === undefined) throw "undefined travIdx"; o = r + this._shift, e.parentVis && (u = o + this._inc, this._table[t][u].column = e, this._savedXPos[e.travIdx] = u); if (e.isBand) for (i = 0, s = e.columns.length; i < s; i++) this._setTableValues(e.columns[i], t + 1, r); e.parentVis ? this._shift - o === 0 ? (this._table[t][this._savedXPos[e.travIdx]].rowSpan = this._height - t, this._shift++) : this._table[t][this._savedXPos[e.travIdx]].colSpan = this._shift - o : !e.isBand && this._height > 0 && (f = this._getVisibleParent(e), a = f ? f.isLeaf : !1, a && this._inc++, t >= this._height && (t = this._height - 1), u = r + this._shift + this._inc, this._table[t][u].column = e, a || (f && this._savedXPos[f.travIdx] === u && this._shiftTableElements(u, t), this._inc++)) } }, t.prototype._shiftTableElements = function (e, t) { var n; for (n = 0; n < t; n++) this._table[n][e + 1] = this._table[n][e], this._table[n][e] = { column: null, colSpan: 0, rowSpan: 0 }, this._table[n][e + 1].column && this._savedXPos[this._table[n][e + 1].column.travIdx]++ }, t }(); t.bandProcessor = r, t.getAllLeaves = i, t.getColumnByTravIdx = o, t.isChildOf = u, t.getLeaves = a, t.setTraverseIndex = l, t.flatten = h, t.traverse = p })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function () { function t(t) { this._dvFilteringSettings = undefined, this._dvPagingSettings = undefined, this._dvSortingSettings = undefined, this._wgFilteringSettings = undefined, this._wgPagingSettings = undefined, this._wgSortingSettings = undefined; if (!t) throw "exception"; this._wijgrid = t, this._dataView = t._dataViewWrapper.dataView(), this._filterCache = new e.grid.filterOperatorsCache(t) } return t.prototype.compareSettings = function () { var t = !0, n, r, i, s; t = (n = this.DVPagingSettings()) === (r = this.WGPagingSettings()), !t && n && r && (t = n.pageSize === r.pageSize && n.pageIndex === r.pageIndex); if (t) { t = (n = this.DVSortingSettings()) === (r = this.WGSortingSettings()); if (!t && n && r && (s = n.length) === r.length) { t = !0; for (i = 0; i < s && t; i++) t = n[i].dataKey === r[i].dataKey && n[i].sortDirection === r[i].sortDirection } } return t && (n = this.DVFilteringSettings(), r = this.WGFilteringSettings(), t = e.grid.compareObj(n, r)), t }, t.prototype.DVFilteringSettings = function () { function e(t, r) { var i; n.each(t, function (t, s) { typeof s == "string" ? i = s : n.isArray(s) ? e(s, r) : (r.filterValue.push(s.value), r.filterOperator.push({ name: s.operator, condition: i })) }) } if (this._dvFilteringSettings === undefined) { var t = [], r = this._dataView.filter(); r && n.each(r, function (r, i) { var s = { dataKey: r }; n.isArray(i) ? (s.filterValue = [], s.filterOperator = [], e(i, s)) : n.isPlainObject(i) ? (s.filterValue = i.value, s.filterOperator = i.operator || "Equals") : (s.filterValue = i, s.filterOperator = "Equals"), t.push(s) }), this._dvFilteringSettings = t.length ? t : null } return this._dvFilteringSettings }, t.prototype.DVPagingSettings = function () { if (this._dvPagingSettings === undefined) { var t = e.grid.asPagedDataView(this._dataView); if (t) { var n = t.pageSize(); this._dvPagingSettings = n > 0 ? { pageSize: t.pageSize(), pageIndex: t.pageIndex() } : null } } return this._dvPagingSettings }, t.prototype.DVSortingSettings = function () { if (this._dvSortingSettings === undefined) { var t = [], r = e.data.sorting.compile(this._dataView.sort()).normalized; r && n.each(r, function (e, n) { n !== null && t.push({ dataKey: typeof n == "string" ? n : n.property, sortDirection: n.asc || n.asc === undefined ? "ascending" : "descending" }) }), this._dvSortingSettings = t.length ? t : null } return this._dvSortingSettings }, t.prototype.WGFilteringSettings = function () { if (this._wgFilteringSettings === undefined) { var t = [], r = this._wijgrid._field("leaves"), i = this; r && n.each(r, function (n, r) { if (e.grid.validDataKey(r.dataKey) && r.filterOperator) { var s = e.grid.deepExtend({}, { foo: r.filterValue }).foo, o = e.grid.deepExtend({}, { foo: r.filterOperator }).foo, u = e.grid.filterHelper.verify(o, s, r.dataType, i._filterCache); u && t.push({ dataKey: r.dataKey, filterValue: u.filterValue, filterOperator: u.filterOperator }) } }), this._wgFilteringSettings = t.length ? t : null } return this._wgFilteringSettings }, t.prototype.WGPagingSettings = function () { return this._wgPagingSettings === undefined && (this._wgPagingSettings = this._wijgrid.options.allowPaging ? { pageSize: this._wijgrid.options.pageSize, pageIndex: this._wijgrid.options.pageIndex } : null), this._wgPagingSettings }, t.prototype.WGSortingSettings = function () { if (this._wgSortingSettings === undefined) { var t = [], r = this._wijgrid._field("leaves"); this._wijgrid.options.allowSorting && (r && n.each(r, function (n, r) { !r.isBand && r.allowSort && e.grid.validDataKey(r.dataKey) && (r.groupInfo && r.groupInfo.position !== "none" && r.sortDirection === "none" && (r.sortDirection = "ascending"), (r.sortDirection === "ascending" || r.sortDirection === "descending") && t.push({ dataKey: r.dataKey, sortDirection: r.sortDirection, sortOrder: r.sortOrder || 0 })) }), t.length && (t.sort(function (e, t) { return e.sortOrder - t.sortOrder }), n.each(t, function (e, t) { delete t.sortOrder }))), this._wgSortingSettings = t.length ? t : null } return this._wgSortingSettings }, t.prototype.MapWGToDV = function () { var e = {}, t, r; this._mapPagingParams() && (t = this.WGPagingSettings()) ? (e.pageIndex = t.pageIndex, e.pageSize = t.pageSize) : e.pageSize = -1; if (this._mapSortingParams()) { e.sort = []; if (t = this.WGSortingSettings()) e.sort = [], n.each(t, function (t, n) { e.sort.push({ property: n.dataKey, asc: n.sortDirection === "ascending" }) }) } if (this._mapFilteringParams()) { e.filter = {}; if (t = this.WGFilteringSettings()) e.filter = this._convertFilterToDV(t); n.isEmptyObject(e.filter) && (e.filter = null) } return e }, t.prototype.MapDVToWG = function () { var t, r = {}, i = this._mapSortingParams(), s = this._mapPagingParams(), o = this._mapFilteringParams(), u = e.grid.asPagedDataView(this._dataView); n.each(this._wijgrid._field("leaves"), function (e, t) { i && (t.sortOrder = 0, t.sortDirection = "none"), o && (t.filterOperator = "nofilter", t.filterValue = undefined), r[t.dataKey] = t }), s && u && (this._wijgrid.options.pageSize = u.pageSize(), this._wijgrid.options.pageIndex = u.pageIndex()), i && (t = this.DVSortingSettings()) && n.each(t, function (e, t) { var n; if (n = r[t.dataKey]) n.sortDirection = t.sortDirection, n.sortOrder = e }), o && (t = this.DVFilteringSettings()) && n.each(t, function (e, t) { var i; if (i = r[t.dataKey]) i.filterValue = t.filterValue, i.filterOperator = t.filterOperator, n.isPlainObject(i.filterOperator) && (i.filterOperator = i.filterOperator.name) }) }, t.prototype._mapPagingParams = function () { return this._wijgrid.options.allowPaging && !this._wijgrid._customPagingEnabled() && !this._wijgrid._serverShaping() }, t.prototype._mapSortingParams = function () { return this._wijgrid.options.allowSorting && !this._wijgrid._serverShaping() }, t.prototype._mapFilteringParams = function () { return !this._wijgrid._serverShaping() }, t.prototype._convertFilterToDV = function (e) { var t = {}, r = this; return n.each(e, function (e, i) { var s = i.dataKey, o = [], u = "and", a, f, l, c, h; if (!n.isPlainObject(i)) return; f = i.filterOperator, l = i.filterValue; if (f == null) return; n.isArray(f) || (f = [f]), n.isArray(l) || (l = [l]); if (f.length != l.length) throw "The number of filter operators must match the number of filter values"; if (f.length == 0) return; n.each(f, function (e, t) { function i() { h.length > 1 ? h.splice(0, 0, "or") : h = h[0] } function f() { u == null && (u = a, o.splice(0, 0, a)) } typeof t == "string" && (t = { name: t }); if (!n.isPlainObject(t) || !t.name) throw "Invalid filter operator"; c = l[e], n.isArray(c) || (c = [c]), h = n.map(c, function (e) { var i = { property: s, operator: t.name, value: e }, o = r._filterCache.getByNameInt(t.name); if (o.isCustom) { var u = n.extend(!0, {}, o.op); n.isFunction(u.operator) && (u.apply = u.operator), i.operator = u } return i }), u = null, a = t.condition || "or", o.length <= 1 || u == a ? h.length == 1 || o.length <= 1 || u == "or" ? (o = o.concat(h), f()) : (i(), o.push(h), f()) : (i(), o = [o, h], f()) }), n.each(o, function (e, t) { n.isArray(t) && t.length == 2 && (o[e] = t[1]) }), o.length == 2 && typeof (o[0] === "string") && o.shift(), o.length == 1 && (o = o[0]), t[s] = o }), t }, t }(); t.settingsManager = r })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; function i(e) { return e && "pageCount" in e ? e : null } function s(e) { return e && "commitEdit" in e ? e : null } var n = jQuery, r = function () { function t(e) { this._domSource = null, this._ignoreAllEvents = !1, this._ignoreChangeEvent = !1, this._ignoreCurrentChangedEvent = !1, this._sharedDataItems = null, this._userData = null, this._totals = null, this._changeTimer = 0, this._toDispose = [], this._isOwnDataView = !1, this._isWijdatasource = !1, this._isDynamicWijdatasource = !1, this._wijgrid = e, this._createDataViewWrapper() } return t.prototype.data = function () { var t = this._getDataViewInst(), n = e.grid.asPagedDataView(t); return { data: this._getSharedDataItems(), totalRows: n != null ? n.totalItemCount() : (t.getSource() || []).length, totals: this._getTotals(), emptyData: this.isBoundedToDOM() ? this._domSource.emptyData : null } }, t.prototype.dataView = function () { return this._getDataViewInst() }, t.prototype.dispose = function () { var e = this._getDataViewInst(); this._propChangeListener.dispose(), n.each(this._toDispose, function (e, t) { t.dispose() }), e && this._isOwnDataView && e.dispose(), this._wijgrid._wijDataView = null }, t.prototype.ignoreChangeEvent = function (e) { if (!arguments.length) return this._ignoreChangeEvent; this._ignoreChangeEvent = e === !0 }, t.prototype.ignoreCurrentChangedEvent = function (e) { if (!arguments.length) return this._ignoreCurrentChangedEvent; this._ignoreCurrentChangedEvent = e === !0 }, t.prototype.isDataLoaded = function () { var e = this._getDataViewInst(); return e.isLoaded() }, t.prototype.isOwnDataView = function () { return this._isOwnDataView }, t.prototype.getFieldsInfo = function () { var e = this._getDataViewInst(), t = e.getProperties(), r = {}; return n.each(t, function (e, t) { r[t.name] = { name: t.name, type: t.type || "string" } }), r }, t.prototype.isBoundedToDOM = function () { return this._domSource !== null }, t.prototype.load = function (t) { this._userData = t; var n = this._getDataViewInst(); n || (this._createDataViewWrapper(), n = this._getDataViewInst()), this._onDataViewLoading(); var r = new e.grid.settingsManager(this._wijgrid); if (this._needToLoad(r)) { var i = r.MapWGToDV(), s = !1; this._isWijdatasource && !this._isDynamicWijdatasource && n.isLoaded() && (s = !0), n.refresh(i, s) } else this.isDataLoaded() && (this._onDataViewLoaded(), this._onDataViewReset()) }, t.prototype.currentPosition = function (e) { var t = this._getDataViewInst(); if (!arguments.length) return t.currentPosition(); this.ignoreCurrentChangedEvent(!0); try { t.currentPosition(e) } finally { this.ignoreCurrentChangedEvent(!1) } }, t.prototype.getValue = function (e, t) { var n = this._getDataViewInst(); return typeof t == "number" && (t += ""), n.getProperty(e, t) }, t.prototype.setValue = function (e, t, n) { var r = this._getDataViewInst(); this.ignoreChangeEvent(!0); try { typeof t == "number" && (t += ""), r.setProperty(e, t, n) } finally { this.ignoreChangeEvent(!1) } }, t.prototype.makeDirty = function () { this._propChangeListener.removeAll(), this._totals = null, this._sharedDataItems = null }, t.prototype._createDataViewWrapper = function () { var t, r = this._wijgrid.options.data, i = this._getDataViewInst(), s = !1; if (i) return; r || (this._domSource = this._processDOM(this._wijgrid.element, this._wijgrid.options.readAttributesFromData), r = this._domSource.items), s = typeof wijdatasource != "undefined" && r instanceof wijdatasource, this._isOwnDataView = n.isArray(r) || s, this._isWijdatasource = !!this._isOwnDataView && !!s, this._isDynamicWijdatasource = !!(this._isOwnDataView && s && r.dynamic), this._isOwnDataView ? (!this._domSource && this._wijgrid.options.readAttributesFromData && this._moveAttributesToExpando(r), i = e.grid.GridDataView.create(e.data.asDataView(r))) : i = r, this._wijgrid._wijDataView = i, this._toDispose.push(i.isLoading.subscribe(n.proxy(this._onDataViewLoadingInternal, this))), this._toDispose.push(i.isLoaded.subscribe(n.proxy(this._onDataViewLoadedInternal, this))), this._toDispose.push(i.subscribe(n.proxy(this._onDataViewChangeInternal, this))), this._toDispose.push(i.currentPosition.subscribe(n.proxy(this._onDataViewCurrentChangedInternal, this))), this._propChangeListener = new e.grid.propChangeListener(n.proxy(this._onPropertyChanged, this)) }, t.prototype._getDataViewInst = function () { return this._wijgrid._wijDataView }, t.prototype._needToLoad = function (e) { var t = this._getDataViewInst(); return this._isDynamicWijdatasource || this._isWijdatasource && !t.isLoaded() ? !0 : this._isOwnDataView && !this._isWijdatasource && this.isDataLoaded() ? !0 : this.isDataLoaded() || t.isLoading() ? !e.compareSettings() : !1 }, t.prototype._validateSettings = function (e) { if (!this._isOwnDataView && this._wijgrid.options.allowPaging && (e.DVPagingSettings() || {}).pageSize !== (e.WGPagingSettings() || {}).pageSize) throw "The pageSize option of the external dataView can't be changed." }, t.prototype._onDataViewLoadingInternal = function (e) { if (this._ignoreAllEvents) return; e && (this._userData || this._onDataViewLoading()) }, t.prototype._onDataViewLoadedInternal = function (e) { if (this._ignoreAllEvents) return; e && this._onDataViewLoaded() }, t.prototype._onDataViewChangeInternal = function (e) { var t = this; if (this._ignoreAllEvents || this._ignoreChangeEvent) return; if (e.changes) { if (e.length && e[0].entityState() === "detached") return; n.each(e.changes, function (e, n) { switch (n.changeType) { case "remove": t._propChangeListener.remove(n.index); break; case "add": t._propChangeListener.insert(n.index, n.element) } }) } this._onDataViewChange.apply(this, arguments) }, t.prototype._onDataViewCurrentChangedInternal = function () { if (this._ignoreAllEvents || this._ignoreCurrentChangedEvent) return; this._onDataViewCurrentChanged.apply(this, arguments) }, t.prototype._onDataViewReset = function () { try { this.makeDirty(), this._wijgrid._onDataViewReset(this._userData) } finally { this._userData = null } }, t.prototype._onPropertyChanged = function (e) { var t = this; this._changeTimer > 0 && (window.clearTimeout(this._changeTimer), this._changeTimer = 0), this._changeTimer != -1 && (this._changeTimer = window.setTimeout(function () { t._changeTimer = -1, t._wijgrid._destroyed || t._onDataViewChange(), t._changeTimer = 0 }, 100)) }, t.prototype._onDataViewChange = function (e) { this._onDataViewReset() }, t.prototype._onDataViewCurrentChanged = function (e, t) { this._wijgrid._onDataViewCurrentPositionChanged(e, t) }, t.prototype._onDataViewLoading = function () { this._wijgrid._onDataViewLoading() }, t.prototype._onDataViewLoaded = function () { this._wijgrid._onDataViewLoaded() }, t.prototype._getSharedDataItems = function () { if (!this._sharedDataItems) { var e = this._getDataViewInst(), t = e.count(); this._sharedDataItems = []; for (var n = 0; n < t; n++) { var r = e.item(n); this._propChangeListener.insert(n, r), this._sharedDataItems.push(this._wrapDataItem(r, n)) } } return this._sharedDataItems || (this._sharedDataItems = []), this._sharedDataItems }, t.prototype._getTotals = function () { if (!this._totals) { var e = this._getDataViewInst(); this._totals = this._prepareTotals(e, this._wijgrid._prepareTotalsRequest(!0)) } return this._totals || (this._totals = {}), this._totals }, t.prototype._prepareTotals = function (t, n) { if (!n || n.length === 0) return {}; var r, i, s, o, u = [], a = {}; for (r = 0, i = n.length; r < i; r++) u.push(new e.grid.tally); for (r = 0, i = t.count() ; r < i; r++) for (s = 0, o = u.length; s < o; s++) u[s].add(this._wijgrid._parse(n[s].column, this.getValue(r, n[s].column.dataKey))); for (r = 0, i = u.length; r < i; r++) a[n[r].column.dataKey] = u[r].getValueString(n[r].column); return a }, t.prototype._processDOM = function (t, r) { var i = { items: [], emptyData: [], header: e.grid.readTableSection(t, e.grid.rowScope.head) }; return e.grid.getTableSectionLength(t, 2) === 1 && n(e.grid.getTableSectionRow(t, 2, 0)).hasClass("wijmo-wijgrid-emptydatarow") ? i.emptyData = e.grid.readTableSection(t, e.grid.rowScope.body) : i.items = e.grid.readTableSection(t, e.grid.rowScope.body, r), i }, t.prototype._moveAttributesToExpando = function (t) { n.each(t, function (t, r) { var i = e.data.Expando.getFrom(r, !0), s; s = i[e.grid.EXPANDO] = { cellsAttributes: {}, rowAttributes: {} }, r.rowAttributes && (s.rowAttributes = r.rowAttributes, delete r.rowAttributes), n.each(r, function (e, t) { n.isArray(t) && (s.cellsAttributes[e] = t[1], r[e] = t[0]) }) }) }, t.prototype._wrapDataItem = function (e, t) { return { values: e, originalRowIndex: t } }, t.prototype._refreshSilent = function () { var e = this._getDataViewInst(); if (e) try { this._ignoreAllEvents = !0, e.refresh() } finally { this._ignoreAllEvents = !1 } }, t.prototype._unsafeReplace = function (t, n) { var r = this._getDataViewInst(); r instanceof e.grid.GridDataView || "operation is not supported", r._unsafeReplace(t, n) }, t.prototype._unsafeSplice = function (t, n, r) { var i = this._getDataViewInst(); i instanceof e.grid.GridDataView || "operation is not supported", arguments.length === 2 ? i._unsafeSplice(t, n) : i._unsafeSplice(t, n, r) }, t.prototype._unsafePush = function (t) { var n = this._getDataViewInst(); n instanceof e.grid.GridDataView || "operation is not supported", n._unsafePush(t) }, t }(); t.dataViewWrapper = r, t.asPagedDataView = i, t.asEditableDataView = s; var o = function () { function e(e) { this._subscriptions = [], this._callback = e } return e.prototype.insert = function (e, t) { var r = [], i = this; this._subscriptions.splice(e, 0, r), n.each(t, function (e, t) { i._isValidPropName(e) && t && n.isFunction(t.subscribe) && r.push(t.subscribe(i._callback)) }) }, e.prototype.remove = function (e) { var t = this._subscriptions[e]; t && n.each(t, function (e, n) { n.dispose(), t[e] = null }), this._subscriptions[e] = null, this._subscriptions.splice(e, 1) }, e.prototype.removeAll = function () { var e, t; while (e = this._subscriptions.length) this.remove(e - 1); this._subscriptions = [] }, e.prototype.dispose = function () { this.removeAll() }, e.prototype._isValidPropName = function (e) { return e && typeof e == "string" ? e.match("^entityState|jQuery") === null : !0 }, e }(); t.propChangeListener = o })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function () { function t(t, n, r, i, s) { this.cr = new e.grid.cellRange(-1, -1), this.isExpanded = !1, this._value = -1, this._sum = -1, this._position = "none", this._hasHeaderOrFooter = !0, t !== undefined && (this.isExpanded = t), n !== undefined && (this.cr = n), r !== undefined && (this._sum = r), i !== undefined && (this._position = i), s !== undefined && (this._hasHeaderOrFooter = s) } return t.prototype.isSubRange = function (e) { return this.cr.r1 >= e.cr.r1 && this.cr.r2 <= e.cr.r2 }, t.prototype.toString = function () { return this.cr.r1 + "-" + this.cr.r2 }, t.prototype.getHeaderImageClass = function (t) { var n = this.owner; return n ? t ? n.expandedImageClass || e.c1field.prototype.options.groupInfo.expandedImageClass : n.collapsedImageClass || e.c1field.prototype.options.groupInfo.collapsedImageClass : null }, t.prototype.collapse = function () { var t, n, r, i, s; (t = this.owner) && (n = t.owner) && (r = n.owner) && (i = r._field("leaves"), e.grid.groupHelper.isParentExpanded(i, this.cr, t.level) && t.position !== "footer" && t.outlineMode !== "none" && (s = e.grid.groupHelper.getGroupedColumnsCount(i), this._collapse(r._rows(), i, this, s, r._field("viewRenderBounds").start))) }, t.prototype.expand = function (t) { var n, r, i, s, o; (n = this.owner) && (r = n.owner) && (i = r.owner) && (s = i._field("leaves"), e.grid.groupHelper.isParentExpanded(s, this.cr, n.level) && (o = e.grid.groupHelper.getGroupedColumnsCount(s), this._expand(i._rows(), s, this, o, t, !0, i._field("viewRenderBounds").start))) }, t.prototype._collapse = function (t, n, r, i, s) { var o = r.owner, u = r.cr.r1, a = r.cr.r2, f, l, c, h, p; switch (o.position) { case "header": case "headerAndFooter": this._toggleRowVisibility(t.item(r.cr.r1 - s), undefined, !1), u++ } for (f = u; f <= a; f++) this._toggleRowVisibility(t.item(f - s), !1); r.isExpanded = !1, this._updateHeaderIcon(t, r, s); for (f = o.level + 1; f <= i; f++) { c = e.grid.groupHelper.getChildGroupRanges(n, r.cr, f - 1); for (p = 0, l = c.length; p < l; p++) { h = c[p], h.isExpanded = !1; switch (h.owner.position) { case "header": case "headerAndFooter": this._toggleRowVisibility(t.item(h.cr.r1 - s), undefined, !1) } this._updateHeaderIcon(t, h, s) } } }, t.prototype._expand = function (t, n, r, i, s, o, u) { var a = r.owner, f = r.cr.r1, l = r.cr.r2, c, h, p, d, v; switch (a.position) { case "header": this._toggleRowVisibility(t.item(f - u), !0, o || s), f++; break; case "footer": this._toggleRowVisibility(t.item(l - u), !0), l--; break; case "headerAndFooter": this._toggleRowVisibility(t.item(f - u), !0, o || s), o && this._toggleRowVisibility(t.item(l - u), !0), f++, l-- } if (!o) return; r.isExpanded = !0, this._updateHeaderIcon(t, r, u); if (r.owner.level === i) for (c = f; c <= l; c++) this._toggleRowVisibility(t.item(c - u), !0); else { p = e.grid.groupHelper.getChildGroupRanges(n, r.cr, r.owner.level); if (p.length && f !== p[0].cr.r1) for (c = f; c < p[0].cr.r1; c++) this._toggleRowVisibility(t.item(c - u), !0); if (s) for (c = 0, h = p.length; c < h; c++) d = p[c], this._expand(t, n, d, i, s, !0, u); else for (c = 0, h = p.length; c < h; c++) d = p[c], v = d.owner.position === "footer" || d.owner.outlineMode === "none" ? !0 : !1, this._expand(t, n, d, i, !1, v, u) } }, t.prototype._toggleRowVisibility = function (e, t, n) { e && (e[0] && (t !== undefined && (e[0].style.display = t ? "" : "none", e[0]["aria-hidden"] = t ? "false" : "true"), n !== undefined && (e[0]["aria-expanded"] = n ? "true" : "false")), e[1] && (t !== undefined && (e[1].style.display = t ? "" : "none", e[1]["aria-hidden"] = t ? "false" : "true"), n !== undefined && (e[1]["aria-expanded"] = n ? "true" : "false"))) }, t.prototype._updateHeaderIcon = function (e, t, r) { if (t.owner.position !== "footer") { var i, s = e.item(t.cr.r1 - r); s && s[0] && (i = n(s[0]).find("div.wijmo-wijgrid-grouptogglebtn:first-child")), i && i.length && (i.toggleClass(t.getHeaderImageClass(!t.isExpanded), !1), i.toggleClass(t.getHeaderImageClass(t.isExpanded), !0)) } }, t }(); t.groupRange = r; var i = function () { function t() { this._groupRowIdx = 0 } return t.prototype.group = function (e, t, r) { this._grid = e, this._data = t, this._leaves = r, this._groupRowIdx = 0; var i = 1, s, o, u, a = [], f = !1, l = 0; for (s = 0, o = r.length; s < o; s++) u = r[s], u.groupInfo && (delete u.groupInfo.level, delete u.groupInfo.expandInfo), u.groupInfo && u.groupInfo.position && u.groupInfo.position !== "none" && u.dataIndex >= 0 ? u.groupedIndex === undefined && (f = !0) : u.groupedIndex !== undefined && delete u.groupedIndex; if (f) for (s = 0, o = r.length; s < o; s++) u = r[s], u.groupInfo && u.groupInfo.position && u.groupInfo.position !== "none" && u.dataIndex >= 0 && (u.groupedIndex = l++, a.push(u)); else a = n.map(r, function (e) { return e.groupedIndex !== undefined ? e : null }), a.sort(function (e, t) { return e.groupedIndex - t.groupedIndex }), n.each(a, function (e, t) { t.groupedIndex = e }); e._field("groupedColumns", a); for (s = 0, o = a.length; s < o; s++) u = a[s], this._groupRowIdx = 0, u.groupInfo && u.groupInfo.position && u.groupInfo.position !== "none" && u.dataIndex >= 0 && (u.groupInfo.level = i, u.groupInfo.expandInfo = [], this._processRowGroup(u, i++)); delete this._grid, delete this._data, delete this._leaves }, t.prototype._processRowGroup = function (t, r) { var i, s, o, u, a, f, l, c, h, p, d = 0, v = !0; n.each(this._leaves, function (e, t) { if (t.parentVis) return d = e, !1 }); for (i = 0; i < this._data.length; i++) { if (!(this._data[i].rowType & e.grid.rowType.data)) continue; s = this._getGroupCellRange(i, t, r), o = !0, u = t.groupInfo.outlineMode === "startCollapsed"; if (u || e.grid.groupHelper.isParentCollapsed(this._leaves, s, r)) { if (t.groupInfo.groupSingleRow === !1 && s.r1 === s.r2) continue; o = !1 } if (r && this._grid.options.groupIndent) for (a = s.r1; a <= s.r2; a++) this._addIndent(this._data[a][d], r); v = t.groupInfo.groupSingleRow !== !1 || s.r1 !== s.r2; switch (t.groupInfo.position) { case "header": f = this._addGroupRange(t.groupInfo, s, o, v); for (p = s.r1; p <= s.r2; p++) this._data[p].__attr["aria-level"] = r + 1, o || (this._data[p].__style.display = "none", this._data[p].__attr["aria-hidden"] = !0); if (!v) break; this._updateByGroupRange(f, r), l = e.grid.groupHelper.isParentCollapsed(this._leaves, f.cr, r), c = this._buildGroupRow(f, s, !0, l), this._data.splice(s.r1, 0, c), c.__attr["arial-level"] = r, c.__attr["aria-expanded"] = o, l && (c.__style.display = "none", c.__attr["aria-hidden"] = !0), i = s.r2 + 1; break; case "footer": f = this._addGroupRange(t.groupInfo, s, !0, v); if (!v) break; this._updateByGroupRange(f, r), h = this._buildGroupRow(f, s, !1, !1), h.__attr["aria-level"] = r, this._data.splice(s.r2 + 1, 0, h), i = s.r2 + 1, l = e.grid.groupHelper.isParentCollapsed(this._leaves, f.cr, r), l && (h.__style.display = "none", h.__attr["aria-hidden"] = !0); break; case "headerAndFooter": f = this._addGroupRange(t.groupInfo, s, o, v); for (p = s.r1; p <= s.r2; p++) this._data[p].__attr["aria-level"] = r + 1, o || (this._data[p].__style.display = "none", this._data[p].__attr["aria-hidden"] = !0); if (!v) break; this._updateByGroupRange(f, r), l = e.grid.groupHelper.isParentCollapsed(this._leaves, f.cr, r), c = this._buildGroupRow(f, s, !0, l), h = this._buildGroupRow(f, s, !1, !1), this._data.splice(s.r2 + 1, 0, h), h.__attr["aria-level"] = r; if (l || !o) h.__style.display = "none", h.__attr["aria-hidden"] = !0; this._data.splice(s.r1, 0, c), c.__attr["aria-level"] = r, c.__attr["aria-expanded"] = o, l && (c.__style.display = "none", c.__attr["aria-hidden"] = !0), i = s.r2 + 2; break; default: throw e.grid.stringFormat('Unknown Position value: "{0}"', t.groupInfo.position) } this._groupRowIdx++ } }, t.prototype._buildGroupRow = function (t, n, r, i) { var s = t.owner, o = s.owner, u = o.owner, a = [], f = "", l = "", c, h, p, d, v, m, g, y; a.__style = {}, a.__attr = {}, a.__attr.id = (r ? "GH" : "GF") + this._groupRowIdx + "-" + s.level, a.rowType = r ? e.grid.rowType.groupHeader : e.grid.rowType.groupFooter, o.dataIndex >= 0 && (c = this._data[n.r1][o.dataIndex].value) !== null && (f = u._toStr(o, c)), this._grid.options.showRowHeader && a.push({ html: "&nbsp;" }), h = { html: "", __attr: {}, __style: {} }, r && s.outlineMode !== "none" && (t.isExpanded ? h.html = '<div class="' + u.options.wijCSS.icon + " " + t.getHeaderImageClass(!0) + ' wijmo-wijgrid-grouptogglebtn">&nbsp;</div>' : h.html = '<div class="' + u.options.wijCSS.icon + " " + t.getHeaderImageClass(!1) + ' wijmo-wijgrid-grouptogglebtn">&nbsp;</div>'), a.push(h), o.aggregate && o.aggregate !== "none" && (l = this._getAggregate(n, o, o, r, f)), p = r ? s.headerText : s.footerText; if (p === "custom") d = { data: this._data, column: o, groupByColumn: s.owner, groupText: f, text: "", groupingStart: n.r1, groupingEnd: n.r2, isGroupHeader: r, aggregate: l }, this._grid._trigger("groupText", null, d) && (p = d.text); else { if (p === undefined || p === null) { r && (p = "{1}: {0}"); if (l || l === 0) p = p ? p + " {2}" : "{2}" } p = e.grid.stringFormat(p, f, o && o.headerText ? o.headerText : "", l.toString()) } p || (p = "&nbsp;"), h.html += "<span>" + p + "</span>", this._addIndent(h, s.level - 1), v = 1, m = this._grid.options.showRowHeader ? 1 : 0, g = !0; for (; m < this._leaves.length; m++) { c = this._leaves[m]; if (c.parentVis) { if (g) { g = !1; continue } if (c.dynamic !== !0 && c.aggregate && c.aggregate !== "none") break; v++ } } for (; m < this._leaves.length; m++) c = this._leaves[m], c.parentVis && (y = this._getAggregate(n, c, s.owner, r, f), !y && y !== 0 && (y = "&nbsp;"), a.push({ html: y.toString(), __attr: { groupInfo: { leafIndex: c.leavesIdx, purpose: e.grid.groupRowCellPurpose.aggregateCell } } })); return h.__attr.colSpan = v, h.__attr.groupInfo = { leafIndex: o.leavesIdx, purpose: e.grid.groupRowCellPurpose.groupCell }, a }, t.prototype._getAggregate = function (t, n, r, i, s) { var o = "", u, a, f; if (!n.aggregate || n.aggregate === "none") return o; if (n.aggregate === "custom") u = { data: this._data, column: n, groupByColumn: r, groupText: s, text: "", groupingStart: t.r1, groupingEnd: t.r2, isGroupHeader: i }, this._grid._trigger("groupAggregate", null, u) && (o = u.text); else { a = new e.grid.tally; for (f = t.r1; f <= t.r2; f++) a.add(this._data[f][n.dataIndex].value); o = a.getValueString(n) } return o }, t.prototype._getGroupCellRange = function (t, n, r) { var i = n.leavesIdx, s = new e.grid.cellRange(t, i), o = e.grid.groupHelper.getParentGroupRange(this._leaves, s, r), u, a, f; if (this._data[t].rowType & e.grid.rowType.data) { u = this._data[t][n.dataIndex].value, u instanceof Date && (u = u.getTime()); for (s.r2 = t, f = this._data.length - 1; s.r2 < f; s.r2++) { if (!(this._data[s.r2 + 1].rowType & e.grid.rowType.data) || o && s.r2 + 1 > o.cr.r2) break; a = this._data[s.r2 + 1][n.dataIndex].value, a instanceof Date && (a = a.getTime()); if (u !== a) break } } return s }, t.prototype._addGroupRange = function (t, n, r, i) { var s = null, o = e.grid.groupHelper.getChildGroupIndex(n, t.expandInfo), u, a, f, l; return o >= 0 && o < t.expandInfo.length ? s = t.expandInfo[o] : (u = new e.grid.cellRange(n.r1, n.r1, n.r2, n.r2), a = t.position === "footer" || !i ? !0 : r && t.outlineMode !== "startCollapsed", s = new e.grid.groupRange(a, u, -1, t.position, i), s.owner = t, t.expandInfo.push(s)), s && i && (f = n.r1, l = n.r2, t.position === "headerAndFooter" && (l += 2), t.position !== "headerAndFooter" && l++, s.cr.r2 = l), s }, t.prototype._updateByGroupRange = function (e, t) { var n, r, i, s, o, u, a; for (n = 0, r = this._leaves.length; n < r; n++) { i = this._leaves[n].groupInfo; if (i && i.level < t) { s = i.expandInfo ? i.expandInfo.length : 0; for (o = 0; o < s; o++) u = i.expandInfo[o], a = e.position === "headerAndFooter" ? 2 : 1, u.cr.r1 >= e.cr.r1 && (u.cr.r1 !== e.cr.r1 || u.position !== "footer") && (u.cr.r1 += a), u.cr.r2 >= e.cr.r1 && (u.cr.r2 += a) } } }, t.prototype._addIndent = function (e, t) { var n; t > 0 && (n = this._grid.options.groupIndent) && (e.__style.paddingLeft = n * t + "px") }, t }(); t.grouper = i })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function () { function t() { } return t._getGroupInfoRegExp = new RegExp(".*G([HF]){1}(\\d+)-(\\d+)$"), t.getGroupInfo = function (n) { if (n) { var r = e.grid.groupHelper._getGroupInfoRegExp.exec(n.id), i, s, o; if (r) return i = parseInt(r[3], 10), s = parseInt(r[2], 10), o = r[1] === "H", { level: i, index: s, isHeader: o, toString: function () { return (o ? "GH" : "GF") + s + "-" + i } } } return null }, t.getColumnByGroupLevel = function (t, n) { var r, i, s; for (r = 0, i = t.length; r < i; r++) { s = t[r]; if (s.groupInfo && s.groupInfo.level === n) return s } return null }, t.getGroupedColumnsCount = function (t) { var n = 0, r, i, s; for (r = 0, i = t.length; r < i; r++) s = t[r].groupInfo, s && (s.position === "header" || s.position === "headerAndFooter" || s.position === "footer") && n++; return n }, t.getChildGroupIndex = function (t, n) { var r = 0, i = n.length - 1, s, o; while (r <= i) { s = (i - r >> 1) + r, o = n[s].cr.r1 - t.r1; if (o === 0) return s; o < 0 ? r = s + 1 : i = s - 1 } return r }, t.getParentGroupIndex = function (n, r) { var i = e.grid.groupHelper.getChildGroupIndex(n, r); return i > 0 && i--, i < r.length ? i : -1 }, t.getChildGroupRanges = function (n, r, i) { var s = [], o, u, a, f, l, c = e.grid.groupHelper.getColumnByGroupLevel(n, i + 1); if (c) { o = c.groupInfo.expandInfo, l = e.grid.groupHelper.getChildGroupIndex(r, o); for (a = l, f = o.length; a < f; a++) { u = o[a]; if (!(u.cr.r2 <= r.r2)) break; s.push(u) } } return s }, t.getParentGroupRange = function (n, r, i) { var s, o, u; i === undefined && (i = 65535); if (i - 2 >= 0) for (s = n.length - 1; s >= 0; s--) { o = n[s].groupInfo; if (!o || !o.expandInfo || o.level < 0 || o.level !== i - 1) continue; u = e.grid.groupHelper.getParentGroupIndex(r, o.expandInfo); if (u >= 0) return o.expandInfo[u] } return null }, t.isParentCollapsed = function (n, r, i) { var s, o; if (i === 1) return !1; for (s = i; s > 1; s--) { o = e.grid.groupHelper.getParentGroupRange(n, r, s); if (o && !o.isExpanded) return !0; r = o.cr } return !1 }, t.isParentExpanded = function (n, r, i) { var s, o; if (i === 1) return !0; for (s = i; s > 1; s--) { o = e.grid.groupHelper.getParentGroupRange(n, r, s); if (o && o.isExpanded) return !0; r = o.cr } return !1 }, t }(); t.groupHelper = r })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function () { function e(e, t, n, r) { switch (arguments.length) { case 2: this.r1 = this.r2 = e, this.c1 = this.c2 = t; break; case 4: this.r1 = e, this.r2 = n, this.c1 = t, this.c2 = r; break; default: this.r1 = 0, this.r2 = 0, this.c1 = 0, this.c2 = 0 } } return e.prototype.isSingleCell = function () { return this.r1 === this.r2 && this.c1 === this.c2 }, e }(); t.cellRange = r; var i = function () { function t() { } return t.prototype.merge = function (e, t) { this._leaves = t, this._data = e; var n, r, i; for (n = 0, r = this._leaves.length; n < r; n++) i = this._leaves[n], i.dataIndex >= 0 && !i.isBand && (i.rowMerge === "free" || i.rowMerge === "restricted") && this._mergeColumn(i); delete this._data, delete this._leaves }, t.prototype._mergeColumn = function (t) { var n = t.dataIndex, r, i, s, o, u; for (r = 0, i = this._data.length; r < i; r++) { if (!(this._data[r].rowType & e.grid.rowType.data)) continue; s = this._getCellRange(r, t); if (s.r1 !== s.r2) { o = s.r2 - s.r1 + 1, this._data[s.r1][n].__attr.rowSpan = o; for (u = s.r1 + 1; u <= s.r2; u++) this._data[u][n].visible = !1 } r = s.r2 } }, t.prototype._getCellRange = function (t, n) { var r = n.dataIndex, i = new e.grid.cellRange(t, r), s = (this._data[t][r].value || "").toString(), o = this._data.length, u, a, f, l; for (i.r2 = t; i.r2 < o - 1; i.r2++) { u = this._data[i.r2 + 1]; if (!(u.rowType & e.grid.rowType.data) || (u[r].value || "").toString() !== s) break } return a = n.leavesIdx, a > 0 && n.rowMerge === "restricted" && (f = this._leaves[a - 1], f.dataIndex >= 0 && (l = this._getCellRange(t, f), i.r1 = Math.max(i.r1, l.r1), i.r2 = Math.min(i.r2, l.r2))), i }, t }(); t.merger = i })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; function f(t, r) { var i, s, o; if (n.isArray(t) && n.isArray(r)) { if (t.length === r.length) { o = !0; for (i = 0, s = t.length; i < s && o; i++) o = e.grid.compareObj(t[i], r[i]); return o } } else { if (n.isPlainObject(t) && n.isPlainObject(r)) { for (i in t) if (t.hasOwnProperty(i) && !e.grid.compareObj(t[i], r[i])) return !1; for (i in r) if (r.hasOwnProperty(i) && !e.grid.compareObj(t[i], r[i])) return !1; return !0 } t instanceof Date && (t = t.getTime()), r instanceof Date && (r = r.getTime()) } return t === r } function l(e) { var t = []; for (var n = 0; n < arguments.length - 1; n++) t[n] = arguments[n + 1]; var r, i; if (!e) return ""; for (r = 0, i = t.length; r < i; r++) e = e.replace(new RegExp("\\{" + r + "\\}", "gm"), t[r]); return e } function c(e) { return e && !(e < 0) || e === 0 } function h(e) { return e.dataType || e._underlyingDataType || "string" } function p(e, t) { e && t && e.find(".ui-widget").each(function (e, r) { return n.each(n(r).data(), function (n, r) { r.widgetName && t(e, r) }), !0 }) } function d(e, t) { var r = []; n.each(e.data(), function (e) { e.indexOf(t) === 0 && r.push(e) }), n.each(r, function (t, n) { e.removeData(n) }) } function m(t) { return n.extend(!0, {}, e.c1basefield.prototype.options, e.c1field.prototype.options, { dynamic: !0, isLeaf: !0, isBand: !1, parentIdx: -1 }, t) } function g(e, t) { if (e) { var r = e.nodeType ? n(e) : e, i = r.offset(); if (i) return t ? { top: i.top, left: i.left, width: r[0].clientWidth || 0, height: r[0].clientHeight || 0 } : { top: i.top, left: i.left, width: r.outerWidth(), height: r.outerHeight() } } return null } function y(t, n, r) { n === undefined && (n = 3); if (t && n !== 0) { if (!r && t.nodeType === 3) return t.nodeValue; if (t.nodeType === 1) { switch (t.type) { case "button": case "text": case "textarea": case "select-one": return t.value; case "checkbox": return t.checked.toString() } var i = "", s = 0, o; while (o = t.childNodes[s++]) i += e.grid._getDOMText(o, n - 1); return i } } return "" } function b(e, t, r, i) { var s = e.jquery || n.isArray(e), o, u, a, f = t + r; if (arguments.length === 3) return s ? n.data(e[0], f) : n.data(e, f); if (s) { for (o = 0, u = e.length; o < u; o++) a = n.data(e[o], f, i); return a } return n.data(e, f, i) } function w(e, t) { if (t && e) { var n, r, i; for (n in t) t.hasOwnProperty(n) && (r = t[n], i = typeof r, (i === "string" || i === "boolean" || i === "number") && e[n] === undefined && (e[n] = r)) } } function E(e) { return e && typeof e == "object" && !(e instanceof Date) } function S(e, t) { var r, i, s = n.isFunction(t); for (r in e) if (e.hasOwnProperty(r)) { i = s ? t(e[r]) : e[r] === t; if (i === !0) return { at: r, found: e[r] } } return { at: null, found: null } } function x(e, t) { if (e) { var n, r, i = 0, s = {}, o, u; for (n = 0, r = e.attributes.length; n < r; n++) u = e.attributes[n].name, u && (!t || !t(u)) && (o = e.getAttribute(u), u === "style" && (o = typeof o == "object" ? o.cssText : o), !o && u === "class" && (o = e.getAttribute("className")), o && typeof o != "function" && (s[u] = o, i++)); if (i) return s } return null } function T(t, r) { var i, s, o, u, a; if (t) { typeof r != "object" && !n.isFunction(r) && (r = {}); for (i in t) { s = t[i], o = r[o]; if (s === r) continue; s && (n.isPlainObject(s) || (u = n.isArray(s))) ? (u ? (u = !1, a = o && n.isArray(o) ? o : []) : a = o && n.isPlainObject(o) ? o : {}, r[i] = e.grid.deepExtend(s, a)) : r[i] = s } } return r } function N() { if (n.ui && n.ui.keyCode) return n.ui.keyCode; if (n.mobile && n.mobile.keyCode) return n.mobile.keyCode; throw "keyCode object is not found" } function C(e, t) { return e && e.jquery && (e = e[0]), e ? arguments.length === 1 ? n.data(e, "wijgridwidgetName") : n.data(e, "wijgridwidgetName", t) : undefined } function k(e, t, n) { return e > t && e < t + n } function L(t, n, r, i, s, o) { return e.grid.isOverAxis(t, r, s) && e.grid.isOverAxis(n, i, o) } function O() { return "uid" + A++ } var n = jQuery; t.EXPANDO = "__wijgrid", function (e) { e._map = [], e.header = 1, e.data = 2, e.dataAlt = 4, e.filter = 8, e.groupHeader = 16, e.groupFooter = 32, e.footer = 64, e.emptyDataRow = 128 }(t.rowType || (t.rowType = {})); var r = t.rowType; (function (e) { e._map = [], e.none = 0, e.rendering = 1, e.current = 2, e.hovered = 4, e.selected = 8 })(t.renderState || (t.renderState = {})); var i = t.renderState; (function (e) { e._map = [], e.table = 0, e.head = 1, e.body = 2, e.foot = 3 })(t.rowScope || (t.rowScope = {})); var s = t.rowScope; (function (e) { e._map = [], e.none = 0, e.toColumn = 1, e.toRow = 2 })(t.cellRangeExtendMode || (t.cellRangeExtendMode = {})); var o = t.cellRangeExtendMode; (function (e) { e._map = [], e.createIfNull = 0, e.createAlways = 1, e.dispose = 2 })(t.objectMode || (t.objectMode = {})); var u = t.objectMode; (function (e) { e._map = [], e.groupCell = 0, e.aggregateCell = 1 })(t.groupRowCellPurpose || (t.groupRowCellPurpose = {})); var a = t.groupRowCellPurpose; t.compareObj = f, t.stringFormat = l, t.validDataKey = c, t.getDataType = h, t.iterateChildrenWidgets = p, t.remove$dataByPrefix = d; var v = function () { function e(e) { this._dom = e } return e.prototype.getSelection = function () { var e = 0, t = 0, n; return this._dom.selectionStart !== undefined ? (e = this._dom.selectionStart, t = this._dom.selectionEnd) : document.selection && (n = document.selection.createRange().duplicate(), t = n.text.length, e = Math.abs(n.moveStart("character", -this._dom.value.length)), t += e), { start: e, end: t, length: t - e } }, e.prototype.setSelection = function (e) { if (this._dom.selectionStart !== undefined) this._dom.setSelectionRange(e.start, e.end); else { var t = this._dom.createTextRange(); t.collapse(!0), t.moveStart("character", e.start), t.moveEnd("character", e.end), t.select() } }, e.prototype.toggleSelection = function (e) { var t = n(this._dom), r = "onselectstart" in this._dom; e ? r ? t.unbind(".wijgrid-disableSelection") : t.css({ MozUserSelect: "", WebkitUserSelect: "" }) : r ? t.bind("selectstart.wijgrid-disableSelection", function (e) { e.preventDefault() }) : t.css({ MozUserSelect: "-moz-none", WebkitUserSelect: "none" }) }, e }(); t.domSelection = v, t.createDynamicField = m, t.bounds = g, t._getDOMText = y, t.dataPrefix = b, t.shallowMerge = w, t.isCustomObject = E, t.search = S, t.getAttributes = x, t.deepExtend = T, t.getKeyCodeEnum = N, t.widgetName = C, t.isOverAxis = k, t.isOver = L; var A = 0; t.getUID = O, n.extend(n.wijmo.wijgrid, { rowType: e.grid.rowType, renderState: e.grid.renderState, bounds: e.grid.bounds }) })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function () { function e() { } return e.NoFilterOp = { applicableTo: null, name: "NoFilter", arity: 1, operator: function () { return !0 } }, e }(), i = function () { function t(t) { this._cache = {}; var i = this; this._wijgrid = t, this._addOperator(null, r.NoFilterOp), n.each(e.data.filtering.ops, function (e, t) { i._addOperator(e, t) }), n.each(t.options.customFilterOperators, function (e, t) { i._addOperator(null, t, !0) }) } return t.prototype.getByName = function (e) { var t = this.getByNameInt(e); return t ? t.op : null }, t.prototype.getByNameInt = function (e) { return this._cache[(e || "").toLowerCase()] }, t.prototype.getByDataType = function (e) { var t = [], r; n.each(this._cache, function (r, i) { var s = i.op; (!s.applicableTo || n.inArray(e, s.applicableTo) >= 0) && t.push(i) }); switch (this._wijgrid.options.filterOperatorsSortMode.toLowerCase()) { case "alphabetical": t.sort(this._sortAlpha); break; case "alphabeticalcustomfirst": t.sort(this._sortAlphaCustomFirst); break; case "alphabeticalembeddedFirst": t.sort(this._sortAlphaEmbeddedFirst); break; case "none": break; default: } return r = n.map(t, function (e, t) { return e.op }), r }, t.prototype._addOperator = function (e, t, n) { typeof n == "undefined" && (n = !1), e && !t.name && (t.name = e), e = (e || t.name).toLowerCase(), this._cache[e] || (this._cache[e] = { op: t, isCustom: n === !0 }) }, t.prototype._sortAlpha = function (e, t) { var n = e.op.name.toLowerCase(), r = t.op.name.toLowerCase(); if (n !== r) { if (n === "nofilter") return -1; if (r === "nofilter") return 1 } return n === r ? 0 : n < r ? -1 : 1 }, t.prototype._sortAlphaEmbeddedFirst = function (e, t) { var n = e.op.name.toLowerCase(), r = t.op.name.toLowerCase(); if (n !== r) { if (n === "nofilter") return -1; if (r === "nofilter") return 1 } if (e.isCustom !== t.isCustom) { if (e.isCustom) return 1; if (t.isCustom) return -1 } return n === r ? 0 : n < r ? -1 : 1 }, t.prototype._sortAlphaCustomFirst = function (e, t) { var n = e.op.name.toLowerCase(), r = t.op.name.toLowerCase(); if (n !== r) { if (n === "nofilter") return -1; if (r === "nofilter") return 1 } if (e.isCustom !== t.isCustom) { if (e.isCustom) return -1; if (t.isCustom) return 1 } return n === r ? 0 : n < r ? -1 : 1 }, t }(); t.filterOperatorsCache = i; var s = function () { function t() { } return t.marker = "_wijgrid", t.getSingleValue = function (t) { return n.isArray(t) && (t = t[0], n.isArray(t) && (t = t[0])), t }, t.getSingleOperatorName = function (t) { return n.isArray(t) && (t = t[0]), t.name || t || "" }, t.verify = function (r, i, s, o) { if (r) if (n.isArray(r)) { var u, a, f = [], l = []; n.isArray(i) || (i = [i]); for (u = 0, a = r.length; u < a; u++) e.grid.filterHelper._verifySingleOp(r[u], i[u], s, o) && (f.push({ name: r[u].name || r[u], condition: r[u].condition || "or" }), l.push(i ? i[u] : undefined)); if (f.length) return { filterOperator: f, filterValue: l } } else if (e.grid.filterHelper._verifySingleOp(r, i, s, o)) return { filterOperator: r, filterValue: i }; return null }, t._verifySingleOp = function (r, i, s, o) { if (r && (r = r.name || r)) { var u; r = (r || "").toLowerCase(); if ((r !== "nofilter" || i !== undefined) && (u = o.getByName(r))) if (u.applicableTo === null || n.inArray(s || "string", u.applicableTo) >= 0) if (u.arity === 1 || u.arity > 1 && e.grid.filterHelper.getSingleValue(i) !== undefined) return !0 } return !1 }, t }(); t.filterHelper = s })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; function r(t, n) { t && !t.nodeType && (t = t[0]); if (t) switch (n) { case e.grid.rowScope.head: return t.tHead; case e.grid.rowScope.body: if (t.tBodies) return t.tBodies[0] || null; break; case e.grid.rowScope.foot: return t.tFoot; default: return t } return null } function i(e, t) { var n; return e && !e.nodeType && (e = e[0]), e && (n = this.getTableSection(e, t)) ? n.rows.length : 0 } function s(e, t, n) { var r; return e && !e.nodeType && (e = e[0]), e && (r = this.getTableSection(e, t)) ? r.rows[n] || null : null } function o(t, r, i) { var s, o, u, a, f, l, c, h, p = [], d = function (e) { return e = e.toLowerCase(), e === "rowspan" || e === "colspan" }, v; t && !t.nodeType && (t = t[0]); if (t && (v = this.getTableSection(t, r))) for (s = 0, o = v.rows.length; s < o; s++) { f = v.rows[s], l = [], i && (c = e.data.Expando.getFrom(l, !0), h = c[e.grid.EXPANDO] = { cellsAttributes: {}, rowAttributes: e.grid.getAttributes(f) || {} }); for (u = 0, a = f.cells.length; u < a; u++) l[u] = n.trim(f.cells[u].innerHTML), i && (h.cellsAttributes[u] = e.grid.getAttributes(f.cells[u], d) || {}); p[s] = l } return p } var n = jQuery; t.getTableSection = r, t.getTableSectionLength = i, t.getTableSectionRow = s, t.readTableSection = o; var u = function () { function t(e, t, n, r) { this._width = 0, this._table = e, this._offsets = [], r && this.ensureColGroup(), n && this.ensureTBody(), t || this._buildOffsets() } return t.prototype.element = function () { return this._table }, t.prototype.width = function () { return this._width }, t.prototype.getCellIdx = function (e, t) { return e < this._width ? this._offsets[t][e].cellIdx : -1 }, t.prototype.getColumnIdx = function (e, t) { if (typeof e != "number") { var n = e; e = n.cellIndex, t = n.parentNode.rowIndex } return e < this._width ? this._offsets[t][e].colIdx : -1 }, t.prototype.clearSection = function (t) { var n, r, i = e.grid.getTableSection(this._table, t); switch (t) { case e.grid.rowScope.body: n = this.getSectionLength(e.grid.rowScope.table), r = n + this.getSectionLength(t) - 1; break; case e.grid.rowScope.foot: n = this.getSectionLength(e.grid.rowScope.table) + this.getSectionLength(e.grid.rowScope.head), r = n + this.getSectionLength(t) - 1; break; default: n = 0, r = this.getSectionLength(t) - 1 } while (i.rows.length) i.deleteRow(0); this._offsets.splice(n, r - n + 1) }, t.prototype.getSectionLength = function (t) { return e.grid.getTableSectionLength(this._table, t) }, t.prototype.getSectionRow = function (t, n) { return e.grid.getTableSectionRow(this._table, n, t) }, t.prototype.forEachColumnCellNatural = function (e, t, n) { var r, i, s, o; for (r = 0, i = this._table.rows.length; r < i; r++) { s = this._table.rows[r]; if (e < s.cells.length) { o = t(s.cells[e], r, n); if (o !== !0) return o } } return !0 }, t.prototype.forEachColumnCell = function (e, t, n) { var r, i, s, o, u; for (r = 0, i = this._offsets.length; r < i; r++) { s = this._table.rows[r], o = this.getCellIdx(e, r); if (o >= 0) { u = t(s.cells[o], r, n); if (u !== !0) return u } } return !0 }, t.prototype.forEachRowCell = function (e, t, n) { var r = this._table.rows[e], i, s, o; for (i = 0, s = r.cells.length; i < s; i++) { o = t(r.cells[i], i, n); if (o !== !0) return o } return !0 }, t.prototype.colGroupTag = function () { var e = this._table.getElementsByTagName("colgroup"); return e && e[0] || null }, t.prototype.colTags = function () { var e = this.colGroupTag(); return e && e.getElementsByTagName("col") || [] }, t.prototype.ensureTBody = function () { return this._table.tBodies && this._table.tBodies[0] || this._table.appendChild(document.createElement("tbody")) }, t.prototype.ensureTHead = function () { return this._table.tHead && this._table.tHead[0] || this._table.createTHead() }, t.prototype.ensureTFoot = function () { return this._table.tFoot && this._table.tFoot[0] || this._table.createTFoot() }, t.prototype.ensureColGroup = function () { var e = this._table.getElementsByTagName("colgroup"); return e && e[0] || this._table.appendChild(document.createElement("colgroup")) }, t.prototype.appendCol = function (e) { var t = this.ensureColGroup(); return e && t.appendChild(e) || t.appendChild(document.createElement("col")) }, t.prototype.removeOffset = function (e) { if (e >= 0 && e < this._offsets.length) { if (e < 0 || !e && e !== 0) e = this._offsets.length - 1; this._offsets.splice(e, 1) } }, t.prototype.insertOffset = function (e) { var t, n; if (this._width > 0) { t = []; for (n = 0; n < this._width; n++) t.push({ cellIdx: n, colIdx: n }); if (e < 0 || !e && e !== 0) e = this._offsets.length; this._offsets.splice(e, 0, t) } }, t.prototype.rebuildOffsets = function () { this._offsets = [], this._width = 0, this._buildOffsets() }, t.prototype._buildOffsets = function () { var e = [], t, n, r, i, s, o, u, a, f, l; for (n = 0, r = this._table.rows.length; n < r; n++) { t = [], this._offsets[n] = t, i = this._table.rows[n]; for (s = 0, o = 0, u = i.cells.length; s < u; s++, o++) { a = i.cells[s]; for (; e[o] > 1; o++) e[o]--, t[o] = { cellIdx: -1, colIdx: -1 }; e[o] > 1 || (e[o] = a.rowSpan), t[o] = { cellIdx: s, colIdx: -1 }, t[s].colIdx = o, f = a.colSpan; for (; f > 1; f--) t[++o] = { cellIdx: -1, colIdx: -1 } } l = e.length; for (; o < l; o++) e[o]--, t[o] = { cellIdx: -1, colIdx: -1 }; this._width = Math.max(this._width, l) } }, t }(); t.htmlTableAccessor = u })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function () { function t(e, t, n, r) { typeof n == "undefined" && (n = null), typeof r == "undefined" && (r = !1), this.__isEdit = !1, this._wijgrid = n, r ? (this._cia = e, this._ria = t) : (this._ci = e, this._ri = t) } return t.outsideValue = new t(-1, -1, null, !0), t.prototype.cellIndexAbs = function (e) { if (arguments.length === 0) return this._ensureCia(), this._cia; this._ci = undefined, this._cia = e }, t.prototype.rowIndexAbs = function (e) { if (arguments.length === 0) return this._ensureRia(), this._ria; this._ri = undefined, this._ria = e }, t.prototype.cellIndex = function (e) { if (arguments.length === 0) return this._ensureCi(), this._ci; this._cia = undefined, this._ci = e }, t.prototype.column = function () { return this._wijgrid && this._isValid() ? this._wijgrid._field("visibleLeaves")[this.cellIndexAbs()] : null }, t.prototype.container = function () { var e = this.tableCell(), t; if (e) { t = n(e).children("div.wijmo-wijgrid-innercell"); if (t) return t } return null }, t.prototype.isEqual = function (e) { return e && e.rowIndex() === this.rowIndex() && e.cellIndex() === this.cellIndex() }, t.prototype.row = function () { var e = null, t = null; return this._wijgrid && (e = this._wijgrid._view().rows().item(this.rowIndexAbs()), e && e.length && (t = this._wijgrid._view()._getRowInfo(e))), t }, t.prototype.rowIndex = function (e) { if (arguments.length === 0) return this._ensureRi(), this._ri; this._ria = undefined, this._ri = e }, t.prototype.tableCell = function () { return this._wijgrid && this._isValid() ? this._wijgrid._view().getCell(this.cellIndexAbs(), this.rowIndexAbs()) : null }, t.prototype.value = function (t) { var n, r, i; if (this._wijgrid && this._isValid()) { r = this._wijgrid._view()._getRowInfo(this._wijgrid._rows().item(this.rowIndex())); if (r.type & e.grid.rowType.data) { n = this.column(); if (arguments.length === 0) return i = this._wijgrid._dataViewWrapper.getValue(r.data, n.dataKey), this._wijgrid._parse(n, i); t = this._wijgrid._parse(n, t); if (t === null && n.valueRequired || e.grid.getDataType(n) !== "string" && isNaN(t)) throw "invalid value"; this._wijgrid._dataViewWrapper.setValue(r.dataItemIndex, n.dataKey, t) } } }, t.prototype.toString = function () { return this.cellIndex() + ":" + this.rowIndex() }, t.prototype._clip = function (e, t) { typeof t == "undefined" && (t = !1); var n = !1, r; return t ? (this.cellIndexAbs() < (r = e.topLeft().cellIndexAbs()) && (n = !0, this._cia = r, this._ci = undefined), this.cellIndexAbs() > (r = e.bottomRight().cellIndexAbs()) && (n = !0, this._cia = r, this._ci = undefined), this.rowIndexAbs() < (r = e.topLeft().rowIndexAbs()) && (n = !0, this._ria = r, this._ri = undefined), this.rowIndexAbs() > (r = e.bottomRight().rowIndexAbs()) && (n = !0, this._ria = r, this._ri = undefined)) : (this.cellIndex() < (r = e.topLeft().cellIndex()) && (n = !0, this._ci = r, this._cia = undefined), this.cellIndex() > (r = e.bottomRight().cellIndex()) && (n = !0, this._ci = r, this._cia = undefined), this.rowIndex() < (r = e.topLeft().rowIndex()) && (n = !0, this._ri = r, this._ria = undefined), this.rowIndex() > (r = e.bottomRight().rowIndex()) && (n = !0, this._ri = r, this._ria = undefined)), n }, t.prototype._clone = function () { return new e.grid.cellInfo(this.cellIndex(), this.rowIndex(), this._wijgrid) }, t.prototype._isValid = function () { return this.cellIndex() >= 0 && this.rowIndex() >= 0 }, t.prototype._isEdit = function (e) { if (!arguments.length) return this.__isEdit; this.__isEdit = e }, t.prototype._setGridView = function (e) { this._wijgrid = e }, t.prototype._ensureCia = function () { if (this._cia === undefined) { if (this._ci === null) throw "relative index value is undefined"; if (this._ci >= 0) { if (!this._wijgrid) throw "wijgrid is null"; this._cia = this._ci + this._wijgrid._getDataToAbsOffset().x } else this._cia = this._ci; this._cia < 0 && (this._cia = -1) } }, t.prototype._ensureRia = function () { if (this._ria === undefined) { if (this._ri === undefined) throw "relative index value is undefined"; if (this._ri >= 0) { if (!this._wijgrid) throw "wijgrid is null"; this._ria = this._ri + this._wijgrid._getDataToAbsOffset().y } else this._ria = this._ri; this._ria < 0 && (this._ria = -1) } }, t.prototype._ensureCi = function () { if (this._ci === undefined) { if (this._cia === undefined) throw "absolute index value is undefined"; if (this._cia >= 0) { if (!this._wijgrid) throw "wijgrid is null"; this._ci = this._cia - this._wijgrid._getDataToAbsOffset().x } else this._ci = this._cia; this._ci < 0 && (this._ci = -1) } }, t.prototype._ensureRi = function () { if (this._ri === undefined) { if (this._ria === undefined) throw "relative index value is undefined"; if (this._ria >= 0) { if (!this._wijgrid) throw "wijgrid is null"; this._ri = this._ria - this._wijgrid._getDataToAbsOffset().y } else this._ri = this._ria; this._ri < 0 && (this._ri = -1) } }, t }(); t.cellInfo = r; var i = function () { function t(e, t) { if (!e || !t) throw "invalid arguments"; this._topLeft = e._clone(), this._bottomRight = t._clone() } return t.prototype.bottomRight = function () { return this._bottomRight }, t.prototype.isEqual = function (e) { return e && this._topLeft.isEqual(e.topLeft()) && this._bottomRight.isEqual(e.bottomRight()) }, t.prototype.topLeft = function () { return this._topLeft }, t.prototype.toString = function () { return this._topLeft.toString() + " - " + this._bottomRight.toString() }, t.prototype._isIntersect = function (e) { var t, n, r, i; if (e) { t = e.bottomRight().rowIndex() - e.topLeft().rowIndex() + 1, n = this._bottomRight.rowIndex() - this._topLeft.rowIndex() + 1; if (e.topLeft().rowIndex() + t - this._topLeft.rowIndex() < t + n) return r = e.bottomRight().cellIndex() - e.topLeft().cellIndex() + 1, i = this._bottomRight.cellIndex() - this._topLeft.cellIndex() + 1, e.topLeft().cellIndex() + r - this._topLeft.cellIndex() < r + i } return !1 }, t.prototype._isValid = function () { return this._topLeft._isValid() && this._bottomRight._isValid() }, t.prototype._clip = function (e, t) { return typeof t == "undefined" && (t = !1), this._topLeft._clip(e, t) || this._bottomRight._clip(e, t) }, t.prototype._clone = function () { return new t(this._topLeft._clone(), this._bottomRight._clone()) }, t.prototype._containsCellInfo = function (e) { return e && e.cellIndex() >= this._topLeft.cellIndex() && e.cellIndex() <= this._bottomRight.cellIndex() && e.rowIndex() >= this._topLeft.rowIndex() && e.rowIndex() <= this._bottomRight.rowIndex() }, t.prototype._containsCellRange = function (e) { return e && this._containsCellInfo(e.topLeft()) && this._containsCellInfo(e.bottomRight()) }, t.prototype._extend = function (t, n) { return t === e.grid.cellRangeExtendMode.toColumn ? (this._topLeft.rowIndex(n.topLeft().rowIndex()), this._bottomRight.rowIndex(n.bottomRight().rowIndex())) : t === e.grid.cellRangeExtendMode.toRow && (this._topLeft.cellIndex(n.topLeft().cellIndex()), this._bottomRight.cellIndex(n.bottomRight().cellIndex())), this }, t.prototype._normalize = function () { var e = this._topLeft.cellIndex(), t = this._topLeft.rowIndex(), n = this._bottomRight.cellIndex(), r = this._bottomRight.rowIndex(); this._topLeft.cellIndex(Math.min(e, n)), this._topLeft.rowIndex(Math.min(t, r)), this._bottomRight.cellIndex(Math.max(e, n)), this._bottomRight.rowIndex(Math.max(t, r)) }, t }(); t.cellInfoRange = i, n.extend(n.wijmo.wijgrid, { cellInfo: e.grid.cellInfo, cellInfoRange: e.grid.cellInfoRange }) })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function () { function t(e, t) { this._rowHeaderSize = 22; if (!e) throw "'wijgrid' must be specified"; this._wijgrid = e, this._bounds = t, this._wijgrid.element.addClass("wijmo-wijgrid-table") } return t.prototype.dispose = function () { this.toggleDOMSelection(!0), this._wijgrid.element.removeClass("wijmo-wijgrid-table") }, t.prototype.ensureDisabledState = function () { var e = "wijmo-wijgrid-disabled " + this._wijgrid.options.wijCSS.stateDisabled, t = this._wijgrid.options.disabled, r = this; n.each(this.subTables(), function (i, s) { if (s) { var o = n(s.element()); t ? (o.addClass(e), r._wijgrid._setAttr(o, "aria-disabled", !0)) : (o.removeClass(e), r._wijgrid._setAttr(o, "aria-disabled", !1)) } }) }, t.prototype.ensureWidth = function (e, t, n) { this._setColumnWidth(e, t) }, t.prototype.ensureHeight = function (e) { }, t.prototype.getScrollValue = function () { return null }, t.prototype.getVisibleAreaBounds = function () { throw "not implemented" }, t.prototype.getFixedAreaVisibleBounds = function () { throw "not implemented" }, t.prototype.render = function () { this._ensureRenderBounds(), this._preRender(), this._renderContent(), this._postRender() }, t.prototype.toggleDOMSelection = function (t) { n.each(this.subTables(), function (n, r) { (new e.grid.domSelection(r.element())).toggleSelection(t) }), (new e.grid.domSelection(this._wijgrid.outerDiv)).toggleSelection(t) }, t.prototype.updateSplits = function (e) { throw "not implemented" }, t.prototype.bodyRows = function () { return this._bodyRowsAccessor || (this._bodyRowsAccessor = new e.grid.rowAccessor(this, e.grid.rowScope.body, 0, 0)), this._bodyRowsAccessor }, t.prototype.filterRow = function () { if (this._wijgrid.options.showFilter) { var t = new e.grid.rowAccessor(this, e.grid.rowScope.head, 0, 0); return t.item(t.length() - 1) } return null }, t.prototype.headerRows = function () { var t; return this._headerRowsAccessor || (t = this._wijgrid.options.showFilter ? 1 : 0, this._headerRowsAccessor = new e.grid.rowAccessor(this, e.grid.rowScope.head, 0, t)), this._headerRowsAccessor }, t.prototype.rows = function () { return this._rowsAccessor || (this._rowsAccessor = new e.grid.rowAccessor(this, e.grid.rowScope.table, 0, 0)), this._rowsAccessor }, t.prototype.focusableElement = function () { throw "not implemented" }, t.prototype.forEachColumnCell = function (e, t, n) { throw "not implemented" }, t.prototype.forEachRowCell = function (e, t, n) { throw "not implemented" }, t.prototype.getAbsoluteCellInfo = function (e) { throw "not implemented" }, t.prototype.getAbsoluteRowIndex = function (e) { throw "not implemented" }, t.prototype.getCell = function (e, t) { throw "not implemented" }, t.prototype.getColumnIndex = function (e) { throw "not implemented" }, t.prototype.getHeaderCell = function (e) { throw "not implemented" }, t.prototype.getJoinedCols = function (e) { throw "not implemented" }, t.prototype.getJoinedRows = function (e, t) { throw "not implemented" }, t.prototype.getJoinedTables = function (e, t) { throw "not implemented" }, t.prototype.subTables = function () { throw "not implemented" }, t.prototype._getMappedScrollMode = function () { var e = this._wijgrid.options.scrollMode, t = "auto", n = "auto"; switch (e) { case "horizontal": t = "hidden", n = "visible"; break; case "vertical": t = "visible", n = "hidden"; break; case "both": t = "visible", n = "visible" } return { vScrollBarVisibility: t, hScrollBarVisibility: n } }, t.prototype._postRender = function () { this.ensureDisabledState() }, t.prototype._preRender = function () { throw "not implemented" }, t.prototype._ensureRenderBounds = function () { var e = this._wijgrid._getDataCellsRange(); this._bounds.start = 0, this._bounds.end = e.bottomRight().rowIndex() }, t.prototype._renderContent = function () { this._renderCOLS(), this._renderHeader(), this._wijgrid.options.showFilter && this._renderFilter(), this._renderBody(), this._wijgrid.options.showFooter && this._renderFooter() }, t.prototype._renderCOLS = function () { var e = this._wijgrid._field("visibleLeaves"), t, n, r, i; for (r = 0, i = e.length; r < i; r++) t = e[r], n = this._createCol(t, r), this._appendCol(n, t, r) }, t.prototype._renderHeader = function () { var t = e.grid.rowType, n = this._wijgrid._columnsHeadersTable(), r, i, s; if (n && (i = n.length)) for (r = 0; r < i; r++) s = this._insertEmptyRow(t.header, r, -1, -1, -1), this._renderRow(s, null, n[r]) }, t.prototype._renderFilter = function () { var t = this._insertEmptyRow(e.grid.rowType.filter, -1, -1, -1, -1); this._renderRow(t, this._wijgrid._field("visibleLeaves"), null) }, t.prototype._renderBody = function () { var t = e.grid.rowType, n = this._wijgrid._field("visibleLeaves"), r = this._wijgrid.sketchTable, i = -1, s = 0, o = 0, u, a, f, l, c = this._wijgrid._dataOffset; if (this._bounds.start >= 0) for (u = this._bounds.start; u <= this._bounds.end; u++) f = r[u - c], l = (f.rowType & t.data) !== 0, a = this._insertEmptyRow(f.rowType, o++, l ? ++i : -1, l ? f.originalRowIndex : -1, l ? s + f.originalRowIndex : -1), this._renderRow(a, n, f) }, t.prototype._renderFooter = function () { var t = this._insertEmptyRow(e.grid.rowType.footer, -1, -1, -1, -1); this._renderRow(t, this._wijgrid._field("visibleLeaves"), null) }, t.prototype._insertEmptyRow = function (t, n, r, i, s) { var o = this._wijgrid._onViewInsertEmptyRow.apply(this._wijgrid, arguments), u = this._insertRow(t, n, o); return this._createRowInfo(u, t, e.grid.renderState.rendering, n, r, i, s) }, t.prototype._createEmptyCell = function (t, n, r) { var i = e.grid.rowType, s = this._wijgrid._onViewCreateEmptyCell.apply(this._wijgrid, arguments); return this._createCell(t.type, s) }, t.prototype._insertRow = function (e, t, n) { throw "not implemented" }, t.prototype._createCell = function (t, r) { var i = e.grid.rowType, s; r || (t === i.header ? r = document.createElement("th") : r = document.createElement("td")); if (t !== i.filter) { s = document.createElement("div"), s.className = "wijmo-wijgrid-innercell"; if (r.firstChild) while (r.firstChild) s.appendChild(r.firstChild); r.appendChild(s) } return n(r) }, t.prototype._appendCell = function (e, t, n) { throw "not implemented" }, t.prototype._createCol = function (e, t) { throw "not implemented" }, t.prototype._appendCol = function (e, t, n) { throw "not implemented" }, t.prototype._renderRow = function (t, n, r) { var i = e.grid.rowType, s, o; switch (t.type) { case i.filter: this._renderFilterRow(t, n); break; case i.footer: this._renderFooterRow(t, n); break; case i.header: this._renderHeaderRow(t, r); break; case i.data: case i.data | i.dataAlt: this._renderDataRow(t, n, r), s = r.__attr, o = r.__style; break; case i.emptyDataRow: case i.groupHeader: case i.groupFooter: this._renderSpannedRow(t, n, r), s = r.__attr, o = r.__style; break; default: throw "unknown rowType" } this._rowRendered(t, s, o) }, t.prototype._renderCell = function (t, r, i, s, o, u, a) { var f = this._createEmptyCell(t, o.dataIndex, o), l = t.type === e.grid.rowType.filter ? f : n(f[0].firstChild); this._appendCell(t, r, f), s ? l.html(i) : this._wijgrid.cellFormatter.format(l, o, i, t), this._cellRendered(t, f, r, o, u, a) }, t.prototype._renderDataRow = function (e, t, n) { var r, i, s, o, u, a, f, l = !1; for (r = 0, i = t.length; r < i; r++) { s = t[r], o = s.dataIndex, u = null; if (o >= 0 && (!n[o] || n[o].visible === !1)) continue; u = o >= 0 ? this._wijgrid._toStr(s, n[o].value) : null, a = o >= 0 ? n[o].__attr : null, f = o >= 0 ? n[o].__style : null, this._renderCell(e, r, u, l, s, a, f) } }, t.prototype._renderFilterRow = function (t, n) { var r, i, s; for (r = 0, i = n.length; r < i; r++) s = n[r], this._renderCell(t, r, e.grid.filterHelper.getSingleValue(s.filterValue), !1, s) }, t.prototype._renderFooterRow = function (e, t) { var n, r; for (n = 0, r = t.length; n < r; n++) this._renderCell(e, n, "", !1, t[n]) }, t.prototype._renderHeaderRow = function (e, t) { var n, r, i = 0, s; for (n = 0, r = t.length; n < r; n++) s = t[n], s.column && s.column.parentVis && (s.column.thX = i++, s.column.thY = e.sectionRowIndex, this._renderCell(e, n, s.column.headerText, !1, s.column, { colSpan: s.colSpan, rowSpan: s.rowSpan })) }, t.prototype._renderSpannedRow = function (e, t, n) { var r, i, s = Math.min(t.length, n.length); for (r = 0; r < s; r++) this._renderCell(e, r, n[r].html, !0, t[r], n[r].__attr, n[r].__style) }, t.prototype._cellRendered = function (t, n, r, i, s, o) { this._wijgrid.cellStyleFormatter.format(n, r, i, t, e.grid.renderState.rendering, s, o), this._changeCellRenderState(n, e.grid.renderState.rendering, !1), this._wijgrid._onViewCellRendered(t, n, r, i) }, t.prototype._rowRendered = function (t, n, r) { this._wijgrid.rowStyleFormatter.format(t, n, r), t.state &= ~e.grid.renderState.rendering, this._setRowInfo(t.$rows, t), this._wijgrid._onViewRowRendered(t) }, t.prototype._isBodyRow = function (t) { var n = e.grid.rowType, r = t.type; return r & n.data || r === n.groupHeader || r === n.groupFooter || r === n.emptyDataRow }, t.prototype._changeRowRenderState = function (e, t, n) { n ? e.state |= t : e.state &= ~t, this._setRowInfo(e.$rows, e) }, t.prototype._changeCellRenderState = function (t, n, r) { var i = e.grid.dataPrefix, s = this._wijgrid._data$prefix, o = i(t, s, "renderState"); return r ? (n = o | n, i(t, s, "renderState", n)) : (n = o & ~n, i(t, s, "renderState", n)), n }, t.prototype._adjustWidthArray = function (e, t, r, i, s) { var o = this._sumWidthArray(e), u = this._sumWidthArray(t), a = [], f, l = 0, c, h, p = !0; if (o <= r) { n.extend(!0, a, e); if (o === r || i) return a; f = r - o } else { n.extend(!0, a, t); if (u >= r) return a; f = r - u } n.each(a, function (e, t) { t.real || l++ }); if (l !== 0) { if (s !== undefined && s > -1 && s < a.length && !a[s].real) return a[s].width += f, a; c = Math.floor(f / l), h = f - c * l, n.each(a, function (e, t) { t.real || (t.width += c, p && (t.width += h, p = !1)) }) } return a }, t.prototype._getColumnWidth = function (e, t) { var r, i, s, o, u, a, f, l, c, h, p, d; if (t) { r = this._wijgrid._field("visibleLeaves")[e]; if (r._realWidth !== undefined) i = { width: r._realWidth, real: !0 }; else if (r.isRowHeader) i = { width: this._rowHeaderSize, real: !0 }; else { s = 0, o = this.getJoinedTables(!0, e), u = o[2]; for (a = 0; a < 2; a++) { f = o[a]; if (f !== null) { l = f.element().rows; if (d = l.length) { for (p = d - 1, h = null; p >= 0; p--) if (l[p].cells.length === f.width()) { h = l[p]; break } h && (c = h.cells[u], s = Math.max(s, n(c).outerWidth())) } } } i = { width: s, real: !1 } } t.push(i) } }, t.prototype._setColumnWidth = function (e, t) { var r = this.getHeaderCell(e), i = this.getJoinedCols(e); t && (n(r).setOutWidth(t), n.each(i, function (e, r) { n(r).setOutWidth(t) })) }, t.prototype._setTableWidth = function (e, t, r, i) { var s, o; n.each(e, function (e, n) { n.css("table-layout", "fixed").setOutWidth(t) }), s = e[0].outerWidth(), o = s - t, o !== 0 && this._setColumnWidth(i, r - o) }, t.prototype._sumWidthArray = function (e, t, r) { var i = 0; return n.each(e, function (e, n) { if (t !== undefined && r !== undefined && (e < t || e > r)) return !0; i += n.width }), i }, t.prototype._clearBody = function () { n.each(this.subTables(), function (e, t) { t.clearSection(2) }) }, t.prototype._rebuildOffsets = function () { n.each(this.subTables(), function (e, t) { t.rebuildOffsets() }) }, t.prototype._removeBodyRow = function (t, n) { var r = e.grid.rowType, i = this._wijgrid._rows(), s, o, u, a, f, l, c; if (t >= 0 && t < (o = i.length())) { if (n) for (s = 0; s < o; s++) u = this._getRowInfo(i.item(s)), f = u.sectionRowIndex - t, u.sectionRowIndex > t && (u.sectionRowIndex--, u.type & r.data && (u.type & r.dataAlt ? u.type &= ~r.dataAlt : u.type |= r.dataAlt, u.dataItemIndex--, u.dataRowIndex--, u.virtualDataItemIndex--), this._setRowInfo(u.$rows, u)); u = this._getRowInfo(i.item(t)), l = this.getAbsoluteRowIndex(u.$rows[0]), u.$rows.remove(), c = this.getJoinedTables(!1, l), c[0] && c[0].removeOffset(c[2]), c[1] && c[1].removeOffset(c[2]) } }, t.prototype._insertBodyRow = function (t, n, r, i) { var s = this._wijgrid._field("visibleLeaves"), o = e.grid.rowType, u = this._wijgrid._view(), a = this._wijgrid._rows(), f = a.length(), l = (t.rowType & o.data) !== 0, c, h, p; if (n < 0 || n >= f || !n && n !== 0) n = f; return c = this._insertEmptyRow(t.rowType, n, -1, r, i), this._renderRow(c, s, t), h = this.getAbsoluteRowIndex(c.$rows[0]), p = this.getJoinedTables(!1, h), p[0] && p[0].insertOffset(h), p[1] && p[1].insertOffset(h), c }, t.prototype._findRowInfo = function (e) { var t = this.bodyRows(), r = 0, i = t.length(), s; if (n.isFunction(e)) for (r = 0; r < i; r++) { s = this._getRowInfo(t.item(r)); if (e(s) === !0) return s } return null }, t.prototype._setRowInfo = function (t, n) { var r = "$rows" in n, i = "data" in n, s, o; r && (s = n.$rows, delete n.$rows), i && (o = n.data, delete n.data), e.grid.dataPrefix(t, this._wijgrid._data$prefix, "rowInfo", n), r && (n.$rows = s), i && (n.data = o) }, t.prototype._getRowInfo = function (t) { var r = this._wijgrid, i = t[1] ? n(t) : n(t[0]), s = e.grid.dataPrefix(i, r._data$prefix, "rowInfo"), o; return s.$rows = i, s.dataItemIndex >= 0 && s.type & e.grid.rowType.data && (s.data = r._getDataItem(s.dataItemIndex)), s }, t.prototype._createRowInfo = function (t, r, i, s, o, u, a) { var f, l = { type: r, state: i, sectionRowIndex: s, dataRowIndex: o, dataItemIndex: u, virtualDataItemIndex: a, $rows: n(t) }; return u >= 0 && r & e.grid.rowType.data && (l.data = this._wijgrid._getDataItem(u)), l }, t }(); t.baseView = r })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function (t) { function r(e, n) { t.call(this, e, n), this._dataTable = null, this._contentArea = null } return __extends(r, t), r.prototype.dispose = function () { this._wijgrid.outerDiv.unbind("scroll", this._onScroll), t.prototype.dispose.call(this) }, r.prototype.ensureWidth = function (e, r, i) { var s = n(this._dataTable.element()), o = s.width() + r - i; t.prototype.ensureWidth.call(this, e, r, i), this._setTableWidth([s], o, r, e) }, r.prototype.getVisibleAreaBounds = function () { var t = e.grid.bounds(this._dataTable.element()), n; return this._wijgrid.options.scrollMode === "none" ? t : (n = e.grid.bounds(this._wijgrid.outerDiv.find(".wijmo-wijgrid-split-area-se:first")[0]), { top: t.top, left: t.left, width: Math.min(n.width, t.width), height: Math.min(n.height, t.height) }) }, r.prototype.updateSplits = function (e) { var t = this, r = this._wijgrid, i = r.options, s = r.element, o = [], u = [], a = [], f = r._field("visibleLeaves"), l = r.outerDiv, c, h; s.css({ "table-layout": "", width: "" }), n.each(f, function (e, n) { var r, s = n.width; if (s || s === 0) { r = typeof s == "string" && s.length > 1 && s[s.length - 1] === "%", r ? s = l.width() * parseFloat(s) / 100 : s = parseFloat(s); if (n.ensurePxWidth || n.ensurePxWidth === undefined && i.ensureColumnsPxWidth) n._realWidth = s; t._setColumnWidth(e, s) } }), n.each(f, function (e, n) { t._getColumnWidth(e, o) }), s.css("width", "1px"), n.each(f, function (e, n) { t._getColumnWidth(e, u) }), c = l.width(), a = this._adjustWidthArray(o, u, c, i.ensureColumnsPxWidth, i.autoExpandColumnIndex), n.each(a, function (e, n) { var r = f[e]; if (r._realWidth !== undefined) { delete r._realWidth; return } t._setColumnWidth(e, n.width) }), h = a.length - 1, h !== -1 && this._setTableWidth([s], this._sumWidthArray(a, 0, h), a[h].width, h) }, r.prototype.focusableElement = function () { return n(this._dataTable.element()) }, r.prototype.forEachColumnCell = function (e, t, n) { return this._dataTable.forEachColumnCell(e, t, n) }, r.prototype.forEachRowCell = function (e, t, n) { return this._dataTable.forEachRowCell(e, t, n) }, r.prototype.getAbsoluteCellInfo = function (t) { return new e.grid.cellInfo(this.getColumnIndex(t), t.parentNode.rowIndex, this._wijgrid, !0) }, r.prototype.getAbsoluteRowIndex = function (e) { return e.rowIndex }, r.prototype.getCell = function (e, t) { var n = this._dataTable.getCellIdx(e, t), r; if (n >= 0) { r = this.getJoinedRows(t, 0); if (r[0]) return r[0].cells[n] } return null }, r.prototype.getColumnIndex = function (e) { return this._dataTable.getColumnIdx(e) }, r.prototype.getHeaderCell = function (t) { var n = this._wijgrid._field("visibleLeaves")[t], r; return n && (r = this._wijgrid._headerRows()) ? e.grid.rowAccessor.getCell(r.item(n.thY), n.thX) : null }, r.prototype.getJoinedCols = function (e) { var t = n(this._dataTable.element()).find("> colgroup"); return t.length && e < t[0].childNodes.length ? [t[0].childNodes[e], null] : [null, null] }, r.prototype.getJoinedRows = function (e, t) { return [this._dataTable.getSectionRow(e, t), null] }, r.prototype.getJoinedTables = function (e, t) { return [this._dataTable, null, t] }, r.prototype.subTables = function () { return [this._dataTable] }, r.prototype._preRender = function () { this._dataTable = new e.grid.htmlTableAccessor(this._wijgrid.element[0], !0, !0, !0) }, r.prototype._postRender = function () { this._wijgrid.element.find("> tbody").addClass(this._wijgrid.options.wijCSS.content + " wijmo-wijgrid-data"), this._dataTable = new e.grid.htmlTableAccessor(this._wijgrid.element[0]), this._wijgrid._setAttr(this._wijgrid.element, { role: "grid", cellpadding: "0", border: "0", cellspacing: "0" }), this._wijgrid.element.css("border-collapse", "separate"), this._wijgrid.outerDiv.bind("scroll", { wijgrid: this._wijgrid }, n.proxy(this._onScroll, this)), t.prototype._postRender.call(this) }, r.prototype._insertRow = function (t, n, r) { var i = e.grid.rowType, s; switch (t) { case i.header: case i.filter: s = this._dataTable.ensureTHead(); break; case i.footer: s = this._dataTable.ensureTFoot(); break; default: s = this._dataTable.ensureTBody() } return r ? [s.appendChild(r)] : (n > s.rows.length && (n = -1), [s.insertRow(n)]) }, r.prototype._rowRendered = function (e, n, r) { var i = e.$rows[0]; !i.cells.length && this._isBodyRow(e) ? i.parentNode.removeChild(i) : t.prototype._rowRendered.call(this, e, n, r) }, r.prototype._appendCell = function (e, t, n) { e.$rows[0].appendChild(n[0]) }, r.prototype._createCol = function (e, t) { return [document.createElement("col")] }, r.prototype._appendCol = function (e, t, n) { this._dataTable.appendCol(e[0]) }, r.prototype._onScroll = function (e) { e.data.wijgrid.$superPanelHeader && e.data.wijgrid.$superPanelHeader.css("left", e.target.scrollLeft), e.data.wijgrid.$bottomPagerDiv && e.data.wijgrid.$bottomPagerDiv.css("left", e.target.scrollLeft) }, r }(t.baseView); t.flatView = r })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function (t) { function r(e, r) { t.call(this, e, r), this._verScrollBarSize = 18, this._viewTables = {}, this._splitAreas = {}, this.element = e.element, this._allowVirtualScrolling = e._allowVirtualScrolling(), this._staticDataRowIndex = e._getStaticIndex(!0), this._staticRowIndex = e._getRealStaticRowIndex(), this._staticColumnIndex = e._getRealStaticColumnIndex(), this._staticAllColumnIndex = this._staticColumnIndex === -1 ? -1 : e._field("visibleLeaves")[this._staticColumnIndex].leavesIdx, this._mouseWheelHandler = n.proxy(this._onMouseWheel, this) } return __extends(r, t), r.prototype.dispose = function () { t.prototype.dispose.call(this), this._wijgrid.outerDiv.unbind("mousewheel", this._mouseWheelHandler) }, r.prototype.ensureWidth = function (e, r, i) { var s = this._wijgrid, o = s.options, u = this._staticColumnIndex, a = e <= u, f = n(this._viewTables.nw.element()), l = n(this._viewTables.ne.element()), c = n(this._viewTables.sw.element()), h = n(this._viewTables.se.element()), p = a ? [f, c] : [l, h], d = (a ? f.width() : l.width()) + r - i, v = s._field("frozener"), m = this.getScrollValue(); this._destroySuperPanel(), t.prototype.ensureWidth.call(this, e, r, i), this._setTableWidth(p, d, r, e); try { u >= 0 ? o.splitDistanceX = f[0].offsetWidth : o.splitDistanceX = 0 } catch (g) { } this._updateSplitAreaBounds(0), this._adjustRowsHeights(); try { this._staticRowIndex >= 0 ? o.splitDistanceY = Math.max(f[0].offsetHeight, l[0].offsetHeight) : o.splitDistanceY = 0 } catch (g) { } this._updateSplitAreaBounds(1), this.refreshPanel(m), v.refresh() }, r.prototype.ensureHeight = function (e) { var t, r = this._wijgrid, i = r.options, s = n(this._viewTables.nw.element()), o = n(this._viewTables.ne.element()), u = n(this._viewTables.sw.element()), a = n(this._viewTables.se.element()), f = r._field("frozener"), l = this.getScrollValue(), c; this._destroySuperPanel(), arguments.length > 0 && (t = this.getJoinedRows(e, 2), this._setRowHeight(t, this._getRowHeight(t))), a.css("height", ""), u.css("height", ""), c = Math.max(a.height(), u.height()), a.height(c), u.height(c); try { this._staticRowIndex >= 0 ? i.splitDistanceY = Math.max(s[0].offsetHeight, o[0].offsetHeight) : i.splitDistanceY = 0 } catch (h) { } this._updateSplitAreaBounds(1), this.refreshPanel(l), f.refresh() }, r.prototype.getScrollValue = function () { var e = this._getSuperPanel(); return e ? { x: e.options.hScroller.scrollValue, y: e.options.vScroller.scrollValue } : null }, r.prototype.getVisibleAreaBounds = function () { var t = e.grid.bounds(this._wijgrid.outerDiv.find(".wijmo-wijsuperpanel-contentwrapper:first")); return t || (t = e.grid.bounds(this._wijgrid.outerDiv)), t }, r.prototype.getFixedAreaVisibleBounds = function () { var t = this.getVisibleAreaBounds(), n = e.grid.bounds(this._splitAreas.ne), r = e.grid.bounds(this._splitAreas.nw), i = null, s = null; if (n.height || r.height) i = { left: t.left, top: t.top, width: t.width, height: Math.min(n.height || r.height, t.height) }; return r.width && (s = { left: t.left, top: t.top, width: Math.min(r.width, t.width), height: t.height }), [i, s] }, r.prototype.refreshPanel = function (t) { var r = this, i = this._wijgrid, s = i.options, o = this._getGridWidth(s.scrollMode), u = this._getMappedScrollMode(), a = this._testNeedVBar(i.outerDiv, i.element, n(this._viewTables.ne.element()), s.scrollMode, i._autoHeight), f = t ? t.x : null, l = t ? t.y : null; this._scroller.width(o), this._splitAreas.ne.width(o - s.splitDistanceX - (a ? this._verScrollBarSize : 0)), this._scroller.data("wijmo-wijsuperpanel") ? this._scroller.wijsuperpanel("paintPanel") : (this._allowVirtualScrolling && (this.vsUI = new e.grid.uiVirtualScroller(i, this._splitAreas.se, s.splitDistanceY)), this._scroller.wijsuperpanel({ disabled: i.options.disabled, scroll: n.proxy(this._onScroll, this), bubbleScrollingEvent: !0, customScrolling: this._allowVirtualScrolling, vScroller: { scrollBarVisibility: u.vScrollBarVisibility, scrollValue: t ? t.y : null }, hScroller: { scrollBarVisibility: u.hScrollBarVisibility, scrollValue: t ? t.x : null }, hScrollerActivating: function (e, t) { var n; if (i._autoHeight) { n = i.element.height() + s.splitDistanceY - t.contentLength; if (n > 0) return r._scroller.height(r._scroller.height() + n), r._scroller.wijsuperpanel("paintPanel"), !1 } r._splitAreas.sw.height(t.contentLength - s.splitDistanceY) } }), this._scroller.find(".wijmo-wijsuperpanel-contentwrapper:first").scroll(function (e) { e.target.scrollLeft && (e.target.scrollLeft = 0), e.target.scrollTop && (e.target.scrollTop = 0), e.preventDefault() }), this._allowVirtualScrolling && this.vsUI.attach(this._scroller)), this._scroller.find(".wijmo-wijsuperpanel-hbarcontainer, .wijmo-wijsuperpanel-vbarcontainer").css("zIndex", 5) }, r.prototype.scrollTo = function (e) { if (!e.tableCell()) return; var t = this._wijgrid, r = t.options, i = this._getSuperPanel(), s = e.tableCell(), o = s.nodeType ? n(s) : s, u, a, f, l, c, h, p, d, v, m, g, y = null, b = null, w, E, S, x; i && o.is(":visible") && (u = i.getContentElement(), a = u.parent(), f = parseInt((u.css("left") + "").replace("px", ""), 10) * -1, l = parseInt((u.css("top") + "").replace("px", ""), 10) * -1, c = a.outerWidth() - r.splitDistanceX, h = a.outerHeight() - r.splitDistanceY, p = o.position(), d = p.left, v = p.top, m = o.outerWidth(), g = o.outerHeight(), w = t._getStaticIndex(!0), E = t._getStaticIndex(!1), S = e.rowIndex(), x = e.cellIndex(), S <= w ? x <= E ? (y = 0, b = 0) : (d += f, d + m > f + c && (f = y = d + m - c), d < f && (y = d), b = 0) : x <= E ? (v += l, v + g > l + h && (l = b = v + g - h), v < l && (b = v), y = 0) : (d -= r.splitDistanceX, v + g > l + h && (l = b = v + g - h), d + m > f + c && (f = y = d + m - c), v < l && (b = v), d < f && (y = d)), y !== null && i.hScrollTo(y), b !== null && (this._allowVirtualScrolling || i.vScrollTo(b))) }, r.prototype.updateSplits = function (e) { var t = this._wijgrid, r = t.options, i, s = this, o = [], u = [], a = [], f = this._staticColumnIndex, l, c = r.scrollMode, h = t._field("visibleLeaves"), p = n(this._viewTables.se.element()), d = n(this._viewTables.ne.element()), v = n(this._viewTables.sw.element()), m = n(this._viewTables.nw.element()), g = t.outerDiv, y, b, w; this._destroySuperPanel(), g.unbind("mousewheel", this._mouseWheelHandler); if ((y = s._viewTables.se.element().tBodies) && (y = y[0])) { w = !1; for (b = 0; b < y.rows.length; b++) if (!n(y.rows[b]).hasClass("wijmo-wijgrid-groupheaderrow")) { w = !0; break } w || t.element.css("width", "100%") } n.each([p, d, v, m], function (e, t) { t.css({ "table-layout": "", width: "" }) }), n.each(h, function (e, t) { var n, i = t.width; if (i || i === 0) { n = typeof i == "string" && i.length > 1 && i[i.length - 1] === "%", n ? i = g.width() * parseFloat(i) / 100 : i = parseFloat(i); if (t.ensurePxWidth || t.ensurePxWidth === undefined && r.ensureColumnsPxWidth) t._realWidth = i; s._setColumnWidth(e, i) } }), n.each(h, function (e, t) { s._getColumnWidth(e, a) }), n.each([m, d, v, p], function (e, t) { t.css({ width: "1px" }) }), n.each(h, function (e, t) { s._getColumnWidth(e, u) }), i = g.width(), o = this._adjustWidthArray(a, u, i, r.ensureColumnsPxWidth, r.autoExpandColumnIndex), n.each(o, function (e, t) { var n = h[e]; if (n._realWidth !== undefined) { delete n._realWidth; return } s._setColumnWidth(e, t.width) }), f >= 0 && (l = f, this._setTableWidth([m, v], this._sumWidthArray(o, 0, l), o[l].width, l)); try { f >= 0 ? r.splitDistanceX = m[0].offsetWidth : r.splitDistanceX = 0 } catch (E) { } this._updateSplitAreaBounds(0), r.ensureColumnsPxWidth || d.parent().width(i - r.splitDistanceX), l = o.length - 1, l !== -1 && this._setTableWidth([d, p], this._sumWidthArray(o, f + 1, l), o[l].width, l), this._adjustRowsHeights(); try { this._staticRowIndex >= 0 ? r.splitDistanceY = Math.max(m[0].offsetHeight, d[0].offsetHeight) : r.splitDistanceY = 0 } catch (E) { } this._updateSplitAreaBounds(1); if (!r.ensureColumnsPxWidth && this._testNeedVBar(t.outerDiv, p, d, c, t._autoHeight)) { i -= this._verScrollBarSize, o = this._adjustWidthArray(a, u, i, r.ensureColumnsPxWidth, r.autoExpandColumnIndex), n.each(o, function (e, t) { t.real || s._setColumnWidth(e, t.width) }), f >= 0 && (l = f, this._setTableWidth([m, v], this._sumWidthArray(o, 0, l), o[l].width, l)); try { f >= 0 ? r.splitDistanceX = m[0].offsetWidth : r.splitDistanceX = 0 } catch (E) { } this._updateSplitAreaBounds(0), d.parent().width(i - r.splitDistanceX), l = o.length - 1, l !== -1 && this._setTableWidth([d, p], this._sumWidthArray(o, f + 1, l), o[l].width, l), this._adjustRowsHeights(); try { this._staticRowIndex >= 0 ? r.splitDistanceY = Math.max(m[0].offsetHeight, d[0].offsetHeight) : r.splitDistanceY = 0 } catch (E) { } this._updateSplitAreaBounds(1) } this.refreshPanel(e), g.bind("mousewheel", n.proxy(this._mouseWheelHandler, this)) }, r.prototype._clearBody = function () { t.prototype._clearBody.call(this) }, r.prototype.bodyRows = function () { var e = t.prototype.bodyRows.call(this); return e }, r.prototype.focusableElement = function () { return this._wijgrid.outerDiv }, r.prototype.forEachColumnCell = function (e, t, n) { var r = this.getJoinedTables(!0, e), i, s; if (r[0] !== null) { i = r[2], s = r[0].forEachColumnCell(i, t, n); if (s !== !0) return s; if (r[1] !== null) { s = r[1].forEachColumnCell(i, t, n); if (s !== !0) return s } } return !0 }, r.prototype.forEachRowCell = function (e, t, n) { var r = this.getJoinedTables(!1, e), i = r[0], s = r[1], o, u; if (i !== null) { o = r[2]; if (o < i.element().rows.length) { u = i.forEachRowCell(o, t, n); if (u !== !0) return u } if (s !== null && o < s.element().rows.length) { u = s.forEachRowCell(o, t, n); if (u !== !0) return u } } return HTMLTableCellElement, !0 }, r.prototype.getAbsoluteCellInfo = function (t) { return new e.grid.cellInfo(this.getColumnIndex(t), this.getAbsoluteRowIndex(t.parentNode), this._wijgrid, !0) }, r.prototype.getAbsoluteRowIndex = function (e) { var t = e.rowIndex, n = e.parentNode; while (n.tagName.toLowerCase() !== "table") n = n.parentNode; return n === this._viewTables.nw.element() || n === this._viewTables.ne.element() ? t : t + this._staticRowIndex + 1 }, r.prototype.getCell = function (e, t) { var n = this.getJoinedTables(!1, t), r, i, s, o, u; if (n[0] !== null) { r = this.getJoinedTables(!0, e); if (r[0] !== null) { i = n[2], s = r[2], o = null, n[1] !== null ? o = e === s ? n[0] : n[1] : o = n[0], u = o.getCellIdx(s, i); if (u >= 0) return o.element().rows[i].cells[u] } } return null }, r.prototype.getColumnIndex = function (e) { var t = null, n = null, r = !1, i; for (t = e.parentNode; t.tagName.toLowerCase() !== "table"; t = t.parentNode); if (t !== null) { t === this._viewTables.nw.element() ? n = this._viewTables.nw : t === this._viewTables.ne.element() ? (n = this._viewTables.ne, r = !0) : t === this._viewTables.sw.element() ? n = this._viewTables.sw : t === this._viewTables.se.element() && (n = this._viewTables.se, r = !0); if (n !== null) return i = n.getColumnIdx(e), r && (i += this._staticColumnIndex + 1), i } return -1 }, r.prototype.getHeaderCell = function (t) { var n = this._wijgrid._field("visibleLeaves")[t], r; return n && (r = this._wijgrid._headerRows()) ? e.grid.rowAccessor.getCell(r.item(n.thY), n.thX) : null }, r.prototype.getJoinedCols = function (e) { var t = [], r = this.getJoinedTables(!0, e), i = r[2]; return r.splice(r.length - 1, 1), n.each(r, function (e, r) { t.push(r ? n(r.element()).find("col")[i] : null) }), t }, r.prototype.getJoinedRows = function (e, t) { var n = null, r = null, i = null, s = null, o = this._staticRowIndex, u = this._staticColumnIndex, a = this._wijgrid._field("visibleLeaves").length - 1, f = this._rowsCountRaw() - 1, l = o === f, c = o < 0, h = !l && !c, p = 0; if (l || h) u >= 0 && u < a ? (i = this._viewTables.nw, s = this._viewTables.ne) : i = u < 0 ? this._viewTables.ne : this._viewTables.nw, p = i.getSectionLength(t), e < p && (n = i.getSectionRow(e, t), s !== null && (r = s.getSectionRow(e, t))); if (c || h && n === null) c || (e -= p), u >= 0 && u < a ? (i = this._viewTables.sw, s = this._viewTables.se) : i = u < 0 ? this._viewTables.se : this._viewTables.sw, n = i.getSectionRow(e, t), s !== null && (r = s.getSectionRow(e, t)); return n === null && r === null ? null : [n, r] }, r.prototype.getJoinedTables = function (e, t) { var n = null, r = null, i = t, s = this._wijgrid, o = this._staticRowIndex, u = this._staticColumnIndex; return e ? (t <= u ? (n = this._viewTables.nw, r = this._viewTables.sw) : (n = this._viewTables.ne, r = this._viewTables.se, i -= u + 1), o < 0 && (n = null), o === this._rowsCountRaw() - 1 && (r = null)) : (t <= o ? (n = this._viewTables.nw, r = this._viewTables.ne) : (n = this._viewTables.sw, r = this._viewTables.se, i -= o + 1), u < 0 && (n = null), u === s._field("leaves").length - 1 && (r = null)), n === null && (n = r, r = null), [n, r, i] }, r.prototype.subTables = function () { return [this._viewTables.nw, this._viewTables.ne, this._viewTables.sw, this._viewTables.se] }, r.prototype._getGridWidth = function (e) { var t = this._wijgrid, r = t.element.outerWidth(!0) + t.options.splitDistanceX, i = t.outerDiv.innerWidth(); return this._testNeedVBar(t.outerDiv, t.element, n(this._viewTables.ne.element()), e, t._autoHeight) && (r += this._verScrollBarSize), r > i && (r = i), r }, r.prototype._getSuperPanel = function () { return this._scroller ? this._scroller.data("wijmo-wijsuperpanel") : null }, r.prototype._ensureRenderBounds = function () { this._wijgrid._allowVirtualScrolling() ? (this._wijgrid._ensureRenderBounds(this._bounds), this._wijgrid._serverSideVirtualScrolling(), this._bounds.end = this._bounds.start + this._wijgrid.options.pageSize - 1, this._wijgrid._ensureRenderBounds(this._bounds)) : t.prototype._ensureRenderBounds.call(this) }, r.prototype._renderContent = function () { t.prototype._renderContent.call(this) }, r.prototype._preRender = function () { var t = document.createDocumentFragment(), r = e.grid.htmlTableAccessor; this._wijgrid.outerDiv.wrapInner('<div class="wijmo-wijgrid-fixedview"><div class="wijmo-wijgrid-scroller"><div class="wijmo-wijgrid-split-area-se wijmo-wijgrid-content-area"></div></div></div>'), this._scroller = this._wijgrid.outerDiv.find(".wijmo-wijgrid-scroller"), this._scroller.css("padding", 0), this._scroller.after(this._splitAreas.nw = n('<div class="wijmo-wijgrid-split-area wijmo-wijgrid-split-area-nw" style="overflow:hidden;position:absolute;z-index:4;top:0px;left:0px;"></div>')), this._scroller.after(this._splitAreas.ne = n('<div class="wijmo-wijgrid-split-area wijmo-wijgrid-split-area-ne" style="overflow:hidden;position:absolute;z-index:4;top:0px;left:0px;"></div>')), this._scroller.after(this._splitAreas.sw = n('<div class="wijmo-wijgrid-split-area wijmo-wijgrid-split-area-sw" style="overflow:hidden;position:absolute;z-index:4;top:0px;left:0px;"></div>')), this._splitAreas.se = this._scroller.find(".wijmo-wijgrid-split-area-se:first"), this._viewTables = { nw: new r(t.appendChild(document.createElement("table")), !0, !0, !0), ne: new r(t.appendChild(document.createElement("table")), !0, !0, !0), sw: new r(t.appendChild(document.createElement("table")), !0, !0, !0), se: new r(t.appendChild(this._wijgrid.element[0]), !0, !0, !0) } }, r.prototype._postRender = function () { var r, i, s, o, u = e.grid.htmlTableAccessor, a = this; this._viewTables = { nw: new u(r = this._viewTables.nw.element()), ne: new u(i = this._viewTables.ne.element()), sw: new u(s = this._viewTables.sw.element()), se: new u(o = this._viewTables.se.element()) }, this._splitAreas.nw.empty().append(r), this._splitAreas.ne.empty().append(i), this._splitAreas.sw.empty().append(s), this._splitAreas.se.empty().append(o), n.each(this._viewTables, function (e, t) { var r = n(t.element()); a._wijgrid._setAttr(r, { role: "grid", border: "0", cellpadding: "0", cellspacing: "0" }), r.addClass("wijmo-wijgrid-table").css("border-collapse", "separate").find("> tbody").addClass(a._wijgrid.options.wijCSS.content + " wijmo-wijgrid-data") }), t.prototype._postRender.call(this) }, r.prototype._rowsCountRaw = function () { var e = this._viewTables.nw.element(), t = this._viewTables.ne.element(), n = this._viewTables.sw.element(), r = this._viewTables.se.element(), i; return i = Math.max(e.rows.length, t.rows.length) + Math.max(n.rows.length, r.rows.length), i }, r.prototype._createCol = function (e, t) { return [document.createElement("col"), document.createElement("col")] }, r.prototype._appendCol = function (e, t, n) { n <= this._staticColumnIndex ? (this._viewTables.nw.appendCol(e[0]), this._viewTables.sw.appendCol(e[1])) : (this._viewTables.ne.appendCol(e[0]), this._viewTables.se.appendCol(e[1])) }, r.prototype._insertRow = function (t, n, r) { var i = e.grid.rowType, s, o, u = this._viewTables; switch (t) { case i.header: case i.filter: s = u.nw.ensureTHead(), o = u.ne.ensureTHead(); break; case i.footer: s = u.sw.ensureTFoot(), o = u.se.ensureTFoot(); break; default: n <= this._staticDataRowIndex ? (s = u.nw.ensureTBody(), o = u.ne.ensureTBody()) : (n -= this._staticDataRowIndex + 1, s = u.sw.ensureTBody(), o = u.se.ensureTBody()) } return r ? [s.appendChild(r), o.appendChild(r.cloneNode(!1))] : [s.insertRow(n > s.rows.length ? -1 : n), o.insertRow(n > o.rows.length ? -1 : n)] }, r.prototype._rowRendered = function (e, r, i) { var s = e.$rows[0], o = e.$rows[1]; !s.cells.length && this._isBodyRow(e) && (s.parentNode.removeChild(s), s = null), !o.cells.length && this._isBodyRow(e) && (o.parentNode.removeChild(o), o = null); if (s || o) { if (!s || !o) e.$rows = s ? n(s) : n(o); t.prototype._rowRendered.call(this, e, r, i) } }, r.prototype._appendCell = function (t, n, r) { var i = t.type !== e.grid.rowType.header ? this._staticColumnIndex : this._staticAllColumnIndex; n <= i ? t.$rows[0].appendChild(r[0]) : t.$rows[1].appendChild(r[0]) }, r.prototype._getRowHeight = function (e, t) { if (e[0] && e[1]) { var r = e[0], i = e[1], s = n(r), o = n(i), u, a, f, l = function (e) { var t, r = e[0], i; for (t = 0; t < r.cells.length; t++) { i = r.cells[t]; if (!i.rowSpan || i.rowSpan === 1) return n(i).outerHeight() } return e.height() }; return (f = n.data(r, "customHeight")) ? u = a = parseInt(f) : (s.css("height", ""), o.css("height", ""), t ? (u = l(s), a = l(o)) : (u = s.height(), a = o.height())), Math.max(u, a) } return null }, r.prototype._setRowHeight = function (e, t) { if (e[0] && e[1]) { var r = [n(e[0]), n(e[1])], i; if (t === null) return; t += 1, n.each(r, function (e, n) { n.height(t), i = t - n.height(), i && n.height(t + i) }) } }, r.prototype._adjustRowHeight = function () { var e = this._wijgrid, t = this._staticColumnIndex, n = e._field("visibleLeaves").length - 1, r, i, s, o, u, a, f, l, c, h, p, d, v, m, g, y, b = []; if (t > -1 && t < n) { r = this._staticRowIndex, i = this._rowsCountRaw() - 1, s = this._viewTables; if (r > -1 && r <= i) { o = s.ne.element(), u = o.parentNode, a = s.nw.element(), f = a.parentNode, g = a.rows, y = o.rows, d = g.length; for (v = 0; v < d; v++) b.push(this._getRowHeight([g[v], y[v]], !0)) } if (r >= -1 && r < i) { l = s.se.element(), c = l.parentNode, h = s.sw.element(), p = h.parentNode, g = h.rows, y = l.rows, d = g.length; for (v = 0; v < d; v++) b.push(this._getRowHeight([g[v], y[v]])) } r > -1 && r <= i && (f.removeChild(a), u.removeChild(o)), r >= -1 && r < i && (p.removeChild(h), c.removeChild(l)); if (r > -1 && r <= i) { g = a.rows, y = o.rows, d = g.length; for (v = 0, m = 0; v < d; v++) this._setRowHeight([g[v], y[v]], b[m++]) } if (r >= -1 && r < i) { g = h.rows, y = l.rows, d = g.length; for (v = 0; v < d; v++) this._setRowHeight([g[v], y[v]], b[m++]) } r > -1 && r <= i && (f.appendChild(a), u.appendChild(o)), r >= -1 && r < i && (p.appendChild(h), c.appendChild(l)) } }, r.prototype._adjustRowsHeights = function () { var e = n(this._viewTables.sw.element()), t = n(this._viewTables.se.element()), r; t.css("height", ""), e.css("height", ""), this._adjustRowHeight(), r = Math.max(t.height(), e.height()), e.height(r), t.height(r) }, r.prototype._destroySuperPanel = function () { this._scroller.data("wijmo-wijsuperpanel") && (this.vsUI && this.vsUI.dispose(), this._scroller.wijsuperpanel("destroy")) }, r.prototype._onScroll = function (e, t) { var n = this._getSuperPanel(); this._allowVirtualScrolling ? t.dir === "h" && (this._setFixedAreaPosition(n.getContentElement(), t.dir, t.position, t.animationOptions, !1), this._setFixedAreaPosition(this._splitAreas.ne, t.dir, t.position, t.animationOptions, !0)) : this._setFixedAreaPosition(t.dir === "h" ? this._splitAreas.ne : this._splitAreas.sw, t.dir, t.position, t.animationOptions, !0), this._wijgrid._trackScrollingPosition(n.options.hScroller.scrollValue, n.options.vScroller.scrollValue) }, r.prototype._onMouseWheel = function (t, r) { var i, s = r > 0 ? "top" : "bottom", o = !1, u; this._wijgrid._canInteract() && (i = this.getFixedAreaVisibleBounds(), n.each(i, function (n, r) { if (r && e.grid.isOver(t.pageY, t.pageX, r.top, r.left, r.height, r.width)) return o = !0, !1 }), o && this._scroller.data("wijmo-wijsuperpanel") && (u = this._scroller.wijsuperpanel("option", "vScroller").scrollValue, this._scroller.wijsuperpanel("doScrolling", s), u !== this._scroller.wijsuperpanel("option", "vScroller").scrollValue && (t.stopPropagation(), t.preventDefault()))) }, r.prototype._setFixedAreaPosition = function (e, t, n, r, i) { var s = {}, o; t === "h" ? o = i ? "scrollLeft" : "left" : o = i ? "scrollTop" : "top", i || (n = -n), r ? (s[o] = n, e.animate(s, r)) : i ? e[0][o] = n : e.css(o, n) }, r.prototype._testNeedVBar = function (e, t, n, r, i) { var s, o = this._wijgrid, u = n.width() + o.options.splitDistanceX, a = t.height() + o.options.splitDistanceY, f = e.width(), l = e.height(), c, h = 0, p = 0; return this._allowVirtualScrolling && o._totalRowsCount() > 1 ? !0 : (o.$superPanelHeader !== null && (h = o.$superPanelHeader.outerHeight(!0)), o.$bottomPagerDiv !== null && (p = o.$bottomPagerDiv.outerHeight(!0)), c = l - h - p, r === "both" || r === "vertical" ? s = !0 : s = r === "auto" && (a > c || !i && u > f && a > c - this._verScrollBarSize), s) }, r.prototype._updateSplitAreaBounds = function (e) { var t = this._wijgrid, n = t.options, r, i, s = 0, o = 0; if (e === 0 || e === 2) this._splitAreas.nw.width(n.splitDistanceX), this._splitAreas.sw.width(n.splitDistanceX), this._splitAreas.se.css("marginLeft", n.splitDistanceX), this._splitAreas.ne.css("marginLeft", n.splitDistanceX); if (e === 1 || e === 2) this._scroller.css("height", ""), this._splitAreas.se.css("marginTop", 0), r = t.outerDiv.height(), t._autoHeight ? this._scroller.height(r + n.splitDistanceY) : this._scroller.height(r), this._splitAreas.nw.height(n.splitDistanceY), this._splitAreas.ne.height(n.splitDistanceY), t.$superPanelHeader !== null && (s = t.$superPanelHeader.outerHeight(!0)), t.$bottomPagerDiv !== null && (o = t.$bottomPagerDiv.outerHeight(!0)), i = r - s - o, t.$superPanelHeader !== null && (this._splitAreas.nw.css("top", s + "px"), this._splitAreas.ne.css("top", s + "px")), t._autoHeight ? this._splitAreas.sw.height(i) : this._splitAreas.sw.height(i - n.splitDistanceY), this._splitAreas.sw.css("top", n.splitDistanceY + s), this._splitAreas.se.css("marginTop", n.splitDistanceY) }, r }(t.baseView); t.fixedView = r })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function () { function t(e) { this._updates = 0, this._selectedColumns = null, this._selectedRows = null, this._extend_rules = { singlecell: [0, 0, 0], singlecolumn: [1, 1, 1], singlerow: [2, 2, 2], singlerange: [0, 1, 2], multicolumn: [1, 1, 1], multirow: [2, 2, 2], multirange: [0, 1, 2] }; if (!e) throw "invalid arguments"; this._wijgrid = e, this._addedCells = new i(e), this._removedCells = new i(e), this._selectedCells = new i(e), this._addedDuringCurTransactionCells = new i(e) } return t.prototype.selectedCells = function () { return this._selectedCells }, t.prototype.addColumns = function (e, t) { !t && t !== 0 && (t = e), this.addRange(e, 0, t, 16777215) }, t.prototype.addRange = function (t, n, r, i) { if (!t && arguments.length === 1) throw "invalid argument"; var s = arguments.length === 4 ? new e.grid.cellInfoRange(new e.grid.cellInfo(t, n), new e.grid.cellInfo(r, i)) : t._clone(); s._normalize(); if (!s._isValid()) throw "invalid argument"; this.beginUpdate(), this._startNewTransaction(this._wijgrid._field("currentCell")), this._selectRange(s, !1, !0, 0, null), this.endUpdate() }, t.prototype.addRows = function (e, t) { !t && t !== 0 && (t = e), this.addRange(0, e, 16777215, t) }, t.prototype.removeRange = function (t, n, r, i) { if (!t && arguments.length === 1) throw "invalid argument"; var s = arguments.length === 4 ? new e.grid.cellInfoRange(new e.grid.cellInfo(t, n), new e.grid.cellInfo(r, i)) : t._clone(); s._normalize(); if (!s._isValid()) throw "invalid argument"; this.beginUpdate(), this._startNewTransaction(this._wijgrid._field("currentCell")), this._clearRange(s, 0), this.endUpdate() }, t.prototype.removeColumns = function (e, t) { !t && t !== 0 && (t = e), this.removeRange(e, 0, t, 16777215) }, t.prototype.removeRows = function (e, t) { !t && t !== 0 && (t = e), this.removeRange(0, e, 16777215, t) }, t.prototype.clear = function () { this.beginUpdate(), this._removedCells._clear(), this._removedCells._addFrom(this._selectedCells), this.endUpdate() }, t.prototype.selectAll = function () { this.beginUpdate(), this._selectRange(this._wijgrid._getDataCellsRange(), !1, !1, 0, null), this.endUpdate() }, t.prototype.beginUpdate = function () { this._updates++ }, t.prototype.endUpdate = function () { if (this._updates > 0) { this._updates--; if (this._updates === 0) { this.doSelection(); if (this._addedCells.length() || this._removedCells.length()) this._selectedColumns !== null && this._selectedColumns.UnderlyingDataChanged(), this._selectedRows !== null && this._selectedRows.UnderlyingDataChanged(), this._wijgrid._trigger("selectionChanged", null, { addedCells: this._addedCells, removedCells: this._removedCells }); this._addedCells = new e.grid.cellInfoOrderedCollection(this._wijgrid), this._removedCells._clear() } } }, t.prototype._multipleRangesAllowed = function () { var e = this._wijgrid.options.selectionMode; return e && ((e = e.toLowerCase()) === "multicolumn" || e === "multirow" || e === "multirange") }, t.prototype._anchorCell = function () { return this.__anchorCell }, t.prototype._startNewTransaction = function (t) { t && (this.__anchorCell = t._clone(), this._addedDuringCurTransactionCells = new e.grid.cellInfoOrderedCollection(this._wijgrid)) }, t.prototype._clearRange = function (e, t) { var n = this._wijgrid.options.selectionMode.toLowerCase(), r, i, s, o, u, a, f, l, c, h = this._wijgrid._getDataCellsRange(); if (e._isValid() && n !== "none" && this._selectedCells.length() > 0) { r = e._clone(), r._normalize(), r._clip(h); if (!e._isValid()) return; r._extend(this._extend_rules[n][t], h), this.beginUpdate(); for (f = 0, l = this._selectedCells.length() ; f < l; f++) c = this._selectedCells.item(f), r._containsCellInfo(c) && this._removedCells._add(c); this.endUpdate() } }, t.prototype._selectRange = function (t, n, r, i, s) { var o = this._wijgrid.options.selectionMode.toLowerCase(), u, a = this._wijgrid._getDataCellsRange(); if (o !== "none" && t._isValid()) { u = t._clone(), u._normalize(), u._clip(a); if (!u._isValid()) return; this.beginUpdate(), this._multipleRangesAllowed() ? n || r ? r && (this._removedCells._clear(), this._removedCells._addFrom(this._addedDuringCurTransactionCells)) : this.clear() : this.clear(); switch (o) { case "singlecell": case "singlecolumn": case "singlerow": u = s === null ? new e.grid.cellInfoRange(u.topLeft(), u.topLeft()) : new e.grid.cellInfoRange(s, s) } u._extend(this._extend_rules[o][i], a), this.doRange(u, !0), this.endUpdate() } }, t.prototype.doSelection = function () { var t = this._wijgrid._getDataToAbsOffset(), r = t.x, i = t.y, s = this._wijgrid._view(), o, u, a, f, l, c, h = e.grid.renderState, p, d, v = -1; for (o = 0, u = this._removedCells.length() ; o < u; o++) a = this._removedCells.item(o), this._addedCells.indexOf(a) < 0 ? (f = s.getCell(a.cellIndex() + r, a.rowIndex() + i), f && (v !== a.rowIndex() && (p = a.row(), v = a.rowIndex()), l = n(f), d = s._changeCellRenderState(l, h.selected, !1), this._wijgrid.cellStyleFormatter.format(l, a.cellIndex(), a.column(), p, d)), this._selectedCells._remove(a), this._addedDuringCurTransactionCells._remove(a)) : (this._removedCells._removeAt(o), o--, u--); v = -1; for (o = 0, u = this._addedCells.length() ; o < u; o++) a = this._addedCells.item(o), c = this._selectedCells.indexOf(a), c < 0 ? (f = s.getCell(a.cellIndex() + r, a.rowIndex() + i), f && (v !== a.rowIndex() && (p = a.row(), v = a.rowIndex()), l = n(f), d = s._changeCellRenderState(l, h.selected, !0), this._wijgrid.cellStyleFormatter.format(l, a.cellIndex(), a.column(), p, d)), this._selectedCells._insertUnsafe(a, ~c), this._addedDuringCurTransactionCells._add(a)) : (this._addedCells._removeAt(o), o--, u--) }, t.prototype.doRange = function (t, n) { var r = t.topLeft().cellIndex(), i = t.topLeft().rowIndex(), s = t.bottomRight().cellIndex(), o = t.bottomRight().rowIndex(), u, a, f, l, c = this._wijgrid._view(), h, p; if (n) { u = this._addedCells.length(), p = this._wijgrid._rows(); for (a = i; a <= o; a++) { h = c._getRowInfo(p.item(a)); if (h.type & e.grid.rowType.data) for (f = r; f <= s; f++) l = new e.grid.cellInfo(f, a), u === 0 ? this._addedCells._appendUnsafe(l) : this._addedCells._add(l) } } else { u = this._removedCells.length(); for (a = i; a <= o; a++) for (f = r; f <= s; f++) l = new e.grid.cellInfo(f, a), u === 0 ? this._removedCells._appendUnsafe(l) : this._removedCells._add(l) } }, t }(); t.selection = r; var i = function () { function t(e) { this._clear = function () { this._list.length = 0 }; if (!e) throw "invalid arguments"; this._wijgrid = e, this._list = [] } return t.prototype.item = function (e) { return this._list[e] }, t.prototype.length = function () { return this._list.length }, t.prototype.indexOf = function (e, t) { arguments.length === 1 && (t = e.rowIndex(), e = e.cellIndex()); var n = 0, r = this._list.length - 1, i, s, o; while (n <= r) { i = n + (r - n >> 1), s = this._list[i], o = s.rowIndex() - t, o === 0 && (o = s.cellIndex() - e); if (o < 0) n = i + 1; else { if (!(o > 0)) return i; r = i - 1 } } return ~n }, t.prototype.toString = function () { var e = "", t, n; for (t = 0, n = this._list.length; t < n; t++) e += this._list[t].toString() + "\n"; return e }, t.prototype._add = function (e) { var t = this.indexOf(e); return t < 0 ? (this._list.splice(~t, 0, e), e._setGridView(this._wijgrid), !0) : !1 }, t.prototype._addFrom = function (e) { if (e) { var t = e.length(), n = this._list.length, r; if (n === 0) { this._list.length = t; for (r = 0; r < t; r++) this._list[r] = e.item(r), this._list[r]._setGridView(this._wijgrid) } else for (r = 0; r < t; r++) this._add(e.item(r)) } }, t.prototype._appendUnsafe = function (e) { this._list[this._list.length] = e, e._setGridView(this._wijgrid) }, t.prototype._insertUnsafe = function (e, t) { this._list.splice(t, 0, e) }, t.prototype._remove = function (e) { var t = this.indexOf(e); return t >= 0 ? (this._list.splice(t, 1), !0) : !1 }, t.prototype._removeAt = function (e) { this._list.splice(e, 1) }, t.prototype._getColumnsIndicies = function () { var e = [], t = this._list.length, n, r, i; if (t) { n = []; for (r = 0; r < t; r++) n[this._list[r].cellIndex()] = 1; t = n.length, i = 0; for (r = 0; r < t; r++) n[r] && (e[i++] = r) } return e }, t.prototype._getSelectedRowsIndicies = function () { var e = [], t = this._list.length, n, r, i; if (t) { n = []; for (r = 0; r < t; r++) n[this._list[r].rowIndex()] = 1; t = n.length, i = 0; for (r = 0; r < t; r++) n[r] && (e[i++] = r) } return e }, t.prototype._rectangulate = function () { var t = this._list.length, n = 4294967295, r = 4294967295, i = 0, s = 0, o, u; if (t) { for (o = 0; o < t; o++) u = this._list[o], n = Math.min(n, u.cellIndex()), r = Math.min(r, u.rowIndex()), i = Math.max(i, u.cellIndex()), s = Math.max(s, u.rowIndex()); return new e.grid.cellInfoRange(new e.grid.cellInfo(n, r), new e.grid.cellInfo(i, s)) } return null }, t }(); t.cellInfoOrderedCollection = i })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function () { function t(t) { this._gap_to_start = 10, this._inProgress = !1, this._additionalEventsAttached = !1, this._wijgrid = t, this._evntFormat = "{0}." + this._wijgrid.widgetName + ".selectionui", this._addedCells = new e.grid.cellInfoOrderedCollection(this._wijgrid), this._view = this._wijgrid._view(), this._rootElement = this._view.focusableElement(), this._visLeavesLen = this._wijgrid._field("visibleLeaves").length, this._rootElement.bind(this._eventKey("mousedown"), n.proxy(this._onGridMouseDown, this)) } return t.prototype.dispose = function () { this._rootElement.unbind(this._eventKey("mousedown"), this._onGridMouseDown), this._detachAdditionalEvents() }, t.prototype._onGridMouseDown = function (e) { if (!this._wijgrid._canInteract() || this._wijgrid.options.selectionMode.toLowerCase() === "none") return; var t = this._view.getVisibleAreaBounds(), r = { x: e.pageX, y: e.pageY }, i = e.target && e.target.tagName !== undefined ? e.target.tagName.toLowerCase() : undefined, s = n(e.target); (!i || s.is("td.wijgridtd, th.wijgridtd, div.wijmo-wijgrid-innercell")) && r.x > t.left && r.x < t.left + t.width && r.y > t.top && r.y < t.top + t.height && (this._attachAdditionalEvents(), this._startPos = r, this._startCellInfo = this._coordToDataCellInfo(this._startPos)) }, t.prototype._onDocumentMouseMove = function (t) { if (!this._startCellInfo || !this._startCellInfo._isValid()) return; var r = { x: t.pageX, y: t.pageY }, i, s, o, u, a, f, l, c, h, p, d, v, m, g, y, b = this._wijgrid._view(), w = this._wijgrid._rows(), E = e.grid.renderState; this._inProgress || (this._inProgress = Math.abs(this._startPos.x - r.x) > this._gap_to_start || Math.abs(this._startPos.y - r.y) > this._gap_to_start); if (this._inProgress) { i = this._coordToDataCellInfo(r); if (!i._isValid()) return; this._endCellInfo = i, o = new e.grid.cellInfoRange(this._startCellInfo, this._endCellInfo), o._normalize(), o._clip(this._wijgrid._getDataCellsRange()); if (o._isValid() && !o.isEqual(this._prevMouseMoveRange)) { u = this._wijgrid._getDataToAbsOffset(), this._prevMouseMoveRange = o, a = new e.grid.cellInfoOrderedCollection(this._wijgrid), f = o.bottomRight().rowIndex(), l = o.bottomRight().cellIndex(); for (c = o.topLeft().rowIndex() ; c <= f; c++) { m = b._getRowInfo(w.item(c)); if (m.type & e.grid.rowType.data) for (h = o.topLeft().cellIndex() ; h <= l; h++) a._appendUnsafe(new e.grid.cellInfo(h, c)) } g = -1; for (p = 0, d = this._addedCells.length() ; p < d; p++) s = this._addedCells.item(p), a.indexOf(s) < 0 && (this._wijgrid.selection().selectedCells().indexOf(s) < 0 && (h = this._view.getCell(s.cellIndex() + u.x, s.rowIndex() + u.y), h && (g !== s.rowIndex() && (m = s.row(), g = s.rowIndex()), v = n(h), y = b._changeCellRenderState(v, E.selected, !1), this._wijgrid.cellStyleFormatter.format(v, s.cellIndex(), s.column(), m, y))), this._addedCells._removeAt(p), p--, d--); g = -1; for (p = 0, d = a.length() ; p < d; p++) s = a.item(p), this._addedCells.indexOf(s) < 0 && this._wijgrid.selection().selectedCells().indexOf(s) < 0 && this._addedCells._add(s) && (h = this._view.getCell(s.cellIndex() + u.x, s.rowIndex() + u.y), h && (g !== s.rowIndex() && (m = s.row(), g = s.rowIndex()), v = n(h), y = b._changeCellRenderState(v, E.selected, !0), this._wijgrid.cellStyleFormatter.format(v, s.cellIndex(), s.column(), m, y))) } } }, t.prototype._onDocumentMouseUp = function (t) { this._detachAdditionalEvents(); if (this._inProgress) { this._inProgress = !1; if (this._prevMouseMoveRange && this._prevMouseMoveRange._isValid()) { this._wijgrid._changeCurrentCell(t, this._endCellInfo), (!t.shiftKey || !this._wijgrid.selection()._multipleRangesAllowed() && this._wijgrid.options.selectionMode.toLowerCase() !== "singleRange") && this._wijgrid.selection()._startNewTransaction(this._startCellInfo), this._wijgrid.selection().beginUpdate(), this._wijgrid.selection()._selectRange(this._prevMouseMoveRange, t.shiftKey, t.ctrlKey, 0, this._endCellInfo), this._wijgrid.selection().endUpdate(); var r = this._wijgrid._view(), i = this._wijgrid._getDataToAbsOffset(), s, o, u, a, f, l = -1, c, h, p = e.grid.renderState; for (s = 0, o = this._addedCells.length() ; s < o; s++) u = this._addedCells.item(s), this._wijgrid.selection().selectedCells().indexOf(u) < 0 && (a = r.getCell(u.cellIndex() + i.x, u.rowIndex() + i.y), a !== null && (l !== u.rowIndex() && (c = u.row(), l = u.rowIndex()), f = n(a), h = r._changeCellRenderState(f, p.selected, !1), this._wijgrid.cellStyleFormatter.format(f, u.cellIndex(), u.column(), c, h))); return this._addedCells._clear(), this._startCellInfo = this._endCellInfo = this._prevMouseMoveRange = null, !1 } } }, t.prototype._attachAdditionalEvents = function () { if (!this._additionalEventsAttached) try { this._view.toggleDOMSelection(!1), n(document).bind(this._eventKey("mousemove"), n.proxy(this._onDocumentMouseMove, this)).bind(this._eventKey("mouseup"), n.proxy(this._onDocumentMouseUp, this)) } finally { this._additionalEventsAttached = !0 } }, t.prototype._detachAdditionalEvents = function () { if (this._additionalEventsAttached) try { this._view.toggleDOMSelection(!0), n(document).unbind(this._eventKey("mousemove"), this._onDocumentMouseMove).unbind(this._eventKey("mouseup"), this._onDocumentMouseUp) } finally { this._additionalEventsAttached = !1 } }, t.prototype._eventKey = function (t) { return e.grid.stringFormat(this._evntFormat, t) }, t.prototype._coordToDataCellInfo = function (t) { var n = 0, r = this._visLeavesLen - 1, i = 0, s = -1, o, u = new e.grid.rowAccessor(this._view, 2, 0, 0), a, f, l, c; while (n <= r) { i = (r - n >> 1) + n, o = e.grid.bounds(this._view.getHeaderCell(i)), o || (f = u.item(0), o = e.grid.bounds(e.grid.rowAccessor.getCell(f, i))); if (!o) break; if (t.x < o.left) r = i - 1; else { if (!(t.x > o.left + o.width)) { s = i; break } n = i + 1 } } if (s === -1) return e.grid.cellInfo.outsideValue; u = new e.grid.rowAccessor(this._view, 0, 0, 0), a = -1, n = 0, r = u.length() - 1, i = 0; while (n <= r) { i = (r - n >> 1) + n, f = u.item(i), o = e.grid.bounds(e.grid.rowAccessor.getCell(f, 0)); if (t.y < o.top) r = i - 1; else { if (!(t.y > o.top + o.height)) { a = i; break } n = i + 1 } } return a === -1 ? e.grid.cellInfo.outsideValue : (l = this._wijgrid._getDataToAbsOffset(), c = new e.grid.cellInfo(s - l.x, a - l.y), c._clip(this._wijgrid._getDataCellsRange()), c) }, t }(); t.uiSelection = r })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (e) { "use strict"; var t = jQuery, n = function () { function e(e, t, n, r) { this._view = e, this._scope = t, this._offsetBottom = r, this._offsetTop = n } return e.prototype.item = function (e) { var t = this.length(); return e < t ? this._view.getJoinedRows(e + this._offsetTop, this._scope) : null }, e.prototype.length = function () { var e = this._view.getJoinedTables(!0, 0), t = 0, n; if (n = e[0]) t = n.getSectionLength(this._scope); if (n = e[1]) t += n.getSectionLength(this._scope); return t -= this._offsetTop + this._offsetBottom, t < 0 && (t = 0), t }, e.iterateCells = function (t, n, r) { if (t && n) { var i = 0, s, o, u, a, f, l; for (s = 0, o = t.length; s < o; s++) { u = t[s]; if (u) for (a = 0, f = u.cells.length; a < f; a++) { l = n(u.cells[a], i++, r); if (l !== !0) return } } } }, e.getCell = function (t, n) { var r, i; if (t && (r = t[0])) { i = r.cells.length; if (n < i) return r.cells[n]; n -= i; if (r = t[1]) { i = r.cells.length; if (n < i) return r.cells[n] } } return null }, e.cellsCount = function (t) { var n = 0, r; if (t && (r = t[0])) { n = r.cells.length; if (r = t[1]) n += r.cells.length } return n }, e }(); e.rowAccessor = n })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function () { function t() { this._timeout = 25 } return t.prototype.currentCellEditStart = function (t, r) { var i = !1, s = t.currentCell(), o = t._view(), u, a, f, l; if (s._isValid() && !s._isEdit() && s.column().dataIndex >= 0) { u = s.row(); if (u) { l = u.type; if (l & e.grid.rowType.data) { a = { cell: s, event: r, handled: !1 }; if (i = t._trigger("beforeCellEdit", null, a)) a.handled || (i = this._defaultBeforeCellEdit(t, a)); i && (s._isEdit(!0), t.options.showRowHeader && (f = n(u.$rows[0].cells[0]).children("div.wijmo-wijgrid-innercell"), f.length && (f.empty(), f.append(n("<div>&nbsp;</div>").addClass(t.options.wijCSS.icon + " ui-icon-pencil"))))) } } } return i }, t.prototype.currentCellEditEnd = function (t, r) { var i = t.currentCell(), s = !1, o = t._view(), u, a, f, l, c, h, p = e.grid.getKeyCodeEnum(); if (!i._isValid() || !i._isEdit()) return; u = i.row(); if (u) { a = u.type; if (!(a & e.grid.rowType.data)) return s; f = r && r.which === p.ESCAPE; if (!r || !f) { var d = { cell: i, value: undefined }; if (s = t._trigger("beforeCellUpdate", null, d)) { d.value === undefined && (d.value = this._getCellValue(t, i)), l = d.value; try { d.value = t._parse(i.column(), d.value), l = d.value } catch (v) { d.value = l } c = i.value(), e.grid.getDataType(d.cell.column()) === "datetime" && (l instanceof Date && (l = l.getTime()), c instanceof Date && (c = c.getTime())); if (l !== c) { try { i.value(d.value) } catch (v) { var m = { cell: i, value: d.value }; s = !1, t._trigger("invalidCellValue", null, m) } if (s) { var g = { cell: i }; t._trigger("afterCellUpdate", null, g) } } } } else s = !0; if (s) { var y = { cell: i, event: r, handled: !1 }; t._trigger("afterCellEdit", null, y), y.handled || (s = this._defaultAfterCellEdit(t, y)), s && i._isEdit(!1), t.options.showRowHeader && n(u.$rows[0].cells[0]).children("div.wijmo-wijgrid-innercell").html("&nbsp;"), window.setTimeout(function () { t._destroyed || (i = t.currentCell(), (h = i.tableCell()) ? n(h).attr("tabIndex", 0).focus() : n(t._view().focusableElement()).focus()) }, this._timeout) } } return s }, t.prototype._defaultBeforeCellEdit = function (t, r) { var i = r.cell.column(), s = !1, o, u, a, f, l, c = e.grid.getKeyCodeEnum(); if (i.dataIndex >= 0) { o = r.cell.value(), s = !0; try { u = r.cell.container(); if (e.grid.getDataType(i) === "boolean") a = u.children("input"), a.focus(), r.event && r.event.type === "keypress" && a.one("keyup", function (e) { e.which === c.SPACE && (e.preventDefault(), a[0].checked = !o) }); else { a = n("<input />").attr("type", "text").addClass("wijgridinput wijmo-wijinput " + t.options.wijCSS.stateFocus).bind("keydown", t, n.proxy(this._checkBoxOrInputKeyDown, this)), a.bind(n.support.selectstart ? "selectstart" : "mousedown", function (e) { e.stopPropagation() }); if (r.event && r.event.type === "keypress" && r.event.which) a.val(String.fromCharCode(r.event.which)); else switch (e.grid.getDataType(r.cell.column())) { case "currency": case "number": if (o !== null) { a.val(o); break }; default: a.val(t._toStr(r.cell.column(), o)) } u.empty().append(a), f = a.val().length, (new e.grid.domSelection(a[0])).setSelection({ start: f, end: f }), a.focus(), setTimeout(function () { a.focus() }, this._timeout * 2) } } catch (h) { alert(h.message), s = !1 } } return s }, t.prototype._defaultAfterCellEdit = function (t, n) { var r = n.cell.column(), i = !1, s, o, u, a, f; if (r.dataIndex >= 0) { i = !0, f = t._view(); try { s = n.cell.container(), o = t._toStr(r, n.cell.value()), a = f._getRowInfo(t._rows().item(n.cell.rowIndex())), e.grid.getDataType(r) === "boolean" ? (u = s.children("input"), o === "true" ? u.attr("checked", "checked") : u.removeAttr("checked")) : t.cellFormatter.format(s, r, o, a) } catch (l) { alert("defaultAfterCellEdit: " + l.message), i = !1 } } return i }, t.prototype._checkBoxOrInputKeyDown = function (t) { var n = e.grid.getKeyCodeEnum(); if (t.which === n.ENTER) { var r = t.data; if (r) return r._endEditInternal(t), !1 } }, t.prototype._getCellValue = function (e, t) { var n = t.container().find(":input:first"), r = null; return n.length && (r = n.attr("type") === "checkbox" ? n[0].checked : n.val()), r }, t }(); t.cellEditorHelper = r })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function () { function t() { } return t._div = document.createElement("div"), t.prototype.format = function (t, r, i, s) { s.type & e.grid.rowType.footer && (r.aggregate && r.aggregate !== "none" ? i = e.grid.stringFormat(r.footerText || "{0}", r._totalsValue || "") : i = r.footerText || r._footerTextDOM || ""); var o = !0, u = null, a = { $container: t, column: r, formattedValue: i, row: s, afterDefaultCallback: null }, f; n.isFunction(r.cellFormatter) && (o = !r.cellFormatter(a)); if (o) { switch (e.grid.getDataType(r)) { case "boolean": u = this._boolFormatter; break; default: u = this._textFormatter } u && (u.call(this, a), n.isFunction(f = a.afterDefaultCallback) && f(a)) } }, t.prototype._textFormatter = function (t) { var n; switch (t.row.type) { case e.grid.rowType.filter: this._defFormatFilterCell(t); break; default: n = t.$container[0]; if (n.firstChild) while (n.firstChild) n.removeChild(n.firstChild); e.grid.cellFormatterHelper._div.innerHTML = t.formattedValue || "&nbsp;"; while (e.grid.cellFormatterHelper._div.firstChild) n.appendChild(e.grid.cellFormatterHelper._div.firstChild) } }, t.prototype._boolFormatter = function (t) { var n, r, i = "disabled='disabled'", s, o, u = e.grid.rowType, a = e.grid.getKeyCodeEnum(); switch (t.row.type) { case u.data: case u.data | u.dataAlt: n = t.column.owner, r = n.options.allowEditing && t.column.readOnly !== !0, r && (i = ""), n._parse(t.column, n._dataViewWrapper.getValue(t.row.data, t.column.dataKey)) === !0 ? t.$container.html("<input class='wijgridinput' type='checkbox' checked='checked' " + i + " />") : t.$container.html("<input class='wijgridinput' type='checkbox' " + i + " />"), r && t.$container.children("input").bind("mousedown", function (e) { s = t.$container.parent()[0], o = n.currentCell(), o.tableCell() !== s && n._onClick({ target: s }), o._isEdit() || n.beginEdit() }).bind("keydown", function (e) { if (e.which === a.ENTER) return n._endEditInternal(e), !1 }); break; default: this._textFormatter(t) } }, t.prototype._defFormatFilterCell = function (e) { var t = e.column.owner, n = t.options.wijCSS; e.$container.addClass(n.widget + " " + n.stateDefault), e.column.dataIndex >= 0 && !e.column.isBand && e.column.showFilter ? e.$container.html('<div class="wijmo-wijgrid-filter ' + n.cornerAll + '"><input type="text" class="wijmo-wijgrid-filter-input" style="width:100%" /><a class="wijmo-wijgrid-filter-trigger ' + n.cornerRight + " " + n.stateDefault + '" href="#"><span class="' + n.icon + " " + n.iconArrowDown + '"></span></a></div>') : e.$container.html("&nbsp;") }, t }(); t.cellFormatterHelper = r })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function () { function t(e) { this._elements = [], this._gap = 10, this._step = 1, this._inProgress = !1, this._hoveredField = null, this._startLocation = null, this._lastLocation = null, this._proxy = null, this._wijgrid = e, this._evntFormat = "{0}." + this._wijgrid.widgetName + ".resizer" } return t.prototype.addElement = function (e) { e && e.element && (e.element.bind(this._eventKey("mousemove"), n.proxy(this._onMouseMove, this)).bind(this._eventKey("mousedown"), n.proxy(this._onMouseDown, this)).bind(this._eventKey("mouseout"), n.proxy(this._onMouseOut, this)), this._elements.push(e)) }, t.prototype.dispose = function () { var e = this; n.each(this._elements, function (t, n) { n.element.unbind(e._eventKey("mousemove"), e._onMouseMove).unbind(e._eventKey("mousedown"), e._onMouseDown).unbind(e._eventKey("mouseout"), e._onMouseOut) }), this._detachDocEvents() }, t.prototype.inProgress = function () { return this._inProgress }, t.prototype._onMouseMove = function (e) { if (!this._inProgress) { var t = this._getFieldByPos({ x: e.pageX, y: e.pageY }); t && t._canSize() && this._wijgrid._canInteract() ? (t.element.css("cursor", "e-resize"), this._hoveredField = t, e.stopPropagation()) : this._onMouseOut(e) } }, t.prototype._onMouseOut = function (e) { this._inProgress || this._hoveredField && (this._hoveredField.element.css("cursor", ""), this._hoveredField = null) }, t.prototype._onMouseDown = function (t) { this._hoveredField = this._getFieldByPos({ x: t.pageX, y: t.pageY }); if (this._hoveredField && this._hoveredField._canSize() && this._wijgrid._canInteract()) try { this._hoveredField.element.css("cursor", ""), this._docCursor = document.body.style.cursor, document.body.style.cursor = "e-resize", this._startLocation = this._lastLocation = e.grid.bounds(this._hoveredField.element), this._proxy = n('<div class="wijmo-wijgrid-resizehandle ' + this._wijgrid.options.wijCSS.stateHightlight + '">&nbsp;</div>'); var r = this._wijgrid._view().getVisibleAreaBounds(); this._proxy.css({ left: t.pageX, top: this._startLocation.top, height: r.height + r.top - this._startLocation.top }), n(document.body).append(this._proxy) } finally { this._attachDocEvents(), this._inProgress = !0, t.stopPropagation() } }, t.prototype._onDocumentMouseMove = function (e) { var t = this._step * Math.round((e.pageX - this._lastLocation.left) / this._step); this._lastLocation = { left: this._lastLocation.left + t, top: e.pageY, width: undefined, height: undefined }, this._proxy.css("left", this._lastLocation.left) }, t.prototype._onDocumentMouseUp = function (e) { try { document.body.style.cursor = this._docCursor, this._proxy.remove(), this._startLocation !== this._lastLocation && this._wijgrid._fieldResized(this._hoveredField, this._startLocation.width, this._lastLocation.left - this._startLocation.left) } finally { this._hoveredField = null, this._proxy = null, this._detachDocEvents(), this._inProgress = !1 } }, t.prototype._onSelectStart = function (e) { e.preventDefault() }, t.prototype._attachDocEvents = function () { this._inProgress || (n(document).bind(this._eventKey("mousemove"), n.proxy(this._onDocumentMouseMove, this)).bind(this._eventKey("mouseup"), n.proxy(this._onDocumentMouseUp, this)), n.fn.disableSelection && n(document.body).disableSelection(), "onselectstart" in document && n(document.body).bind("selectstart", this._onSelectStart)) }, t.prototype._detachDocEvents = function () { this._inProgress && (n(document).unbind(this._eventKey("mousemove"), this._onDocumentMouseMove).unbind(this._eventKey("mouseup"), this._onDocumentMouseUp), n.fn.enableSelection && n(document.body).enableSelection(), "onselectstart" in document && n(document.body).unbind("selectstart", this._onSelectStart)) }, t.prototype._getFieldByPos = function (t) { var n, r, i, s, o; for (n = 0, r = this._elements.length; n < r; n++) { i = this._elements[n], s = e.grid.bounds(i.element), o = e.grid.isOver(t.y, t.x, s.top, s.left + s.width - this._gap, s.height, this._gap); if (o) return i } return null }, t.prototype._eventKey = function (t) { return e.grid.stringFormat(this._evntFormat, t) }, t }(); t.uiResizer = r })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function () { function t(t) { this._scope_guid = "scope_" + e.grid.getUID(), this._dragEnd = !1, this._wijgrid = t, this._wijCSS = this._wijgrid.options.wijCSS, this._wrapHtml = '<div class="' + this._wijCSS.widget + " wijmo-wijgrid " + this._wijCSS.content + " " + this._wijCSS.cornerAll + '">' + '<table class="wijmo-wijgrid-root wijmo-wijgrid-table">' + '<tr class="wijmo-wijgrid-headerrow">' + "</tr>" + "</table>" + "</div>" } return t.prototype.attachGroupArea = function (e) { var t, r = this; if (!n.ui.droppable || !n.ui.draggable) return; e.droppable({ scope: this._scope_guid, tolerance: "pointer", greedy: !0, accept: function (e) { if (r._wijgrid.options.allowColMoving) { t = r._getWijFieldInstance(e); if (t) return t instanceof n.wijmo.c1groupedfield && t.options.groupedIndex === r._wijgrid._field("groupedColumns").length - 1 ? !1 : !t.options.isBand && (t.options.groupedIndex === undefined || t instanceof n.wijmo.c1groupedfield) } return !1 }, drop: function (e, n) { !r._isInElement(e, n.draggable) && (t = r._getWijFieldInstance(n.draggable)) && (r._dragEnd = !0) }, over: function (t, n) { var i = r._wijgrid._field("groupedWidgets").length; r._dropTargetRedirected = i > 0, r._droppableWijField = i > 0 ? r._wijgrid._field("groupedWidgets")[i - 1] : e, e.data("thisDroppableWijField", r._droppableWijField) }, out: function (t, n) { r._droppableWijField === e.data("thisDroppableWijField") && (r._droppableWijField = null) } }) }, t.prototype.attach = function (t) { var r, i, s = this; if (!n.ui.droppable || !n.ui.draggable) return; if (!t || !(r = t.element)) return; r.draggable({ helper: function (e) { return t instanceof n.wijmo.c1groupedfield ? r.clone().addClass("wijmo-wijgrid-dnd-helper") : r.clone().wrap(s._wrapHtml).width(r.width()).height(r.height()).closest(".wijmo-wijgrid").addClass("wijmo-wijgrid-dnd-helper") }, appendTo: "body", scope: s._scope_guid, drag: function (e, n) { s._hideArrows(); if (s._droppableWijField && !s._isInElement(e, r)) { var i = s._droppableWijField.element; i || (i = s._droppableWijField), s._showArrows(i, s._getPosition(t, s._droppableWijField, e, n)) } }, start: function (r, i) { if (s._wijgrid._canInteract() && s._wijgrid.options.allowColMoving && !s._wijgrid._field("resizer").inProgress()) { var o = t.options, u = t.options.travIdx, a = t instanceof n.wijmo.c1groupedfield, f = a ? "groupArea" : "columns"; a && (o = e.grid.search(s._wijgrid.columns(), function (e) { return e.options.travIdx === u }), o = o.found ? o.found.options : e.grid.getColumnByTravIdx(s._wijgrid.options.columns, u).found); if (t._canDrag() && s._wijgrid._trigger("columnDragging", null, { drag: o, dragSource: f })) return s._wijgrid._trigger("columnDragged", null, { drag: o, dragSource: f }), !0 } return !1 }, stop: function (e, r) { s._hideArrows(); try { s._dragEnd && (s._droppableWijField.element ? s._wijgrid._handleDragnDrop(t.options.travIdx, s._droppableWijField.options.travIdx, s._getPosition(t, s._droppableWijField, e, r), t instanceof n.wijmo.c1groupedfield, s._droppableWijField instanceof n.wijmo.c1groupedfield) : s._wijgrid._handleDragnDrop(t.options.travIdx, -1, "left", t instanceof n.wijmo.c1groupedfield, !0)) } finally { s._droppableWijField = null, s._dragEnd = !1 } } }).droppable({ hoverClass: s._wijCSS.stateHover, scope: s._scope_guid, tolerance: "pointer", greedy: !0, accept: function (e) { if (s._wijgrid.options.allowColMoving && r[0] !== e[0]) { i = s._getWijFieldInstance(e); if (i) return i._canDropTo(t) } return !1 }, drop: function (e, t) { if (i = s._getWijFieldInstance(t.draggable)) s._dragEnd = !0 }, over: function (e, n) { s._dropTargetRedirected = !1, s._droppableWijField = t, r.data("thisDroppableWijField", s._droppableWijField) }, out: function (e, n) { s._droppableWijField === t.element.data("thisDroppableWijField") && (s._droppableWijField = null) } }) }, t.prototype.detach = function (e) { var t; e && (t = e.element) && (t.data("ui-draggable") && t.draggable("destroy"), t.data("ui-droppable") && t.droppable("destroy")) }, t.prototype.dispose = function () { this._$topArrow && (this._$topArrow.remove(), this._$topArrow = null), this._$bottomArrow && (this._$bottomArrow.remove(), this._$bottomArrow = null) }, t.prototype._getWijFieldInstance = function (t) { var n = e.grid.widgetName(t); if (!n) throw "widgetName is undedined"; return t.data(n) }, t.prototype._showArrows = function (e, t) { this._topArrow().show().position({ my: "center", at: t + " top", of: e, collision: "none" }), this._bottomArrow().show().position({ my: "center", at: t + " bottom", of: e, collision: "none" }) }, t.prototype._hideArrows = function () { this._topArrow().hide(), this._bottomArrow().hide() }, t.prototype._topArrow = function () { return this._$topArrow || (this._$topArrow = n("<div />").addClass("wijmo-wijgrid-dnd-arrow-top").append(n("<span />").addClass(this._wijCSS.icon + " ui-icon-arrowthick-1-s")).hide().appendTo(document.body)), this._$topArrow }, t.prototype._bottomArrow = function () { return this._$bottomArrow || (this._$bottomArrow = n("<div />").addClass("wijmo-wijgrid-dnd-arrow-bottom").append(n("<span />").addClass(this._wijCSS.icon + " ui-icon-arrowthick-1-n")).hide().appendTo(document.body)), this._$bottomArrow }, t.prototype._isInElement = function (t, n) { var r = e.grid.bounds(n, !1); return t.pageX > r.left && t.pageX < r.left + r.width && t.pageY > r.top && t.pageY < r.top + r.height }, t.prototype._getPosition = function (t, r, i, s) { if (!r.element) return "left"; if (this._dropTargetRedirected) return "right"; var o = e.grid.bounds(r.element, !1), u = o.width / 6, a = o.left + o.width / 2, f = "right", l; return i.pageX < a && (f = "left"), r instanceof n.wijmo.c1groupedfield ? (t instanceof n.wijmo.c1groupedfield && (l = r.options.groupedIndex - t.options.groupedIndex, Math.abs(l) === 1 && (f = l < 0 ? "left" : "right")), f) : (l = r.options.linearIdx - t.options.linearIdx, r.options.isBand && t.options.parentIdx !== r.options.travIdx && Math.abs(i.pageX - a) < u ? "center" : (t.options.parentIdx === r.options.parentIdx && Math.abs(l) === 1 && (f = l < 0 ? "left" : "right"), f)) }, t }(); t.uiDragndrop = r })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function () { function t(e) { if (!e) throw "invalid arguments"; this._wijgrid = e } return t.prototype.format = function (t, r, i, s, o, u, a) { var f = e.grid.renderState, l = e.grid.rowType, c = s.type, h, p = null; r === 0 && this._wijgrid.options.showRowHeader && (i = null); if (c === l.groupHeader || c === l.groupFooter) i = null, u && (p = u.groupInfo) && (i = this._wijgrid._field("leaves")[p.leafIndex], delete u.groupInfo); h = { $cell: t, state: o, row: s, column: i, _cellIndex: r, _purpose: p ? p.purpose : undefined }, o === f.rendering ? this._renderingStateFormatter(h, u, a) : (this._currentStateFormatter(h, o & f.current), this._selectedStateFormatter(h, o & f.selected)), n.isFunction(this._wijgrid.options.cellStyleFormatter) && this._wijgrid.options.cellStyleFormatter(h) }, t.prototype._renderingStateFormatter = function (t, n, r) { var i = e.grid.rowType, s, o, u = t.column, a = t.row.type; switch (a) { case i.header: t.$cell.addClass("wijgridth"); break; default: t.$cell.addClass("wijgridtd") } if (a & i.data && u && u.textAlignment) switch (u.textAlignment.toLowerCase()) { case "left": t.$cell.addClass("wijalign-left"); break; case "right": t.$cell.addClass("wijalign-right"); break; case "center": t.$cell.addClass("wijalign-center") } if (n) for (s in n) if (n.hasOwnProperty(s)) { o = n[s]; if (!(s !== "colSpan" && s !== "rowSpan" || o > 1)) continue; s === "class" ? t.$cell.addClass(o) : t.$cell.attr(s, o) } if (r) for (s in r) if (r.hasOwnProperty(s)) { if (s === "paddingLeft") { t.$cell.children(".wijmo-wijgrid-innercell").css(s, r[s]); continue } t.$cell.css(s, r[s]) } if (t._cellIndex === 0 && this._wijgrid.options.showRowHeader) t.$cell.attr({ role: "rowheader", scope: "row" }).addClass(this._wijgrid.options.wijCSS.stateDefault + " " + this._wijgrid.options.wijCSS.content + " wijmo-wijgrid-rowheader"); else switch (a) { case i.header: t.$cell.attr({ role: "columnheader", scope: "col" }); break; case i.footer: t.$cell.attr({ role: "columnfooter", scope: "col" }); break; default: t.$cell.attr("role", "gridcell") } a & i.data && t._cellIndex >= 0 && u && (t.$cell.attr("headers", window.escape(u.headerText)), u.readOnly && t.$cell.attr("aria-readonly", !0), u.dataIndex >= 0 && t.$cell.addClass("wijdata-type-" + e.grid.getDataType(u))), (a === i.groupHeader || a === i.groupFooter) && u && t._purpose === e.grid.groupRowCellPurpose.aggregateCell && t.$cell.addClass("wijdata-type-" + e.grid.getDataType(u)) }, t.prototype._currentStateFormatter = function (t, n) { var r = e.grid.rowType; n ? (t.$cell.addClass(this._wijgrid.options.wijCSS.stateActive), t.row.type === r.header ? t.$cell.addClass("wijmo-wijgrid-current-headercell") : t.$cell.addClass("wijmo-wijgrid-current-cell")) : (t.$cell.removeClass(this._wijgrid.options.wijCSS.stateActive), t.row.type === r.header ? t.$cell.removeClass("wijmo-wijgrid-current-headercell") : t.$cell.removeClass("wijmo-wijgrid-current-cell")) }, t.prototype._hoveredStateFormatter = function (e, t) { t }, t.prototype._selectedStateFormatter = function (e, t) { t ? e.$cell.addClass(this._wijgrid.options.wijCSS.stateHightlight).attr("aria-selected", "true") : e.$cell.removeClass(this._wijgrid.options.wijCSS.stateHightlight).removeAttr("aria-selected") }, t }(); t.cellStyleFormatterHelper = r })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function () { function t(e) { if (!e) throw "invalid arguments"; this._wijgrid = e } return t.prototype.format = function (t, r, i) { var s = e.grid.renderState, o = e.grid.rowType, u = t.state, a = t; u === s.rendering ? this._renderingStateFormatter(a, r, i) : (this._currentStateFormatter(a, (u & s.current) !== 0), this._hoveredStateFormatter(a, (u & s.hovered) !== 0), this._selectedStateFormatter(a, (u & s.selected) !== 0)), n.isFunction(this._wijgrid.options.rowStyleFormatter) && this._wijgrid.options.rowStyleFormatter(a) }, t.prototype._renderingStateFormatter = function (t, r, i) { var s = "wijmo-wijgrid-row " + this._wijgrid.options.wijCSS.content, o = "wijmo-wijgrid-row " + this._wijgrid.options.wijCSS.content, u = e.grid.rowType, a; t.$rows.attr("role", "row"); if (r) for (a in r) r.hasOwnProperty(a) && (a === "class" ? t.$rows.addClass(r[a]) : (t.$rows.attr(a, r[a]), t.$rows[0].style.height && t.$rows.each(function () { return n.data(this, "customHeight", this.style.height), !0 }))); if (i) for (a in i) i.hasOwnProperty(a) && t.$rows.css(a, i[a]); switch (t.type & ~u.dataAlt) { case u.header: s = "wijmo-wijgrid-headerrow"; break; case u.data: s = o + " wijmo-wijgrid-datarow", t.type & u.dataAlt && (s += " wijmo-wijgrid-alternatingrow"); break; case u.emptyDataRow: s = o + " wijmo-wijgrid-emptydatarow"; break; case u.filter: s = "wijmo-wijgrid-filterrow"; break; case u.groupHeader: s = o + " wijmo-wijgrid-groupheaderrow"; break; case u.groupFooter: s = o + " wijmo-wijgrid-groupfooterrow"; break; case u.footer: s = "wijmo-wijgrid-footerrow " + this._wijgrid.options.wijCSS.stateHightlight; break; default: throw e.grid.stringFormat("unknown rowType: {0}", t.type) } t.$rows.addClass(s) }, t.prototype._currentStateFormatter = function (e, t) { this._wijgrid.options.showRowHeader && (t ? n(e.$rows[0].cells[0]).addClass(this._wijgrid.options.wijCSS.stateActive + " wijmo-wijgrid-current-rowheadercell") : n(e.$rows[0].cells[0]).removeClass(this._wijgrid.options.wijCSS.stateActive + " wijmo-wijgrid-current-rowheadercell")) }, t.prototype._hoveredStateFormatter = function (e, t) { t ? e.$rows.addClass(this._wijgrid.options.wijCSS.stateHover) : e.$rows.removeClass(this._wijgrid.options.wijCSS.stateHover) }, t.prototype._selectedStateFormatter = function (e, t) { t }, t }(); t.rowStyleFormatterHelper = r })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (e) { "use strict"; var t = jQuery, n = function () { function e() { this._sum = 0, this._sum2 = 0, this._cntNumbers = 0, this._cntStrings = 0, this._cntDates = 0, this._max = 0, this._min = 0, this._minDate = 0, this._maxDate = 0 } return e.prototype.add = function (e) { if (e === null || e === "") return; var t, n = e instanceof Date ? "datetime" : typeof e; t = e.toString(), this._cntStrings++ === 0 && (this._minString = this._maxString = t), t < this._minString && (this._minString = t), t > this._maxString && (this._maxString = t), n === "number" ? (this._cntNumbers++ === 0 && (this._min = this._max = e), this._sum += e, this._sum2 += e * e, e < this._min && (this._min = e), e > this._max && (this._max = e)) : n === "datetime" && (t = e.getTime(), this._cntDates++ === 0 && (this._minDate = this._maxDate = t), t < this._minDate && (this._minDate = t), t > this._maxDate && (this._maxDate = t)) }, e.prototype.getValueString = function (e) { var t = e.owner; if (!this._cntNumbers || e.dataType !== "number" && e.dataType !== "currency") { if (this._cntDates && e.dataType === "datetime") switch (e.aggregate) { case "max": return t._toStr(e, new Date(this._maxDate)); case "min": return t._toStr(e, new Date(this._minDate)); case "count": return this._cntStrings + "" } if (this._cntStrings) switch (e.aggregate) { case "max": return this._maxString; case "min": return this._minString; case "count": return this._cntStrings + "" } return "" } var n = this._getValue(e.aggregate); return t._toStr(e, n) }, e.prototype._getValue = function (e) { switch (e) { case "average": return this._cntNumbers === 0 ? 0 : this._sum / this._cntNumbers; case "count": return this._cntStrings; case "max": return this._max; case "min": return this._min; case "sum": return this._sum; case "std": if (this._cntNumbers <= 1) return 0; return Math.sqrt(this._getValue("var")); case "stdPop": if (this._cntNumbers <= 1) return 0; return Math.sqrt(this._getValue("varPop")); case "var": if (this._cntNumbers <= 1) return 0; return this._getValue("varPop") * this._cntNumbers / (this._cntNumbers - 1); case "vapPop": if (this._cntNumbers <= 1) return 0; var t = this._sum / this._cntNumbers; return this._sum2 / this._cntNumbers - t * t } return 0 }, e }(); e.tally = n })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function () { function t(t) { this._docEventsUID = "wijgridfrozener" + e.grid.getUID(), this._docEventsAttached = !1, this._newStaticIndex = -1, this._staticColumnIndex = -1, this._staticRowIndex = -1, this._staticOffsetH = 0, this._staticOffsetV = 0, this._inProgress = !1, this._wijgrid = t, this.refresh() } return t.prototype.inProgress = function () { return this._inProgress }, t.prototype.refresh = function () { this.dispose(), this._$outerDiv = this._wijgrid.outerDiv.find(".wijmo-wijgrid-fixedview"), this._superPanel = this._wijgrid._view()._getSuperPanel(), this._staticOffsetH = this._wijgrid._getStaticOffsetIndex(!1), this._staticOffsetV = this._wijgrid._getStaticOffsetIndex(!0), this._staticColumnIndex = this._wijgrid._getStaticIndex(!1), this._staticRowIndex = this._wijgrid._getStaticIndex(!0), this._visibleBounds = this._wijgrid._view().getVisibleAreaBounds(); var t = e.grid.bounds(this._$outerDiv.find(".wijmo-wijgrid-split-area-nw")), n = e.grid.bounds(this._$outerDiv); this._createVBar(this._visibleBounds, t, n), this._createHBar(this._visibleBounds, t, n) }, t.prototype.dispose = function () { this._$hBar && (this._$hBar.remove(), this._$hBar = null), this._$vBar && (this._$vBar.remove(), this._$vBar = null), this._$proxy && (this._$proxy.remove(), this._$proxy = null), this._$outerDiv = null, this._superPanel = null, this._detachDocEvents() }, t.prototype._createVBar = function (e, t, r) { var i = t.width + t.left, s = this; i <= e.left + e.width && (this._$vBar = n("<div><div></div></div>").addClass("wijmo-wijgrid-frozener-v").css({ left: i - r.left, top: t.top - r.top, height: e.height + e.top - t.top }).bind("mousedown", function (e) { e.data = !0, s._onBarMouseDown.apply(s, arguments) }).appendTo(this._$outerDiv), this._$vBar.find("div").addClass(this._wijgrid.options.wijCSS.header).css({ width: 0, height: "100%" })) }, t.prototype._createHBar = function (e, t, r) { var i = t.top + t.height, s = this; i <= e.top + e.height && (this._$hBar = n("<div><div></div></div>").addClass("wijmo-wijgrid-frozener-h").css({ left: t.left - r.left, top: i - r.top, width: e.width + e.left - t.left }).bind("mousedown", function (e) { e.data = !1, s._onBarMouseDown.apply(s, arguments) }).appendTo(this._$outerDiv), this._$hBar.find("div").addClass(this._wijgrid.options.wijCSS.header).css({ width: "100%", height: 0 })) }, t.prototype._onBarMouseDown = function (e) { this._visibleBounds = this._wijgrid._view().getVisibleAreaBounds(), this._newStaticIndex = e.data ? this._staticColumnIndex : this._staticRowIndex, this._$proxy = n('<div class="wijmo-wijgrid-resizehandle ' + this._wijgrid.options.wijCSS.header + '"></div>').appendTo(document.body), this._attachDocEvents(e.data), this._inProgress = !0, e.stopPropagation() }, t.prototype._onDocumentMouseMove = function (e) { e.data && this._superPanel.options.hScroller.scrollValue ? this._superPanel.hScrollTo(0) : !e.data && this._superPanel.options.vScroller.scrollValue && this._superPanel.vScrollTo(0), this._showPosition(e) }, t.prototype._onDocumentMouseUp = function (e) { try { this._$proxy && this._$proxy.remove(), this._detachDocEvents(), e.data ? this._newStaticIndex !== this._staticColumnIndex && this._wijgrid.option("staticColumnIndex", this._newStaticIndex) : this._newStaticIndex !== this._staticRowIndex && this._wijgrid.option("staticRowIndex", this._newStaticIndex) } finally { this._$proxy = null, this._inProgress = !1 } }, t.prototype._attachDocEvents = function (e) { if (!this._docEventsAttached) try { n.fn.disableSelection && n(document.body).disableSelection(), this._wijgrid._view().toggleDOMSelection(!1), n(document).bind(this._docEventKey("mousemove"), e, n.proxy(this._onDocumentMouseMove, this)).bind(this._docEventKey("mouseup"), e, n.proxy(this._onDocumentMouseUp, this)) } finally { this._docEventsAttached = !0 } }, t.prototype._detachDocEvents = function () { if (this._docEventsAttached) try { n.fn.enableSelection && n(document.body).enableSelection(), this._wijgrid._view().toggleDOMSelection(!0), n(document).unbind("." + this._docEventsUID) } finally { this._docEventsAttached = !1 } }, t.prototype._docEventKey = function (t) { return e.grid.stringFormat("{0}.{1}", t, this._docEventsUID) }, t.prototype._showPosition = function (t) { var n, r, i, s, o, u, a, f; if (t.data) { f = e.grid.bounds(this._$vBar); if (Math.abs(t.pageX - (f.left + f.width / 2)) < f.width) { this._$proxy.hide(); return } if (n = this._getFieldByPos({ x: t.pageX, y: t.pageY })) { r = e.grid.bounds(n.element), i = r.left + r.width / 2, s = n.options.visLeavesIdx - this._staticOffsetV, o = Math.max(s - 1, -1), u = t.pageX < i ? o !== this._staticColumnIndex : s === this._staticColumnIndex, a = u ? r.left : r.left + r.width; if (!e.grid.isOverAxis(a, this._visibleBounds.left - 1, this._visibleBounds.width + 2)) return; this._newStaticIndex = u ? o : s, this._$proxy.show().css({ left: a, top: r.top, width: 3, height: this._visibleBounds.height + this._visibleBounds.top - r.top }) } } else { f = e.grid.bounds(this._$hBar); if (Math.abs(t.pageY - (f.top + f.height / 2)) < f.height) { this._$proxy.hide(); return } if (n = this._getRowByPos({ x: t.pageX, y: t.pageY })) { r = e.grid.bounds(n), i = r.top + r.height / 2, s = this._wijgrid._view().getAbsoluteRowIndex(n) - this._staticOffsetH, o = Math.max(s - 1, -1), u = t.pageY < i ? o !== this._staticRowIndex : s === this._staticRowIndex, a = u ? r.top : r.top + r.height; if (!e.grid.isOverAxis(a, this._visibleBounds.top - 1, this._visibleBounds.height + 2)) return; this._newStaticIndex = u ? o : s, this._$proxy.show().css({ left: r.left, top: a, width: this._visibleBounds.width + this._visibleBounds.left - r.left, height: 3 }) } } }, t.prototype._getFieldByPos = function (t) { var n = this._wijgrid.columns(), r, i, s, o, u; for (r = 0, i = n.length; r < i; r++) { s = n[r], o = s.options; if (o.isLeaf) { u = e.grid.bounds(s.element); if (e.grid.isOverAxis(t.x, u.left, u.width)) return s } } return null }, t.prototype._getRowByPos = function (t) { var r = this._wijgrid._rows(), i, s, o, u; for (i = 0, s = r.length() ; i < s; i++) { o = r.item(i)[0], u = e.grid.bounds(n(o)); if (e.grid.isOverAxis(t.y, u.top, u.height)) return o } return null }, t }(); t.uiFrozener = r })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { "use strict"; var n = jQuery, r = function () { function t() { } return t.generate = function (r, i, s) { switch (r) { case "append": t._processAppendMode(i, s); break; case "merge": t._processMergeMode(i, s); break; case "none": break; default: throw e.grid.stringFormat('Unsupported value: "{0}"', r) } }, t._processAppendMode = function (i, s) { var o = {}; e.grid.traverse(s, function (t) { t.dynamic && e.grid.validDataKey(t.dataKey) && (o[t.dataKey] = !0) }), n.each(i, function (e, n) { if ("name" in n && !o[n.name]) { var r = t._createAutoField(n); s.push(r) } }) }, t._processMergeMode = function (i, s) { var o = [], u; e.grid.traverse(s, function (t) { if (t.isLeaf && !t.isBand) { var n = t.dataKey; e.grid.validDataKey(n) ? i[n] !== undefined && delete i[n] : n !== null && o.push(t) } }), o.length && (u = 0, n.each(i, function (e, t) { var n = o[u++]; n && (n.dataKey = t.name, delete i[e]) })), n.each(i, function (e, n) { var r = t._createAutoField(n); s.push(r) }) }, t._createAutoField = function (n) { return e.grid.createDynamicField({ dataKey: n.name }) }, t }(); t.columnsGenerator = r })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (e) { "use strict"; var t = jQuery, n = function () { function e(e, t, n) { this._timer = 0, this._timeout = 50, this._ignoreScrollEvents = !1, this._wijgrid = e, this._fixedAreaHeight = n, this._view = this._wijgrid._view(), this._N = this._wijgrid._totalRowsCount(); var r = 20, i = this._wijgrid.outerDiv.height() + this._N * r; t.height(i - n - (this._N > 0 ? r : 0)), this._view._splitAreas.sw.height(i) } return e.prototype.attach = function (e) { this._$scroller = e, this._panelInst = e.data("wijmo-wijsuperpanel"); var n, r = e.find(".wijmo-wijsuperpanel-contentwrapper:first"), i = this._panelInst.getContentElement().height(), s = this._fixedAreaHeight + i, o = r.innerHeight(), u = 101 / (this._N - 1) * ((s - o) / s); n = this._panelInst.options.vScroller, n.scrollSmallChange = u, this._panelInst.option("vScroller", n), e.bind("wijsuperpanelscrolled.wijgrid", t.proxy(this._onSuperpanelScrolled, this)), e.bind("wijsuperpanelscrolling.wijgrid", t.proxy(this._onSuperpanelScrolling, this)), e.bind("wijsuperpanelscrolled.wijgrid", t.proxy(this._onSuperpanelPostScrolled, this)) }, e.prototype.dispose = function () { this._$scroller.unbind(".wijgrid"), this._clearTimer() }, e.prototype._clearTimer = function () { window.clearTimeout(this._timer), this._timer = 0 }, e.prototype._onSuperpanelScrolling = function (e, t) { if (this._ignoreScrollEvents || t.dir !== "v") return; if (this._timer === -1) return !1 }, e.prototype._onSuperpanelScrolled = function (e, n) { var r = this; if (this._ignoreScrollEvents || n.dir !== "v") return; this._timer > 0 && this._clearTimer(), this._timer !== -1 && (this._timer = window.setTimeout(function () { r._timer = -1; var e = Math.round(n.newValue / r._panelInst.options.vScroller.scrollSmallChange), i = r._view._bounds.start; e < 0 && (e = 0), e >= r._N && (e = r._N - 1), e !== i ? r._wijgrid._handleVirtualScrolling(e, t.proxy(r._scrollingCompleted, r)) : (r._log(), r._clearTimer()) }, this._timeout)) }, e.prototype._scrollingCompleted = function (e) { this._wijgrid._trackScrollingIndex(e), this._log(), this._clearTimer() }, e.prototype._onSuperpanelPostScrolled = function () { t.isFunction(this._postScrolled) && this._postScrolled.apply(this, arguments) }, e.prototype._log = function () { }, e }(); e.uiVirtualScroller = n })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (e) { function r(n, r, i, s) { function u(t) { return s.parser = s.parser || e.defaultParsers[t], !s.parser && n != null && e.errors.noParser(t), s.parser } var o = n; s = t.extend({ nullString: "", format: "" }, s), r = r || n != null && typeof n, i = i || r; if (!i) return n; if (i == "string") return u(r), s.parser ? s.parser.toStr(n, s.culture, s.format, s.nullString, !0) : n; u(i); if (!s.parser) return n; n = s.parser.parse(n, s.culture, s.format, s.nullString, !0); if (isNaN(n) && n != null && e.util.isNumeric(n)) { if (s.ignoreError) return o; e.errors.cantConvert(i, o) } return n } function i(t) { return function () { return n || e.util.logError(e.errors.noGlobalize.create().message), t.apply(this, arguments) } } var t = jQuery, n = Globalize; e.convert = r, e.defaultParsers = { string: { parse: function (e, t, n, r, i) { switch (e) { case null: return null; case r: if (i) return null; case undefined: case "&nbsp": return ""; default: return "" + e } }, toStr: function (e, t, n, r, i) { return e === null && i ? r : "" + e } }, number: { parse: function (e, t, r, i, s) { var o = typeof e; return o === "number" ? isNaN(e) ? NaN : e : !e && e !== 0 || e === "&nbsp;" || e === i && s ? null : n.parseFloat(e, 10, t.name) }, toStr: function (e, t, r, i, s) { return e === null && s ? i : n.format(e, r ? r : "n", t.name) } }, currency: { parse: function (e, t, r, i, s) { var o = typeof e; return o === "number" ? isNaN(e) ? NaN : e : !e && e !== 0 || e === "&nbsp;" || e === i && s ? null : (o === "string" && (e = e.replace(t.numberFormat.currency.symbol, "")), n.parseFloat(e, 10, t.name)) }, toStr: function (e, t, r, i, s) { return e === null && s ? i : n.format(e, r ? r : "c", t.name) } }, datetime: { parse: function (e, t, r, i, s) { var o; if (e instanceof Date) return e; if (!e || e === "&nbsp;" || e === i && s) return null; o = /^\/Date\((\d+)\)\/$/.exec(e); if (o) return new Date(parseInt(o[1], 10)); var u = n.parseDate(e, r, t.name); if (u == null || isNaN(u)) u = Date.parse(e), u = isNaN(u) ? NaN : new Date(u); return u }, toStr: function (e, t, r, i, s) { return e === null && s ? i : n.format(e, r ? r : "d", t.name) } }, "boolean": { parse: function (e, n, r, i, s) { var o = typeof e; if (o === "number") return e != 0; if (o === "boolean") return e; o === "string" && (e = t.trim(e)); if (!e || e === "&nbsp;" || e === i && s) return null; switch (e.toLowerCase()) { case "true": return !0; case "false": return !1 } return NaN }, toStr: function (e, t, n, r, i) { return e === null && i ? r : e ? "true" : "false" } } }, t.each(e.defaultParsers, function (e, t) { t.parse = t.parse && i(t.parse), t.toStr = t.toStr && i(t.toStr) }) })(e.data || (e.data = {})); var t = e.data })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (e) { (function (t) { (function (n) { function r(r) { function i(r) { var s = []; if (r.length === 0) return s; var o = n.Connective.AND; return e.util.each(r, function (r, u) { if (r == 0 && e.util.isString(u)) { var a = u.toLowerCase(); if (a == n.Connective.AND || a == n.Connective.OR) { o = a; return } } if ($.isArray(u)) { u = i(u); if (!u) return; if (u[0] === o || u.length == 2) { u.shift(), s = s.concat(u); return } } else { var f = t.normalizeCondition(u); if (!f) return; f.property = u.property, u = f } s.push(u) }), s.length == 0 ? null : (s.unshift(o), s) } return i(r) } function i(t) { if (!$.isArray(t)) return null; var i = { original: t, normalized: r(t), func: null }; return i.normalized == null ? i.func = function (e) { return !0 } : i.func = function (t) { function r(i) { var s = i[0] === n.Connective.AND, o = s ? e.util.every : e.util.some; return o(i, function (n, i) { if (i === 0) return s; if ($.isArray(n)) return r(n); var o = e.util.getProperty(t, n.property); return n.op.apply(o, n.value) }) } return r(i.normalized) }, i } function s(t) { return i(t) || e.filtering.compile(t) } n.Connective = { AND: "and", OR: "or" }, n.compile = s })(t.extended || (t.extended = {})); var n = t.extended })(e.filtering || (e.filtering = {})); var t = e.filtering })(e.data || (e.data = {})); var t = e.data })(wijmo || (wijmo = {})); var wijmo; (function (e) { (function (t) { var n = jQuery, r = e.data, i = r.filtering.extended, s = function () { function e(e) { this.real = e, this._updatingFilter = !1, this._overrideFilter(), this._makeMemberProxies() } return e.prototype._overrideFilter = function () { var e = this; this.filter = r.observable(this.real.filter()), this.filter.subscribe(function (t) { e.real.filter() !== t && !e._updatingFilter && e.refresh({ filter: t }) }), this.real.filter.subscribe(function (t) { t !== e._lastSetFilter && e.filter(t) }) }, e.prototype.refresh = function (e, t) { typeof t == "undefined" && (t = !1), e = n.extend({}, e); var r = e.filter; e.filter = this._coerceFilter(e.filter), this._lastSetFilter = e.filter, this._updatingFilter = !0; try { n.isFunction(e.filter) && !n.isFunction(r) ? this.filter(r) : this.filter(e.filter) } finally { this._updatingFilter = !1 } return this.real.refresh(e, t) }, e.prototype._makeMemberProxies = function () { var e = this; r.util.each(this.real, function (t, r) { if (!n.isFunction(r) || e[t] || t.charAt(0) === "_") return; e[t] = n.isFunction(r.subscribe) ? r : function () { return r.apply(e.real, arguments) } }) }, e.create = function (n) { return new e(n) }, e.prototype._convertComplexPropertyFilterToExtendedFilterFormat = function (e) { var t = []; return n.each(e, function (e, s) { if (!n.isArray(s)) s = [s]; else { var o = r.util.isString(s[0]) && s[0].toLowerCase(); if (o === i.Connective.AND || o === i.Connective.OR) { t.push(s); return } } var u = []; n.each(s, function (t, n) { var i = r.filtering.normalizeCondition(n); i && (i.property = e, u.push(i)) }), u.length > 0 && t.push(u) }), t.length > 0 ? t : null }, e.prototype._coerceFilter = function (e) { if (n.isArray(e)) return i.compile(e).func; if (!n.isPlainObject(e)) return e; e = n.extend(!0, {}, e); var t = {}; n.each(e, function (i, s) { n.isArray(s) || (s = [s]); if (t) { var o = r.util.isString(s[0]) && s[0].toLowerCase(); if (s.length == 1 || s.length == 2 && (o === "and" || o === "or")) { t[i] = s[s.length - 1]; return } } e[i] = s, t = null }); if (t) return t; var s = this._convertComplexPropertyFilterToExtendedFilterFormat(e); return i.compile(s).func }, e.prototype._unsafeReplace = function (e, t) { this.real.sourceArray[e] = t, this.real.local[e] = t }, e.prototype._unsafeSplice = function (e, t, n) { arguments.length === 2 ? (this.real.sourceArray.splice(e, t), this.real.local.splice(e, t)) : (this.real.sourceArray.splice(e, t, n), this.real.local.splice(e, t, n)) }, e.prototype._unsafePush = function (e) { this.real.sourceArray.push(e), this.real.local.push(e) }, e }(); t.GridDataView = s })(e.grid || (e.grid = {})); var t = e.grid })(wijmo || (wijmo = {}));;
var wijmo; (function (e) { var t = jQuery, n = function () { function e() { } return e.prototype.round = function (e, t) { return e ? Globalize.parseFloat(e.toFixed(t), 10, Globalize.culture("en")) : 0 }, e.prototype.toOADate = function (e) { var t = 864e5, n = e - new Date(1900, 0, 1) + 2 * t; return n }, e.prototype.fromOADate = function (e) { var t = 864e5, n = new Date(e - 2 * t + (new Date(1900, 0, 1)).getTime()); return n }, e.prototype.arrayClone = function (e) { var n = []; return t.each(e, function (e, r) { n.push(t.extend(!0, {}, r)) }), n }, e }(), r = function () { function e() { } return e.prototype.isSVGElem = function (e) { var t = "http://www.w3.org/2000/svg"; return e.nodeType === 1 && e.namespaceURI === t }, e.prototype.addClass = function (e, n) { n = n || ""; var r = this; t.each(e, function () { if (r.isSVGElem(this)) { var e = this; t.each(n.split(/\s+/), function (n, r) { var i = e.className ? e.className.baseVal : e.getAttribute("class"); t.inArray(r, i.split(/\s+/)) === -1 && (i += (i ? " " : "") + r, e.className ? e.className.baseVal = i : e.setAttribute("class", i)) }) } else t(this).addClass(n) }) }, e.prototype.clearRaphaelCache = function () { }, e.prototype.getPositionByAngle = function (e, t, n, r) { var i = { x: 0, y: 0 }, s = Raphael.rad(r); return i.x = e + n * Math.cos(-1 * s), i.y = t + n * Math.sin(-1 * s), i }, e.prototype.hasClass = function (e, n) { if (!n || n.length === 0) return !1; if (this.isSVGElem(e)) { var r = e.className ? e.className.baseVal : e.getAttribute("class"), i = !1; return t.each(r.split(/\s+/), function (e, t) { if (t === n) return i = !0, !1 }), i } return t(e).hasClass(n) }, e.prototype.sector = function (e, t, n, r, i) { var s = this.getPositionByAngle(e, t, n, r), o = this.getPositionByAngle(e, t, n, i); return ["M", e, t, "L", s.x, s.y, "A", n, n, 0, +(i - r > 180), 0, o.x, o.y, "z"] }, e }(); t.extend(n.prototype), t.extend({ wijraphael: r.prototype }); var i = "[\\x20\\t\\r\\n\\f]", s = t.expr.filter.CLASS; t.expr.filter.CLASS = function (e, n) { if (parseFloat(t.fn.jquery) < 1.8) { var r = !t.wijraphael || !t.wijraphael.isSVGElem(e) ? e.className : e.className ? e.className.baseVal : e.getAttribute("class"); return (" " + r + " ").indexOf(n) > -1 } var s = new RegExp("(^|" + i + ")" + e + "(" + i + "|$)"); return function (e) { var n = !t.wijraphael || !t.wijraphael.isSVGElem(e) ? e.className : e.className ? e.className.baseVal : e.getAttribute("class"); return s.test(n) } }, parseFloat(t.fn.jquery) < 1.8 && (t.expr.preFilter.CLASS = function (e, n, r, i, s, o) { var u = 0, a = null, f = null; e = " " + e[1].replace(/\\/g, "") + " "; if (o) return e; for (u = 0, a = {}; a; u++) { a = n[u]; if (!a) try { a = n.item(u) } catch (l) { } a && (f = !t.wijraphael || !t.wijraphael.isSVGElem(a) ? a.className : (a.className ? a.className.baseVal : "") || a.getAttribute("class"), s ^ (f && (" " + f + " ").indexOf(e) > -1) ? r || i.push(a) : r && (n[u] = !1)) } return !1 }), Raphael.fn.tri = function (e, t, n) { var r = e, i = t - n, s = Math.cos(30 * Math.PI / 180) * n, o = Math.tan(60 * Math.PI / 180) * s, u = e + s, a = t + o, f = e - s, l = t + o, c = ["M", r.toString(), i.toString(), "L", u.toString(), a.toString(), "L", f.toString(), l.toString(), "z"]; return this.path(c.join(" ")) }, Raphael.fn.invertedTri = function (e, t, n) { var r = e, i = t + n, s = Math.cos(30 * Math.PI / 180) * n, o = Math.tan(60 * Math.PI / 180) * s, u = e + s, a = t - o, f = e - s, l = t - o, c = ["M", r.toString(), i.toString(), "L", u.toString(), a.toString(), "L", f.toString(), l.toString(), "z"]; return this.path(c.join(" ")) }, Raphael.fn.box = function (e, t, n) { var r = Math.cos(45 * Math.PI / 180) * n, i = ["M", e - r, t - r, "L", e + r, t - r, "L", e + r, t + r, "L", e - r, t + r, "z"]; return this.path(i.join(" ")) }, Raphael.fn.diamond = function (e, t, n) { var r = ["M", e, t - n, "L", e + n, t, "L", e, t + n, "L", e - n, t, "z"]; return this.path(r.join(" ")) }, Raphael.fn.cross = function (e, t, n) { var r = Math.cos(45 * Math.PI / 180) * n, i = ["M", e - r, t - r, "L", e + r, t + r, "M", e - r, t + r, "L", e + r, t - r]; return this.path(i.join(" ")) }, Raphael.fn.paintMarker = function (e, t, n, r) { var i = this, s = null; e || (e = "circle"); switch (e) { case "circle": s = i.circle(t, n, r); break; case "tri": s = i.tri(t, n, r); break; case "invertedTri": s = i.invertedTri(t, n, r); break; case "box": s = i.box(t, n, r); break; case "diamond": s = i.diamond(t, n, r); break; case "cross": s = i.cross(t, n, r) } return s }, Raphael.fn.htmlText = function (e, n, r, i, s, o) { var u = function (e, t, n) { var r = /<(b|strong)>/, i = /<(i|em)>/, s = /href=[\"\']([^\"\']+)[\"\']/, o = /<a/; n && e.attr(n), r.test(t) && e.attr("font-weight", "bold"), i.test(t) && e.attr("font-style", "italic"), o.test(t) && t.match(s)[1] && e.attr("href", t.match(s)[1]) }, a = r.toString().split(/<br\s?\/>|\\r/i), f = this, l = f.set(), c = 0, h = 0; return s = s || 3, o = o || 5, t.each(a, function (e, n) { var r = 0, a = n.split("|||"); n = n.replace(/<([A-Za-z]+(.|\n)*?)>/g, "|||<$1>").replace(/<\/([A-Za-z]*)>/g, "</$1>|||"), t.each(a, function (e, n) { var o = null, a = null, p = 0, d, v = 0; n !== "" && (o = n, o = t.trim(o.replace(/<(.|\n)*?>/g, "")), d = f.text(0, 0, o), u(d, n, i), a = d.wijGetBBox(), p = a.width / 2 + c, v = -a.height / 2 + h, c = c + a.width + s, d.translate(p, v), l.push(d), r < a.height && (r = a.height)) }), h += r + o, c = r = 0 }), h = 0, l.transform(Raphael.format("...t{0},{1}", e - l.getBBox().x, n - l.getBBox().y)), l }, Raphael.fn.line = function (e, t, n, r) { return this.path(["M", e.toString(), t.toString(), "L", n.toString(), r.toString()]) }, Raphael.fn.roundRect = function (e, n, r, i, s, o, u, a) { var f = [], l = [-1, 1, 1, 1, 1, -1, -1, -1], c = ["v", "h", "v", "h"], h = null, p = null; return t.each([s, o, u, a], function (e, t) { typeof t == "number" ? f = f.concat([{ x: t, y: t }]) : typeof t == "object" ? f = f.concat(t) : f = f.concat([{ x: 0, y: 0 }]) }), h = ["M", e + f[0].x, n], p = [i - f[0].y - f[1].y, r - f[1].x - f[2].x, f[2].y + f[3].y - i, f[3].x + f[0].x - r], t.each(f, function (e, t) { t.x && t.y && (h = h.concat("a", t.x, t.y, 0, 0, 0, l[2 * e] * t.x, l[2 * e + 1] * t.y)), h = h.concat(c[e], p[e]) }), h.push("z"), this.path(h) }, Raphael.fn.wrapText = function (e, n, r, i, s, o) { function v(e, t, n) { var r = null, i = null, s = e.toString().split(" "), o = [], a = [], f = ""; while (s.length) f += " " + s[0], r = u.text(-1e3, -1e3, f), r.attr(n), i = r.wijGetBBox(), i.width > t ? (a.length && (o.push(a), f = s[0]), a = [s.shift()]) : a.push(s.shift()), s.length === 0 && o.push(a), r.wijRemove(), r = null; return o } var u = this, a = o.rotation, f = a ? t.extend(!0, {}, o, { rotation: 0 }) : o, l = n, c = u.set(), h = null, p = null, d = []; return typeof r == "undefined" && (r = ""), t.each(v(r, i, f), function (t, n) { var r = n.join(" "), o = s || "near", p = u.text(e, l, r), v = 0, m = 0; p.attr(f), h = p.wijGetBBox(); switch (o) { case "near": v = i - h.width / 2; break; case "center": v += i / 2; break; case "far": v += h.width / 2 } a ? (m += h.height / 2 / Math.abs(Math.sin(a)), l += h.height / Math.abs(Math.sin(a))) : (m += h.height / 2, l += h.height), h.x += v, h.y += m, a ? p.attr({ x: p.attr("x") + v, y: p.attr("y") + m }) : p.transform(Raphael.format("...T{0},{1}", v, m)), c.push(p), d.push(h) }), a && (h = c.wijGetBBox(), c.length > 1 ? (t.each(c, function (e, t) { t.attr({ y: t.attr("y") - h.height / 2 }), d[e].y -= h.height / 2 }), p = { x: h.x + h.width / 2, y: h.y + h.height / 2 }, t.each(c, function (e, n) { var r = Math, i = d[e], s = { x: i.x + i.width / 2, y: i.y + i.height / 2 }, o = r.sqrt(r.pow(s.x - p.x, 2) + r.pow(s.y - p.y, 2)), u = 0, f = null, l = null; n.attr({ rotation: a }); if (o === 0) return !0; f = n.wijGetBBox(), u = Raphael.deg(r.asin(r.abs(s.y - p.y) / o)), s.y > p.y ? s.x > p.x ? u -= 360 : u = -1 * (u + 180) : s.x > p.x ? u *= -1 : u = -1 * (180 - u), l = t.wijraphael.getPositionByAngle(p.x, p.y, o, -1 * (a + u)), n.attr({ y: n.attr("y") + l.y - f.y - f.height / 2 }) })) : c[0].transform(Raphael.format("...R{0}", a))), c }, Raphael.fn.getSVG = function () { function e(e, n) { var r = "<" + e + " ", i = null, s = !1; return t.each(n, function (e, t) { if (e === "text" || e === "opacity" || e === "transform" || e === "path" || e === "w" || e === "h" || e === "translation") return !0; t && (e === "stroke" && t === 0 && (t = "none"), r += e + "='" + t + "' ") }), n.opacity && (i = n.opacity, r += "opacity='" + i + "' style='opacity:" + i + ";", s = !0), n.transform && n.transform.length > 0 && (i = n.transform, s ? r += "transform:" + i : (r += "style='transform:" + i, s = !0)), s && (r += "'"), n.text ? (i = n.text, r += "><tspan>" + i + "</tspan>") : r += ">", r += "</" + e + ">", r } var n = this, r = '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="' + n.canvas.offsetWidth + '" height="' + n.canvas.offsetHeight + '"><desc>Created with Raphael</desc><defs></defs>', i, s = "", o, u, a, f = 0, l = 0, c = 0, h = 0; for (i = n.bottom; i; i = i.next) if (i && i.type) switch (i.type) { case "path": for (f = 0, l = i.attrs.path.length; f < l; f++) { u = i.attrs.path[f]; for (c = 0, h = u.length; c < h; c++) a = u[c], c < 1 ? s += a : c === h - 1 ? s += a : s += a + "," } s && s.length > 0 && (i.attrs.d = s.replace(/,/g, " ")); break; case "text": i.attrs["text-anchor"] || (i.attrs["text-anchor"] = "middle"); break; case "image": o = i.transformations, i.attrs.transform = o ? o.join(" ") : ""; break; case "ellipse": case "rect": r += e(i.type, i.attrs) } return r += "</svg>", r }, Raphael.el.wijRemove = function () { var e = this, n; if (e.removed) return; e.node.parentNode && (n = t(e.node), e.stop().remove(), n.remove()) }, Raphael.el.wijGetBBox = function () { return this.getBBox() }, Raphael.el.wijAnimate = function (e, n, r, i) { if (!e || t.isEmptyObject(e)) return; var s = this.shadow, o = 0, u = { easeInCubic: ">", easeOutCubic: "<", easeInOutCubic: "<>", easeInBack: "backIn", easeOutBack: "backOut", easeOutElastic: "elastic", easeOutBounce: "bounce" }; u[r] && (r = u[r]), this.animate(e, n, r, i), u = null, s && s.offset && (o = s.offset, e.x && (e.x += o), e.y && (e.y += o), this.shadow.animate(e, n, r, i)) }, Raphael.el.wijAttr = function (e, n) { this.attr(e, n); if (this.shadow) if (typeof e == "object") { var r = t.extend(!0, {}, e); r.fill && delete r.fill, r.stroke && delete r.stroke, r["stroke-width"] && delete r["stroke-width"], this.shadow.attr(r, n) } else if (typeof e == "string") switch (e) { case "clip-rect": case "cx": case "cy": case "fill-opacity": case "font": case "font-family": case "font-size": case "font-weight": case "height": case "opacity": case "path": case "r": case "rotation": case "rx": case "ry": case "scale": case "stroke-dasharray": case "stroke-linecap": case "stroke-linejoin": case "stroke-miterlimit": case "stroke-opacity": case "stroke-width": case "translation": case "width": this.shadow.attr(e, n); break; case "x": this.shadow.attr(e, n), this.shadow.attr("transform", "...t1,0"); break; case "y": this.shadow.attr(e, n), this.shadow.attr("transform", "...t0,1"); break; default: } }, Raphael.st.wijRemove = function () { t.each(this, function (e, t) { t.wijRemove && !t.removed && t.wijRemove() }) }, Raphael.st.wijAttr = function (e, n) { return t.each(this.items, function (t, r) { r.wijAttr(e, n) }), this }, Raphael.st.wijAnimate = function (e, t, n, r) { var i = 0, s = 0, o = null; for (i = 0, s = this.items.length; i < s; i++) o = this.items[i], o.removed || o.wijAnimate(e, t, n, r); return this }, Raphael.st.wijGetBBox = function () { var e = [], t = [], n = [], r = [], i, s, o = Math.max, u = Math.min, a = "push", f = "apply", l = null, c = 0; for (c = this.items.length - 1; c >= 0; c--) l = this.items[c].wijGetBBox(), e[a](l.x), t[a](l.y), n[a](l.x + l.width), r[a](l.y + l.height); return i = u[f](0, e), s = u[f](0, t), { x: i, y: s, x2: undefined, y2: undefined, width: o[f](0, n) - i, height: o[f](0, r) - s } }; var o = Raphael.el.attr; Raphael.el.attr = function (e, n) { return t.isPlainObject(e) && t.each(e, function (t, n) { (t === "width" || t === "height" || t === "r") && !isNaN(n) && n < 0 && (e[t] = 0) }), (e === "width" || e === "height" || e === "r") && !isNaN(n) && n < 0 && (n = 0), o.apply(this, arguments) } })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { var t = jQuery, n = function () { function e() { } return e.getDiffAttrs = function (n, r) { var i = {}; return t.each(r, function (e, t) { if (typeof n == "undefined") return !0; typeof n[e] == "undefined" ? i[e] = r[e] : n[e] !== r[e] && (i[e] = r[e]) }), i }, e.paintShadow = function (n, r, i) { if (n.removed || t(n.node).parent().length === 0) return; var s = n.clone(), o = r || 1, u = i || "#cccccc"; s.insertBefore(n), s.attr({ transform: Raphael.format("...T{0},{1}", o, o), stroke: u, "stroke-width": o }), s.toBack(), s.offset = o, n.shadow = s }, e.getScaling = function (t, n, r, i) { var s = n - r; return s === 0 && (s = 1), t && (s = -s), i / s }, e.getTranslation = function (t, n, r, i, s) { var o = 0; return t ? (o = n.y, o -= s * r) : (o = n.x, o -= s * i), o }, e.getXSortedPoints = function (n) { function a(e, t) { return e - t } var r = n.data.x, i = [].concat(r), s = [].concat(n.data.y), o = [], u = r; if (r === undefined || r.length === 0) return; return typeof r[0] == "number" && (u = [].concat(r).sort(a)), t.each(u, function (e, n) { t.each(i, function (t, r) { if (n === r) return typeof r != "number" && (r = e), o.push({ x: r, y: s[t] }), i.splice(t, 1), s.splice(t, 1), !1 }) }), o }, e.sector = function (n, r, i, s, o) { var u = t.wijraphael.getPositionByAngle(n, r, i, s), a = t.wijraphael.getPositionByAngle(n, r, i, o); return ["M", n, r, "L", u.x, u.y, "A", i, i, 0, +(o - s > 180), 0, a.x, a.y, "z"] }, e.donut = function (n, r, i, s, o, u) { var a = t.wijraphael.getPositionByAngle(n, r, i, o), f = t.wijraphael.getPositionByAngle(n, r, i, u), l = t.wijraphael.getPositionByAngle(n, r, s, o), c = t.wijraphael.getPositionByAngle(n, r, s, u), h = u - o > 180; return ["M", a.x, a.y, "A", i, i, 0, +h, 0, f.x, f.y, "L", c.x, c.y, "A", s, s, 0, +h, 1, l.x, l.y, "L", a.x, a.y, "z"] }, e.getFirstValidListValue = function (n) { var r; return t.each(n, function (e, t) { return t === null ? !0 : typeof t == "undefined" ? !0 : typeof t == "number" && isNaN(t) ? !0 : (r = t, !1) }), r }, e.getLastValidListValue = function (n) { var r = [].concat(n).reverse(); return e.getFirstValidListValue(r) }, e.isHolefunction = function (t, n) { return t === null ? !0 : typeof t == "undefined" ? !0 : typeof t == "number" && isNaN(t) ? !0 : n === null ? !1 : typeof t != "undefined" ? t - n === 0 ? !0 : !1 : !1 }, e }(); e.ChartUtil = n; var r = function () { function e() { } return e.roundTime = function (n, r, i) { var s = this, o = r, u = t.fromOADate(n), a, f, l, c; return o > 0 ? (a = { year: u.getFullYear(), month: u.getMonth(), day: u.getDate(), hour: u.getHours(), minute: u.getMinutes(), second: u.getSeconds() }, o < s.tmInc.minute ? (a.second = s.tround(a.second, o, i), s.getTimeAsDouble(a)) : (a.second = 0, o < s.tmInc.hour ? (o /= s.tmInc.minute, a.minute = s.tround(a.minute, o, i), s.getTimeAsDouble(a)) : (a.minute = 0, o < s.tmInc.day ? (o /= s.tmInc.hour, a.hour = s.tround(a.hour, o, i), s.getTimeAsDouble(a)) : (a.hour = 0, o < s.tmInc.month ? (o /= s.tmInc.day, a.day = s.tround(a.day, o, i), s.getTimeAsDouble(a)) : (a.day = 1, o < s.tmInc.year ? (o /= s.tmInc.month, a.month = s.tround(a.month, o, i), s.getTimeAsDouble(a)) : (a.month = 0, o /= s.tmInc.year, a.year = s.tround(a.year, o, i), s.getTimeAsDouble(a))))))) : (f = u, l = f - o, c = parseInt((l / r).toString(), 10) * r, i && c !== l && (c += r), f = o + c, f) }, e.tround = function (t, n, r) { var i = parseInt((t / n * n).toString(), 10); return r && i !== t && (i += parseInt(n, 10)), i }, e.getTimeAsDouble = function (n) { var r = 0, i = 0, s = null; return n.day < 1 ? (i = -1 - n.day, n.day = 1) : n.day > 28 && (i = n.day - 28, n.day = 28), n.month < 0 ? (r = -1 - n.day, n.month = 0) : n.month > 11 && (r = n.month - 11, n.month = 11), s = new Date(n.year, n.month, n.day, n.hour, n.minute, n.second), s.setDate(s.getDate() + i), s.setMonth(s.getMonth() + r), t.toOADate(s) }, e.getTimeDefaultFormat = function (t, n) { var r = this, i = t - n, s = "d"; return i > 2 * r.tmInc.year ? s = "yyyy" : i > r.tmInc.year ? s = "MMM yy" : i > 3 * r.tmInc.month ? s = "MMM" : i > 2 * r.tmInc.week ? s = "MMM d" : i > 2 * r.tmInc.day ? s = "ddd d" : i > r.tmInc.day ? s = "ddd H:mm" : i > r.tmInc.hour ? s = "H:mm" : i >= 1e3 && (s = "H:mm:ss"), s }, e.niceTimeUnit = function (t, n) { var r = this, i = t; return i = r.niceTimeSpan(i, n), i }, e.niceTimeSpan = function (t, n) { var r = this, i = r.manualTimeInc(n), s = 0, o = 0; s = Math.ceil(t); if (s === 0) return r.timeSpanFromTmInc(i); o = 1; if (i < r.tmInc.minute) { if (s < r.tmInc.minute) { o = r.getNiceInc([1, 2, 5, 10, 15, 30], s, i); if (o !== 0) return o } i = r.tmInc.minute } if (i < r.tmInc.hour) { if (s < r.tmInc.hour) { o = r.getNiceInc([1, 2, 5, 10, 15, 30], s, i); if (o !== 0) return o } i = r.tmInc.hour } if (i < r.tmInc.day) { if (s < r.tmInc.day) { o = r.getNiceInc([1, 3, 6, 12], s, i); if (o !== 0) return o } i = r.tmInc.day } if (i < r.tmInc.month) { if (s < r.tmInc.month) { o = r.getNiceInc([1, 2, 7, 14], s, i); if (o !== 0) return o } i = r.tmInc.month } if (i < r.tmInc.year) { if (s < r.tmInc.year) { o = r.getNiceInc([1, 2, 3, 4, 6], s, i); if (o !== 0) return o } i = r.tmInc.year } return o = 100 * r.tmInc.year, s < o && (o = r.getNiceInc([1, 2, 5, 10, 20, 50], s, i), o === 0 && (o = 100 * r.tmInc.year)), o }, e.getNiceInc = function (t, n, r) { var i = 0, s = 0, o = t.length; for (i = 0; i < o; i++) { s = t[i] * r; if (n <= s) return s } return 0 }, e.timeSpanFromTmInc = function (t) { var n = 1e3, r = t, i = 1; if (t !== this.tmInc.maxtime) if (t > this.tmInc.tickf1) n = t; else { t += 7; while (r > 0) i *= 10, r--; n = i } return n }, e.manualTimeInc = function (t) { var n = this, r = n.tmInc.second; return !t || t.length === 0 ? r : (t.indexOf("s") >= 0 ? r = n.tmInc.second : t.indexOf("m") >= 0 ? r = n.tmInc.minute : t.indexOf("h") >= 0 || t.indexOf("H") >= 0 ? r = n.tmInc.hour : t.indexOf("d") >= 0 ? r = n.tmInc.day : t.indexOf("M") >= 0 ? r = n.tmInc.month : t.indexOf("y") >= 0 && (r = n.tmInc.year), r) }, e.tmInc = { tickf7: -7e3, tickf6: -6e3, tickf5: -5e3, tickf4: -4e3, tickf3: -3e3, tickf2: -2e3, tickf1: -1, second: 1e3, minute: 6e4, hour: 36e5, day: 864e5, week: 6048e5, month: 26784e5, year: 31536e6, maxtime: 2147483647 }, e.niceTickNumber = function (t) { if (parseFloat(t) === 0) return t; t < 0 && (t = -t); var n = Math.log(t) / Math.log(10), r = parseInt(this.signedFloor(n).toString(), 10), i = t / Math.pow(10, r), s = 10; return i <= 1 ? s = 1 : i <= 2 ? s = 2 : i <= 5 && (s = 5), s * Math.pow(10, r) }, e.niceNumber = function (t, n, r) { if (parseFloat(t) === 0) return t; t < 0 && (t = -t); var i = t / Math.pow(10, n), s = 10; return r ? i < 1.5 ? s = 1 : i < 3 ? s = 2 : i < 7 && (s = 5) : i <= 1 ? s = 1 : i <= 2 ? s = 2 : i <= 5 && (s = 5), s * Math.pow(10, n) }, e.nicePrecision = function (t) { if (t <= 0 || typeof t != "number") return 0; var n = Math.log(t) / Math.log(10), r = parseInt(this.signedFloor(n).toString(), 10), i = t / Math.pow(10, r); return i < 3 && (r = -r + 1), r }, e.precCeil = function (t, n) { var r = Math.pow(10, t), i = n / r; return i = Math.ceil(i), i * r }, e.precFloor = function (t, n) { var r = Math.pow(10, t), i = n / r; return i = Math.floor(i), i * r }, e.signedCeiling = function (t) { return t < 0 ? Math.floor(t) : Math.ceil(t) }, e.signedFloor = function (t) { return t < 0 ? Math.ceil(t) : Math.floor(t) }, e }(); e.ChartDataUtil = r, Raphael.fn.closeBtn = function (e, t, n) { var r = Math.cos(45 * Math.PI / 180) * n, i = this.set(), s = ["M", e - r, t - r, "L", e + r, t + r, "M", e - r, t + r, "L", e + r, t - r], o = this.path(s.join(" ")), u = null; return o.attr({ cursor: "pointer" }), i.push(o), u = this.rect(e - n, t - n, n * 2, n * 2), u.attr({ fill: "white", "fill-opacity": 0, cursor: "pointer", stroke: "none" }), i.push(u), i }; var i = function () { function e(e, n, r) { this.options = { content: "", contentStyle: {}, title: "", titleStyle: {}, style: { fill: "white", "fill-opacity": .5 }, closeBehavior: "auto", mouseTrailing: !0, triggers: "hover", animated: "fade", showAnimated: null, hideAnimated: null, duration: 500, showDuration: 500, hideDuration: 500, easing: null, showEasing: null, hideEasing: null, showDelay: 150, hideDelay: 150, relativeTo: "mouse", compass: "east", offsetX: 0, offsetY: 0, showCallout: !0, calloutFilled: !1, calloutFilledStyle: { fill: "black" }, calloutLength: 12, calloutOffset: 0, calloutAnimation: { easing: null, duration: 500 }, windowCollisionDetection: "flip", calloutSide: null, width: null, height: null, beforeShowing: null }, this.paper = e, this.targets = n, t.extend(this.options, r), this.init() } return e.prototype.init = function () { var e = this.options; this.calloutOffset = e.calloutOffset, this.offsetLength = 0, this.gapLength = e.calloutLength / 2, this.width = e.width, this.height = e.height, this.offset = { x: 0, y: 0 }, this.targets && this._bindLiveEvent(this.targets), this.selector && this._bindLiveEventBySelector(this.selector) }, e.prototype._getShowPoint = function (e, t) { var n = e.getBBox(), r = { x: 0, y: 0 }; switch (t) { case "east": r.x = n.x + n.width, r.y = n.y + n.height / 2; break; case "eastnorth": r.x = n.x + n.width, r.y = n.y; break; case "eastsouth": r.x = n.x + n.width, r.y = n.y + n.height; break; case "west": r.x = n.x, r.y = n.y + n.height / 2; break; case "westnorth": r.x = n.x, r.y = n.y; break; case "westsouth": r.x = n.x, r.y = n.y + n.height; break; case "north": r.x = n.x + n.width / 2, r.y = n.y; break; case "northeast": r.x = n.x + n.width, r.y = n.y; break; case "northwest": r.x = n.x, r.y = n.y; break; case "south": r.x = n.x + n.width / 2, r.y = n.y + n.height; break; case "southeast": r.x = n.x + n.width, r.y = n.y + n.height; break; case "southwest": r.x = n.x, r.y = n.y + n.height } return r }, e.prototype._clearIntentTimer = function (e) { e && (window.clearTimeout(e), e = null) }, e.prototype._removeTooltip = function (t) { var n = this, r = this, i = this.elements, s = r.options, o, u, a; if (i) { if (s.hideAnimated || s.animated) o = s.hideAnimated, o || (o = s.animated), o && e.animations[o] && (a = { animated: o, duration: s.hideDuration || s.duration, easing: s.hideEasing || s.easing, context: i, show: !1 }, e.animations[o](a)); u = s.hideDuration || s.duration, t && (u = t), window.setTimeout(function () { var e, t; n.content && (n.content.wijRemove(), n.content = null), n.title && (n.title.wijRemove(), n.title = null), n.container && (n.container.wijRemove(), n.container = null); if (n.closeBtn) { for (e = 0, t = n.closeBtn.length; e < t; e++) n.closeBtn[e].unclick(); n.closeBtn.wijRemove(), n.closeBtn = null } n.callout && (n.callout.wijRemove(), n.callout = null), r.lastPoint = null, i = null }, u) } }, e.prototype._clearTimers = function () { this.intentShowTimer && this._clearIntentTimer(this.intentShowTimer), this.intentHideTimer && this._clearIntentTimer(this.intentHideTimer) }, e.prototype._hide = function (e) { var t = this; t._clearTimers(), t.options.hideDelay ? t.intentHideTimer = window.setTimeout(function () { t._removeTooltip() }, t.options.hideDelay) : t._removeTooltip() }, e.prototype._convertCompassToPosition = function (e) { var t = "", n = { x: 0, y: 0 }; switch (e) { case "east": t = "right-middle", n.x = 2, n.y = 0; break; case "eastnorth": t = "right-top", n.x = 2, n.y = -2; break; case "eastsouth": t = "right-bottom", n.x = 2, n.y = 2; break; case "west": t = "left-middle", n.x = -2, n.y = 0; break; case "westnorth": t = "left-top", n.x = -2, n.y = -2; break; case "westsouth": t = "left-bottom", n.x = -2, n.y = 2; break; case "north": t = "top-middle", n.x = 0, n.y = -2; break; case "northeast": t = "top-right", n.x = 2, n.y = -2; break; case "northwest": t = "top-left", n.x = -2, n.y = -2; break; case "south": t = "bottom-middle", n.x = 0, n.y = 2; break; case "southeast": t = "bottom-right", n.x = 2, n.y = 2; break; case "southwest": t = "bottom-left", n.x = -2, n.y = 2 } return this.offset = n, t }, e.prototype._getCalloutArr = function (e, t) { var n = [], r = this.options, i = r.compass; r.calloutSide && (i = r.calloutSide); switch (i.toLowerCase()) { case "east": case "eastsouth": case "eastnorth": n = ["M", e.x + t, e.y + t, "l", -t, -t, "l", t, -t, "Z"]; break; case "west": case "westsouth": case "westnorth": n = ["M", e.x - t, e.y - t, "l", t, t, "l", -t, t, "Z"]; break; case "north": case "northeast": case "northwest": n = ["M", e.x - t, e.y - t, "l", t, t, "l", t, -t, "Z"]; break; case "south": case "southeast": case "southwest": n = ["M", e.x - t, e.y + t, "l", t, -t, "l", t, t, "Z"] } return n }, e.prototype._getFuncText = function (e, n) { if (t.isFunction(e)) { var r = null, i, s = { target: null, fmt: e }, o; if (n && n.target) { o = n.target; if (!o.raphael || !o.raphaelid) o = o.parentNode; o.raphael && o.raphaelid ? (i = this.paper.getById(o.raphaelid), s.target = i) : s.target = n.target } return r = t.proxy(s.fmt, s), r().toString() } return e }, e.prototype._translateCallout = function (e) { var t = this.options, n = this.width, r = this.height, i = this.gapLength, s = this.offsetLength, o = this.calloutOffset, u = this.tooltipElements.callout; if (t.calloutSide) { var a = i || s; switch (t.calloutSide) { case "south": case "north": e ? u.animate({ translation: -n / 2 + a + o + ",0" }, e) : u.translate(-n / 2 + a + o, 0); break; case "east": case "west": e ? u.animate({ translation: "0," + (-r / 2 + a + o) }, e) : u.translate(0, -r / 2 + a + o) } } }, e.replacer = function (t, n, r) { var i = r, s = /(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g; return n.replace(s, function (e, t, n, r, s) { t = t || r, i && (i[t] !== "string" && (i = i[t]), typeof i == "function" && s && (i = i())) }), i = (i === null || i === r ? t : i).toString(), i }, e.fill = function (n, r) { var i = /\{([^\}]+)\}/g; return String(n).replace(i, function (t, n) { return e.replacer(t, n, r) }) }, e.prototype._createPath = function (t, n, r) { var i = n.split("-"), s = 5, o = r.getBBox(), u = this.options, a = u.padding, f = this.gapLength, l = this.offsetLength, c = a && !isNaN(a) ? parseInt(a) : 0, h = Math.round(o.width + c * 2), p = Math.round(o.height + c * 2), d = Math.round(o.x - c) - s, v = Math.round(o.y - c) - s, m = 0, g = 0, y = 0, b = 0, w = null, E = null, S = null; u.width && (h = h > u.width ? h : u.width), u.height && (p = p > u.height ? p : u.height), this.width = h, this.height = p, m = Math.min(p / 4, h / 4, f), l && (l = Math.min(p / 4, h / 4, l)), l ? (g = l, w = { top: "M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}l-{right},0-{offset},0,-{left},0a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z", bottom: "M{x},{y}l{left},0,{offset},0,{right},0a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z", right: "M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}l0-{bottom},0-{offset},0-{top}a{r},{r},0,0,1,{r}-{r}z", left: "M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}l0,{top},0,{offset},0,{bottom}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z" }) : w = { top: "M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}l-{right},0-{gap},{gap}-{gap}-{gap}-{left},0a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z", bottom: "M{x},{y}l{left},0,{gap}-{gap},{gap},{gap},{right},0a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z", right: "M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}l0-{bottom}-{gap}-{gap},{gap}-{gap},0-{top}a{r},{r},0,0,1,{r}-{r}z", left: "M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}l0,{top},{gap},{gap}-{gap},{gap},0,{bottom}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z" }, E = [{ x: d + s, y: v, w: h, w4: h / 4, h4: p / 4, left: 0, right: h - m * 2 - g * 2, top: 0, bottom: p - m * 2 - g * 2, r: s, h: p, gap: m, offset: g * 2 }, { x: d + s, y: v, w: h, w4: h / 4, h4: p / 4, left: h / 2 - m - g, right: h / 2 - m - g, top: p / 2 - m - g, bottom: p / 2 - m - g, r: s, h: p, gap: m, offset: g * 2 }, { x: d + s, y: v, w: h, w4: h / 4, h4: p / 4, right: 0, left: h - m * 2 - g * 2, bottom: 0, top: p - m * 2 - g * 2, r: s, h: p, gap: m, offset: g * 2 }][i[1] === "middle" ? 1 : (i[1] === "left" || i[1] === "top" ? 1 : 0) * 2], S = this.paper.path(e.fill(w[i[0]], E)); switch (i[0]) { case "top": y = t.x - (d + s + E.left + m + l), b = t.y - (v + s + p + s + m + l); break; case "bottom": y = t.x - (d + s + E.left + m + l), b = t.y - (v - m - l); break; case "left": y = t.x - (d + s + h + s + m + l), b = t.y - (v + s + E.top + m + l); break; case "right": y = t.x - (d - m - g), b = t.y - (v + s + E.top + m + g) } return S.translate(y, b), r.transform(Raphael.format("...t{0},{1}", y, b)), S }, e.prototype._isWindowCollision = function (e, n, r, i, s, o, u) { var a = e.getBBox(), f = 0, l = n, c = a.x + s, h = a.y + o, p = this.paper.width, d = this.paper.height, v = r, m = i, g = e.attr("stroke-width"), y = u === !0 || u === "flip"; return Raphael.vml && (p = t(this.paper.canvas).width(), d = t(this.paper.canvas).height()), c - g < 0 && (y ? l.toLowerCase().indexOf("west") === -1 ? c + a.width / 2 + a.width - r <= p && (f++, l = l.toLowerCase() + "east", v = 0 - r) : c + a.width + a.width - r <= p && (f++, l = l.toLowerCase().replace("west", "east"), v = 0 - r) : (f++, v = 0 - c + g + r)), h - g < 0 && (y ? l.toLowerCase().indexOf("north") === -1 ? h + a.height / 2 + a.height - i <= d && (f++, l = l.toLowerCase() + "south", m = 0 - i) : h + a.height + a.height - i <= d && (f++, l = l.toLowerCase().replace("north", "south"), m = 0 - i) : (f++, m = 0 - h + g + i)), c + a.width + g > p && (y ? l.toLowerCase().indexOf("east") === -1 ? c - a.width / 2 - r >= 0 && (f++, l = l.toLowerCase() + "west", v = 0 - r) : c - a.width - r >= 0 && (f++, l = l.toLowerCase().replace("east", "west"), v = 0 - r) : (f++, v = p - (c + a.width + g) + r)), h + a.height + g > d && (y ? l.toLowerCase().indexOf("south") === -1 ? h - a.height / 2 - i >= 0 && (f++, l = l.toLowerCase() + "north", m = 0 - i) : h - a.height - i >= 0 && (f++, l = l.toLowerCase().replace("south", "north"), m = 0 - i) : (f++, m = d - (h + a.height + g) + i)), f ? { compass: l, offsetX: v, offsetY: m } : !1 }, e.prototype._createTooltipEles = function (n, r, i, s, o, u, a) { var f = this, l, c, h, p = this.paper.set(), d = null, v = null, m = this.options, g = this.closeBtnLength, y = this.calloutOffset, b = null, w = 0, E = 0, S = 250, x = 0, T = 0, N, C = { x: n.x, y: n.y }, k = this.offset, L = null, A = null; t.wijraphael.clearRaphaelCache(), h = this._convertCompassToPosition(o), C.x += u + k.x, C.y += a + k.y, this.elements = this.paper.set(), this.title && (t.each(this.title, function (e, n) { t(n.node).unbind(".Rtooltip") }), this.title.wijRemove()), r && r.length > 0 ? (this.title = this.paper.htmlText(-1e3, -1e3, r, m.titleStyle), this.elements.push(this.title), l = this.title.getBBox()) : l = { left: -1e3, top: -1e3, width: 0, height: 0 }, this.content && (t.each(this.content, function (e, n) { t(n.node).unbind(".Rtooltip") }), this.content.wijRemove()), i && i.length > 0 ? (this.content = this.paper.htmlText(-1e3, -1e3, i, m.contentStyle), this.elements.push(this.content), c = this.content.getBBox()) : c = { left: -1e3, top: -1e3, width: 0, height: 0 }; if (this.closeBtn) { for (x = 0, T = this.closeBtn.length; x < T; x++) this.closeBtn[x].unclick(); this.closeBtn.wijRemove() } this.content && this.content.transform(Raphael.format("T0,{0}", l.height / 2 + c.height / 2)), this.title && this.title.transform(Raphael.format("T0,{0}", 0)), m.closeBehavior === "sticky" && (this.closeBtn = this.paper.closeBtn(-1e3, -1e3, g), this.elements.push(this.closeBtn), m.width && m.width > l.width + g * 2 && m.width > c.width + g * 2 ? this.closeBtn.transform(Raphael.format("T{0},{1}", m.width - g, g)) : l.width >= c.width - g * 2 ? this.closeBtn.transform(Raphael.format("T{0},{1}", l.width + g, g)) : this.closeBtn.transform(Raphael.format("T{0},{1}", c.width - g, g)), t.each(this.closeBtn, function (e, t) { var n = f; t.click(function (e) { n._hide(e) }) })), this.title && (p.push(this.title), m.relatedElement && this.title.insertBefore(m.relatedElement)), this.content && (p.push(this.content), m.relatedElement && this.content.insertBefore(m.relatedElement)), this.closeBtn && (p.push(this.closeBtn), m.relatedElement && this.closeBtn.insertBefore(m.relatedElement)), m.showCallout || (this.gapLength = 0); if (m.calloutSide || m.calloutFilled) this.gapLength = 0, this.offsetLength = m.calloutLength / 2, m.calloutSide && (h = this._convertCompassToPosition(m.calloutSide)); m.calloutSide && p.length === 0 && (this.content = this.paper.htmlText(-1e3, -1e3, " "), p.push(this.content), m.relatedElement && this.content.insertBefore(m.relatedElement)), this.callout && (t(this.callout.node).unbind(".Rtooltip"), this.callout.wijRemove()), this.container && (t(this.container.node).unbind(".Rtooltip"), this.container.wijRemove()); if (this.lastPoint) { m.showCallout && (m.calloutSide || m.calloutFilled) && (d = this._getCalloutArr(this.lastPoint, this.offsetLength), this.callout = this.paper.path(d.concat(" ")), m.relatedElement && this.callout.insertBefore(m.relatedElement), m.calloutFilled && this.callout.attr(m.calloutFilledStyle), m.calloutSide && this._translateCallout(0)), this.container = this._createPath(this.lastPoint, h, p), m.relatedElement && this.container.insertBefore(m.relatedElement); if (s) { N = this._isWindowCollision(this.container, o, u, a, C.x - this.lastPoint.x, C.y - this.lastPoint.y, s); if (N) { this._createTooltipEles(n, r, i, !1, N.compass, N.offsetX, N.offsetY); return } } this.elements.push(this.callout), this.elements.push(this.container), w = C.x - this.lastPoint.x, E = C.y - this.lastPoint.y, A = Raphael.format("...T{0},{1}", w, E), L = Raphael.animation({ transform: A }, S), this.container && (m.showAnimated || m.animated ? this.container.animate(L) : this.container.attr("transform", A)), this.title && (m.showAnimated || m.animated ? this.title.animate(L) : this.title.attr("transform", A)), this.content && (m.showAnimated || m.animated ? this.content.animate(L) : this.content.attr("transform", A)), this.closeBtn && (m.showAnimated || m.animated ? this.closeBtn.animate(L) : this.closeBtn.attr("transform", A)), this.callout && (m.showAnimated || m.animated ? this.callout.animate(L) : this.callout.attr("transform", A)) } else { m.showCallout && (m.calloutSide || m.calloutFilled) && (d = this._getCalloutArr(C, this.offsetLength), this.callout = this.paper.path(d.concat(" ")), m.relatedElement && this.callout.insertBefore(m.relatedElement), m.calloutFilled && this.callout.attr(m.calloutFilledStyle), m.calloutSide && this._translateCallout(0)), this.container = this._createPath(C, h, p), m.relatedElement && this.container.insertBefore(m.relatedElement); if (s) { N = this._isWindowCollision(this.container, o, u, a, 0, 0, s); if (N) { this._createTooltipEles(n, r, i, !1, N.compass, N.offsetX, N.offsetY); return } } this.elements.push(this.callout), this.elements.push(this.container); if (m.showAnimated || m.animated) v = m.showAnimated, v || (v = m.animated), v && e.animations[v] && (b = { animated: v, duration: m.showDuration || m.duration, easing: m.showEasing || m.easing, context: this.elements, show: !0 }, e.animations[v](b)) } this.lastPoint = C, this.container.attr(m.style), m.relatedElement ? (this.title && this.title.insertBefore(m.relatedElement), this.content && this.content.insertBefore(m.relatedElement), this.closeBtn && this.closeBtn.insertBefore(m.relatedElement)) : p.toFront() }, e.prototype._createTooltip = function (e, n) { var r = null, i = null, s = null, o = null, u = this.options, a, f; if (t.isFunction(u.beforeShowing)) { s = null, o = { target: null, options: u, fmt: u.beforeShowing }; if (n && n.target) { f = n.target; if (!f.raphael || !f.raphaelid) f = f.parentNode; f.raphael && f.raphaelid ? (a = this.paper.getById(f.raphaelid), o.target = a) : (a = n.target, o.target = a) } s = t.proxy(o.fmt, o); if (s() === !1) return } r = u.title, i = u.content, r = this._getFuncText(r, n), i = this._getFuncText(i, n); if (!r && !i) return; this._createTooltipEles(e, r, i, u.windowCollisionDetection, u.compass, u.offsetX, u.offsetY) }, e.prototype._showAt = function (e, t) { var n = this.options, r = this; this._clearTimers(), n.showDelay ? this.intentShowTimer = window.setTimeout(function () { r._createTooltip(e, t) }, n.showDelay) : this._createTooltip(e, t) }, e.prototype._show = function (e) { var n = t(this.paper.canvas.parentNode).offset(), r = n.left, i = n.top, s = this.options, o = s.relativeTo, u = { x: 0, y: 0 }, a = null, f = e.target; switch (o) { case "mouse": u.x = e.pageX - r, u.y = e.pageY - i; break; case "element": if (!f.raphael || !f.raphaelid) f = f.parentNode; f.raphael && f.raphaelid && (a = this.paper.getById(f.raphaelid), u = this._getShowPoint(a, s.compass)) } this._showAt(u, e) }, e.prototype._bindEvent = function (e) { var n = this.options, r = this; switch (n.triggers) { case "hover": t(e.node).bind("mouseover.Rtooltip", function (e) { r._show(e) }).bind("mouseout.Rtooltip", function (e) { n.closeBehavior === "auto" && r._hide(e) }), n.mouseTrailing && n.relativeTo === "mouse" && t(e.node).bind("mousemove.Rtooltip", function (e) { r._show(e) }); break; case "click": t(e.node).bind("click.Rtooltip", function (e) { r._show(e) }); break; case "custom": } }, e.prototype._bindLiveEvent = function (e) { var t, n; if (e) if (e.length) for (t = 0, n = e.length; t < n; t++) this._bindEvent(e[t]); else this._bindEvent(e) }, e.prototype._bindLiveEventBySelector = function (e) { var t = this.options, n = this; if (e) switch (t.triggers) { case "hover": e.on("mouseover.Rtooltip", function (e) { n._show(e) }).on("mouseout.Rtooltip", function (e) { t.closeBehavior === "auto" && n._hide(e) }), t.mouseTrailing && t.relativeTo === "mouse" && e.on("mousemove.Rtooltip", function (e) { n._show(e) }); break; case "click": e.on("click.Rtooltip", function (e) { n._show(e) }); break; case "custom": } }, e.prototype._unbindLiveEvent = function (e, n) { var r, i; if (e) if (e.length) for (r = 0, i = e.length; r < i; r++) t(e[r].node).unbind(".Rtooltip"); else t(e.node).unbind(".Rtooltip"); n && n.off("Rtooltip").off(".Rtooltip") }, e.prototype._destroy = function () { this._unbindLiveEvent(this.targets, this.selector), this._removeTooltip(0) }, e.prototype.hide = function () { this._hide() }, e.prototype.showAt = function (e, t) { this._showAt(e, t) }, e.prototype.resetCalloutOffset = function (e) { var t = this.options, n = t.calloutOffset, r = t.calloutSide, i = t.calloutAnimation, s = this.tooltipElements; s.callout && (r === "south" || r === "north" ? s.callout.animate({ translation: e - n + ",0" }, i.duration, i.easing) : (r === "east" || r === "west") && s.callout.animate({ translation: "0," + (e - n) }, i.duration, i.easing)), t.calloutOffset = e }, e.prototype.destroy = function () { this._destroy() }, e.prototype.getOptions = function () { return this.options }, e.prototype.setTargets = function (e) { this.targets = e, this._bindLiveEvent(e) }, e.prototype.setSelector = function (e) { this.selector = e, this._bindLiveEventBySelector(e) }, e.prototype.setOptions = function (e) { t.extend(!0, this.options, e) }, e.animations = { fade: function (e) { var t = e.context; e.show ? (t.attr({ opacity: 0 }), t.wijAnimate({ opacity: 1 }, e.duration, e.easing)) : t.wijAnimate({ opacity: 0 }, e.duration, e.easing) } }, e }(); e.ChartTooltip = i, Raphael.fn.tooltip = { animations: i.animations }; var s = function () { function e(e) { this.labels = [], this.crossLabels = {}, this.bBox = e } return e.prototype.push = function (e) { var t = e.wijGetBBox(); this.labels.push({ ele: e, x: t.x, y: t.y, width: t.width, height: t.height, overlaps: [], bakBBox: t }) }, e.prototype.pushCross = function (e, t) { var n, r, i, s, o; !this.crossLabels[Raphael.format("{0}-{1}", e, t)] && !this.crossLabels[Raphael.format("{0}-{1}", t, e)] && (n = this.labels[e], r = this.labels[t], this.crossLabels[Raphael.format("{0}-{1}", e, t)] = { label1: n, label2: r, dx: this._getAdjust(n, r, "h"), dy: this._getAdjust(n, r, "v") }) }, e.prototype._detect = function (e, t) { return (e.x + e.width > t.x && e.x < t.x || t.x + t.width > e.x && t.x < e.x) && (e.y + e.height > t.y && e.y < t.y || t.y + t.height > e.y && t.y < e.y) }, e.prototype._resetOverlaps = function () { this.crossLabels = {} }, e.prototype._detects = function () { var e = this.labels.length, t, n; for (var r = 0; r < e; r++) for (var i = r + 1; i < e; i++) t = this.labels[r], n = this.labels[i], this._detect(t, n) && this.pushCross(r, i) }, e.prototype._getAdjust = function (e, t, n) { var r = { dx: 0, needRevert: !1 }; return n === "h" ? e.x < t.x ? r.dx = e.x + e.width - t.x : (r.dx = t.x + t.width - e.x, r.needRevert = !0) : e.y < t.y ? r.dx = e.y + e.height - t.y : (r.dx = t.y + t.height - e.y, r.needRevert = !0), r }, e.prototype._adjustlabel = function (e, t, n, r) { r === "h" ? (e.x -= n / 2, t.x += n / 2, this.bBox && (e.x < this.bBox.x ? (e.x = this.bBox.x, t.x = t.x + (this.bBox.x - e.x)) : t.x > this.bBox.x + this.bBox.width && (t.x = this.bBox.x + this.bBox.width, e.x -= t.x - this.bBox.x + this.bBox.width))) : (e.y -= n / 2, t.y += n / 2, this.bBox && (e.y < this.bBox.y ? (e.y = this.bBox.y, t.y = t.y + (this.bBox.y - e.y)) : t.y > this.bBox.y + this.bBox.height && (t.y = this.bBox.y + this.bBox.height, e.y -= t.y - this.bBox.y + this.bBox.height))) }, e.prototype._adjustInternal = function () { var e = this; t.each(this.crossLabels, function (t, n) { var r = n.label1, i = n.label2, s = n.dx, o = n.dy; s.dx < o.dx ? o.needRevert ? e._adjustlabel(i, r, o.dx, "v") : e._adjustlabel(r, i, o.dx, "v") : s.needRevert ? e._adjustlabel(i, r, s.dx, "h") : e._adjustlabel(r, i, s.dx, "h") }) }, e.prototype._adjustTheEdge = function () { var e = this; this.bBox && t.each(this.labels, function (t, n) { n.x < e.bBox.x ? n.x = e.bBox.x : n.x + n.width > e.bBox.x + e.bBox.width && (n.x = e.bBox.x + e.bBox.width - n.width), n.y < e.bBox.y ? n.y = e.bBox.y : n.y + n.height > e.bBox.y + e.bBox.height && (n.y = e.bBox.y + e.bBox.height - n.height) }) }, e.prototype._translateLabels = function () { t.each(this.labels, function (e, t) { t.x !== t.bakBBox.x && (t.ele.attr("x", t.x + t.width / 2), t.bakBBox.x = t.x), t.y !== t.bakBBox.y && (t.ele.attr("y", t.y + t.height / 2), t.bakBBox.y = t.y) }) }, e.prototype.adjust = function () { var e = 1e3; while (e > 0) { this._resetOverlaps(), this._adjustTheEdge(), this._detects(); if (t.isEmptyObject(this.crossLabels)) break; e--, this._adjustInternal() } console.log(e), this._translateLabels() }, e }(); e.AdjustLabel = s; var o = function (e) { function s() { e.apply(this, arguments), this.innerState = {} } return __extends(s, e), s.prototype._setOption = function (n, r) { var i = this, o = i.options, u = null, a = 0, f = 0, l = o.axis.x.tickMajor.factor, c = o.axis.x.tickMinor.factor, h, p, d, v, m, g = s.prototype.options.axis, y; if (n === "dataSource") i.seriesTransition = !0, o.dataSource = r, i.seriesList && (o.seriesList = t.arrayClone(i.seriesList)), i._init(); else if (n === "data") i.seriesTransition = !0, o.data = r, i.seriesList && (o.seriesList = t.arrayClone(i.seriesList)), i._init(); else if (n === "seriesList") { r || (r = []), u = t.Event("beforeserieschange"); if (i._trigger("beforeSeriesChange", u, { oldSeriesList: o.seriesList, newSeriesList: r }) === !1) return !1; o.seriesList = r, i.seriesList = t.arrayClone(r), i._trigger("seriesChanged", null, r), i.seriesTransition = !0, i._init() } else t.isPlainObject(o[n]) ? (n === "axis" && (t.isArray(o.axis.y) ? d = t.arrayClone(o.axis.y) : d = t.extend(!0, {}, o.axis.y)), n === "axis" ? (t.extend(!0, o.axis.x, r.x || {}), t.isArray(o.axis.y) || t.isArray(r.y) ? y = {} : y = o.axis.y, t.isArray(r.y) ? (t.each(r.y, function (e, n) { r.y[e] = t.extend(!0, {}, g.y, y, n) }), o.axis.y = r.y) : o.axis.y = t.extend(!0, {}, g.y, y, r.y)) : t.extend(!0, o[n], r), n === "indicator" && (this._unbindCanvasEvents(), this._bindCanvasEvents()), n === "axis" && (v = o.axis.y, o.axis.x.tickMajor.factor < 0 && (o.axis.x.tickMajor.factor = l), o.axis.x.tickMinor.factor < 0 && (o.axis.x.tickMinor.factor = c), t.isArray(v) ? (t.isArray(d) || (d = [d]), t.each(v, function (e, t) { var n = d[e] || {}; n.tickMajor && n.tickMajor.factor && t.tickMajor && t.tickMajor.factor && t.tickMajor.factor < 0 && (t.tickMajor.factor = n.tickMajor.factor), n.tickMinor && n.tickMinor.factor && t.tickMinor && t.tickMinor.factor && t.tickMinor.factor < 0 && (t.tickMinor.factor = n.tickMinor.factor) })) : (t.isArray(d) ? (h = d[0].tickMajor.factor, p = d[0].tickMinor.factor) : (l = d.tickMajor.factor, c = d.tickMinor.factor), o.axis.y.tickMajor && o.axis.y.tickMajor.factor !== undefined && o.axis.y.tickMajor.factor < 0 && (o.axis.y.tickMajor.factor = h), o.axis.y.tickMinor && o.axis.y.tickMinor.factor !== undefined && o.axis.y.tickMinor.factor < 0 && (o.axis.y.tickMinor.factor = p)))) : e.prototype._setOption.call(this, n, r); n === "disabled" && i._handleDisabledOption(r, i.chartElement); if (n === "seriesTransition" || n === "animation") return; if (n === "hint") { i._resetTooltip(); return } a = o.seriesList.length; if (n === "seriesList" || n === "seriesStyles" || n === "seriesHoverStyles") n !== "seriesList" && i._handleChartStyles(), i.styles = { style: [].concat(o.seriesStyles.slice(0, o.seriesStyles.length)), hoverStyles: [].concat(o.seriesHoverStyles.slice(0, o.seriesHoverStyles.length)) }, i._initStyles(); if (n === "seriesList" || n === "seriesHoverStyles") { m = o.seriesHoverStyles.length; for (f = m; f < a; f++) o.seriesHoverStyles[f] = o.seriesHoverStyles[f % m] } (n === "height" || n === "width") && i.chartElement[n](r), i.redraw() }, s.prototype._preHandleSeriesData = function () { }, s.prototype._initStyles = function () { var e = this.options, t = e.seriesStyles, n = e.seriesHoverStyles, r, i, s, o; e.seriesList && (i = e.seriesList.length || 0), e.seriesStyles && (r = e.seriesStyles.length || 0), e.seriesHoverStyles && (s = e.seriesHoverStyles.length || 0); if (i > r && r) for (o = r; o < i; o++) t[o] = t[o % r]; if (i > s && s) for (o = s; o < i; o++) n[o] = n[o % s] }, s.prototype._create = function () { var e = this, n = e.options, r = n.width || e.element.width(), i = n.height || e.element.height(), s = null, o; window.wijmoApplyWijTouchUtilEvents && (t = window.wijmoApplyWijTouchUtilEvents(t)), e.updating = 0, e.innerState = {}, e.axisCompass = {}, e.element.is(":hidden") && e.element.wijAddVisibilityObserver && e.element.wijAddVisibilityObserver(function () { e.redraw(), e.element.wijRemoveVisibilityObserver && e.element.wijRemoveVisibilityObserver() }, "wijchart"), t.isFunction(window.wijmoASPNetParseOptions) && window.wijmoASPNetParseOptions(n), e.styles = { style: [].concat(n.seriesStyles.slice(0, n.seriesStyles.length)), hoverStyles: [].concat(n.seriesHoverStyles.slice(0, n.seriesHoverStyles.length)) }, e._initStyles(), n.hint && typeof n.hint.content == "string" && window[n.hint.content] && (n.hint.content = window[n.hint.content]), n.hint && typeof n.hint.title == "string" && window[n.hint.title] && (n.hint.title = window[n.hint.title]), e.headerEles = [], e.footerEles = [], e.legendEles = [], e.axisEles = [], e.legends = [], e.legendIcons = [], e.legendDots = [], e.chartLabelEles = [], e.seriesEles = []; if (e.element.length > 0) { e.element.is("table") ? (e._parseTable(), s = t("<div></div>"), r && s.css("width", r), i && s.css("height", i), e.element.after(s), e.chartElement = s) : e.chartElement = e.element, e.chartElement.addClass("ui-widget"); try { o = Raphael(e.chartElement[0], r, i) } catch (u) { var a = e.chartElement.css("display"); s = t("<div></div>").insertBefore(e.chartElement).append(e.chartElement), e.chartElement.addClass("ui-helper-hidden-accessible").appendTo(t("body")), a === "none" && e.chartElement.css("display", "block"), o = Raphael(e.chartElement[0], r, i), e.chartElement.appendTo(s).unwrap().removeClass("ui-helper-hidden-accessible"), a === "none" && e.chartElement.css("display", "none") } e.canvas = o, i === 0 && n.height !== 0 && e.element.height(o.height), n.disabled && e.disable(), o.customAttributes.rotation = function (e) { this.transform("...R" + e) }, o.customAttributes.scale = function (e) { this.transform("...S" + e) }, o.customAttributes.translation = function (e, t) { this.transform(Raphael.format("...T{0},{1}", e, t)) }, e._bindLiveEvents() } }, s.prototype._handleChartStyles = function () { this._extendArrayFromBase("seriesStyles"), this._extendArrayFromBase("seriesHoverStyles"); var e = this.options, n = this._getDefFill(); t.each(e.seriesStyles, function (e, t) { t.fill || (t.fill = n[e]) }) }, s.prototype._extendArrayFromBase = function (e) { var n = t.extend(!0, {}, s.prototype.options[e], this.options[e]), r = []; t.each(n, function (e, t) { r.push(t) }), this.options[e] = r }, s.prototype._getDefFill = function () { var e = ["#00cc00", "#0099cc", "#0055cc", "#2200cc", "#8800cc", "#d9007e", "#ff0000", "#ff6600", "#ff9900", "#ffcc00", "#ffff00", "#ace600"]; return e }, s.prototype._getCulture = function (e) { return Globalize.findClosestCulture(e || this.options.culture) }, s.prototype._handleDisabledOption = function (e, t) { var n = this; e ? (n.disabledDiv || (n.disabledDiv = n._createDisabledDiv(t)), n.disabledDiv.appendTo("body")) : n.disabledDiv && (n.disabledDiv.remove(), n.disabledDiv = null) }, s.prototype._createDisabledDiv = function (e) { var n = this, r = n.options, i = e || n.element, s = i.offset(), o = r.width || i.outerWidth(), u = r.height || i.outerHeight(), a; return a = t("<div></div>").css({ "z-index": "99999", position: "absolute", width: o, height: u, left: s.left, top: s.top }), Raphael.vml && a.addClass(r.wijCSS.stateDisabled).css("background-color", "#fff"), a }, s.prototype._bindData = function () { var e = this, n = e.options, r = n.dataSource, i = n.seriesList, s = n.data, o; t.each(i, function (t, n) { var i = n.data, u, a, f, l = n.dataSource || r; l && i && (u = i.x, a = i.y, f = i.y1, u && u.bind ? i.x = e._getBindData(l, u.bind) : s && s.x && s.x.bind && (o === undefined && (o = e._getBindData(l, s.x.bind)), i.x = o), a && a.bind && (i.y = e._getBindData(l, a.bind)), f && f.bind && (i.y1 = e._getBindData(l, f.bind))) }) }, s.prototype._getBindData = function (e, n) { if (t.isArray(e)) { var r = []; return t.each(e, function (e, t) { t && t[n] !== undefined && r.push(t[n]) }), r } return null }, s.prototype._hanldSharedXData = function () { var e = this, n = e.options, r = n.seriesList, i = n.data; i && t.each(r, function (e, n) { var r = n.data; if (r.x === undefined || r.x === null && t.isArray(i.x)) r.x = i.x }) }, s.prototype._init = function () { var e = this, n = e.options; e.rendered || (e.seriesList = t.arrayClone(n.seriesList)), e._bindData(), e._hanldSharedXData(), t.each(n.seriesList, function (e, r) { var i = r.data, s; if (typeof i == "undefined" || i === null) s = t.inArray(r, n.seriesList), n.seriesList.splice(s, 1) }), e.rendered || e._paint() }, s.prototype.destroy = function () { var n = this, r = n.options; n._unbindLiveEvents(), n._clearChartElement(), n.chartElement.removeClass("ui-widget"), t("." + r.wijCSS.canvasObject, n.chartElement[0]).off(n.widgetName).off("." + n.widgetName), n.element !== n.chartElement && n.chartElement.remove(), n.element.empty(), n.styles && (n.styles = null), n.disabledDiv && (n.disabledDiv.remove(), n.disabledDiv = null), e.prototype.destroy.call(this) }, s.prototype.getCanvas = function () { return this.canvas }, s.prototype.addSeriesPoint = function (e, t, n) { var r = this.options.seriesList, i = null, s = null; if (e >= r.length) return; i = r[e], s = i.data || [], s.x.push(t.x), s.y.push(t.y), n && (s.x.shift(), s.y.shift()), this._setOption("seriesList", r) }, s.prototype.beginUpdate = function () { var e = this; e.updating++ }, s.prototype.endUpdate = function () { var e = this; e.updating--, e.redraw() }, s.prototype.redraw = function (e) { var t = this, n = t.options, r = 0, i = 0; if (t.updating > 0) return; if (e && t.rendered) return; r = n.width || t.element.width(), i = n.height || t.element.height(); if (r < 1 || i < 1) return; t.canvas.setSize(r, i), t._paint() }, s.prototype._parseTable = function () { if (!this.element.is("table")) return; var e = this, n = e.element, r = e.options, i = t("caption", n), s = t("thead th", n), o = [], u = t("tbody tr", n); i.length && (r.header = t.extend({ visible: !0, text: t.trim(t(i[0]).text()) }, r.header), i.length > 1 && (r.footer = t.extend({ visibel: !0, text: t.trim(t(i[1]).text()) }, r.footer))), r.legend = t.extend({ visible: !0 }, r.legend), e._getSeriesFromTR(s, u, o), e.options.seriesList = o }, s.prototype._getSeriesFromTR = function (e, n, r) { var i = [], s = null, o = null; e.length && e.each(function () { s = t.trim(t(this).text()), i.push(s) }), n.length && n.each(function () { var e = t("th", t(this)), n = t.trim(e.text()), s = [], u = t("td", t(this)); u.length && u.each(function (e, n) { var r = t(this); s.push(parseFloat(t.trim(r.text()))) }), o = { label: n, legendEntry: !0, data: { x: i, y: s } }, r.push(o) }) }, s.prototype._destroyRaphaelArray = function (e) { if (!e) return; var n = e.length, r = 0, i, s; for (; n && r < n; r++) i = e[r], i && i[0] && (s = t(i.node), s.unbind().removeData(), i.wijRemove(), s.remove(), s = null), e[r] = null }, s.prototype._clearChartElement = function () { var e = this, n = e.chartElement.data("fields"); e._destroyRaphaelArray(e.headerEles), e._destroyRaphaelArray(e.footerEles), e._destroyRaphaelArray(e.legendEles), e._destroyRaphaelArray(e.legends), e._destroyRaphaelArray(e.legendIcons), e._destroyRaphaelArray(e.legendDots), e._destroyRaphaelArray(e.axisEles), e._destroyRaphaelArray(e.chartLabelEles), e.tooltip && (e.tooltip.destroy(), e.tooltip = null), e.dataPoints = null, e.pointXs = null, n && n.trackers && (e._destroyRaphaelArray(n.trackers), n.trackers = null), e.headerEles = [], e.footerEles = [], e.legendEles = [], e.legends = [], e.legendIcons = [], e.legendDots = [], e.axisEles = [], e.chartLabelEles = [], n && n.chartElements && (t.each(n.chartElements, function (t, n) { e._destroyRaphaelArray(n) }), n.chartElements = null), n && n.seriesEles && (n.seriesEles = null), e.seriesEles && (e.seriesEles = []), e.canvas.clear(), e.innerState = null, e.axisInfo = null, e.seriesGroup = null, e.lastAxisOffset = null, e.innerState = {} }, s.prototype._text = function (e, t, n) { var r = this.canvas.text(e, t, n); return this.options.disableDefaultTextStyle && (r.node.style.cssText = ""), r }, s.prototype._paint = function () { var e = this, t = e.options, n = e.element, r = n.css("display") === "none" || n.css("visibility") === "hidden", i = {}, s = null; r && (i = n.css("left"), s = n.css("position"), n.css("left", "-10000px"), n.css("position", "absolute"), n.show()); if (n.is(":hidden")) { r && (n.css("left", i), n.css("position", s), n.hide()); return } e._clearChartElement(); if (e._trigger("beforePaint") === !1) return; e._preHandleSeriesData(), e.canvasBounds = { startX: 0, endX: t.width || n.width(), startY: 0, endY: t.height || n.height() }, e._paintHeader(), e._paintFooter(), e._paintLegend(), e._paintChartArea(), t.indicator && t.indicator.visible && this.pointXs && (this.pointXs = this.pointXs.sort(function (e, t) { return e - t })), e._paintTooltip(), e._trigger("painted"), e.rendered = !0, e.styles && (t.seriesStyles = e.styles.style, t.seriesHoverStyles = e.styles.hoverStyles), r && (n.css("left", i), n.css("position", s), n.hide()) }, s.prototype._paintIndicater = function () { }, s.prototype._calculatePosition = function (e, t, n) { var r = { x: 0, y: 0 }, i = 5, s = 5, o = this.canvasBounds; switch (e) { case "north": r.x = (o.endX - o.startX) / 2, r.y = o.startY + n / 2 + s, o.startY = o.startY + s * 2 + n; break; case "south": r.x = (o.endX - o.startX) / 2, r.y = o.endY - n / 2 - s, o.endY = o.endY - s * 2 - n; break; case "east": r.x = o.endX - t / 2 - i, r.y = (o.endY - o.startY) / 2, o.endX = o.endX - i * 2 - t; break; case "west": r.x = o.startX + t / 2 + i, r.y = (o.endY - o.startY) / 2, o.startX = o.startX + i * 2 + t } return r }, s.prototype._paintHeader = function () { var e = 2, n = this, r = n.options, i = r.header, s = null, o = null, u = null, a = null, f = null, l = null, c = 0, h = null; i.text && i.text.length > 0 && i.visible && (s = i.compass, o = n._text(0, 0, i.text), t.wijraphael.addClass(t(o.node), r.wijCSS.headerText), c = n._getRotationByCompass(s), u = t.extend(!0, {}, r.textStyle, i.textStyle), o.attr(u), o.transform("...R" + c), a = o.wijGetBBox(), f = n._calculatePosition(s, a.width, a.height), o.transform(Raphael.format("...T{0},{1}", f.x, f.y)), l = o.wijGetBBox(), h = n.canvas.rect(l.x - e, l.y - e, l.width + 2 * e, l.height + 2 * e), t.wijraphael.addClass(t(h.node), r.wijCSS.headerContainer), h.attr(i.style), h.toBack(), n.headerEles.push(o), n.headerEles.push(h)) }, s.prototype._paintFooter = function () { var e = 2, n = this, r = n.options, i = r.footer, s = null, o = null, u = null, a = null, f = null, l = null, c = 0, h = null; i.text && i.text.length > 0 && i.visible && (s = i.compass, o = n._text(0, 0, i.text), t.wijraphael.addClass(t(o.node), r.wijCSS.footerText), c = n._getRotationByCompass(s), u = t.extend(!0, {}, r.textStyle, i.textStyle), o.attr(u), o.transform("...R" + c), a = o.wijGetBBox(), f = n._calculatePosition(s, a.width, a.height), o.transform(Raphael.format("...T{0},{1}", f.x, f.y)), l = o.wijGetBBox(), h = n.canvas.rect(l.x - e, l.y - e, l.width + 2 * e, l.height + 2 * e), t.wijraphael.addClass(t(h.node), r.wijCSS.footerContainer), h.attr(i.style), h.toBack(), n.footerEles.push(o), n.footerEles.push(h)) }, s.prototype._getRotationByCompass = function (e) { var t = 0; return e === "east" ? t = 90 : e === "west" && (t = -90), t }, s.prototype._paintLegendIcon = function (e, n, r, i, s, o, u, a, f, l) { var c = this, h = c.canvas.rect(e, n, r, i); return t(h.node).data("legendIndex", o).data("index", u), c.legendIcons.push(h), s && h.attr(s), t.wijraphael.addClass(t(h.node), a), h }, s.prototype._paintLegend = function () { if (!this.options.legend.visible) return; var e = this, n = e.options, r = t.extend(!0, { size: { width: 22, height: 10 } }, n.legend), i = 2, s = n.seriesStyles, o = [].concat(n.seriesList), u = r.compass, a = r.orientation, f, l, c, h, p = e.canvasBounds, d = p.endX - p.startX, v = p.endY - p.startY, m = r.size.width, g = r.size.height, y, b = 0, w = 0, E = 0, S = 0, x = 0, T = 0, N = 1, C = 0, k = 0, L = 0, A = 0, O = 0, M, _, D, P, H = [], B = 0, j = 0, F = 0, I = []; r.text && r.text.length && (f = e._text(0, 0, r.text), t.wijraphael.addClass(t(f.node), n.wijCSS.legendTitle), l = t.extend(!0, {}, n.textStyle, r.textStyle, r.titleStyle), f.attr(l), e.legendEles.push(f)), r.reversed && (o = o.reverse()), F = o.length, e.widgetName === "wijcompositechart" && (F = 0, t.each(o, function (e, t) { t.type === "pie" ? F += t.data.length : F++ })), t.each(o, function (i, o) { function u(i) { var o = r.reversed ? F - 1 - B : B, u = s[o], a = t.extend(!0, { fill: "none", opacity: 1, stroke: "black" }, u), f, l, c, h = !1, p = i.type, d; i.legendEntry && i.display !== "exclude" && (l = t.extend(!0, {}, n.textStyle, r.textStyle), r.textWidth ? f = e.canvas.wrapText(0, 0, i.label, r.textWidth, "far", l) : (f = e._text(0, 0, i.label), f.attr(l)), t.wijraphael.addClass(t(f.node), n.wijCSS.legendText + " " + n.wijCSS.legend), e.legends.push(f), c = t.extend(a, { "stroke-width": 1 }), H.push(c), I.push(i), e.widgetName === "wijcompositechart" ? h = p === "line" || p === "spline" || p === "bezier" || p === "area" : h = e.widgetName === "wijlinechart", r.textWidth ? t.each(f, function (e, r) { i.visible === !1 && !h && (t(r.node).data("hidden", !0).data("textOpacity", r.attr("opacity") || 1), r.attr("opacity", .3)), t.wijraphael.addClass(t(r.node), n.wijCSS.legendText + " " + n.wijCSS.legend), t(r.node).data("legendIndex", j).data("index", B) }) : (i.visible === !1 && !h && (t(f.node).data("hidden", !0).data("textOpacity", f.attr("opacity") || 1), f.attr("opacity", .3)), t.wijraphael.addClass(t(f.node), n.wijCSS.legendText + " " + n.wijCSS.legend), t(f.node).data("legendIndex", j).data("index", B)), j++), B++ } o = t.extend(!0, { legendEntry: !0, display: "show" }, o); if (o.type === "pie" && o.legendEntry) t.each(o.data, function (e, n) { n = t.extend({ legendEntry: o.legendEntry }, n), u(n) }); else if (e._isPieChart()) u(o); else if (e._isStockChart() && e._validateSeriesData(o)) u(o); else { if (o.data.x === undefined && o.data.xy === undefined || o.data.xy === undefined && o.data.y === undefined) return !0; u(o) } }), c = e.legends.length, h = r.textMargin, f && (y = f.wijGetBBox(), b = y.height, w = y.width), t.each(e.legends, function (e, t) { var n = t.wijGetBBox(); n.width > E && (E = n.width), n.height > S && (S = n.height) }); if (u === "east" || u === "west") a === "horizontal" ? (x = c * (E + m + i) + c * (h.left + h.right), x > d / 2 ? (N = Math.floor(d / 2 / E), N < 1 && (N = 1)) : N = c) : a === "vertical" && (T = S * c + b + c * (h.top + h.bottom), T > v ? N = Math.ceil(T / v) : N = 1); else if (u === "south" || u === "north") a === "horizontal" ? (x = (E + m + i) * c + c * (h.left + h.right), x > d ? (N = Math.floor(c / x * d), N < 1 && (N = 1)) : N = c) : a === "vertical" && (T = S * c + b + c * (h.top + h.bottom), T > v / 2 ? (C = Math.floor(v - b) / 2 / S, N = Math.ceil(c / C)) : N = 1); N === 0 && (N = 1), k = N * (E + m + i) + N * (h.left + h.right), L = S * Math.ceil(c / N) + b + Math.ceil(c / N) * (h.top + h.bottom), k = k > w ? k : w, M = e._calculatePosition(u, k, L), _ = M.x - k / 2, D = M.y - L / 2, P = e.canvas.rect(_ - i, D - i, k + 2 * i, L + 2 * i), t.wijraphael.addClass(t(P.node), n.wijCSS.legendContainer), P.attr(r.style), P.toBack(), e.legendEles.push(P), f && f.transform(Raphael.format("...T{0},{1}", _ + k / 2, D + b / 2)), A = b, t.each(e.legends, function (s, o) { d = H[s]; var u = o.wijGetBBox(), a, f = d["stroke-width"] || 0, l = _ + O * (m + f * 2 + E + i) + (O + 1) * h.left + O * h.right, c = D + A + u.height / 2 + h.top + S / 2 - u.height / 2, p = c - g / 2 - f, d, v, y = o; r.textWidth && (y = o[0]), a = e._paintLegendIcon(l, p, m, g, d, t(y.node).data("legendIndex"), t(y.node).data("index"), n.wijCSS.legendIcon + " " + n.wijCSS.legend, I[t(y.node).data("legendIndex")], y), t(y.node).data("hidden") === !0 && (t(y.node).data("iconOpacity", a.attr("opacity") || 1), a.attr("opacity", .3)), r.textStyle["text-anchor"] === "start" && (l -= u.width / 2), r.textWidth ? o.transform(Raphael.format("...T{0},{1}", l + m + i, c - u.height / 2)) : o.transform(Raphael.format("...T{0},{1}", l + m + i + u.width / 2, c)), Raphael.vml && (v = e.canvas.rect(l + m + i, c - u.height / 2, u.width, u.height).attr({ stroke: "none", fill: "#000000", opacity: .01 }), t.wijraphael.addClass(t(v.node), n.wijCSS.legendTextCover + " " + n.wijCSS.legend), t(v.node).data("legendIndex", t(y.node).data("legendIndex")), t(v.node).data("index", t(y.node).data("index")), e.legendEles.push(v)), o.toFront(), O++, O === N && (O = 0, A += S + h.top + h.bottom) }) }, s.prototype._getLegendStyle = function (e) { return e }, s.prototype._hasAxes = function () { return this.widgetName === "wijpiechart" ? !1 : !0 }, s.prototype._applyAxisText = function (e, n) { var r = this, i = e.text, s = null, o = null, u = null, a = 0, f = 0, l = n.bounds || r.canvasBounds; if (i !== null && i !== undefined && i.length > 0) { o = r._text(-100, -100, i), u = t.extend(!0, {}, r.options.textStyle, e.textStyle), o.attr(u), s = o.wijGetBBox(), u["margin-left"] && (f += parseFloat(u["margin-left"])), u["margin-top"] && (a += parseFloat(u["margin-top"])), u["margin-right"] && (f += parseFloat(u["margin-right"])), u["margin-bottom"] && (a += parseFloat(u["margin-bottom"])); switch (e.compass) { case "north": l.startY += s.height + a; break; case "south": l.endY -= s.height + a; break; case "east": l.endX -= s.height + f; break; case "west": l.startX += s.height + f } o.wijRemove(), o = null } return s }, s.prototype._isSeriesDataEmpty = function () { var e = this, n = e.options.seriesList; return !n || n.length === 0 ? !0 : (t.each(n, function (e, t) { if (!t.data || (!t.data.x || !t.data.y) && !t.data.xy) return !0 }), !1) }, s.prototype._setTooltipContent = function (e) { var n = this, r, i, s, o = n.tooltip, u, a = {}, f = n.options.hint, l = t.isFunction; o && (r = [], t.each(e, function (e, n) { var i = n.valX, s = n.valY; i && s ? r.push(t.extend({}, n, { x: i, y: s })) : r.push(n) }), u = o.getOptions(), i = f.title, s = f.content, l(i) && (a.title = function () { return i.call(r) }), l(s) && (a.content = function () { return s.call(r) }), o.setOptions(a)) }, s.prototype._setTooltip = function () { var e = this, t = e.options, n = e.tooltip, r; n && (r = { closeBehavior: "none", style: { stroke: t.indicator.style.stroke }, animated: !1, showDelay: 0, hideDelay: 0, windowCollisionDetection: "fit", beforeShowing: function (t, n) { if (this.target && e.indicatorLine) return !1 } }, t.horizontal && (r.compass = "east"), n.setOptions(r)) }, s.prototype._resetTooltip = function () { var e = this, n = e.options, r = n.hint, i = r.title, s = r.content, o = e.tooltip, u = t.isFunction, a = t.extend(!0, {}, this.options.hint); o && (a.animated = r.animated, a.showDelay = r.showDelay, a.hideDelay = r.hideDelay, a.title = r.title, a.content = r.content, a.closeBehavior = r.closeBehavior || "auto", a.windowCollisionDetection = "fit", u(i) && (a.title = function () { return e._getTooltipText(i, this.target) }), u(s) && (a.content = function () { return e._getTooltipText(s, this.target) }), a.beforeShowing = function () { e._onBeforeTooltipShowing(this) }, o.setOptions(a)) }, s.prototype._fotmatTooltip = function (e) { var t = this; return t._isDate(e) ? Globalize.format(e, "f", t._getCulture()) : isNaN(e) ? e : Globalize.format(parseFloat(e), "n", t._getCulture()) }, s.prototype._paintTooltip = function () { var e = this, n = e.options, r = n.hint, s = !n.disabled && r.enable, o = r, u, a, f = t.isFunction; s && !e.tooltip && (o = t.extend(!0, {}, r, {}), u = r.title, a = r.content, a || (a = r.content = function () { var n; if (t.isArray(this)) { var r = ""; return t.each(this, function (t, i) { n = i.label, i.lineSeries && i.lineSeries.label && (n = i.lineSeries.label), r += n + ":" + e._fotmatTooltip(i.y) + "\n" }), r } return n = this.label, this.lineSeries && this.lineSeries.label && (n = this.lineSeries.label), n + ":" + e._fotmatTooltip(this.y) }), f(u) && (o.title = function () { return e._getTooltipText(u, this.target) }), f(a) && (o.content = function () { return e._getTooltipText(a, this.target) }), o.beforeShowing = function () { e._onBeforeTooltipShowing(this) }, e.tooltip = new i(e.canvas, null, o)) }, s.prototype._getTooltipText = function (e, n) { var r = t(n.node).data("wijchartDataObj"), i = { data: r, label: r.label, x: r.x, y: r.y, target: n, fmt: e }; return t.proxy(e, i)() }, s.prototype._onBeforeTooltipShowing = function (e) { var t = e.target, n = this.options.hint.style; t && (e.options.style.stroke = n.stroke || t.attrs.stroke || t.attrs.fill) }, s.prototype._paintChartArea = function () { var e = this, n = e.options, r = n.axis, i = 2, s = null, o = null, u = {}, a = 5, f = 0, l = 0, c = t.isArray(r.y), h = 0, p, d, v; e._applyMargins(), e.isMultiYAxis = c; if (e._isSeriesDataEmpty()) return; c && t.each(r.y, function (e, n) { r.y[e] = t.extend(!0, { alignment: "center", style: { stroke: "#999999", "stroke-width": .5 }, visible: !1, textVisible: !0, text: "", textStyle: { fill: "#888", "font-size": 15, "font-weight": "bold" }, labels: { style: { fill: "#333", "font-size": 11 }, textAlign: "center", width: null }, compass: "west", autoMin: !0, autoMax: !0, min: null, max: null, origin: null, autoMajor: !0, autoMinor: !0, unitMajor: null, unitMinor: null, gridMajor: { visible: !0, style: { stroke: "#999999", "stroke-width": "0.5", "stroke-dasharray": "none" } }, gridMinor: { visible: !1, style: { stroke: "#CACACA", "stroke-dasharray": "- " } }, tickMajor: { position: "none", style: { fill: "black" }, factor: 1 }, tickMinor: { position: "none", style: { fill: "black" }, factor: 1 }, annoMethod: "values", annoFormatString: "", valueLabels: [] }, n) }); if (e._hasAxes()) { if (e.innerState.axisInfo) e.axisInfo = e.innerState.axisInfo, e.canvasBounds = e.innerState.canvasBounds; else { s = e._applyAxisText(r.x, {}), e.axisInfo = { x: { id: "x", tprec: 0, isTime: !1, offset: 0, vOffset: 0, max: 0, min: 0, majorTickRect: null, minorTickRect: null, annoFormatString: null, textBounds: s, axisTextOffset: i, autoMax: !0, autoMin: !0, autoMajor: !0, autoMinor: !0, annoMethod: r.x.annoMethod, valueLabels: r.x.valueLabels || [] }, y: {} }, e.axisCompass[r.x.compass] = !0, c ? t.each(r.y, function (t, n) { o = e._applyAxisText(n, {}), e.axisInfo.y[t.toString()] = { id: "y" + t, tprec: 0, isTime: !1, offset: 0, vOffset: 0, max: 0, min: 0, majorTickRect: null, minorTickRect: null, annoFormatString: null, textBounds: o, axisTextOffset: i, autoMax: !0, autoMin: !0, autoMajor: !0, autoMinor: !0, annoMethod: n.annoMethod, valueLabels: n.valueLabels || [] }, e.axisCompass[n.compass] || (e.axisCompass[n.compass] = !0) }) : (o = e._applyAxisText(r.y, {}), e.axisInfo.y[0] = { id: "y", tprec: 0, isTime: !1, offset: 0, vOffset: 0, max: 0, min: 0, majorTickRect: null, minorTickRect: null, annoFormatString: null, textBounds: o, axisTextOffset: i, autoMax: !0, autoMin: !0, autoMajor: !0, autoMinor: !0, annoMethod: r.y.annoMethod, valueLabels: r.y.valueLabels || [] }, e.axisCompass[r.y.compass] || (e.axisCompass[r.y.compass] = !0)), e._getSeriesGroup(c), u = e._getDataExtreme(c), e.extremeValue = u, r.x.autoMin && e.axisInfo.x.autoMin ? r.x.min = u.txn : r.x.min && e._isDate(r.x.min) && (r.x.min = t.toOADate(r.x.min)), r.x.autoMax && e.axisInfo.x.autoMax ? r.x.max = u.txx : r.x.max && e._isDate(r.x.max) && (r.x.max = t.toOADate(r.x.max)), t.each(u.y, function (e, t) { h++ }); for (p = 0; p < (r.y.length || 1) ; p++) { d = r.y[p] || r.y, v = p.toString(), d.autoMin && e.axisInfo.y[v].autoMin && u.y[v] ? d.min = u.y[v].tyn : d.min && e._isDate(d.min) && (d.min = t.toOADate(d.min)), d.autoMax && e.axisInfo.y[v].autoMax && u.y[v] ? d.max = u.y[v].tyx || 0 : d.max && e._isDate(d.max) && (d.max = t.toOADate(d.max)); do { l = e._autoPosition(e.axisInfo, r, "y", v), f = e._autoPosition(e.axisInfo, r, "x", v); if (l === e.axisInfo.y[v].offset && f === e.axisInfo.x.offset) { a = 0; break } !isNaN(f) && !isNaN(l) && (l !== e.axisInfo.y[v].offset && l !== 0 && (e.axisInfo.y[v].offset = l, e.axisInfo.y[v].vOffset = f), f !== e.axisInfo.x.offset && f !== 0 && (e.axisInfo.x.offset = f, e.axisInfo.x.vOffset = l)), a-- } while (a > 0) } e._adjustPlotArea(r.x, e.axisInfo.x), e._adjustPlotArea(r.y, e.axisInfo.y, !0), e.innerState.axisInfo = e.axisInfo, e.innerState.canvasBounds = e.canvasBounds } e._paintAxes(), e._paintPlotArea() } else e._paintPlotArea() }, s.prototype._getSeriesGroup = function (e) { var n = this, r = n.options, i = {}; t.each(r.seriesList, function (t, n) { n.yAxis && e ? i[n.yAxis.toString()] ? i[n.yAxis.toString()].push(n) : i[n.yAxis.toString()] = [n] : i[0] ? i[0].push(n) : i[0] = [n] }), n.seriesGroup = i }, s.prototype._adjustPlotArea = function (e, n, r) { var i = this.canvasBounds, s, o = { east: Number.MIN_VALUE, west: Number.MIN_VALUE, south: Number.MIN_VALUE, north: Number.MIN_VALUE }; if (r) t.each(n, function (e, t) { s = e }), t.each(n, function (t, n) { var r = e[t] || e, i = r.compass; r.max = n.max, r.min = n.min; switch (i) { case "north": o.north = Math.max(n.offset, o.north); break; case "south": o.south = Math.max(n.offset, o.south); break; case "east": o.east = Math.max(n.offset, o.east); break; case "west": o.west = Math.max(n.offset, o.west) } }), o.north !== Number.MIN_VALUE && (i.startY += o.north), o.south !== Number.MIN_VALUE && (i.endY -= o.south), o.east !== Number.MIN_VALUE && (i.endX -= o.east), o.west !== Number.MIN_VALUE && (i.startX += o.west); else { e.max = n.max, e.min = n.min; switch (e.compass) { case "north": i.startY += n.offset; break; case "south": i.endY -= n.offset; break; case "east": i.endX -= n.offset; break; case "west": i.startX += n.offset } } }, s.prototype._autoPosition = function (e, t, n, r) { return this._autoPositionCartesianAxis(e, t, n, r) }, s.prototype._autoPositionCartesianAxis = function (e, n, r, i) { var s = this, o = null, u, a, f, l, c, h, p, d, v = s.lastAxisOffset || {}, m, g; r === "y" ? (u = e.y[i], a = n.y[i] || n.y, l = n.x, f = e.x) : (u = e.x, a = n.x, f = e.y[i], l = n.y[i] || n.y), c = a.compass, h = l.origin, p = f.max, d = f.min, h !== null && s._isDate(h) && (h = t.toOADate(h)), s._calculateParameters(u, a), o = s._getMaxExtents(u, a); switch (c) { case "north": case "south": m = o.height, u.maxExtent = m; break; case "east": case "west": m = o.width, u.maxExtent = m } return r === "y" && v[c] && (t.each(v[c], function (e, t) { e !== i && (g = t) }), g && !u.isPartAxis && (u.preStartOffset = g, m += g)), r === "y" && (v[c] === undefined && (v[c] = {}), v[c][i] = m + s._getAxisLabelBox(a).width, s.lastAxisOffset = v), m }, s.prototype._getAxisLabelBox = function (e) { var n = this, r = n.options, i = e.text, s = 0, o = 0, u = 0, a = 0, f, l, c = n._isVertical(e.compass), h = t.extend(!0, {}, r.textStyle, e.textStyle); return h["margin-top"] && (s = parseFloat(h["margin-top"])), h["margin-left"] && (u = parseFloat(h["margin-left"])), h["margin-right"] && (o = parseFloat(h["margin-right"])), h["margin-bottom"] && (a = parseFloat(h["margin-bottom"])), f = n._text(0, 0, i), f.attr(h), c && f.transform("...R-90"), l = f.wijGetBBox(), f.wijRemove(), f = null, { width: l.width + u + o, height: l.height + a + s } }, s.prototype._getMaxExtents = function (e, n, r) { var i = this, s = i.options, o = null, u = { width: 0, height: 0 }, a = e.min, f = e.max, l = e.isTime, c = n.annoFormatString, h = s.is100Percent, p = 0, d = n.compass, v = n.labels, m, g = !1, y = e.bounds || i.canvasBounds, b, w; e.majorTickRect = i._getTickRect(e, n, !0, !0, r), e.minorTickRect = i._getTickRect(e, n, !1, !0, r), o = i._getMajorTickValues(e, n); if (!n.textVisible) return u; if (!c || c.length === 0) c = e.annoFormatString; return m = t.extend(!0, {}, s.textStyle, n.textStyle, v.style), w = m.transform, w && w.length && t.each(w, function (e, t) { if (t[0].toLowerCase() === "r") return g = !0, !1 }), m = t.extend(!0, m, e.textStyle), b = y.endX - y.startX - e.vOffset - e.axisTextOffset, o && o.length && (b /= o.length - 1, t.each(o, function (n, r) { var s, o, y; if (r < a || r > f) return !0; if (e.annoMethod === "valueLabels") { if (r < 0) return !0; if (p >= e.valueLabels.length) return !1; r = e.valueLabels[p], r.text ? r = r.text : typeof r.value != "undefined" && (r = r.value, c && c.length && (r = Globalize.format(r, c, i._getCulture()))) } else e.annoMethod === "values" && (c && c.length ? (l && (r = t.fromOADate(r)), r = Globalize.format(r, c, i._getCulture())) : h && e.id === "y" && (r = Globalize.format(r, "p0", i._getCulture()))); v.width ? s = i.canvas.wrapText(-100, -100, r, v.width, v.textAlign, m) : s = i._text(-100, -100, r).attr(m), o = s.wijGetBBox(), !i._isVertical(d) && !g && e.annoMethod === "valueLabels" && o.width > b && (s.attr({ transform: "r-45" }), o = s.wijGetBBox(), n === 0 && (m.transform = "r-45", e.textStyle = { transform: "r-45" }, y = s.clone(), y.attr({ transform: "r0" }), o = y.wijGetBBox(), Math.sqrt(2) * o.height > b && (s.attr({ transform: "r-90" }), m.transform = "r-90", e.textStyle = { transform: "r-90" }), y.wijRemove(), y = null, o = s.wijGetBBox())), s.wijRemove(), s = null, o.width > u.width && (u.width = o.width), o.height > u.height && (u.height = o.height), p++ })), u.width < v.width && (u.width = v.width), e.labelWidth = u.width, u }, s.prototype._getMajorTickValues = function (e, n) { var r = [], i = e.valueLabels; return i && i.length > 0 && t.each(i, function (e, t) { if (typeof t.text != "undefined" || typeof t.value != "undefined") return !1; typeof t == "string" ? i[e] = { text: t, gridLine: !1 } : i[e] = { value: t, gridLine: !1 } }), e.annoMethod === "valueLabels" && i && i.length > 0 && typeof i[0].value != "undefined" ? (r = this._getSortedDataValues(e, n), r) : (r = this._getTickValues(e.max, e.min, n.unitMajor, e.tprec, !e.isTime, n.autoMajor), r) }, s.prototype._getSortedDataValues = function (e, n) { var r = this, i = [], s = e.valueLabels; return t.each(s, function (e, n) { var s = n.value; r._isDate(s) ? i.push(t.toOADate(s)) : typeof s == "number" ? i.push(s) : i.push(e) }), i }, s.prototype._getMinorTickValues = function (e, t) { var n = []; return n = this._getTickValues(e.max, e.min, t.unitMinor, e.tprec, !e.isTime, t.autoMinor), n }, s.prototype._getTickValues = function (e, n, i, s, o, u) { var a = this, f = [], l = n, c = 0, h = 0, p = 0, d = 0, v = 0, m = 0; try { if (i === 0) f = [e, n]; else { u ? (s + 1 < 0 ? s = -1 : s + 1 > 15 && (s = 14), m = t.round(r.signedCeiling(n / i) * i, s + 1), m < e && (n = m), p = parseInt(t.round(e / i, 5).toString(), 10), d = parseInt(t.round(n / i, 5).toString(), 10), v = parseInt((p - d + 1).toString(), 10), v > 1 && (h = d * i, h < n && (v--, n += i), h = n + (v - 1) * i, h > e && v--), v < 1 && (v = 2, n = l, i = e - n)) : (v = parseInt(((e - n) / i + 1).toString(), 10), v > 1 && (h = n + (v - 1) * i, h > e && v--), v < 1 && (v = 2, i = e - n)); for (c = 0; c < v; c++) o ? u ? f[c] = t.round(n + c * i, s + 1) : f[c] = n + c * i : f[c] = n + c * i } } catch (g) { } return f }, s.prototype._getTickRect = function (e, t, n, r, i) { var s = t.compass, o = 0, u = null, a = 3, f = 2, l = 2, c = t.tickMajor.factor, h = t.tickMinor.factor, p = { x: 0, y: 0, width: 0, height: 0 }; n ? (u = t.tickMajor.position, c = c > 0 ? c : 1, o = a * c) : (u = t.tickMinor.position, h = h > 0 ? h : 1, o = f * h); if (u === "none" || u === "inside" && r) o = 0; return s === "east" || s === "west" ? (p = { x: 0, y: -1, width: o * l, height: l }, s === "east" && (u === "outside" || u === "cross" && r) || s === "west" && u === "inside" ? p.width += 2 : r || (u === "cross" && (p.width <<= 1), p.width += 2)) : (p = { x: -1, y: 0, width: l, height: o * l }, s === "south" && (u === "outside" || u === "corss" && r) || s === "north" && u === "inside" ? p.height += 2 : r || (u === "cross" && (p.height <<= 1), p.height += 2)), p }, s.prototype._applyMargins = function () { var e = this, t = e.options, n = e.canvasBounds; n.startX += t.marginLeft, n.endX -= t.marginRight, n.startY += t.marginTop, n.endY -= t.marginBottom }, s.prototype._paintAxes = function () { var e = this, n = e.options.axis, r = e.axisInfo, i = n.x, s = n.y, o = r.x, u = r.y, a; a = e._paintAxis(i, o), t.each(u, function (t, n) { var r = s[t] || s; r.origin !== null && e._translateAxisIfNeeded(a, i.compass, r.origin, r.compass, n.max, n.min) }), t.each(u, function (t, n) { var r = s[t] || s; a = e._paintAxis(r, n), i.origin !== null && e._translateAxisIfNeeded(a, r.compass, i.origin, i.compass, o.max, o.min) }) }, s.prototype._translateAxisIfNeeded = function (e, n, r, i, s, o) { var u = this, a = i === "west" || i === "east", f = u.canvasBounds, l = r, c; u._isDate(l) && (l = t.toOADate(l)), a ? (n === "south" ? c = (o - l) / (s - o) * (f.endY - f.startY) : c = (s - l) / (s - o) * (f.endY - f.startY), t.each(e, function (e, t) { t.transform(Raphael.format("...T{0},{1}", 0, c)) })) : (n === "west" ? c = (l - o) / (s - o) * (f.endX - f.startX) : c = (l - s) / (s - o) * (f.endX - f.startX), t.each(e, function (e, t) { t.transform(Raphael.format("...T{0},{1}", c, 0)) })) }, s.prototype._paintAxis = function (e, n) { var r = this, i = r.options, s = n.bounds || r.canvasBounds, o = { x: 0, y: 0 }, u = { x: 0, y: 0 }, a = e.compass, f = 2, l = !0, c = null, h = [], p = [], d = [], v = n.max, m = n.min, g = e.unitMajor, y = e.unitMinor, b = e.tickMajor.position, w = e.tickMinor.position, E = n.maxExtent, S = e.tickMajor.style, x = e.tickMinor.style, T = n.majorTickRect, N = n.minorTickRect, C = n.axisTextOffset, k = e.gridMajor, L = e.gridMinor, A = e.labels, O = 0, M = [], _ = 0, D = e.annoFormatString, P = null, H = []; T = r._getTickRect(n, e, !0, !1), N = r._getTickRect(n, e, !1, !1); if (!D || D.length === 0) D = n.annoFormatString; h = r._getMajorTickValues(n, e), p = r._getMinorTickValues(n, e), d = r._resetMinorTickValues(p, h); switch (a) { case "south": o.x = s.startX, o.y = s.endY, u.x = s.endX, u.y = s.endY, l = !1; break; case "north": o.x = s.startX, o.y = s.startY - f, u.x = s.endX, u.y = s.startY - f, l = !1; break; case "east": o.x = s.endX - f, n.preStartOffset && (o.x += n.preStartOffset), o.y = s.endY, u.x = s.endX - f, u.y = s.startY; break; case "west": o.x = s.startX, n.preStartOffset && (o.x -= n.preStartOffset), o.y = s.endY, u.x = s.startX, u.y = s.startY } return e.visible && (c = r.canvas.line(o.x, o.y, u.x, u.y).attr(e.style), t.wijraphael.addClass(t(c.node), i.wijCSS.axis), r.axisEles.push(c), H.push(c)), t.each(h, function (s, f) { var l = f, c = n.isTime, h = i.is100Percent, p, d, y = !1, w = {}; if (f < m || f > v) return _++, !0; if (n.annoMethod === "valueLabels") { if (_ >= n.valueLabels.length) return !1; l = n.valueLabels[_], y = l.gridLine, w = l.gridLineStyle, l.text ? l = l.text : typeof l.value != "undefined" && (l = l.value, D && D.length && (l = Globalize.format(l, D, r._getCulture()))) } else n.annoMethod === "values" && (D && D.length ? (c && (l = t.fromOADate(f)), l = Globalize.format(l, D, r._getCulture())) : h && n.id === "y" && (l = Globalize.format(f, "p0", r._getCulture()))); P = t.extend(!0, {}, i.textStyle, e.textStyle, A.style, n.textStyle), n.id === "x" && (l = r._getTickText(l)), p = r._paintMajorMinor(e.origin, v, m, f, b, g, T, a, o, u, E, C, S, l, k, e.textVisible, P, A.textAlign, A.width ? n.labelWidth : null, y, w), p && (p.elements && (H = H.concat(p.elements)), d = p.textInfo), d && (M.push(d), O < d.len && (O = d.len)), _++ }), A.width || t.each(M, function (e, t) { var n = t.text, r = (t.len - O) / 2; r = A.textAlign === "near" ? r * -1 : r, l ? n.transform(Raphael.format("...T{0},{1}", r, 0)) : n.transform(Raphael.format("...T{0},{1}", 0, r)) }), t.each(d, function (t, i) { var s; i > m && i < v && (s = r._paintMajorMinor(e.origin, v, m, i, w, y, N, a, o, u, E, C, x, null, L, e.textVisible, P, A.textAlign, A.width ? n.labelWidth : null), s && s.elements && (H = H.concat(s.elements))) }), e.text && e.text.length > 0 && H.push(r._paintAxisText(e, n)), n.isPartAxis && !n.isLastAxis && H.push(r.canvas.path(["M", o.x.toString(), o.y.toString() + (n.vOffset / 2).toString, "H", (o.x + n.maxExtent * 2).toString()].join())), H }, s.prototype._paintAxisText = function (e, n) { if (!e.text || e.text.length === 0) return; var r = this, i = r.options, s = e.text, o = e.compass, u = e.alignment, a = n.bounds || r.canvasBounds, f = a.startX, l = a.startY, c = a.endX, h = a.endY, p = f, d = l, v = n.textBounds, m = r._isVertical(o), g = n.axisTextOffset, y = n.majorTickRect, b = e.tickMajor.position, w = m ? y.width : y.height, E = null, S = null, x = 0, T = 0, N = 0, C = 0; E = t.extend(!0, {}, r.options.textStyle, e.textStyle), E["margin-top"] && (x = parseFloat(E["margin-top"])), E["margin-left"] && (T = parseFloat(E["margin-left"])), E["margin-right"] && (N = parseFloat(E["margin-right"])), E["margin-bottom"] && (C = parseFloat(E["margin-bottom"])), b === "cross" ? w /= 2 : b === "inside" && (w = 0); if (m) { switch (u) { case "near": d = h - v.width / 2; break; case "center": d = (l + h) / 2; break; case "far": d = l + v.width / 2 } o === "west" ? p = f - (n.offset + g + w + v.height / 2 + N) : p = c + n.offset + g + w + v.height / 2 + T } else { switch (u) { case "near": p = f + v.width / 2; break; case "center": p = (f + c) / 2; break; case "far": p = c - v.width / 2 } o === "north" ? d = l - (n.offset + g + w + v.height / 2 + C) : d = h + n.offset + g + w + v.height / 2 + x } return S = r._text(p, d, s), t.wijraphael.addClass(t(S.node), i.wijCSS.axisText), r.axisEles.push(S), S.attr(E), m && S.transform("...R-90"), S }, s.prototype._resetMinorTickValues = function (e, t) { var n = 0, r = 0, i = null, s = null; for (n = e.length - 1; n >= 0; n--) { i = e[n]; for (r = t.length - 1; r >= 0; r--) s = t[r], i === s && e.splice(n, 1) } return e }, s.prototype._getTickText = function (e) { return e }, s.prototype._paintMajorMinor = function (e, n, r, i, s, o, u, a, f, l, c, h, p, d, v, m, g, y, b, w, E) { var S = this, x = f.x, T = f.y, N = S.options, C = -1, k = -1, L = !0, A = S.canvasBounds, O = null, M = null, _ = [], D = [], P = null, H = { "stroke-width": 2 }, B = { text: null, len: 0 }, j = null, F = {}, I = [], q = S.axisCompass; switch (a) { case "south": s === "inside" ? T -= u.height : s === "cross" && (T -= u.height / 2), b ? k = T + h + u.height : k = T + h + u.height + c / 2, L = !1; break; case "west": s === "outside" ? x -= u.width : s === "cross" && (x -= u.width / 2), b ? C = x - (h + c) : C = x - (h + c / 2); break; case "north": s === "outside" ? T -= u.height : s === "cross" && (T -= u.height / 2), b ? k = T - (h + c) : k = T - (h + c / 2), L = !1; break; case "east": s === "inside" ? x -= u.width : s === "cross" && (x -= u.width / 2), b ? C = x + h + u.width : C = x + h + u.width + c / 2 } return L ? (T += (i - r) / (n - r) * (l.y - f.y), D = ["M", A.startX, T, "H", A.endX], v.visible && ((T !== A.startY || !q.north) && (T !== A.endY || !q.south) || e !== i) && (P = S.canvas.path(D.join(" ")), t.wijraphael.addClass(t(P.node), N.wijCSS.axisGridLine), P.attr(v.style), S.axisEles.push(P)), w && ((T !== A.startY || !q.north) && (T !== A.endY || !q.south) || e !== i) && (P = S.canvas.path(D.join(" ")), t.wijraphael.addClass(t(P.node), N.wijCSS.axisGridLine), P.attr(t.extend(!0, v.style, E)), S.axisEles.push(P)), k = T, s !== "none" && (_ = ["M", x, T, "h", u.width], p["stroke-width"] = u.height)) : (x += (i - r) / (n - r) * (l.x - f.x), D = ["M", x, A.startY, "V", A.endY], v.visible && ((x !== A.startX || !q.west) && (x !== A.endX || !q.east) || e !== i) && (P = S.canvas.path(D.join(" ")), t.wijraphael.addClass(t(P.node), N.wijCSS.axisGridLine), P.attr(v.style), S.axisEles.push(P)), w && ((x !== A.startX || !q.west) && (x !== A.endX || !q.east) || e !== i) && (P = S.canvas.path(D.join(" ")), t.wijraphael.addClass(t(P.node), N.wijCSS.axisGridLine), P.attr(t.extend(!0, {}, v.style, E)), S.axisEles.push(P)), b ? C = x - b / 2 : C = x, s !== "none" && (_ = ["M", x, T, "v", u.height], p["stroke-width"] = u.width)), s !== "none" && (M = S.canvas.path(_.join(" ")), t.wijraphael.addClass(t(M.node), N.wijCSS.axisTick), H = t.extend(H, p), M.attr(H), S.axisEles.push(M), I.push(M)), d !== null && m && (b ? (B = S.canvas.wrapText(C, k, d.toString(), b, y, g), t.wijraphael.addClass(t(B.node), N.wijCSS.axisLabel)) : (B = S._text(C, k, d.toString()), t.wijraphael.addClass(t(B.node), N.wijCSS.axisLabel), B.attr(g)), S.axisEles.push(B), I.push(B), m || B.hide(), y !== "center" && (j = B.getBBox(), O = { text: B, len: L ? j.width : j.height })), F = { textInfo: O, elements: I }, F }, s.prototype._paintPlotArea = function () { }, s.prototype._paintChartLabels = function () { var e = this, n = e.options.chartLabels; n && n.length && t.each(n, function (n, r) { var i; r = t.extend(!0, { compass: "east", attachMethod: "coordinate", attachMethodData: { seriesIndex: -1, pointIndex: -1, x: -1, y: -1 }, offset: 0, visible: !1, text: "", connected: !1 }, r); if (r.visible) { i = e._getChartLabelPointPosition(r); if (typeof i.x != "number" || typeof i.y != "number") return !1; e._setChartLabel(r, i) } }) }, s.prototype._getChartLabelPointPosition = function (e) { }, s.prototype._setChartLabel = function (e, n, r, i) { var s = this, o = e.compass, u = s.options, a = t.extend(!0, {}, u.textStyle, u.chartLabelStyle), f = s._text(0, 0, e.text).attr(a), l = e.offset, c = 0, h = 0, p = null, d = null; t.wijraphael.addClass(t(f.node), u.wijCSS.labelText), s.chartLabelEles.push(f), p = s._getCompassTextPosition(o, f.wijGetBBox(), l, n, r), l && e.connected && (d = s.canvas.path("M" + n.x + " " + n.y + "L" + p.endPoint.x + " " + p.endPoint.y), t.wijraphael.addClass(t(d.node), u.wijCSS.labelConnect), d.attr(i), s.chartLabelEles.push(d)), c = p.endPoint.x + p.offsetX, h = p.endPoint.y + p.offsetY, f.transform(Raphael.format("...T{0},{1}", c, h)).toFront() }, s.prototype._getCompassTextPosition = function (e, n, r, i, s) { var o = 0, u = 0, a = { x: 0, y: 0 }; switch (e.toLowerCase()) { case "east": s = 0; break; case "west": s = 180; break; case "north": s = 90; break; case "south": s = 270; break; case "northeast": s = 45; break; case "northwest": s = 135; break; case "southeast": s = 315; break; case "southwest": s = 225 } return s >= 0 && s < 22.5 || s > 337.5 && s < 360 ? o = n.width / 2 : s >= 22.5 && s < 67.5 ? (o = n.width / 2, u = -1 * n.height / 2) : s >= 67.5 && s < 112.5 ? u = -1 * n.height / 2 : s >= 112.5 && s < 157.5 ? (o = -1 * n.width / 2, u = -1 * n.height / 2) : s >= 157.5 && s < 202.5 ? o = -1 * n.width / 2 : s >= 202.5 && s < 247.5 ? (o = -1 * n.width / 2, u = n.height / 2) : s >= 247.5 && s < 292.5 ? u = n.height / 2 : (o = n.width / 2, u = n.height / 2), a = t.wijraphael.getPositionByAngle(i.x, i.y, r, s), { endPoint: a, offsetX: o, offsetY: u } }, s.prototype._mouseDown = function (e, t) { this._trigger("mouseDown", e, t) }, s.prototype._mouseUp = function (e, t) { this._trigger("mouseUp", e, t) }, s.prototype._mouseOver = function (e, t) { this._trigger("mouseOver", e, t) }, s.prototype._mouseOut = function (e, t) { this._trigger("mouseOut", e, t) }, s.prototype._mouseMove = function (e, t) { this._trigger("mouseMove", e, t) }, s.prototype._click = function (e, t) { this._trigger("click", e, t) }, s.prototype._mouseMoveInsidePlotArea = function (e, n) { var r = this, i = r.options, s = i.indicator, o = r.canvas, u, a, f, l = 0, c = [], h = i.horizontal; s && s.visible && this.isPlotAreaMouseDown && (h ? u = this._calculatePositionByX(n.top) : u = this._calculatePositionByX(n.left), u && this.indicatorLine && u.x !== this.lastIndicatorPosition && (t.each(u.data, function (e, t) { t.visible && c.push(t) }), c.length > 0 && (a = r.canvasBounds, h ? this.indicatorLine.transform("T0 " + u.x) : this.indicatorLine.transform("T" + u.x + " 0"), this._setTooltipContent(c), h ? this.tooltip.showAt({ x: a.endX, y: u.x }) : this.tooltip.showAt({ x: u.x, y: a.startY }), this.lastIndicatorPosition = u.x, r._indicatorLineShowing(c), this.lastIndicatorObjects = c))) }, s.prototype._calculatePositionByX = function (e) { var t = this, n = t.pointXs, r, i = t.dataPoints; return n && n.length > 0 && (r = this._calculatePositionByXInternal(e, n)), i ? { x: r, data: i[r.toString()] } : null }, s.prototype._calculatePositionByXInternal = function (e, t) { var n = t.length, r, i; return n === 1 ? t[0] : n === 2 ? Math.abs(e - t[0]) > Math.abs(e - t[1]) ? t[1] : t[0] : (r = parseInt((n / 2).toString()), e > t[r] ? i = t.slice(r) : i = t.slice(0, r + 1), this._calculatePositionByXInternal(e, i)) }, s.prototype._mouseMoveOutsidePlotArea = function (e, t) { this.indicatorLine && (this.indicatorLine.wijRemove(), this.indicatorLine = null, this.tooltip && this.tooltip.hide(), this._resetTooltip()) }, s.prototype._mouseDownInsidePlotArea = function (e, n) { this.isPlotAreaMouseDown = !0; var r = this, i = r.options, s = i.indicator, o = r.canvas, u, a, f, l = [], c = i.horizontal; s && s.visible && this.isPlotAreaMouseDown && (r._setTooltip(), c ? u = this._calculatePositionByX(n.top) : u = this._calculatePositionByX(n.left), u && (t.each(u.data, function (e, t) { t.visible && l.push(t) }), l.length > 0 && (a = r.canvasBounds, c ? f = ["M", a.startX, 0, "H", a.endX] : f = ["M", 0, a.startY, "V", a.endY], this.indicatorLine && this.indicatorLine.wijRemove(), this.indicatorLine = o.path(f), this.indicatorLine.attr(s.style), c ? this.indicatorLine.transform("T0 " + u.x) : this.indicatorLine.transform("T" + u.x + " 0"), this._setTooltipContent(l), c ? this.tooltip.showAt({ x: a.endX, y: u.x }) : this.tooltip.showAt({ x: u.x, y: a.startY }), this.lastIndicatorPosition = u.x, r._indicatorLineShowing(l), this.lastIndicatorObjects = l)), e.preventDefault()) }, s.prototype._indicatorLineShowing = function (e) { this.lastIndicatorObjects && this._removeIndicatorStyles(this.lastIndicatorObjects) }, s.prototype._removeIndicatorStyles = function (e) { }, s.prototype._mouseUpInsidePlotArea = function (e, t) { this.isPlotAreaMouseDown = !1, this.indicatorLine && (this.indicatorLine.wijRemove(), this.indicatorLine = null, this.tooltip && this.tooltip.hide(), this._resetTooltip()), this.lastIndicatorObjects && (this._removeIndicatorStyles(this.lastIndicatorObjects), this.lastIndicatorObjects = null) }, s.prototype._bindLiveEvents = function () { this._bindLegendEvents(), this._bindCanvasEvents() }, s.prototype._bindCanvasEvents = function () { var e = this, n = e.chartElement, r = "", i = "." + this.widgetName; window.navigator.msPointerEnabled && n.css("-ms-touch-action", "none"), t.support.isTouchEnabled && t.support.isTouchEnabled() && (r = "wij"), n.bind(r + "mousemove" + i, function (t) { var r = n.offset(), i = e.canvasBounds, s = { left: t.pageX - r.left, top: t.pageY - r.top }, o = e.options.disabled; if (o) return; s.left >= i.startX && s.left <= i.endX && s.top >= i.startY && s.top <= i.endY ? e._mouseMoveInsidePlotArea(t, s) : e._mouseMoveOutsidePlotArea(t, s) }), e.options.indicator && e.options.indicator.visible && n.bind(r + "mousedown" + i, function (t) { var r = n.offset(), i = e.canvasBounds, s = { left: t.pageX - r.left, top: t.pageY - r.top }, o = e.options.disabled; if (o) return; s.left >= i.startX && s.left <= i.endX && s.top >= i.startY && s.top <= i.endY && e._mouseDownInsidePlotArea(t, s) }).bind(r + "mouseup" + i, function (t) { var r = n.offset(), i = e.canvasBounds, s = { left: t.pageX - r.left, top: t.pageY - r.top }, o = e.options.disabled; if (o) return; s.left >= i.startX && s.left <= i.endX && s.top >= i.startY && s.top <= i.endY && e._mouseUpInsidePlotArea(t, s) }) }, s.prototype._unbindCanvasEvents = function () { window.navigator.msPointerEnabled && this.element.css("-ms-touch-action", ""), this.element.unbind("." + this.widgetName) }, s.prototype._bindLegendEvents = function () { var e = this, n = e.chartElement; n.delegate("." + e.options.wijCSS.legend, "click.wijchartcore", function (n) { if (e.options.disabled) return; var r = t(n.target); r[0].tagName && r[0].tagName === "tspan" && (r = r.parent()), e._legendClick(r) }) }, s.prototype._legendClick = function (e) { if (typeof e.data("index") == "undefined") return; var n = this, r = n.options.legend, i = e.data("index"), s = e.data("legendIndex"), o = n.chartElement.data("fields"), u = n.seriesEles, a, f = n.legendIcons[s], l = n.legends[s], c = r.textWidth ? t(l[0].node) : t(l.node), h = i, p; o && o.seriesEles && (u = o.seriesEles), n.legendDots && n.legendDots.length > i && (p = n.legendDots[i]), r.reversed && (h = n.legends.length - 1 - i), a = u[h], a && (c.data("hidden") ? (n._showSerieEles(a), l.attr("opacity", c.data("textOpacity")), f.attr("opacity", c.data("iconOpacity")), p && p.attr("opacity", c.data("dotOpacity")), c.data("hidden", !1)) : (n._hideSerieEles(a), c.data("textOpacity") || (r.textWidth ? c.data("textOpacity", l[0].attr("opacity") || 1) : c.data("textOpacity", l.attr("opacity") || 1)), c.data("iconOpacity") || c.data("iconOpacity", f.attr("opacity") || 1), p && !c.data("dotOpacity") && c.data("dotOpacity", f.attr("opacity") || 1), l.attr("opacity", "0.3"), f.attr("opacity", "0.3"), p && p.attr("opacity", "0.3"), c.data("hidden", !0))) }, s.prototype._showSerieEles = function (e) { }, s.prototype._hideSerieEles = function (e) { }, s.prototype._unbindLiveEvents = function () { var e = this, t = e.options, n = this.chartElement, r = e.widgetName; n.undelegate("." + t.wijCSS.legend, ".wijchartcore").undelegate("." + t.wijCSS.legend, "wijchartcore"), this._unbindCanvasEvents() }, s.prototype._isBarChart = function () { return !1 }, s.prototype._isPieChart = function () { }, s.prototype._isStockChart = function () { }, s.prototype._validateSeriesData = function (e) { return !1 }, s.prototype._calculateParameters = function (e, t) { var n = this, i = t.max, s = t.min, o = t.autoMax && e.autoMax, u = t.autoMin && e.autoMin, a = t.autoMajor && e.autoMajor, f = t.autoMinor && e.autoMinor, l = null, c = null, h = e.annoMethod === "valueLabels", p = 0, d = 0, v = 0, m = 0, g = 0, y = e.isTime, b = n.options.adjustMinValue; o && i !== Number.MIN_VALUE && e.id !== "x" && n._isBarChart() && i < 0 && .5 * (i - s) > -i && (i = 0), u && s !== Number.MAX_VALUE && e.id !== "x" && n._isBarChart() && s > 0 && .5 * (i - s) > s && (s = 0), i === s && (s !== 0 && (s -= 1), i += 1), m = i - s; if (y) { l = t.annoFormatString; if (!l || l.length === 0) l = r.getTimeDefaultFormat(i, s), e.annoFormatString = l; g = r.niceTimeUnit(0, l) } c = r.nicePrecision(m), e.tprec = c, o && (y ? (d = r.roundTime(i, g, !0), d < i ? i = d + g : i = d) : (d = r.precCeil(-c, i), typeof d == "number" && (i = d))), u && (y ? (v = r.roundTime(s, g, !1), v > s ? s = v - g : s = v) : (v = r.precFloor(-c, s), typeof v == "number" && (s = v))), e.max = i, e.min = s, e.annoFormatString = l, e.tinc = g; if (a || f) m = i - s, n._calculateMajorMinor(t, e), p = t.unitMajor, o && p !== 0 && !y && !h && (m = i - parseInt((i / p).toString(), 10) * p, m !== 0 && (i += p - m, i = r.precCeil(-c, i))), u && p !== 0 && !y && !h && (m = s - parseInt((s / p).toString(), 10) * p, m !== 0 && (m < 0 && (m += p), s -= Math.abs(m), s = r.precFloor(-c, s))), u && p !== 0 && !h && (typeof b == "undefined" || b === !1) && u && s === t.min && s - p >= 0 && e.id === "y" && (s -= p); e.max = i, e.min = s }, s.prototype._supportStacked = function () { return !1 }, s.prototype._getDataExtreme = function (e) { var t = { txx: 0, txn: 0, tyx: 0, tyn: 0 }, n; return n = this._getDataExtremes(t, e), n ? (n.txn > n.txx && (n.txn = 0, n.txx = 1), n) : (t.txn > t.txx && (t.txn = 0, t.txx = 1), t) }, s.prototype._getDataExtremes = function (e, r) { var i = this, s = i.options, o = s.seriesList, u = s.stacked && i._supportStacked(), a = s.is100Percent, f = s.axis, l = i.axisInfo, c = [], h = [], p = [], d, v = { y: {} }, m = f.x.valueLabels, g = l.x.annoMethod, y = l.y.annoMethod; return !o || o.length === 0 ? e : (t.each(o, function (e, n) { var r = n.data, i = [], s = [], o, u = 0; if (r.xy && t.isArray(r.xy)) { o = r.xy.length; while (u < o) i.push(r.xy[u]), s.push(r.xy[u + 1]), u += 2; r.x = i, r.y = s } }), i.seriesGroup && t.each(i.seriesGroup, function (r, s) { var o = [], m = parseInt(r, 10); t.each(s, function (n, r) { if (r.type === "pie") return !0; r = t.extend(!0, { display: "show" }, r); var s = r.data, a = 0, f = 0, l = [].concat(s.xy), p = l.length, d, v; if (r.display === "exclude") return !0; c = [].concat(s.x), o = [].concat(s.y); if (s.xy && p) { c = [], o = []; while (f < p) c[a] = l[f], o[a] = l[f + 1], f += 2, a++, s.x = c, s.y = o } else s.x || (c = [], t.each(o, function (e) { c.push(e) }), s.x = c); u && n > 0 && t.each(o, function (e) { o[e] += h[e] }), h = o, d = i._getMinMaxValue(c), v = i._getMinMaxValue(o), n === 0 ? (e.txx = d.max, e.txn = d.min, e.tyx = v.max, e.tyn = v.min) : (e.txx < d.max && (e.txx = d.max), e.txn > d.min && (e.txn = d.min), e.tyx < v.max && (e.tyx = v.max), e.tyn > v.min && (e.tyn = v.min)), n++ }), a && (e.tyx = 1, e.tyn = 0), v.y[r] = { tyx: e.tyx, tyn: e.tyn }, v.txx = e.txx, v.txn = e.txn, e.tyx = 0, e.tyn = 0; if (o.length) { d = n.getFirstValidListValue(o); if (i._isDate(d)) l.y[r].isTime = !0; else { if (typeof d == "undefined") return !0; typeof d != "number" && (t.each(o, function (e, t) { var n = f.y.annoFormatString, r = t; n && n.length > 0 ? r = Globalize.format(r, n, i._getCulture()) : r = r.toString(), p.push({ text: r, value: t, gridLine: !1 }) }), l.y[r].annoMethod = "valueLabels", !f.y[m].valueLabels && f.y[m].valueLabels.length === 0 ? l.y[r].valueLabels = p : l.y[r].valueLabels = f.y[m].valueLabels, f.x.max = o.length - 1, f.x.min = 0, f.y[m].unitMajor = 1, f.x.unitMinor = .5, l.y[r].autoMax = !1, l.y[r].autoMin = !1, l.y[r].autoMajor = !1, l.y[r].autoMinor = !1) } } }), c.length && (d = n.getFirstValidListValue(c), g === "valueLabels" && m && m.length > 0 && (l.x.valueLabels = m), i._isDate(d) ? l.x.isTime = !0 : typeof d != "number" && (t.each(c, function (e, n) { var r = {}, s, o; if (g === "valueLabels" && m && m.length && e < m.length) { s = m[e], o = typeof s; if (o === "string") s = { text: s }; else if (o === "number" || i._isDate(s)) s = { value: s } } r = t.extend({ text: n, value: e, gridLine: !1 }, s), p.push(r) }), f.x.max = c.length - 1, f.x.min = 0, f.x.unitMajor = 1, f.x.unitMinor = .5, l.x.annoMethod = "valueLabels", l.x.valueLabels = p, l.x.autoMax = !1, l.x.autoMin = !1, l.x.autoMajor = !1, l.x.autoMinor = !1)), v) }, s.prototype._isVertical = function (e) { return e === "west" || e === "east" }, s.prototype._isDate = function (e) { return e ? typeof e == "object" && e.constructor === Date : !1 }, s.prototype._getMinMaxValue = function (e) { var r = this, i = { min: 0, max: 0 }, s = 0, o; if (!e.length) return i; o = n.getFirstValidListValue(e); if (typeof o != "number") { if (!r._isDate(o)) return i.min = 0, i.max = e.length - 1, i; i.min = o, i.max = o } else i.min = o, i.max = o; for (s = 0; s < e.length; s++) { if (e[s] === null || typeof e[s] == "undefined") continue; if (typeof e[s] == "number" && isNaN(e[s])) continue; e[s] < i.min ? i.min = e[s] : e[s] > i.max && (i.max = e[s]) } return r._isDate(i.min) && (i.min = t.toOADate(i.min), i.max = t.toOADate(i.max)), i }, s.prototype._calculateMajorMinor = function (e, n) { var i = this, s = i.options, o = n.bounds || i.canvasBounds, u = e.autoMajor, a = e.autoMinor, f = n.max, l = n.min, c = n.isTime, h = n.tinc, p = n.annoFormatString, d = null, v = null, m = null, g = null, y = null, b = null, w = null, E = null, S = null, x = f - l, T = 0, N = 0, C = 0, k = 0; if (u) { S = t.extend(!0, {}, s.textStyle, e.textStyle, e.labels.style); if (c) d = Globalize.format(t.fromOADate(f), p, i._getCulture()), v = Globalize.format(t.fromOADate(l), p, i._getCulture()), y = i._text(-1e3, -1e3, d).attr(S), b = i._text(-1e3, -1e3, v).attr(S), m = y.wijGetBBox(), g = b.wijGetBBox(), y.wijRemove(), y = null, b.wijRemove(), b = null; else { w = r.nicePrecision(x), E = w + 1; if (E < 0 || E > 15) E = 0; y = i._text(-1e3, -1e3, t.round(f, E).toString()).attr(S), b = i._text(-1e3, -1e3, t.round(l, E).toString()).attr(S), m = y.wijGetBBox(), g = b.wijGetBBox(), y.wijRemove(), y = null, b.wijRemove(), b = null } m.width < g.width && (m.width = g.width), m.height < g.height && (m.height = g.height), i._isVertical(e.compass) ? (N = o.endY - o.startY - n.vOffset - n.axisTextOffset, k = N / m.height, Number.POSITIVE_INFINITY === k ? C = 0 : C = parseInt(k.toString(), 10)) : (T = o.endX - o.startX - n.vOffset - n.axisTextOffset, k = T / m.width, Number.POSITIVE_INFINITY === k ? C = 0 : C = parseInt(k.toString(), 10)), k = x, C > 0 && (x /= C, c ? x < h ? k = h : k = r.niceTimeUnit(x, n.annoFormatString) : (n.tprec = r.nicePrecision(x), k = r.niceNumber(2 * x, -w, !0), k < x && (k = r.niceNumber(x, -w + 1, !1)), k < x && (k = r.niceTickNumber(x)))), e.unitMajor = k } a && e.unitMajor && !isNaN(e.unitMajor) && (e.unitMinor = e.unitMajor / 2) }, s }(e.wijmoWidget); e.wijchartcore = o; var u = function () { function e() { this.width = null, this.height = null, this.wijCSS = { headerText: "wijchart-header-text", headerContainer: "wijchart-header-container", footerText: "wijchart-footer-text", footerContainer: "wijchart-footer-container", legendTitle: "wijchart-legend-title", legendText: "wijchart-legend-text", legend: "wijchart-legend", legendDot: "chart-legend-dot", legendIcon: "wijchart-legend-icon", legendContainer: "wijchart-legend-container", legendTextCover: "wijchart-legend-textCover", axis: "wijchart-axis", axisText: "wijchart-axis-text", axisGridLine: "wijchart-axis-gridline", axisTick: "wijchart-axis-tick", axisLabel: "wijchart-axis-label", labelText: "wijchart-label-text", labelConnect: "wijchart-label-connect", canvasObject: "wijchart-canvas-object" }, this.culture = "", this.seriesList = [], this.seriesStyles = [{ stroke: "#00cc00", opacity: .9, "stroke-width": 1 }, { stroke: "#0099cc", opacity: .9, "stroke-width": 1 }, { stroke: "#0055cc", opacity: .9, "stroke-width": 1 }, { stroke: "#2200cc", opacity: .9, "stroke-width": 1 }, { stroke: "#8800cc", opacity: .9, "stroke-width": 1 }, { stroke: "#d9007e", opacity: .9, "stroke-width": 1 }, { stroke: "#ff0000", opacity: .9, "stroke-width": 1 }, { stroke: "#ff6600", opacity: .9, "stroke-width": 1 }, { stroke: "#ff9900", opacity: .9, "stroke-width": 1 }, { stroke: "#ffcc00", opacity: .9, "stroke-width": 1 }, { stroke: "#ffff00", opacity: .9, "stroke-width": 1 }, { stroke: "#ace600", opacity: .9, "stroke-width": 1 }], this.seriesHoverStyles = [{ opacity: 1, "stroke-width": 1.5 }, { opacity: 1, "stroke-width": 1.5 }, { opacity: 1, "stroke-width": 1.5 }, { opacity: 1, "stroke-width": 1.5 }, { opacity: 1, "stroke-width": 1.5 }, { opacity: 1, "stroke-width": 1.5 }, { opacity: 1, "stroke-width": 1.5 }, { opacity: 1, "stroke-width": 1.5 }, { opacity: 1, "stroke-width": 1.5 }, { opacity: 1, "stroke-width": 1.5 }, { opacity: 1, "stroke-width": 1.5 }, { opacity: 1, "stroke-width": 1.5 }], this.marginTop = 25, this.marginRight = 25, this.marginBottom = 25, this.marginLeft = 25, this.textStyle = { fill: "#888", "font-size": 10, stroke: "none" }, this.header = { text: "", style: { fill: "none", stroke: "none" }, textStyle: { "font-size": 18, fill: "#666", stroke: "none" }, compass: "north", visible: !0 }, this.footer = { text: "", style: { fill: "#fff", stroke: "none" }, textStyle: { fill: "#000", stroke: "none" }, compass: "south", visible: !1 }, this.legend = { text: "", textMargin: { left: 2, top: 2, right: 2, bottom: 2 }, style: { fill: "none", stroke: "none" }, textWidth: null, textStyle: { fill: "#333", stroke: "none" }, titleStyle: { "font-weight": "bold", fill: "#000", stroke: "none" }, compass: "east", orientation: "vertical", visible: !0 }, this.axis = { x: { alignment: "center", style: { stroke: "#999999", "stroke-width": .5 }, visible: !0, textVisible: !0, text: "", textStyle: { fill: "#888", "font-size": 15, "font-weight": "bold" }, labels: { style: { fill: "#333", "font-size": 11 }, textAlign: "near", width: null }, compass: "south", autoMin: !0, autoMax: !0, min: null, max: null, origin: null, autoMajor: !0, autoMinor: !0, unitMajor: null, unitMinor: null, gridMajor: { visible: !1, style: { stroke: "#CACACA", "stroke-dasharray": "- " } }, gridMinor: { visible: !1, style: { stroke: "#CACACA", "stroke-dasharray": "- " } }, tickMajor: { position: "none", style: { fill: "black" }, factor: 1 }, tickMinor: { position: "none", style: { fill: "black" }, factor: 1 }, annoMethod: "values", annoFormatString: "", valueLabels: [] }, y: { alignment: "center", style: { stroke: "#999999", "stroke-width": .5 }, visible: !1, textVisible: !0, text: "", textStyle: { fill: "#888", "font-size": 15, "font-weight": "bold" }, labels: { style: { fill: "#333", "font-size": 11 }, textAlign: "center", width: null }, compass: "west", autoMin: !0, autoMax: !0, min: null, max: null, origin: null, autoMajor: !0, autoMinor: !0, unitMajor: null, unitMinor: null, gridMajor: { visible: !0, style: { stroke: "#999999", "stroke-width": .5, "stroke-dasharray": "none" } }, gridMinor: { visible: !1, style: { stroke: "#CACACA", "stroke-dasharray": "- " } }, tickMajor: { position: "none", style: { fill: "black" }, factor: 1 }, tickMinor: { position: "none", style: { fill: "black" }, factor: 1 }, annoMethod: "values", annoFormatString: "", valueLabels: [] } }, this.hint = { enable: !0, content: null, contentStyle: { fill: "#d1d1d1", "font-size": 16 }, title: null, titleStyle: { fill: "#d1d1d1", "font-size": 16 }, style: { fill: "#000000", "stroke-width": 2 }, animated: "fade", showAnimated: "fade", hideAnimated: "fade", duration: 120, showDuration: 120, hideDuration: 120, easing: "", showEasing: "", hideEasing: "", showDelay: 0, hideDelay: 150, compass: "north", offsetX: 0, offsetY: 0, showCallout: !0, calloutFilled: !1, calloutFilledStyle: { fill: "#000" } }, this.indicator = { visible: !1, style: { stroke: "#000000" } }, this.showChartLabels = !0, this.chartLabelStyle = {}, this.chartLabelFormatString = "", this.disableDefaultTextStyle = !1, this.shadow = !0, this.dataSource = null, this.data = null, this.beforeSeriesChange = null, this.seriesChanged = null, this.beforePaint = null, this.painted = null } return e }(); o.prototype.options = t.extend(!0, {}, e.wijmoWidget.prototype.options, new u) })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { var t = function (e) { function t() { e.apply(this, arguments) } return __extends(t, e), t.prototype._create = function () { var t = this, n = t.options, r = t._getDefFill(), i; n.horizontal && (i = n.axis.y.compass || "south", n.axis.y.compass = n.axis.x.compass || "west", n.axis.x.compass = i), $.extend(!0, { compass: "east" }, n.hint), t._handleChartStyles(), r = null, e.prototype._create.call(this), t.chartElement.addClass(n.wijCSS.barChart) }, t.prototype._setOption = function (t, n) { t === "horizontal" && $.extend(!0, this.options.axis, { x: { compass: n ? "west" : "south" }, y: { compass: n ? "south" : "west" } }), e.prototype._setOption.call(this, t, n) }, t.prototype.destroy = function () { var t = this, n = t.options, r = t.chartElement, i = r.data("fields"), s = i && i.bars; r.removeClass(n.wijCSS.barChart), e.prototype.destroy.call(this), s && s.length && $.each(s, function (e, t) { t = null }), r.data("fields", null) }, t.prototype._clearChartElement = function () { var t = this, n = t.options, r = t.chartElement.data("fields"); e.prototype._clearChartElement.call(this), t.element.removeData("plotInfos"), n.seriesTransition.enabled || r && r.aniBarsAttr && (r.aniBarsAttr = null) }, t.prototype._isBarChart = function () { return !0 }, t.prototype.getBar = function (e) { var t = this.chartElement, n = t.data("fields"); return n.chartElements.bars[e] }, t.prototype._paintTooltip = function () { var t = this, n = t.chartElement, r = n.data("fields"); e.prototype._paintTooltip.call(this), t.tooltip && r && r.trackers && r.trackers.length && (t.tooltip.setTargets(r.trackers), t.tooltip.setOptions({ relatedElement: r.trackers[0] })) }, t.prototype._getTooltipText = function (e, t) { var n = $(t.node), r, i; return n.data("owner") && (n = n.data("owner")), r = n.data("wijchartDataObj"), i = { data: r, value: r.value, label: r.label, total: r.total, target: t, fmt: e, x: r.x, y: r.y }, $.proxy(e, i)() }, t.prototype._preHandleSeriesData = function () { e.prototype._preHandleSeriesData.call(this); var t = this, n = t.options, r = n.seriesList; $.each(r, function (e, n) { var r = n.data; r.y && $.each(r.y, function (e, n) { try { t._isDate(n) || (r.y[e] = parseFloat(n)) } catch (i) { r.y[e] = 1 } }) }) }, t.prototype._paintPlotArea = function () { var e = this, t = e.options; this.barchartRender = new i(this.chartElement, { canvas: e.canvas, bounds: e.canvasBounds, tooltip: e.tooltip, widgetName: e.widgetName, horizontal: t.horizontal, stacked: t.stacked, axis: t.axis, seriesList: t.seriesList, seriesStyles: t.seriesStyles, seriesHoverStyles: t.seriesHoverStyles, seriesTransition: t.seriesTransition, showChartLabels: t.showChartLabels, textStyle: t.textStyle, chartLabelStyle: t.chartLabelStyle, chartLabelFormatString: t.chartLabelFormatString, shadow: t.shadow, disabled: t.disabled, clusterOverlap: t.clusterOverlap, clusterWidth: t.clusterWidth, clusterSpacing: t.clusterSpacing, is100Percent: t.is100Percent, clusterRadius: t.clusterRadius, animation: t.animation, culture: e._getCulture(), isYTime: e.axisInfo.y[0].isTime, isXTime: e.axisInfo.x.isTime, mouseDown: $.proxy(e._mouseDown, e), mouseUp: $.proxy(e._mouseUp, e), mouseOver: $.proxy(e._mouseOver, e), mouseOut: $.proxy(e._mouseOut, e), mouseMove: $.proxy(e._mouseMove, e), click: $.proxy(e._click, e), wijCSS: t.wijCSS, widget: this }), this.barchartRender.render() }, t.prototype._showSerieEles = function (e) { var t = this.options.stacked, n = -1; $.each(e, function (e, t) { t && t.bar && (t.bar.show(), t.bar.shadow && t.bar.shadow.show(), t.bar.tracker && t.bar.tracker.show(), $(t.bar.node).data("wijchartDataObj") && ($(t.bar.node).data("wijchartDataObj").visible = !0)), t && t.dcl && t.dcl.show(), t && t.animatedBar && !t.animatedBar.removed && t.animatedBar.show(), t.sIndex && (n = t.sIndex) }), t && this.stackedSeriesObjs && this._handleStackedVisible(e.length) }, t.prototype._hideSerieEles = function (e) { var t = this.options.stacked, n = -1, r = e.length; $.each(e, function (e, t) { t && t.bar && (t.bar.hide(), t.bar.shadow && t.bar.shadow.hide(), t.bar.tracker && t.bar.tracker.hide(), $(t.bar.node).data("wijchartDataObj") && ($(t.bar.node).data("wijchartDataObj").visible = !1)), t && t.dcl && t.dcl.hide(), t && t.animatedBar && !t.animatedBar.removed && t.animatedBar.hide(), t.sIndex && (n = t.sIndex) }), t && this.stackedSeriesObjs && this._handleStackedVisible(e.length) }, t.prototype._handleStackedVisible = function (e) { function n(e) { return $(e.bar.node).data("wijchartDataObj").visible !== !1 } function r(e, t, n) { e && (e.bar && (e.bar.attr("x", t), e.bar.attr("width", n)), e.bar.shadow && (e.bar.shadow.attr("x", t), e.bar.shadow.attr("width", n)), e.bar.tracker && (e.bar.tracker.attr("x", t), e.bar.tracker.attr("width", n))) } function i(e, t, n) { e && (e.bar && (e.bar.attr("y", t), e.bar.attr("height", n)), e.bar.shadow && (e.bar.shadow.attr("y", t), e.bar.shadow.attr("height", n)), e.bar.tracker && (e.bar.tracker.attr("y", t), e.bar.tracker.attr("height", n))) } function s(e) { if (e) { var t = e.rect.x, n = e.rect.width; e.bar && (e.bar.attr("x", t), e.bar.attr("width", n)), e.bar.shadow && (e.bar.shadow.attr("x", t), e.bar.shadow.attr("width", n)), e.bar.tracker && (e.bar.tracker.attr("x", t), e.bar.tracker.attr("width", n)) } } function o(e) { if (e) { var t = e.rect.y, n = e.rect.height; e.bar && (e.bar.attr("y", t), e.bar.attr("height", n)), e.bar.shadow && (e.bar.shadow.attr("y", t), e.bar.shadow.attr("height", n)), e.bar.tracker && (e.bar.tracker.attr("y", t), e.bar.tracker.attr("height", n)) } } var t = this; if (this.stackedSeriesObjs) { $.each(this.stackedSeriesObjs, function (e, n) { t.options.horizontal ? s(n) : o(n) }); var u = [], a = this.element.data("fields").seriesEles.length; for (var f = 0; f < a; f++) u.push(n(this.stackedSeriesObjs[f + "0"])); var l = [], c = -1, h = -1, p = -1; for (var f = u.length - 1; f >= 0; f--) u[f] && (p - f > 1 && l.push({ start: p, end: f + 1 }), p = f); p > 0 && l.push({ start: p, end: 0 }), $.each(l, function (n, s) { var o = s.start, u = s.end, a, f, l, c, h, p; for (var n = 0; n < e; n++) a = t.stackedSeriesObjs[o + "" + n], f = t.stackedSeriesObjs[u + "" + n], t.options.horizontal ? (l = f.rect.x, h = a.rect.width + a.rect.x - f.rect.x, r(a, l, h)) : (l = a.rect.y, h = f.rect.height + f.rect.y - a.rect.y, i(a, l, h)) }) } }, t.prototype._indicatorLineShowing = function (t) { e.prototype._indicatorLineShowing.call(this, t), $.each(t, function (e, t) { t.bar && t.bar.attr(t.hoverStyle) }) }, t.prototype._removeIndicatorStyles = function (e) { $.each(e, function (e, t) { t.bar && t.bar.attr(t.style) }) }, t.prototype._supportStacked = function () { return !0 }, t.prototype._calculateParameters = function (t, n) { e.prototype._calculateParameters.call(this, t, n); if (t.id === "x") { var r = n.unitMinor, i = this._getBarAdjustment(t); i === 0 ? i = r : r < i && r !== 0 && (i = Math.floor(i / r) * r), t.min -= i, t.max += i, this._calculateMajorMinor(n, t) } }, t.prototype._getBarAdjustment = function (e) { var t = 0, n = this.options, r = e.max, i = e.min, s = n.seriesList, o = 0, u = 0; for (o = 0; o < s.length && s[o].data.x; o++) u = s[o].data.x.length, t < u && (t = u); return t > 1 ? (r - i) / t * n.clusterWidth * .0125 : t === 1 ? (i === 0 && r === 1 && (i = -1, e.min = i), (r - i) * .0125) : 0 }, t }(e.wijchartcore); e.wijbarchart = t; var n = function () { function e() { this.initSelector = ":jqmData(role='wijbarchart')", this.wijCSS = { barChart: "wijmo-wijbarchart", barLabel: "wijbarchart-label", barElement: "wijbarchart", barTracker: "bartracker" }, this.horizontal = !0, this.stacked = !1, this.is100Percent = !1, this.clusterOverlap = 0, this.clusterWidth = 85, this.clusterRadius = 0, this.clusterSpacing = 0, this.animation = { enabled: !0, duration: 400, easing: ">" }, this.seriesTransition = { enabled: !0, duration: 400, easing: ">" }, this.mouseDown = null, this.mouseUp = null, this.mouseOver = null, this.mouseOut = null, this.mouseMove = null, this.click = null } return e }(); t.prototype.options = $.extend(!0, {}, e.wijchartcore.prototype.options, new n), t.prototype.widgetEventPrefix = "wijbarchart", $.wijmo.registerWidget("wijbarchart", t.prototype); var r = function () { function e(e) { this.x = e, this.paSpec = [] } return e.prototype.stackValues = function () { var e = this, t = e.paSpec.length, n; t > 1 && (n = e.paSpec[0], $.each(e.paSpec, function (e, t) { if (e === 0) return !0; t.y += n.y, n = t })) }, e }(), i = function () { function t(e, t) { this.options = t, this.element = e, this._init() } return t.prototype._init = function () { var t = this.options, n = t.horizontal, r = t.axis.x, i = t.bounds; this.startLocation = { x: i.startX, y: i.startY }, this.width = i.endX - this.startLocation.x, this.height = i.endY - this.startLocation.y, this.nSeries = t.seriesList.length, this.seriesList = $.arrayClone(t.seriesList), this.seriesStyles = [].concat(t.seriesStyles.slice(0, this.nSeries)), this.seriesHoverStyles = [].concat(t.seriesHoverStyles.slice(0, this.nSeries)), this.xscale = e.ChartUtil.getScaling(n, r.max, r.min, n ? this.height : this.width), this.xlate = e.ChartUtil.getTranslation(n, this.startLocation, r.max, r.min, this.xscale), this.fields = this.element.data("fields") || {}, this.chartElements = this.fields.chartElements || {}, this.aniBarsAttr = this.fields.aniBarsAttr, this.canvas = t.canvas }, t.prototype._paintShadow = function (t, n, r) { this.options.shadow && e.ChartUtil.paintShadow(t, n, r) }, t.prototype.getMinDX = function (e) { var t = Number.MAX_VALUE, n = e.length, r, i; for (r = 1; r < n; r++) i = e[r].x - e[r - 1].x, i < t && i > 0 && (t = i); return t === Number.MAX_VALUE ? 2 : t }, t.prototype.stackValues = function (e) { return $.each(e, function (e, t) { t.stackValues() }), e }, t.prototype.barPointList = function (t) { function s(e, t) { var s = i(t), o = t.length, u = null, a = 0, f = 0, l = 0, c = !0, h = 0, p = !1; s && (a = s.length), n && (l = n.length); if (s === undefined) return; $.each(s, function (t, i) { c ? (c = !1, h = i.x) : (h === i.x ? p = !0 : p = !1, h = i.x); while (f < l && n[f].x < i.x) f++; f < l ? n[f].x !== i.x ? (u = new r(i.x), n.splice(f, 0, u), l = n.length) : u = n[f] : (u = new r(i.x), n.push(u), l = n.length), u.paSpec.push({ y: i.y, sIdx: e, pIdx: t, dupl: p }) }) } var n = [], i = e.ChartUtil.getXSortedPoints; return $.each(t, function (e, t) { s(e, t) }), n }, t.prototype.adjustToLimits = function (e, t, n) { return e < t ? t : e > n ? n : e }, t.prototype.transformPoints = function (e, t, n, r, i, s) { return $.each(s, function (s, o) { var u = o.x, a = o.y, f = 0; o.x = t * u + r, o.y = n * a + i, e && (f = o.x, o.x = o.y, o.y = f) }), s }, t.prototype.paintDefaultChartLabel = function (e, t, n, r) { var i = this.options, s = i.horizontal, o = i.canvas, u = i.wijCSS, a = i.culture, f = $.extend(!0, {}, i.textStyle, i.chartLabelStyle), l = s ? { x: e.x + e.width, y: e.y + e.height / 2 } : { x: e.x + e.width / 2, y: e.y }, c = i.chartLabelFormatString, h, p, d = this.options.widget, v = t; return r && (f = $.extend(!0, f, r)), n && (v = $.fromOADate(t)), c && c.length ? v = Globalize.format(v, i.chartLabelFormatString, a) : n || (v = $.round(v, 2)), p = d._text.call(d, l.x, l.y, v).attr(f), $.wijraphael.addClass($(p.node), u.barLabel), h = p.getBBox(), s ? p.attr({ x: l.x + h.width / 2 }) : p.attr({ y: l.y - h.height / 2 }), p }, t.prototype.paintBar = function (e, t, n, r, i, s, o, u, a, f, l, c, h, p, d) { var v = this.options, m = v.stacked, g = v.horizontal, y = v.is100Percent, b = r.min, w = r.max, E = i.min, S = i.max, x = r.scale, T = r.late, N = i.scale, C = i.late, k, L, A, O, M = null, _, D = s, P = s["stroke-width"], H = s.stroke, B, j, F, I, q = -1; d.origin !== null && (q = N * d.origin + C); if (m) if (y) { c > 0 && (e.height = t / c); if (l || l === 0) e.y = l / c, e.height -= e.y } else { e.height = t; if (l || l === 0) e.height -= l, e.y = l } else if (l || l === 0) e.x += e.width * (1 - f), e.height = t; L = [{ x: e.x, y: e.y }, { x: e.x + e.width, y: e.y + e.height }], A = (b <= L[0].x && L[0].x <= w || b <= L[1].x && L[1].x <= w) && (E <= L[0].y && L[0].y <= S || E <= L[1].y && L[1].y <= S), L[0].x = this.adjustToLimits(L[0].x, b, w), L[0].y = this.adjustToLimits(L[0].y, E, S), L[1].x = this.adjustToLimits(L[1].x, b, w), L[1].y = this.adjustToLimits(L[1].y, E, S), L = this.transformPoints(g, x, N, T, C, L), L[0].x > L[1].x && (k = L[0].x, L[0].x = L[1].x, L[1].x = k), L[0].y > L[1].y && (k = L[0].y, L[0].y = L[1].y, L[1].y = k), O = { x: L[0].x, y: L[0].y, width: L[1].x - L[0].x, height: L[1].y - L[0].y }, A && !m && (O.width === 0 && (O.width = 1), O.height === 0 && (O.height = 1, O.y -= 1)), v.showChartLabels && (M = this.paintDefaultChartLabel(O, t, h, p)), _ = s.r ? s.r : v.clusterRadius, _ && (D = $.extend(!0, {}, s, { r: 0 })), H !== "none" && P && (P = parseInt(P, 10)); if (!P || isNaN(P)) P = 0; return j = O.width, F = O.height, P > 1 && (P--, j = O.width - P, F = O.height - P / 2, O.x += P / 2), j < 0 && (j = 0), F < 0 && (F = 0), o ? (q === -1 && (g ? q = a.x + P / 2 : q = a.y + n - P / 2), _ ? (g ? (t > d.origin ? B = this.canvas.roundRect(O.x, O.y, j, F, 0, 0, _, _).hide() : B = this.canvas.roundRect(O.x, O.y, j, F, _, _, 0, 0).hide(), I = this.canvas.rect(q, O.y, 0, F)) : (t > d.origin ? B = this.canvas.roundRect(O.x, O.y, j, F, _, 0, 0, _).hide() : B = this.canvas.roundRect(O.x, O.y, j, F, 0, _, _, 0).hide(), I = this.canvas.rect(O.x, q, O.width, 0)), this._paintShadow(I, u), I.wijAttr(D), I.bar = B) : (g ? B = this.canvas.rect(q, O.y, 0, F) : B = this.canvas.rect(O.x, q, j, 0), I = B), M && (M.attr({ opacity: 0 }), I.chartLabel = M), I.left = O.x, I.top = O.y, I.width = j, I.height = F, I.r = _) : _ ? g ? t > d.origin ? B = this.canvas.roundRect(O.x, O.y, j, F, 0, 0, _, _) : B = this.canvas.roundRect(O.x, O.y, j, F, _, _, 0, 0) : t > d.origin ? B = this.canvas.roundRect(O.x, O.y, j, F, _, 0, 0, _) : B = this.canvas.roundRect(O.x, O.y, j, F, 0, _, _, 0) : B = this.canvas.rect(O.x, O.y, j, F), this._paintShadow(B, u), o && _ && B.shadow && B.shadow.hide(), B.wijAttr(s), { rect: O, dcl: M, animatedBar: I, bar: B } }, t.prototype.paintClusters = function (t, n, r, i, s, o, u, a, f, l) { var c = this, h = c.options, p = h.clusterOverlap / 100, d = h.clusterWidth / 100, v = 1, m = h.clusterSpacing + v, g = t.length, y = h.canvas, b = h.stacked, w = h.horizontal, E = h.axis.y, S = h.widget, x = h.wijCSS, T = h.animation && h.animation.enabled, N, C, k, L = [], A = [], O = [], M = [], _ = [], D = [], P = y.set(), H, B = 0; return f || l ? ($.each(t, function (e, t) { var n = $.extend(!0, {}, t); n.data && n.data.y && n.data.y.length && f && $.each(n.data.y, function (e, t) { n.data.y[e] = $.toOADate(t) }), n.data && n.data.x && n.data.x.length && l && $.each(n.data.x, function (e, t) { n.data.x[e] = $.toOADate(t) }), _.push(n) }), N = c.barPointList(_)) : N = c.barPointList(t), b && (N = c.stackValues(N)), C = c.getMinDX(N) * d, $.each(n, function (e, t) { t["stroke-width"] && !isNaN(t["stroke-width"]) && (B !== 0 ? B = Math.min(parseFloat(t["stroke-width"]), B) : B = parseFloat(t["stroke-width"])) }), g > 1 && !b && (p -= N.length * (g - 1) * (m + B * 2) / (w ? u : o), C /= g * (1 - p) + p), $.each(N, function (l, d) { var m = d.paSpec, g = m.length, y, N, _, B; b ? y = C : y = C * (g * (1 - p) + p), N = { x: d.x - y / 2, y: 0, width: C, height: m[0].y }, $.each(m, function (l, d) { if (N.height === undefined) return !0; var g = d.sIdx, y = d.pIdx, b = n[g], C = t[g], j, F = C.yAxis || 0, I = E[F] || E, q = s[F] || s; M[g] || (M[g] = []), D[g] || (D[g] = []), c.yscale = e.ChartUtil.getScaling(!w, I.max, I.min, w ? o : u), c.ylate = e.ChartUtil.getTranslation(!w, a, I.max, I.min, c.yscale), q.late = c.ylate, q.scale = c.yscale, B = c.paintBar(N, d.y, u, i, q, b, T, v, a, p, l > 0 ? m[l - 1].y : null, m[m.length - 1].y, f, C.textStyle, I), _ = B.bar, j = _.clone().attr({ opacity: .01, fill: "white", "stroke-width": 0, "fill-opacity": .01 }), C.visible === !1 && (_.hide(), B.dcl && B.dcl.hide(), j.hide(), _.shadow && _.shadow.hide()), $.wijraphael.addClass($(_.node), x.canvasObject + " " + x.barElement), H = $.extend(!1, { index: y, bar: _, type: "bar", style: b, hoverStyle: r[g], x: C.data.x[y], y: C.data.y[y], visible: !0 }, C), $(_.node).data("wijchartDataObj", H), S.dataPoints = S.dataPoints || {}, S.pointXs = S.pointXs || [], h.horizontal ? k = $.round(B.rect.y + B.rect.height / 2, 2) : k = $.round(B.rect.x + B.rect.width / 2, 2), S.dataPoints[k.toString()] || (S.dataPoints[k.toString()] = [], S.pointXs.push(k)), S.dataPoints[k.toString()].push(H), $(j.node).data("owner", $(_.node)), $.wijraphael.addClass($(j.node), x.barElement + " " + x.barTracker), B.bar.tracker = j, P.push(j), A.push(_), B.animatedBar && O.push(B.animatedBar), B.dcl && L.push(B.dcl), M[g][y] = B.rect, D[g][y] = B, _ = null, j = null }) }), $.each(L, function (e, t) { t.toFront() }), P.toFront(), { bars: A, animatedBars: O, rects: M, chartLabels: L, seriesEles: D, trackers: P } }, t.prototype.processStackedElement = function (e) { var t = {}; $.each(e, function (e, n) { $.each(n, function (n, r) { r.sIndex = e, r.stackIndex = n, t[e + "" + n] = r }) }), this.options.widget.stackedSeriesObjs = t }, t.prototype.playAnimation = function (t) { var n = this, r = n.options, i = r.animation, s = i && i.enabled, o = r.horizontal, u = r.seriesTransition, a, f, l = [], c, h = r.chartLabelStyle; s && (a = i.duration || 2e3, f = i.easing || "linear", $.each(t, function (t, r) { var i; o ? i = { width: r.width, x: r.left } : i = { height: r.height, y: r.top }, n.aniBarsAttr && u.enabled && n.aniBarsAttr.length > t && (c = e.ChartUtil.getDiffAttrs(n.aniBarsAttr[t], r.attr()), o ? (c.x = n.aniBarsAttr[t].x, c.width = n.aniBarsAttr[t].width) : (c.y = n.aniBarsAttr[t].y, c.height = n.aniBarsAttr[t].height), c.path && delete c.path, r.attr(c), a = u.duration, f = u.easing), l.push($.extend(!0, {}, r.attr(), i)), r.tracker && r.tracker.hide(), r.stop().wijAnimate(i, a, f, function () { var e = this, t = e.r, n = e; e.chartLabel && (h && h.opacity ? e.chartLabel.wijAnimate({ opacity: h.opacity }, 250) : e.chartLabel.wijAnimate({ opacity: 1 }, 250)), e.tracker && (e.tracker.show(), e.tracker.attr({ width: e.width, height: e.height, x: e.attr("x"), y: e.attr("y") })), t && (n = e.bar, n.show(), n.shadow && n.shadow.show(), e.shadow && (e.shadow.wijRemove(), e.shadow = null), e.wijRemove(), e = null) }) }), n.aniBarsAttr = l) }, t.prototype.bindLiveEvents = function () { var e = this.options, t = e.wijCSS, n = e.widgetName, r = e.disabled, i = e.mouseDown, s = e.mouseUp, o = e.mouseOver, u = e.mouseOut, a = e.mouseMove, f = e.click, l = this.element, c = $.isFunction; $("." + t.barElement, l[0]).on("mousedown." + n, function (e) { if (r) return; if (c(i)) { var t = $(e.target), n; t.data("owner") && (t = t.data("owner")), n = t.data("wijchartDataObj"), i.call(l, e, n), n = null } }).on("mouseup." + n, function (e) { if (r) return; if (c(s)) { var t = $(e.target), n; t.data("owner") && (t = t.data("owner")), n = t.data("wijchartDataObj"), s.call(l, e, n), n = null } }).on("mouseover." + n, function (e) { if (r) return; if (c(o)) { var t = $(e.target), n; t.data("owner") && (t = t.data("owner")), n = t.data("wijchartDataObj"), o.call(l, e, n), n = null } }).on("mouseout." + n, function (e) { if (r) return; var t = $(e.target), n, i; t.data("owner") && (t = t.data("owner")), n = t.data("wijchartDataObj"), i = n.bar, n.hoverStyle ? i.attr(n.style) : i && i.attr({ opacity: "1" }), c(u) && u.call(l, e, n), n = null }).on("mousemove." + n, function (e) { if (r) return; var t = $(e.target), n, i; t.data("owner") && (t = t.data("owner")), n = t.data("wijchartDataObj"), i = n.bar, n.hoverStyle ? i.attr(n.hoverStyle) : i && i.attr({ opacity: "0.8" }), c(a) && a.call(l, e, n), n = null }).on("click." + n, function (e) { if (r) return; if (c(f)) { var t = $(e.target), n; t.data("owner") && (t = t.data("owner")), n = t.data("wijchartDataObj"), f.call(l, e, n) } }) }, t.prototype.unbindLiveEvents = function () { var e = this.options, t = e.widgetName, n = e.wijCSS, r = this.element; $("." + n.barElement, r[0]).off(t).off("." + t) }, t.prototype.render = function () { var e = this.options, t = e.horizontal, n = e.stacked, r = this.seriesList, i = this.seriesStyles, s = this.seriesHoverStyles, o = e.axis.x, u = e.axis.y, a = e.isYTime, f = e.isXTime, l; this.unbindLiveEvents(), t && !n && (r.reverse(), i.reverse(), s.reverse()); if (this.nSeries === 0) return; l = this.paintClusters(r, i, s, { min: o.min, max: o.max, late: this.xlate, scale: this.xscale }, u, this.width, this.height, this.startLocation, a, f), this.element.data("plotInfos", { xscale: this.xscale, xlate: this.xlate, yscale: this.yscale, ylate: this.ylate, rects: l.rects }), this.playAnimation(l.animatedBars), this.chartElements.bars = l.bars, this.chartElements.animatedBars = l.animatedBars, this.chartElements.chartLabels = l.chartLabels, this.fields.seriesEles = l.seriesEles, this.fields.trackers = l.trackers, this.fields.chartElements || (this.fields.chartElements = {}), t && !n && this.fields.seriesEles.reverse(), n && this.processStackedElement(this.fields.seriesEles), $.extend(!0, this.fields.chartElements, this.chartElements), this.fields.aniBarsAttr = this.aniBarsAttr, this.element.data("fields", this.fields), this.bindLiveEvents() }, t }(); e.BarChartRender = i })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { var t = function (e) { function t() { e.apply(this, arguments) } return __extends(t, e), t.prototype._create = function () { var t = this.options; this._handleChartStyles(), e.prototype._create.call(this), this.chartElement.addClass(t.wijCSS.lineChart), t.type === "area" && this.chartElement.addClass(t.wijCSS.areaChart) }, t.prototype.destroy = function () { var t = this.options; this.chartElement.removeClass(t.wijCSS.lineChart), t.type === "area" && this.chartElement.removeClass(t.wijCSS.areaChart), e.prototype.destroy.call(this), this.aniPathsAttr && this.aniPathsAttr.length && ($.each(this.aniPathsAttr, function (e, t) { t = null }), this.aniPathsAttr = null) }, t.prototype.getLinePath = function (e) { var t = this.chartElement.data("fields"), n, r; if (t && t.chartElements) { n = t.chartElements; if (n.paths && n.paths.length) return n.paths[e] } return r }, t.prototype.getLineMarkers = function (e) { var t = this.options, n = this.chartElement.data("fields"), r, i; if (t.seriesList && t.seriesList[e].markers && t.seriesList[e].markers.visible && n && n.chartElements) { r = n.chartElements; if (r.markersSet && r.markersSet.length) return r.markersSet[e] } return i }, t.prototype._showSerieEles = function (e) { var t = this.options, n; e.markers && $.each(e.markers, function (e, t) { var n = $(t.node).data("wijchartDataObj"); if (n && n.lineSeries && n.lineSeries.markers && !n.lineSeries.markers.visible) return !0; t.show() }), e.dcl && $.each(e.dcl, function (e, n) { t.showChartLabels && n.show() }), e.path && (n = $(e.path.node).data("wijchartDataObj"), n.visible && (e.path.show(), e.path.shadow && e.path.shadow.show(), e.path.area && e.path.area.show(), e.path.tracker && e.path.tracker.show()), $(e.path.node).data("wijchartDataObj") && $(e.path.node).data("wijchartDataObj").virtualMarkers && $.each($(e.path.node).data("wijchartDataObj").virtualMarkers, function (e, t) { t.visible = !0 })) }, t.prototype._hideSerieEles = function (e) { e.markers && $.each(e.markers, function (e, t) { t.hide() }), e.dcl && $.each(e.dcl, function (e, t) { t.hide() }), e.path && (e.path.hide(), e.path.shadow && e.path.shadow.hide(), e.path.area && e.path.area.hide(), e.path.tracker && e.path.tracker.hide(), $(e.path.node).data("wijchartDataObj") && $(e.path.node).data("wijchartDataObj").virtualMarkers && $.each($(e.path.node).data("wijchartDataObj").virtualMarkers, function (e, t) { t.visible = !1 })) }, t.prototype._supportStacked = function () { return !0 }, t.prototype._indicatorLineShowing = function (t) { e.prototype._indicatorLineShowing.call(this, t), $.each(t, function (e, t) { t.marker && t.marker.attr(t.markerHoverStyle) }) }, t.prototype._removeIndicatorStyles = function (e) { $.each(e, function (e, t) { t.marker && (t.marker.attr(t.markerStyle), t.marker.transform("s1")) }) }, t.prototype._mouseDownInsidePlotArea = function (t, n) { e.prototype._mouseDownInsidePlotArea.call(this, t, n), this._clearHoverState(!0) }, t.prototype._mouseDown = function (t, n) { e.prototype._mouseDown.call(this, t, n) }, t.prototype._mouseUp = function (t, n) { e.prototype._mouseUp.call(this, t, n) }, t.prototype._mouseOver = function (t, n) { if (!n || n.type !== "line" && n.type !== "marker") return; if (this.indicatorLine) return; e.prototype._mouseOver.call(this, t, n), n.type === "marker" && (n = n.lineSeries); if (n.path.removed) return; if (this.hoverLine !== n || this.hoverLine === null) this.isNewLine = !0, this.hoverLine && (this.hoverLine.path.removed || (this.options.type === "line" && this.hoverLine.lineStyle.fill && delete this.hoverLine.lineStyle.fill, this.hoverLine.path.wijAttr(this.hoverLine.lineStyle), this.hoverPoint && !this.hoverPoint.isSymbol && (this.hoverPoint.marker.wijAttr(this.hoverPoint.markerStyle), this.hoverPoint.marker.transform("s1")))), n.lineHoverStyle && n.path.wijAttr(n.lineHoverStyle), this.hoverLine = n, this.hoverPoint = null, this.hoverVirtualPoint = null }, t.prototype._mouseOut = function (t, n) { e.prototype._mouseOut.call(this, t, n) }, t.prototype._mouseMove = function (t, n) { e.prototype._mouseMove.call(this, t, n) }, t.prototype._click = function (t, n) { e.prototype._click.call(this, t, n) }, t.prototype._mouseMoveInsidePlotArea = function (t, n) { var r = this, i = this.tooltip, s = this.options.hint, o, u, a = 0, f, l, c, h, p = null, d = null, v = null, m = s.title, g = s.content, y = $.isFunction(m), b = $.isFunction(g), w = 0; i && (v = i.getOptions()); if (this.hoverLine && !this.indicatorLine) { this.isNewLine && (s.enable && i && i.hide(), this.isNewLine = !1), o = this.hoverLine.lineMarkers, u = this.hoverLine.virtualMarkers, a = -1, f = { x: 0, y: 0 }; if (o && o.length) { $.each(o, function (e, t) { if (t.removed) return !0; var r = t.wijGetBBox(), i = r.x + r.width / 2, s = Math.abs(i - n.left); if (e === 0 || s < w) w = s, a = e, f = { x: i, y: r.y + r.height / 2 } }); if (this.hoverPoint && this.hoverPoint.index === a) return; if (a > -1) { if (o[a].removed) return; l = $(o[a].node).data("wijchartDataObj"), l && (this.hoverPoint && !this.hoverPoint.isSymbol && (this.hoverPoint.removed || (this.hoverPoint.marker.wijAttr(this.hoverPoint.markerStyle), this.hoverPoint.marker.transform("s1"))), l.isSymbol || l.marker.removed || l.marker.wijAttr(l.markerHoverStyle)), this.hoverPoint = l, this.hoverVirtualPoint = u[a] } } else { $.each(u, function (e, t) { var r = Math.abs(t.x - n.left); if (e === 0 || r < w) w = r, a = e, f = { x: t.x, y: t.y } }); if (this.hoverVirtualPoint && this.hoverVirtualPoint.index === a) return; a > -1 && (this.hoverPoint = null, this.hoverVirtualPoint = u[a]) } if (i) { d = this.hoverVirtualPoint, c = d.valX, h = d.valY; if (y || b) y && (v.title = function () { var e = { pointIndex: a, lineIndex: r.hoverLine.index, x: c, y: h, label: r.hoverLine.label, data: d, fmt: m }, t = $.proxy(e.fmt, e), n = t(); return n }), b && (v.content = function () { var e = { pointIndex: a, lineIndex: r.hoverLine.index, x: c, y: h, label: r.hoverLine.label, data: d, fmt: g }, t = $.proxy(e.fmt, e), n = t(); return n }); p = $.extend({ stroke: this.hoverLine.path.attr("stroke") }, s.style), v.style.stroke = p.stroke, i.showAt(f) } } e.prototype._mouseMoveInsidePlotArea.call(this, t, n) }, t.prototype._mouseMoveOutsidePlotArea = function (t, n) { this._clearHoverState(!1), e.prototype._mouseMoveOutsidePlotArea.call(this, t, n) }, t.prototype._clearHoverState = function (e) { var t = this.tooltip, n = this.options.hint; n.enable && t && !e && t.hide(), this.hoverLine && (this.hoverLine.path.removed || (this.options.type === "line" && this.hoverLine.lineStyle.fill && delete this.hoverLine.lineStyle.fill, this.hoverLine.path.wijAttr(this.hoverLine.lineStyle), this.hoverPoint && !this.hoverPoint.isSymbol && (this.hoverPoint.marker.wijAttr(this.hoverPoint.markerStyle), this.hoverPoint.marker.transform("s1")))), this.hoverLine = null, this.hoverPoint = null, this.hoverVirtualPoint = null }, t.prototype._paintLegendIcon = function (e, t, n, r, i, s, o, u, a, f) { var l = this, c = this.options, h = l.canvas.path(Raphael.format("M{0},{1}L{2},{3}", e, t + r / 2, e + n, t + r / 2)), p; $(h.node).data("legendIndex", s).data("index", o), l.legendIcons.push(h), i && h.attr($.extend(!0, {}, i, { "stroke-width": c.legend.size.height })), $.wijraphael.addClass($(h.node), u); var d = a.markerStyle; d = $.extend({ fill: i.stroke, stroke: i.stroke, opacity: 1 }, d), i["stroke-dasharray"] && h.attr({ "stroke-width": 1, "stroke-dasharray": i["stroke-dasharray"] }); if (a.markers && a.markers.visible) { var v = a.markers.type; v || (v = "circle"), p = this.canvas.paintMarker(v, e + n / 2, t + r / 2, 3), $.wijraphael.addClass($(p.node), Raphael.format("{0} {1} {2}", c.wijCSS.legend, c.wijCSS.legendDot, c.wijCSS.canvasObject)), p.attr(d), $(p.node).data("index", o).data("legendIndex", s), this.legendDots.push(p) } return h }, t.prototype._paintLegend = function () { var t = this.options, n = 0, r = 0, i = 0, s = null, o = t.seriesList, u = t.seriesStyles, a = null, f = null, l = null, c = 0, h = 0, p = null, d = null, v = null; $.extend(!0, t, { legend: { size: { width: 30, height: 3 } } }), e.prototype._paintLegend.call(this) }, t.prototype._paintPlotArea = function () { var e = this.options, t; this.aniPathsAttr || (this.aniPathsAttr = []), this.linechartRender = new r(this.chartElement, { bounds: this.canvasBounds, widgetName: this.widgetName, canvas: this.canvas, tooltip: this.tooltip, wijCSS: e.wijCSS, stacked: e.stacked, hole: e.hole, type: e.type, axis: e.axis, animation: e.animation, seriesTransition: e.seriesTransition, seriesList: e.seriesList, seriesStyles: e.seriesStyles, seriesHoverStyles: e.seriesHoverStyles, showChartLabels: e.showChartLabels, chartLabelStyle: e.chartLabelStyle, chartLabelFormatString: e.chartLabelFormatString, isXTime: this.axisInfo.x.isTime, isYTime: this.axisInfo.y.isTime || this.axisInfo.y[0].isTime, disabled: e.disabled, culture: this._getCulture(), hint: e.hint, aniPathsAttr: this.aniPathsAttr, chartLabelEles: this.chartLabelEles, mouseDown: $.proxy(this._mouseDown, this), mouseUp: $.proxy(this._mouseUp, this), mouseOver: $.proxy(this._mouseOver, this), mouseOut: $.proxy(this._mouseOut, this), mouseMove: $.proxy(this._mouseMove, this), click: $.proxy(this._click, this), widget: this, extremeValue: { txx: this.extremeValue.txx, txn: this.extremeValue.txn, tyx: this.extremeValue.y[0].tyx, tyn: this.extremeValue.y[0].tyn } }), this.linechartRender.render() }, t }(e.wijchartcore); e.wijlinechart = t; var n = function () { function e() { this.initSelector = ":jqmData(role='wijlinechart')", this.wijCSS = { lineChart: "wijmo-wijlinechart", areaChart: "wijmo-wijareachart", lineLabel: "wijlinechart-label", lineElement: "wijlinechart", areaElement: "wijlinechart-area", lineTracker: "linetracker", canvasMarker: "wijchart-canvas-marker" }, this.stacked = !1, this.hole = null, this.type = "line", this.animation = { enabled: !0, direction: "horizontal", duration: 2e3, easing: "easeInCubic" }, this.seriesTransition = { enabled: !0, duration: 2e3, easing: "easeInCubic" }, this.mouseDown = null, this.mouseUp = null, this.mouseOver = null, this.mouseOut = null, this.mouseMove = null, this.click = null } return e }(); t.prototype.options = $.extend(!0, {}, e.wijchartcore.prototype.options, new n), $.wijmo.registerWidget("wijlinechart", t.prototype); var r = function () { function t(e, t) { this.options = t, this.element = e } return t.prototype.render = function () { var e = this.element, t = this.options, n = t.wijCSS, r = t.bounds, i = t.widgetName, s = t.canvas, o = t.animation, u = t.seriesTransition, a = t.hint, f = t.tooltip, l = t.mouseDown, c = t.mouseUp, h = t.mouseOver, p = t.mouseOut, d = t.mouseMove, v = t.click, m = [], g = [], y = [], b = [], w = [], E = t.disabled, S = s.set(), x = t.aniPathsAttr, T = [], N, C = e.data("fields") || {}, k = [], L = t.culture, A = t.widget, O = t.extremeValue, M = { enable: !1, left: -10, top: -10, right: 10, bottom: 10 }; this.widget = A, this.renderLineChart(t, T, x, b, w, m, S, g, y, k, L), !t.axis.x.autoMax && t.axis.x.max < O.txx && (M.enable = !0, M.right = 0), !t.axis.x.autoMin && t.axis.x.min > O.txn && (M.enable = !0, M.left = 0), !t.axis.y.autoMax && t.axis.y.max < O.tyx && (M.enable = !0, M.top = 0), !t.axis.y.autoMin && t.axis.y.min > O.tyn && (M.enable = !0, M.bottom = 0), o.enabled || u.enabled ? this.playAnimation(o, u, S, r, b, x, M) : M.enable && this.setClipRect(M, S, r), x.length = 0, $.each(T, function (e, t) { x.push(t) }), this.unbindLiveEvents(e, i, n), this.bindLiveEvents(e, s, r, i, l, c, h, p, d, v, E, a, y, f, n), N = { paths: b, shadowPaths: w, markersSet: m, animationSet: S, symbols: g }, C.chartElements || (C.chartElements = {}), C.seriesEles = k, $.extend(!0, C.chartElements, N), e.data("fields", C) }, t.prototype.setClipRect = function (e, t, n) { var r = n.endX - n.startX - e.left + e.right, i = n.endY - n.startY - e.top + e.bottom; t.wijAttr("clip-rect", Raphael.format("{0} {1} {2} {3}", n.startX + e.left, n.startY + e.top, r, i)) }, t.prototype.playAnimation = function (e, t, n, r, i, s, o) { var u = this, a = e.duration, f = e.easing; e.direction === "horizontal" ? (s && s.length && t.enabled && (a = t.duration, f = t.easing), this.playHAnimation(a, f, n, r, i, o)) : (o.enable && this.setClipRect(o, n, r), $.each(i, function (e, n) { if (typeof n == "undefined" || n === null) return !0; s && s.length > e && t.enabled ? (a = t.duration, f = t.easing, u.playVAnimation(n, s, e, a, f)) : n.straight && u.playVStraightAnimation(n, a, f) })) }, t.prototype.playVAnimation = function (t, n, r, i, s) { var o, u; t.shadow && t.shadow.hide(), t.tracker && t.tracker.hide(), o = n[r], o && o.path && (u = e.ChartUtil.getDiffAttrs(o.path, t.attr())), $.isEmptyObject(u) || (t.attr(o.path), t.wijAnimate(u, i, s, function () { t.shadow && t.visible !== !1 && t.shadow.show(), t.tracker && t.tracker.show() })), $.each(t.markers, function (t, n) { var r = e.ChartUtil.getDiffAttrs(o.markers[t], n.attr()); $.isEmptyObject(r) || (n.attr(o.markers[t]), n.wijAnimate(r, i, s)) }), t.labels && $.each(t.labels, function (t, n) { var r = e.ChartUtil.getDiffAttrs(o.labels[t], n.attr()), u = o.labels[t]; u && u.text && delete u.text, $.isEmptyObject(r) || (n.attr(u), n.wijAnimate(r, i, s)) }), t.area && (u = e.ChartUtil.getDiffAttrs(o.area, t.area.attr()), $.isEmptyObject(u) || (t.area.attr(o.area), t.area.wijAnimate(u, i, s))) }, t.prototype.playVStraightAnimation = function (e, t, n) { var r, i, s; e.shadow && e.shadow.hide(), e.tracker && e.tracker.hide(), r = e.straight, i = e.attr().path, e.attr({ path: r }), e.wijAnimate({ path: i }, t, n, function () { e.shadow && e.visible !== !1 && e.shadow.show(), e.tracker && e.tracker.show() }), $.each(e.markers, function (e, r) { if (r.straight) { var i = r.attr().cy; r.attr({ cy: r.straight }), r.wijAnimate({ cy: i }, t, n) } }), e.area && (s = e.area, r = s.straight, i = s.attr().path, s.attr({ path: r }), s.wijAnimate({ path: i }, t, n)) }, t.prototype.playHAnimation = function (e, t, n, r, i, s) { $.each(i, function (e, t) { t.tracker && t.tracker.hide() }); var o = s.enable, u = r.endX - r.startX - s.left + s.right, a = r.endY - r.startY - s.top + s.bottom; n.wijAttr("clip-rect", Raphael.format("{0} {1} 0 {2}", r.startX + s.left, r.startY + s.top, a)), n.wijAnimate({ "clip-rect": Raphael.format("{0} {1} {2} {3}", r.startX + s.left, r.startY + s.top, u, a) }, e, t, function () { this.tracker && this.tracker.show(); if (Raphael.vml && !o) { var e = null, t = null, n = this.node; n && n.clipRect && (e = this.attrs, delete e["clip-rect"], n.clipRect = null, t = $(n).parent(), t.before(n), t.remove(), this.attr(e), e.src && e.src.length && this.attr({ src: e.src })) } }) }, t.prototype.renderLineChart = function (t, n, r, i, s, o, u, a, f, l, c) { var h = this, p = t.wijCSS, d = t.bounds, v = t.canvas, m = t.stacked, g = t.hole, y = t.type, b = t.axis, w = t.animation, E = t.seriesTransition, S = !1, x = t.seriesList, T = t.seriesStyles, N = t.seriesHoverStyles, C = t.showChartLabels, k = t.chartLabelStyle, L = t.chartLabelFormatString, A = t.isXTime, O = t.isYTime, M = t.chartLabelEles, _, D, P, H, B, j, F = [], I = [], q, R, U, z, W; $.each(x, function (t, X) { var V = [], J = [], K = [], Q, G, Y, Z, et, tt, nt = []; if (X.display === "exclude") return !0; tt = T[t], X = $.extend(!0, { display: "show", fitType: "line", markers: { visible: !1, type: "circle" }, visible: !0 }, X), Q = X.data, G = $.extend({ stroke: "black", opacity: 1, fill: "none", "stroke-linejoin": "round", "stroke-linecap": "round" }, tt), Z = X.markerStyle, Z = $.extend({ fill: G.stroke, stroke: G.stroke, opacity: 1, width: 3 }, Z), Y = N[t], et = $.extend(!0, {}, Y, { transform: "s1.5", "stroke-width": 1 }, x.markerHoverStyle), B = [].concat(Q.x), j = [].concat(Q.y), U = v.set(), R = [], H = X.fitType, z = !1, X.markers.symbol && X.markers.symbol.length && (z = !0), _ = v.set(); if (!r || r.length <= t || w.enabled && !E.enabled) S = !0; S && j.length > 0 && (D = e.ChartUtil.getFirstValidListValue(j), O && (D = $.toOADate(D)), P = e.ChartUtil.getLastValidListValue(j), O && (P = $.toOADate(P))), W = h.processYValues(j, X.display, g, m, F), $.each(j, function (e, t) { q = B[e], A && (q = $.toOADate(q)), t = j[e]; if (W[e].isHole) { if (X.display === "excludeHole") return !0; if (!W[e].isValue) return !0 } O && (t = $.toOADate(t)); if (q === undefined) return !1; R = h.renderPoint(d, v, K, R, U, V, u, _, J, M, L, S, D, P, q, t, Q.y[e], b, H, A, O, e, Z, et, X, z, C, a, B, j, W, X.display, m, nt, c, p) }), h.renderPath(v, d, X, i, s, f, Y, Z, et, U, o, u, R, n, K, G, k, V, J, _, t, y, I, m, nt, p), l.push({ markers: U, path: i[i.length - 1], shadowPath: s[s.length - 1], dcl: _ }) }), $.each($.merge([], i).reverse(), function (e, t) { t.toFront(), t.area && t.area.toFront() }), $.each(i, function (e, t) { t.tracker && t.tracker.toFront() }), $.each(i, function (e, t) { t.markers && t.markers.toFront() }) }, t.prototype.renderPath = function (t, n, r, i, s, o, u, a, f, l, c, h, p, d, v, m, g, y, b, w, E, S, x, T, N, C) { var k, L, A, O, M, _, D, P, H, B, j, F, I, q, R; k = t.path(p.join(" ")), k.straight = v.join(" "), e.ChartUtil.paintShadow(k, 1, "#cccccc"), E === 0 && (x.length = 0, p.length > 1 ? (_ = p[1], D = p[p.length - 2]) : (_ = n.startX, D = n.endX), $.merge(x, ["L", _, n.endY, "L", D, n.endY])), P = t.path(p.join(" ")), k.tracker = P, m["stroke-width"] ? H = 10 + parseFloat(m["stroke-width"]) : H = 10, P.attr({ "stroke-width": H, stroke: "#C0C0C0", opacity: .01 }), $.wijraphael.addClass($(P.node), Raphael.format("{0} {1} {2}", C.canvasObject, C.lineElement, C.lineTracker)), $(P.node).data("owner", $(k.node)), S === "area" ? (m.fill && m.fill !== "none" ? (L = m.fill, delete m.fill) : L = m.stroke, A = .5, O = 1, m["fill-opacity"] && m["fill-opacity"] !== "none" && (A = m["fill-opacity"]), m.opacity && m.opacity !== "none" && (O = m.opacity), k.wijAttr(m), p.length > 1 ? _ = p[1] : _ = n.startX, T ? (p.push("V"), p.push(n.endY), p.push("H"), p.push(_), p.push("Z")) : (I = Raphael.parsePathString(k.attr("path")), I && I.length > 0 && (p = [], $.each(I, function (e, t) { $.each(t, function (e, t) { p.push(t) }), t[0] === "M" && (_ = t[1]), e < I.length - 1 && I[e + 1][0] === "M" && (p.push("V"), p.push(n.endY), p.push("H"), p.push(_), p.push("Z")), e === I.length - 1 && (p.push("V"), p.push(n.endY), p.push("H"), p.push(_), p.push("Z")) }))), M = t.path(p.join(" ")), $.wijraphael.addClass($(M.node), C.areaElement), M.wijAttr({ fill: L, opacity: O, "fill-opacity": A, stroke: "none" }), v.push("V"), v.push(n.endY), v.push("H"), v.push(_), v.push("Z"), M.straight = v.join(" "), k.area = M, h.push(M), d.push({ path: $.extend(!0, {}, k.attr()), area: $.extend(!0, {}, M.attr()), markers: y, labels: b })) : (R = $.extend(!0, {}, m), R.fill && delete R.fill, k.wijAttr(R), d.push({ path: $.extend(!0, {}, k.attr()), markers: y, labels: b })), k.markers = l, i.push(k), k.shadow && (s[E] = k.shadow), h.push(k), o[E] = { lineStyle: m, lineHoverStyle: u, markerStyle: a, markerHoverStyle: f }, (!r.markers.visible || r.display === "hide") && l.hide(); if (!r.visible || r.display === "hide") k.hide(), k.shadow && k.shadow.hide(), k.area && k.area.hide(), k.visible = !1; r.markers.style && l.attr(r.markers.style), l.toFront(), w.length && (B = $.extend(!0, {}, g), r.textStyle && (B = $.extend(!0, B, r.textStyle)), w.attr(B), w.toFront(), k.labels = w), c[E] = l, r.index = E, r.type = "line", r.path = k, r.lineMarkers = l, r.lineStyle = m, r.lineHoverStyle = u, r.virtualMarkers = N, $.wijraphael.addClass($(k.node), Raphael.format("{0} {1}", C.canvasObject, C.lineElement)), $(k.node).data("wijchartDataObj", r) }, t.prototype.renderPoint = function (e, t, n, r, i, s, o, u, a, f, l, c, h, p, d, v, m, g, y, b, w, E, S, x, T, N, C, k, L, A, O, M, _, D, P, H) { var B = e.endX - e.startX, j = e.endY - e.startY, F = g.x.min, I = g.y.min, q = g.x.max, R = g.y.max, U = B / (q - F), z = j / (R - I), W, X, V, J = 0, K, Q, G, Y, Z = T.markers.visible, et = this.widget, tt; return isNaN(d) || typeof d == "string" ? V = E : V = d, J = e.startX + (V - F) * U, K = e.endY - (v - I) * z, O[E].x = J, O[E].y = K, c && (Q = h + (p - h) / (q - F) * (V - F), Q = e.endY - (Q - I) * z, n.push(O[E].idx ? "L" : "M"), n.push(J), n.push(Q)), O[E].isHole ? r : (r = this.getPathArrByFitType(r, y, E, A.length, e, L, A, J, K, b, w, d, v, U, z, F, I, O, M, _), C && (Y = this.renderChartLabel(t, w, v, l, J, K, P, H), f.push(Y), u.push(Y), a.push($.extend(!0, {}, Y.attr()))), Z && (W = this.renderMarker(t, k, N, T.markers, E, J, K, S, H), X = W.dot, c && (X.straight = Q)), G = {}, G.valX = L[E], G.valY = m, G.index = E, G.type = "marker", G.lineSeries = T, G.x = J, G.y = K, G.markerStyle = S, G.markerHoverStyle = x, G.visible = !0, Z && (G.marker = X, G.isSymbol = W.isSymbol, $(X.node).data("wijchartDataObj", G), i.push(X), s.push($.extend(!0, {}, X.attr())), o.push(X)), et.dataPoints = et.dataPoints || {}, et.pointXs = et.pointXs || [], tt = $.round(J, 2), et.dataPoints[tt.toString()] || (et.dataPoints[tt.toString()] = [], et.pointXs.push(tt)), et.dataPoints[tt.toString()].push(G), D.push(G), r) }, t.prototype.processYValues = function (t, n, r, i, s) { var o = [], u = 0, a = 0; return $.each(t, function (f, l) { u || (a = f); var c = { isHole: !1, isValue: !0, idx: u, firstYIdx: a, x: 0, y: 0 }; u++, e.ChartUtil.isHolefunction(l, r) && (i ? t[f] = 0 : (c.isHole = !0, n === "excludeHole" ? (u--, c.idx = 0) : (u = 0, c.idx = 0), !e.ChartUtil.isHolefunction(r, undefined) && l === r ? c.isValue = !0 : c.isValue = !1)), o.push(c), i && f < s.length && (t[f] += s[f]) }), s.length = 0, $.merge(s, t), o }, t.prototype.renderMarker = function (e, t, n, r, i, s, o, u, a) { var f, l = null, c = !1, h, p; return n && (f = r.symbol, $.each(f, function (n, r) { if (r.index === i) return l = e.image(r.url, s - r.width / 2, o - r.height / 2, r.width, r.height), t.push(l), c = !0, !1 })), l === null && (h = r.type, p = u.width, l = e.paintMarker(h, s, o, p), r.visible && l.attr(u)), $.wijraphael.addClass($(l.node), Raphael.format("{0} {1} {2}", a.canvasObject, a.lineElement, a.canvasMarker)), { dot: l, isSymbol: c } }, t.prototype.renderChartLabel = function (e, t, n, r, i, s, o, u) { var a, f, l, c = this.options.widget; return a = t ? $.fromOADate(n) : n, r && r.length && (a = Globalize.format(a, r, o)), f = c._text.call(c, i, s, a), $.wijraphael.addClass($(f.node), u.lineLabel), l = f.wijGetBBox(), f.transform(Raphael.format("...T{0},{1}", 0, -l.height)), f }, t.prototype.getAnchors = function (e, t, n, r, i, s) { var o = (n - e) / 2, u = (i - n) / 2, a = Math.atan((n - e) / Math.abs(r - t)), f = Math.atan((i - n) / Math.abs(r - s)), l = 0, c = 0, h = 0, p = 0, d = 0; return a = t < r ? Math.PI - a : a, f = s < r ? Math.PI - f : f, l = Math.PI / 2 - (a + f) % (Math.PI * 2) / 2, c = o * Math.sin(l + a), h = o * Math.cos(l + a), p = u * Math.sin(l + f), d = u * Math.cos(l + f), { x1: n - c, y1: r + h, x2: n + p, y2: r + d } }, t.prototype.getPathArrByFitType = function (e, t, n, r, i, s, o, u, a, f, l, c, h, p, d, v, m, g, y, b) { var w = null, E = 0, S = 0, x = 0, T = 0, N = null, C = null, k = g[n], L = !1, A = k.idx, O, M = n - 1, _ = n + 1; if (y === "excludeHole" && !b) { if (n > 0 && n < r - 1) { _ = -1, M = -1; for (O = n + 1; O < r; O++) { L = !0; if (g[O].isHole) continue; _ = O, L = !1; break } for (O = n - 1; O >= 0; O--) { if (g[O].isHole) continue; M = O; break } M > -1 && (x = g[M].x, E = g[M].y) } } else n < r - 1 && (L = g[_].isHole), n > 0 && n < r - 1 && (x = g[M].x, E = g[M].y); return b && (t = "line"), t === "line" ? e = e.concat([A ? "L" : "M", u, a]) : t === "spline" ? A ? A && n < r - 1 && !L ? (w = o[_], l && (w = $.toOADate(w)), S = i.endY - (w - m) * d, isNaN(c) || typeof c == "string" ? T = i.startX + (_ - v) * p : (N = s[_], f && (N = $.toOADate(N)), T = i.startX + (N - v) * p), C = this.getAnchors(x, E, u, a, T, S), e = e.concat([C.x1, C.y1, u, a, C.x2, C.y2])) : e = e.concat([u, a, u, a]) : n === r - 1 ? e = e.concat(["M", u, a]) : L ? e = e.concat(["M", u, a]) : e = e.concat(["M", u, a, "C", u, a]) : t === "bezier" && (A ? n < r - 1 && g[n + 1].isHole && A % 2 === 1 || n === r - 1 && A % 2 === 1 ? e = e.concat(["Q", u, a, u, a]) : A % 2 === 0 ? e = e.concat([u, a]) : e = e.concat(["Q", u, a]) : e = e.concat(["M", u, a])), e }, t.prototype.bindLiveEvents = function (e, t, n, r, i, s, o, u, a, f, l, c, h, p, d) { var v = "", m = { element: e, mousedown: function (t) { if (l) return; var n = $(t.target), r, s = null; n.data("owner") && (n = n.data("owner")), r = n.data("wijchartDataObj"), n.hasClass(d.canvasMarker) ? (s = r.lineSeries, s.markers.visible ? i.call(e, t, r) : i.call(e, t, s)) : i.call(e, t, r) }, mouseup: function (t) { if (l) return; var n = $(t.target), r, i = null; n.data("owner") && (n = n.data("owner")), r = n.data("wijchartDataObj"), n.hasClass(d.canvasMarker) ? (i = r.lineSeries, i.markers.visible ? s.call(e, t, r) : s.call(e, t, i)) : s.call(e, t, r) }, mouseover: function (t) { if (l) return; var n = $(t.target), r, i = null; n.data("owner") && (n = n.data("owner")), r = n.data("wijchartDataObj"), n.hasClass(d.canvasMarker) ? (i = r.lineSeries, i.markers.visible ? o.call(e, t, r) : o.call(e, t, i)) : o.call(e, t, r) }, mouseout: function (t) { if (l) return; var n = $(t.target), r, i = null; n.data("owner") && (n = n.data("owner")), r = n.data("wijchartDataObj"), n.hasClass(d.canvasMarker) ? (i = r.lineSeries, i.markers.visible ? u.call(e, t, r) : u.call(e, t, i)) : u.call(e, t, r) }, mousemove: function (t) { if (l) return; var n = $(t.target), r, i = null; n.data("owner") && (n = n.data("owner")), r = n.data("wijchartDataObj"), n.hasClass(d.canvasMarker) ? (i = r.lineSeries, i.markers.visible ? a.call(e, t, r) : a.call(e, t, i)) : a.call(e, t, r) }, click: function (t) { if (l) return; var n = $(t.target), r, i = null; n.data("owner") && (n = n.data("owner")), r = n.data("wijchartDataObj"), n.hasClass(d.canvasMarker) ? (i = r.lineSeries, i.markers.visible ? f.call(e, t, r) : f.call(e, t, i)) : f.call(e, t, r) } }; $.support.isTouchEnabled && $.support.isTouchEnabled() && (v = "wij"), e.on(v + "mousedown." + r, "." + d.lineElement, $.proxy(m.mousedown, m)).on(v + "mouseup." + r, "." + d.lineElement, $.proxy(m.mouseup, m)).on(v + "mouseover." + r, "." + d.lineElement, $.proxy(m.mouseover, m)).on(v + "mouseout." + r, "." + d.lineElement, $.proxy(m.mouseout, m)).on(v + "mousemove." + r, "." + d.lineElement, $.proxy(m.mousemove, m)).on(v + "click." + r, "." + d.lineElement, $.proxy(m.click, m)) }, t.prototype.unbindLiveEvents = function (e, t, n) { e.off("." + t, "." + n.lineElement) }, t }(); e.LineChartRender = r })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { var t = function (e) { function t() { e.apply(this, arguments) } return __extends(t, e), t.prototype._create = function () { this._handleChartStyles(), e.prototype._create.call(this), this.chartElement.addClass(this.options.wijCSS.pieChart) }, t.prototype.destroy = function () { var t = this.options.wijCSS, n = this.chartElement, r = n.data("fields"), i = r && r.sectors, s = r && r.labels; n.removeClass(t.pieChart), e.prototype.destroy.call(this), i && i.length && $.each(i, function (e, t) { t = null }), s && s.length && $.each(s, function (e, t) { t = null }), n.data("fields", null) }, t.prototype._isPieChart = function () { return !0 }, t.prototype.getSector = function (e) { var t = this.chartElement.data("fields"); return t && t.chartElements ? t.chartElements.sectors[e] : null }, t.prototype._bindData = function () { var e = this.options, t = e.dataSource, n = e.data, r = [], i, s, o; t && n && (i = n.label, s = n.value, o = n.offset, i && i.bind && (i = this._getBindData(t, i.bind)), s && s.bind && (s = this._getBindData(t, s.bind)), o && o.bind && (o = this._getBindData(t, o.bind)), i && $.isArray(i) && i.length && s && $.isArray(s) && s.length && ($.each(s, function (e, t) { var n, u = 0; e >= 0 && e < i.length && (n = i[e]), o && $.isArray(s) && o.length && e >= 0 && e < o.length && (u = typeof o[e] == "undefined" ? 0 : o[e]), r.push({ data: t, label: n, offset: u, legendEntry: !0 }) }), e.seriesList = r)) }, t.prototype._hanldSharedXData = function () { }, t.prototype._getSeriesFromTR = function (e, t, n) { var r = null, i = null, s = null, o = null, u = null; t.length && t.each(function () { i = $("th", $(this)), r = $.trim(i.text()), s = $("td", $(this)), s.length && (o = parseFloat($.trim($(s[0]).text()))), u = { label: r, legendEntry: !0, data: o }, n.push(u) }) }, t.prototype._showSerieEles = function (e) { var t = this.options.showChartLabels; e.sector && (e.sector.show(), e.sector.shadow && e.sector.shadow.show(), e.sector.tracker && e.sector.tracker.show()), e.label && t && (e.label.show(), e.label.connector && e.label.connector.show(), $(e.label.node).data("legendHide", !1)) }, t.prototype._hideSerieEles = function (e) { e.sector && (e.sector.hide(), e.sector.shadow && e.sector.shadow.hide(), e.sector.tracker && e.sector.tracker.hide()), e.label && (e.label.hide(), e.label.connector && e.label.connector.hide(), $(e.label.node).data("legendHide", !0)) }, t.prototype._hasAxes = function () { return !1 }, t.prototype._mouseMoveInsidePlotArea = function (t, n) { e.prototype._mouseMoveInsidePlotArea.call(this, t, n); if (this.isTapAndHold) { var r = this.previousAngle, i = 0, s = "", o = this.chartElement, u = this.tapTarget ? this.tapTarget.data("wijchartDataObj") : {}, a = u.pieID || "", f = o.data("fields").chartElements["sectors" + a], l = this.canvasBounds, c = (l.startX + l.endX) / 2, h = (l.startY + l.endY) / 2, p = Raphael.angle(n.left, n.top, c, h); r && (i = Math.round(p - r), Math.abs(p - r) > 180 && (p > r ? i -= 360 : i += 360), i && (s = Raphael.format("...r{0},{1},{2}", i, c, h), $.each(f, function (e, t) { t.transform(s) }), this.tooltip && this._setTouchTooltip(null))), this.previousAngle = p } }, t.prototype._mouseMoveOutsidePlotArea = function (t, n) { e.prototype._mouseMoveOutsidePlotArea.call(this, t, n), this.isTapAndHold && this._rotateToSectorCenter(null) }, t.prototype._rotateToSectorCenter = function (e) { var t = this, n = this.options.animation, r = this.chartElement, i = this.tapTarget ? this.tapTarget.data("wijchartDataObj") : {}, s = i.pieID || "", o = r.data("fields").chartElements["sectors" + s], u = r.data("fields").chartElements["labels" + s], a = this.canvasBounds, f = (a.startX + a.endX) / 2, l = (a.startY + a.endY) / 2, c, h, p, d = this; this._hideSectorElements(o, u), this.tooltip && (h = this._getTouchttSector(e)), this.touchttSector && this.touchttSector === h && Math.abs(this.targetCenterAngle) >= .01 ? (this.targetCenterAngle > 180 ? p = this.targetCenterAngle - 360 : this.targetCenterAngle < -180 ? p = this.targetCenterAngle + 360 : p = this.targetCenterAngle, c = Raphael.animation({ transform: Raphael.format("...r{0},{1},{2}", p, f, l) }, n.duration, n.easing, function () { d._rotateCallback(this, u) }), $.each(o, function (e, t) { t.animate(c) })) : $.each(o, function (e, n) { t._rotateCallback(n, u) }), this.previousAngle = null, this.isTapAndHold = !1, this.tapTarget = null }, t.prototype._rotateCallback = function (e, t) { var n = this.canvasBounds, r = (n.startX + n.endX) / 2, i = (n.startY + n.endY) / 2, s = e.index, o = 0, u = e.attr("transform"), a; $.each(u, function (e, t) { if (t[0] !== "r") return !0; t.length >= 4 && (o += t[1]) }), r > 0 && (o %= 360, e.attr("transform", Raphael.format("r{0},{1},{2}", o, r, i))), e.tracker && (e.tracker.attr("transform", Raphael.format("r{0},{1},{2}", o, r, i)), e.tracker.show()), e.shadow && (e.shadow.attr("transform", Raphael.format("r{0},{1},{2}", o, r, i)), e.shadow.show()); if (t && t.length && t.length > s) { a = t[s], a.attr("transform", Raphael.format("r{0},{1},{2}r{3}", o, r, i, 0 - o)); if ($(a.node).data("legendHide")) return; a.show() } }, t.prototype._getTouchttSector = function (e) { var t = this, n = this.chartElement, r = this.tapTarget ? this.tapTarget.data("wijchartDataObj") : {}, i = r.pieID || "", s = n.data("fields").chartElements["sectors" + i], o = this.tooltip.getOptions(), u = o.compass, a = 90, f; switch (u) { case "east": a = 0; break; case "south": a = 270; break; case "west": a = 180; break; case "north": default: a = 90 } return $.each(s, function (n, r) { var i = r.attr("transform"), s = 0, o = r.angles; $.each(i, function (e, t) { if (t[0] !== "r") return !0; t.length >= 4 && (s += t[1]) }), s %= 360, s < 0 && (s = 360 + s), s = (a + s) % 360; if (e) { if (r === e) return t.targetCenterAngle = (o.start + o.end) / 2 - s, f = e, !1 } else if (o.start <= s && o.end >= s) return t.targetCenterAngle = (o.start + o.end) / 2 - s, f = r, !1 }), f }, t.prototype._setTouchTooltip = function (e) { var t = this.tooltip.getOptions(), n = t.compass, r = this._getTouchttSector(e), i = this.options.hint, s = i.title, o = i.content, u = $.isFunction(s), a = $.isFunction(o), f, l; if (!r || this.touchttSector && this.touchttSector === r) return; f = $(r.node).data("wijchartDataObj"), l = { data: f, value: f.value, label: f.label, total: f.total, y: f.value }; if (u || a) u && (t.title = function () { l.fmt = s; var e = $.proxy(l.fmt, l), t = e(); return t }), a && (t.content = function () { l.fmt = o; var e = $.proxy(l.fmt, l), t = e(); return t }); this._showTouchTooltip(n), this.touchttSector = r }, t.prototype._showTouchTooltip = function (e) { var t = this.chartElement, n = this.canvasBounds, r = { x: 0, y: 0 }; switch (e) { case "east": r = { x: t.width(), y: (n.startY + n.endY) / 2 }; break; case "south": r = { x: (n.startX + n.endX) / 2, y: t.height() }; break; case "west": r = { x: 0, y: (n.startY + n.endY) / 2 }; break; case "north": default: r = { x: (n.startX + n.endX) / 2, y: 0 } } this.tooltip.showAt(r) }, t.prototype._mouseDown = function (t, n) { var r = $(t.target), i = this.chartElement, s, o, u; e.prototype._mouseDown.call(this, t, n), $.support.isTouchEnabled && $.support.isTouchEnabled() && (this.isTapAndHold = !0, r.data("owner") && (r = r.data("owner")), this.tapTarget = r, s = n.pieID || "", o = i.data("fields").chartElements["sectors" + s], u = i.data("fields").chartElements["labels" + s], this._hideSectorElements(o, u)) }, t.prototype._hideSectorElements = function (e, t) { $.each(e, function (e, n) { n.stop(), n.tracker && n.tracker.hide(), n.shadow && n.shadow.hide(); if (t && t.length) { var r = t[e]; r.hide() } }) }, t.prototype._mouseUp = function (t, n) { e.prototype._mouseUp.call(this, t, n), $.support.isTouchEnabled && $.support.isTouchEnabled() && this.isTapAndHold && this._rotateToSectorCenter(null) }, t.prototype._mouseOver = function (t, n) { e.prototype._mouseOver.call(this, t, n) }, t.prototype._mouseOut = function (t, n) { e.prototype._mouseOut.call(this, t, n) }, t.prototype._mouseMove = function (t, n) { e.prototype._mouseMove.call(this, t, n) }, t.prototype._click = function (t, n) { var r = this.chartElement, i, s, o; e.prototype._click.call(this, t, n), $.support.isTouchEnabled && $.support.isTouchEnabled() && this.tooltip && (i = n.pieID || "", s = r.data("fields").chartElements["sectors" + i], s.length && s.length > n.index && (o = s[n.index], this._setTouchTooltip(o), this._rotateToSectorCenter(o))) }, t.prototype._paintTooltip = function () { var t = this.options.wijCSS, n = this.chartElement, r = n.data("fields"); e.prototype._paintTooltip.call(this), this.tooltip && r && ($.support.isTouchEnabled && $.support.isTouchEnabled() ? (this.tooltip.setOptions({ closeBehavior: "none", mouseTrailing: !1, animated: null, showAnimated: null, windowCollisionDetection: "fit" }), this._setTouchTooltip(null), this._rotateToSectorCenter(null)) : r.trackers && r.trackers.length && (this.tooltip.setSelector($("." + t.canvasObject, n[0])), this.tooltip.setOptions({ relatedElement: r.trackers[0] }))) }, t.prototype._paintPlotArea = function () { var e = this.options, t = this.canvasBounds, n = t.endX - t.startX, i = t.endY - t.startY, s = e.radius; s ? (n < 2 * s && (s = n / 2), i < 2 * s && (s = i / 2)) : s = Math.min(n, i) / 2, t.startX += n / 2 - s, t.endX = t.startX + 2 * s, t.startY += i / 2 - s, t.endY = t.startY + 2 * s, this.chartElement.data("fields") && (this.chartElement.data("fields").seriesEles = null), this.piechartRender = new r(this.chartElement, { canvas: this.canvas, tooltip: this.tooltip, bounds: t, wijCSS: e.wijCSS, radius: s, startAngle: e.startAngle, widgetName: this.widgetName, innerRadius: e.innerRadius, seriesList: e.seriesList, seriesStyles: e.seriesStyles, seriesHoverStyles: e.seriesHoverStyles, seriesTransition: e.seriesTransition, showChartLabels: e.showChartLabels, disabled: e.disabled, textStyle: e.textStyle, chartLabelStyle: e.chartLabelStyle, chartLabelFormatString: e.chartLabelFormatString, chartLabelFormatter: e.chartLabelFormatter, labels: e.labels, shadow: e.shadow, animation: e.animation, culture: this._getCulture(), mouseDown: $.proxy(this._mouseDown, this), mouseUp: $.proxy(this._mouseUp, this), mouseOver: $.proxy(this._mouseOver, this), mouseOut: $.proxy(this._mouseOut, this), mouseMove: $.proxy(this._mouseMove, this), click: $.proxy(this._click, this), widget: this }), this.piechartRender.render() }, t.prototype._getTooltipText = function (e, t) { var n = $(t.node), r, i; return n.data("owner") && (n = n.data("owner")), r = n.data("wijchartDataObj"), i = { data: r, value: r.value, label: r.label, total: r.total, target: t, y: r.value, fmt: e }, $.proxy(e, i)() }, t }(e.wijchartcore); e.wijpiechart = t; var n = function () { function e() { this.initSelector = ":jqmData(role='wijpiechart')", this.wijCSS = { pieChart: "wijmo-wijpiechart", pieLabel: "wijpiechart-label", pieElement: "wijpiechart", pieTracker: "pietracker" }, this.startAngle = 0, this.radius = null, this.innerRadius = 0, this.chartLabelFormatter = null, this.labels = { style: {}, formatString: "", formatter: null, connectorStyle: {}, position: "inside", offset: 10 }, this.animation = { enabled: !0, duration: 400, easing: "easeInCubic", offset: 10 }, this.seriesTransition = { enabled: !0, duration: 1e3, easing: "bounce" }, this.seriesList = [], this.mouseDown = null, this.mouseUp = null, this.mouseOver = null, this.mouseOut = null, this.mouseMove = null, this.click = null } return e }(); t.prototype.options = $.extend(!0, {}, e.wijchartcore.prototype.options, new n), $.wijmo.registerWidget("wijpiechart", t.prototype); var r = function () { function t(e, t) { this.options = t, this.element = e } return t.prototype.render = function () { var t = this.element, n = this.options, r = function (t, r, i) { n.shadow && e.ChartUtil.paintShadow(t, r, i) }, i = e.ChartUtil.getDiffAttrs, s = n.canvas, o = $.wijraphael.getPositionByAngle, u = n.seriesList, a = n.seriesStyles, f = n.seriesHoverStyles, l = a.length, c = n.textStyle, h = n.labels || { style: {}, formatString: "", formatter: null, connectorStyle: {}, position: "inside", offset: 10 }, p = $.extend(!0, {}, c, n.chartLabelStyle, h.style), d = h.formatString || n.chartLabelFormatString, v = h.formatter || n.chartLabelFormatter, m = n.culture, g = n.bounds, y = g.startX, b = g.startY, w = n.radius, E = n.showChartLabels, S = n.animation, x = n.seriesTransition, T = n.innerRadius, N = t.data("fields") || {}, C = N.chartElements || {}, k = N.aniSectorAttrs, L = N.aniLabelAttrs, A = 0, O = n.startAngle || 0, M = n.wijCSS, _, D, P, H = [], B = [], j = [], F = [], I = [], q = [], R = s.set(), U = this.options.widget; s.customAttributes.segment = function (t, n, r, i, s, o) { var u = null, a = .01; return i - r > 360 - a ? i -= a : i - r < a && (i += a), o ? u = e.ChartUtil.donut(t, n, s, o, r, i) : u = e.ChartUtil.sector(t, n, s, r, i), { path: u } }, $.each(u, function (e, t) { t && typeof t.data == "number" && (A += t.data) }), $.each(u, function (e, t) { var n = $.extend({ opacity: 1, stroke: "gray", "stroke-width": 1 }, a[e % l]), u = 360 * t.data / A, c = y + w, g = b + w, S, N, C, z, W, X, V, J, K, Q = h.position, G = h.connectorStyle, Y = h.offset, Z, et, tt, nt = !1; _ = t.pieID, t = $.extend(!0, { offset: 0 }, t), t.offset && (S = o(c, g, t.offset, O + u / 2), c = S.x, g = S.y), D = [c, g, O, O + u, w, T], k && x.enabled ? (n.segment = D, e < k.length ? P = k[e] : (P = $.extend(!0, {}, n), P.segment = [c, g, 0, 360, w, T]), N = s.path().attr(P), n = i(P, n), N.removed || N.wijAnimate(n, x.duration, x.easing, function () { r(N, 1, "#cccccc"), V && !V.removed && !N.removed && V.attr({ path: N.attr("path") }), delete n.segment })) : (N = s.path().attr({ segment: D }), r(N, 1, "#ccccc"), N.wijAttr(n)), N.angles = { start: O, end: O + u }, N.index = e, N.getOffset = function (e) { var t = o(c, g, e, (N.angles.start + N.angles.end) / 2); return { x: t.x - c, y: t.y - g } }, N.center = { x: c, y: g }, N.radius = w, T && (N.innerRadius = T), V = N.clone(), Raphael.vml ? V.attr({ opacity: .01, fill: "white", "stroke-width": 0, "fill-opacity": .01 }) : V.attr({ opacity: .01, fill: "white", "fill-opacity": .01 }), $.wijraphael.addClass($(V.node), Raphael.format("{0} {1} {2} wijchart-tracker" + e, M.canvasObject, M.pieElement, M.pieTracker)), $(V.node).data("owner", $(N.node)), N.tracker = V, R.push(V), $.wijraphael.addClass($(N.node), Raphael.format("{0} {1} wijmo-wijpiechart-series-" + e, M.canvasObject, M.pieElement)), $(N.node).data("wijchartDataObj", t), E && (Q === "outside" ? (X = o(c, g, w, O + u / 2), z = o(c, g, w + Y, O + u / 2)) : z = o(c, g, t.offset + w * 2 / 3, O + u / 2), W = $.extend(!0, {}, W, p), t.textStyle && (W = $.extend(!0, W, t.textStyle)), J = t.label, d && d.length > 0 && (J = Globalize.format(J, d, m)), v && $.isFunction(v) && (K = { index: e, value: t.data, y: t.data, total: A, chartLabel: J, chartLabelFormatter: v }, J = $.proxy(v, K)()), L && x.enabled ? e < L.length ? (nt = !0, P = L[e], P.text = J, C = U._text.call(U, 0, 0, "").attr(P), W = i(P, W), W.x = z.x, W.y = z.y, C.wijAnimate(W, x.duration, x.easing, function () { tt && tt.show() })) : C = U._text.call(U, z.x, z.y, J).attr(W) : C = U._text.call(U, z.x, z.y, J).attr(W), Q === "outside" && (Z = (O + u / 2) % 360, et = C.wijGetBBox(), Z >= 90 && Z <= 270 ? C.transform(Raphael.format("T{0},{1}", -et.width / 2, 0)) : C.transform(Raphael.format("T{0},{1}", et.width / 2, 0)), tt = s.path(Raphael.format("M{0} {1}L{2} {3}", X.x, X.y, z.x, z.y)).attr(G), nt && tt.hide(), C.connector = tt), $.wijraphael.addClass($(C.node), Raphael.format("{0} {1} {2}", M.canvasObject, M.pieElement, M.pieLabel)), $(C.node).data("wijchartDataObj", t), I.push(C), F.push(C), B[e] = C.attr()), q.push({ label: F[e], sector: N }), t.visible === !1 && (N.hide(), F[e] && F[e].hide(), tt && tt.hide(), N.shadow && N.shadow.hide(), V.hide()), H[e] = N.attr(), j.push(N), I.push(N), t.style = n, t.hoverStyle = f[e], t.index = e, t.value = t.data, t.y = t.data, t.total = A, t.type = "pie", O += u }), F && F.length && $.each(F, function (e, t) { t.toFront() }), C.sectors = j, _ && (C["sectors" + _] = j, C["labels" + _] = F), C.labels = F, N.chartElements || (N.chartElements = {}), R.toFront(), $.extend(!0, N.chartElements, C), N.aniSectorAttrs = H, N.aniLabelAttrs = B, N.seriesEles = q, N.trackers = R, t.data("fields", N), this.unbindLiveEvents(), this.bindLiveEvents() }, t.prototype.bindLiveEvents = function () { var e = this.options, t = this.element, n = e.tooltip, r = { x: 0, y: 0 }, i = "", s = $.isFunction, o = e.disabled, u = e.animation; $.support.isTouchEnabled && $.support.isTouchEnabled() && (i = "wij"), n && n.setTargets(this.tooltipTars), t.on(i + "mousedown." + e.widgetName, "." + e.wijCSS.pieElement, function (n) { if (o) return; var r = e.mouseDown, i = $(n.target), u; i.data("owner") && (i = i.data("owner")), u = i.data("wijchartDataObj"); if (!u) return; s(r) && r.call(t, n, u) }).on(i + "mouseup." + e.widgetName, "." + e.wijCSS.pieElement, function (n) { if (o) return; var r = e.mouseUp, i = $(n.target), u; i.data("owner") && (i = i.data("owner")), u = i.data("wijchartDataObj"); if (!u) return; s(r) && r.call(t, n, u) }).on(i + "mouseover." + e.widgetName, "." + e.wijCSS.pieElement, function (n) { if (o) return; var i = e.mouseOver, a = $(n.target), f = u && u.enabled, l, c, h, p, d, v, m; a.data("owner") && (a = a.data("owner")), l = a.data("wijchartDataObj"); if (!l) return; c = l.pieID || "", h = l.index, p = t.data("fields").chartElements["sectors" + c][h], d = p.showAnimationTimer, v = p.hideAnimationTimer, m = p.explodeAnimationShowing, s(i) && i.call(t, n, l); if ($.support.isTouchEnabled && $.support.isTouchEnabled()) return; if (p.removed) return; p.wijAttr(l.hoverStyle); if (f) { v && (window.clearTimeout(v), v = null, p.hideAnimationTimer = v), d && (window.clearTimeout(d), d = null, p.showAnimationTimer = null); if (m) return; d = window.setTimeout(function () { var e = u.duration, t = u.easing; if (p.removed) return; r = p.getOffset(u.offset || 10), p.offset = r, p.shadow && !p.shadow.removed && p.shadow.hide(), p.wijAnimate({ transform: Raphael.format("t{0},{1}", r.x, r.y) }, e, t), p.tracker && !p.tracker.removed && p.tracker.wijAnimate({ transform: Raphael.format("t{0},{1}", r.x, r.y) }, e, t), m = !0, p.explodeAnimationShowing = m }, 150), p.showAnimationTimer = d } }).on(i + "mouseout." + e.widgetName, "." + e.wijCSS.pieElement, function (n) { if (o) return; var i = e.mouseOut, a = $(n.target), f = u && u.enabled, l, c, h, p, d, v, m; a.data("owner") && (a = a.data("owner")), l = a.data("wijchartDataObj"); if (!l) return; c = l.pieID || "", h = l.index, p = t.data("fields").chartElements["sectors" + c][h], d = p.showAnimationTimer, v = p.hideAnimationTimer, m = p.explodeAnimationShowing, s(i) && i.call(t, n, l); if ($.support.isTouchEnabled && $.support.isTouchEnabled()) return; if (p.removed) return; l.style.segment && delete l.style.segment, p.wijAttr(l.style); if (f) { v && (window.clearTimeout(v), v = null, p.hideAnimationTimer = v), d && (window.clearTimeout(d), d = null, p.showAnimationTimer = d); if (!m) return; v = window.setTimeout(function () { var e = u.duration, t = u.easing; r = p.offset, p.shadow && !p.shadow.removed && p.shadow.show(), p.removed || p.wijAnimate({ transform: "t0,0" }, e, t), p.tracker && !p.tracker.removed && p.tracker.wijAnimate({ transform: "t0,0" }, e, t), p.shadow && !p.shadow.removed && p.shadow.wijAnimate({ transform: "t0,0" }, e, t), r = { x: 0, y: 0 }, m = !1, p.explodeAnimationShowing = m }, 150), p.hideAnimationTimer = v } }).on(i + "mousemove." + e.widgetName, "." + e.wijCSS.pieElement, function (n) { if (o) return; var r = e.mouseMove, i = $(n.target), u; i.data("owner") && (i = i.data("owner")), u = i.data("wijchartDataObj"); if (!u) return; s(r) && r.call(t, n, u) }).on(i + "click." + e.widgetName, "." + e.wijCSS.pieElement, function (n) { if (o) return; var r = e.click, i = $(n.target), u; i.data("owner") && (i = i.data("owner")), u = i.data("wijchartDataObj"); if (!u) return; s(r) && r.call(t, n, u) }) }, t.prototype.unbindLiveEvents = function () { var e = this.element, t = this.options; e.off("." + t.widgetName, "." + t.wijCSS.pieElement) }, t }(); e.PieChartRender = r })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; var t = jQuery, n = "wijtree", r = function (e) { function n() { e.apply(this, arguments) } return __extends(n, e), n.prototype._create = function () { window.wijmoApplyWijTouchUtilEvents && (t = window.wijmoApplyWijTouchUtilEvents(t)), this._initState(), this._createTree(), this._attachEvent(), this._attachNodeEvent() }, n.prototype._setOption = function (e, n) { var r = this, i = !1, s = r.options, o; switch (e) { case "allowDrag": r._setAllowDrag(n); break; case "allowDrop": r._setAllowDrop(n); break; case "showCheckBoxes": r._setCheckBoxes(n); break; case "showExpandCollapse": r.options.showExpandCollapse !== n && (i = !0); break; case "disabled": n ? r.widgetDom.addClass(s.wijCSS.stateDisabled) : r.widgetDom.removeClass(s.wijCSS.stateDisabled), o = r.element.find(":wijmo-wijtreecheck"), o.length && o.wijtreecheck("option", "disabled", n); break; default: } t.Widget.prototype._setOption.apply(r, arguments), e === "nodes" && r._createChildNodes(), i === !0 && r._setHitArea(n) }, n.prototype._initState = function () { var e = this, t = e.options; e._selectedNodes = [], e._checkedNodes = [], t.nodes || (t.nodes = []), e._enabled = !0, e._insertPosition = "unKnown", e.nodeWidgetName = "wijtreenode" }, n.prototype._createTree = function () { var e = this, n = e.options, r = [], i = ["wijmo-wijtree", n.wijCSS.widget, n.wijCSS.content, n.wijCSS.helperClearFix, n.wijCSS.cornerAll].join(" "); e.element.is("ul") ? (e.$nodes = e.element, e.element.wrap("<div></div>"), e.widgetDom = e.element.parent()) : e.element.is("div") && (e.widgetDom = e.element, e.$nodes = e.widgetDom.children("ul:eq(0)")), e.$nodes.length && (e.widgetDom.addClass(i).attr({ role: "tree", "aria-multiselectable": !0 }), e.$nodes.addClass("wijmo-wijtree-list " + n.wijCSS.helperReset), n.showExpandCollapse === !1 && e.$nodes.addClass("wijmo-wijtree-allexpanded"), e._createChildNodes(), e.widgetDom.append(t("<div>").css("clear", "both"))), n.disabled && e.disable() }, n.prototype._createChildNodes = function () { var e = this, n = { nIndex: undefined }, r = [], i = e.$nodes, s = e.options.nodes, o = i.children("li"); s.length ? (i.empty(), t.each(s, function (t, s) { var o = e._generateMarkup(s); i.append(o), n.nIndex = t, e._createNodeWidget(o, n), r.push(e._getNodeWidget(o)) })) : o.each(function (i, o) { var u = t(o), a; e._createNodeWidget(u, n), a = e._getNodeWidget(u), r.push(a), s.push(a.options) }), e._hasChildren = r.length > 0, e._setField("nodes", r), e.nodes = r }, n.prototype._generateMarkup = function (e) { var n, r, i = e.navigateUrl || ""; if (!t.isPlainObject(e)) return; return n = t("<li></li>"), r = t("<a>").attr("src", typeof i == "string" && i ? i : "#"), r.appendTo(n), typeof e.text == "string" && e.text && t("<span>").html(e.text).appendTo(r), n }, n.prototype._createNodeWidget = function (e, n) { var r = this, i = r.nodeWidgetName; return t.fn[i] && (e.data("owner", this), !!n && t.isPlainObject(n) ? (t.extend(n, { treeClass: this.widgetFullName }), e[i](n)) : e[i]({ treeClass: this.widgetFullName })), e }, n.prototype._attachEvent = function () { var e = this; e.element.bind(t.browser.msie ? "focusin." : "focus." + e.widgetName, t.proxy(e._onFocus, e)).bind("mouseover." + this.widgetName, t.proxy(e._onMouseOver, e)), e.options.allowDrop && e._attachDroppable() }, n.prototype._attachDroppable = function () { var e = this, n = e.options, r = { accept: "li", scope: "tree", drop: undefined }, i = function (t) { n.showCheckBoxes && n.allowTriState && !t.element.is(":" + e.widgetFullName) && t._getField("nodes").length > 0 && t._getField("nodes")[0]._setParentCheckState() }, s = n.droppable; t.extend(r, s), r.drop = function (r, o) { var u = o.draggable, a = e._getNodeWidget(u), f, l, c, h, p, d, v, m = -1; if (e._trigger("nodeBeforeDropped", r, o) === !1 || !a || n.disabled) { e._isDragging = !1; return } f = a._dropTarget, l = a._insertPosition; if (f && l !== "unKnown") { c = u.data("owner"), c && (v = u.index()); if (l === "end") m = f._getField("nodes").length, h = f; else if (l === "before" || l === "after") h = f._getField("owner"), p = h._getField("nodes"), d = t.inArray(f, p), d !== -1 && (m = l === "before" ? d : d + 1); s && t.isFunction(s.drop) ? (o.oldParent = c.element, o.newParent = h.element, o.oldIndex = v, o.newIndex = m, s.drop.call(e.element, r, o)) : (c && c.remove(u), m !== -1 && ((l === "before" || l === "after") && d != t.inArray(f, p) && m--, e.$nodes.children("li").length ? h.add(u, m) : e.add(u, m))), t("a:eq(0)", u).blur(), a._tree._isDragging = !1, a.options.selected && a._setSelected(!1), i(c), i(h), t.extend(o, { sourceParent: c ? c.element : null, sIndex: v, targetParent: h.element, tIndex: m, widget: a }), e._trigger("nodeDropped", r, o) } }, t.fn.droppable && e.widgetDom.droppable(r) }, n.prototype._attachNodeEvent = function () { this.element.bind("click." + this.widgetName, t.proxy(this._onClick, this)).bind("mouseout." + this.widgetName, t.proxy(this._onMouseOut, this)).bind("keydown." + this.widgetName, t.proxy(this._onKeyDown, this)) }, n.prototype._onClick = function (e) { this._callEvent(e, "_onClick"), t.browser.webkit && this.widgetDom.focus() }, n.prototype._onFocus = function (e) { this._callEvent(e, "_onFocus") }, n.prototype._onKeyDown = function (e) { this._callEvent(e, "_onKeyDown") }, n.prototype._onMouseOut = function (e) { this._callEvent(e, "_onMouseOut") }, n.prototype._onMouseOver = function (e) { this._callEvent(e, "_onMouseOver") }, n.prototype._callEvent = function (e, t) { var n = e.target, r; if (n) { r = this._getNodeWidgetByDom(n); if (r === null) return; r[t](e) } }, n.prototype._nodeSelector = function () { return ":wijmo-wijtreenode" }, n.prototype.getSelectedNodes = function () { return this._selectedNodes }, n.prototype.getCheckedNodes = function () { var e = this, n = [], r = e.nodeWidgetName; return t(e._nodeSelector(), e.element).each(function (e, i) { t(i)[r]("option", "checked") && t(i)[r]("option", "checkState") !== "indeterminate" && n.push(t(i)) }), n }, n.prototype.destroy = function () { var e = this, n = e.$nodes, r = e.options, i = ["wijmo-wijtree", r.wijCSS.widget, r.wijCSS.content, r.wijCSS.helperClearFix, r.wijCSS.cornerAll].join(" "); e.widgetDom.removeClass(i).removeAttr("role").removeAttr("aria-multiselectable"), e.widgetDom.data("uiDroppable") && e.widgetDom.droppable("destroy"), e.widgetDom.children("div[style]:last").remove(), n.removeData("nodes").removeClass("wijmo-wijtree-list " + r.wijCSS.helperReset), n.children("li").each(function (n, r) { var i = e._getNodeWidget(t(r)); i && i.destroy() }), t.Widget.prototype.destroy.apply(this) }, n.prototype.add = function (e, n) { var r = null, i = {}, s, o, u = this, a, f, l = "<li><a href='{0}'>{1}</a></li>", c; typeof e == "string" ? (s = t(l.replace(/\{0\}/, "#").replace(/\{1\}/, e)), u._createNodeWidget(s, i), r = s.data(s.data("widgetName"))) : e.jquery ? (e.data("widgetName") || u._createNodeWidget(e, i), r = e.data(e.data("widgetName"))) : e.nodeType ? (s = t(e), u._createNodeWidget(s, i), r = s.data(s.data("widgetName"))) : t.isPlainObject(e) && (s = t(l.replace(/\{0\}/, e.url ? e.url : "#").replace(/\{1\}/, e.text)), u._createNodeWidget(s, e), r = s.data(s.data("widgetName"))); if (r === null) return; o = u._getField("nodes"), (!n || n > o.length) && n !== 0 && (n = o.length), c = r._getField("nodes"), r._tree = u; for (a = 0; a < c.length; a++) c[a]._tree = u; r._setField("owner", this), f = o.length, f > 0 && f !== n ? r.element.get(0) !== o[n].element.get(0) && r.element.insertBefore(o[n].element) : u.$nodes.append(r.element), u._changeCollection(n, r), r._initNodeClass() }, n.prototype.remove = function (e) { var t = -1, n, r; e && e.jquery ? t = e.index() : typeof e == "number" && (t = e), r = this._getField("nodes"); if (t < 0 || t >= r.length) return; n = r[t], n.element.detach(), this._changeCollection(t) }, n.prototype._changeCollection = function (e, t) { var n = this._getField("nodes"), r = this.options.nodes; t ? (n.splice(e, 0, t), r.splice(e, 0, t.options)) : (n.splice(e, 1), r.splice(e, 1)) }, n.prototype.getNodes = function () { return this.nodes }, n.prototype.findNodeByText = function (e) { var n = t(".wijmo-wijtree-node a>span", this.$nodes).filter(function () { return t(this).text() === e }); return n.length ? this._getNodeWidgetByDom(n.get(0)) : null }, n.prototype._setAllowDrag = function (e) { var n = this, r, i = n._nodeSelector(), s = n.nodeWidgetName; if (!t.fn.draggable) return; e ? (r = n.element.find(i), r.each(function () { var e = t(this).data(s); (!t(this).data("uiDraggable") && !e.$navigateUrl.data("events") || !e.$navigateUrl.data("events").mousedown) && e.$navigateUrl.one("mousedown", e, e._onMouseDown) })) : (r = n.element.find(i + ":ui-draggable"), r.draggable("destroy")) }, n.prototype._setAllowDrop = function (e) { if (!t.fn.droppable) return; e ? this.widgetDom.data("uiDroppable") || this._attachDroppable() : this.widgetDom.droppable && this.widgetDom.droppable("destroy") }, n.prototype._setCheckBoxes = function (e) { var n = this; n.$nodes.children("li").each(function (r, i) { var s = n._getNodeWidget(t(i)); s !== null && s._setCheckBoxes(e) }) }, n.prototype._setHitArea = function (e) { var n = this; n.$nodes[e ? "addClass" : "removeClass"]("wijmo-wijtree-allexpanded"), n.$nodes.children("li").each(function (r, i) { var s = n._getNodeWidget(t(i)); s !== null && s._setHitArea(e) }) }, n.prototype._getNodeWidget = function (e) { if (e.is(this._nodeSelector())) { var t = e.data(e.data("widgetName")); return t } return null }, n.prototype._getNodeWidgetByDom = function (e) { var t = this._getNodeByDom(e); return this._getNodeWidget(t) }, n.prototype._getNodeByDom = function (e) { return t(e).closest(this._nodeSelector()) }, n.prototype._refreshNodesClass = function () { var e = this._getField("nodes"), t; for (t = 0; t < e.length; t++) e[t]._initNodeClass() }, n.prototype._getField = function (e) { return this.element.data(e) }, n.prototype._setField = function (e, t) { return this.element.data(e, t) }, n }(e.wijmoWidget); e.wijtree = r; var i = function (e) { function n() { e.apply(this, arguments) } return __extends(n, e), n.prototype._setOption = function (e, n) { var r = this, i, s; switch (e) { case "accessKey": r.$navigateUrl !== null && r.$navigateUrl.attr("accesskey", n); break; case "checked": r._checkState = n ? "checked" : "unChecked", r._setChecked(n); break; case "collapsedIconClass": case "expandedIconClass": case "itemIconClass": r.options[e] = n, r._initNodeImg(); break; case "expanded": r._setExpanded(n); break; case "selected": r._setSelected(n); break; case "text": r._setText(n); break; case "toolTip": r._setToolTip(n); break; case "navigateUrl": r._setNavigateUrlHref(n); break; case "disabled": if (r._isClosestDisabled() && n === !0) return; i = r.element.find(":wijmo-wijtreecheck"), i.length && i.wijtreecheck("option", "disabled", n); break; default: } e === "nodes" ? (r.options.nodes.length = 0, t.each(n, function (e, t) { r.options.nodes.push(t) }), r.options.nodes.concat(), r._hasChildren = r._getChildren(), r._createChildNodes(r.element), r._initNodeClass()) : t.Widget.prototype._setOption.apply(r, arguments) }, n.prototype._initState = function () { this._tree = null, this._dropTarget = null, this._checkState = "unChecked", this._value = this._text = this._navigateUrl = "", this._insertPosition = "unKnown", this._hasNodes = !1 }, n.prototype._create = function () { var e = this, t = e.options; e._initState(), e._createTreeNode(), e._initNode(), e.element.data("widgetName", "wijmoWijtreenode"), t.selected && e._tree._selectedNodes.push(e), t.checked && (e._checkState = "checked", e.$checkBox && (t.checkState === "indeterminate" ? e.$checkBox.wijtreecheck("option", "checkState", "triState") : e.$checkBox.wijtreecheck("option", "checkState", "check"))) }, n.prototype._createTreeNode = function () { var e = this.element, n, r, i = this, s, o = i.options, u = []; this.$navigateUrl = e.children("a"), i._tree === null && (i._tree = i._getTree()), isNaN(o.nIndex) ? o.nodes || (o.nodes = []) : (s = i._getOwner().options, r = s.nodes[o.nIndex], r && !r.nodes && (r.nodes = []), t.extend(o, r), s.nodes[o.nIndex] = o), i.$nodeBody = null, i.$checkBox = null, i.$hitArea = null, i.$nodes = null, i.$nodeImage = t("<span>"), i.$nodeBody = t("<div>").attr({ role: "treeitem", "aria-expanded": !1, "aria-checked": !1, "aria-selected": !1 }), i._tree.options.showCheckBoxes === !0 && (i.$checkBox = t("<div>")), i.$navigateUrl.length === 0 && (i.$navigateUrl = e.children("div"), i.$navigateUrl.addClass("wijmo-wijtree-template"), i._isTemplate = !0), i.$navigateUrl.length === 0 && (i.$navigateUrl = t("<a>"), i.$navigateUrl.attr("href", "#")), i._isTemplate || (i.$text = i.$navigateUrl.find("span:eq(0)"), i.$text.length === 0 && (i.$navigateUrl.wrapInner("<span></span>"), i.$text = i.$navigateUrl.find("span:eq(0)"))), i._hasChildren = i._getChildren(), i.$inner = t("<span></span>").addClass(o.wijCSS.helperClearFix + " wijmo-wijtree-inner " + o.wijCSS.cornerAll), i._createChildNodes(e), i.$inner.append(i.$nodeImage), i.$checkBox !== null && (i.$inner.append(i.$checkBox), i.$checkBox.wijtreecheck()), i.$inner.append(i.$navigateUrl), i.$nodeBody.append(i.$inner), e.prepend(i.$nodeBody) }, n.prototype._createChildNodes = function (e) { var n = this, r = [], i = n.options; n._hasChildren ? (e.addClass("wijmo-wijtree-parent"), n.$nodeBody.addClass("wijmo-wijtree-node wijmo-wijtree-header " + i.wijCSS.stateDefault), n.$hitArea = t("<span>"), n.$inner.prepend(n.$hitArea), n.$nodes = e.find("ul:eq(0)"), r = n._createChildNode(), n.$nodes.addClass("wijmo-wijtree-list " + i.wijCSS.helperReset + " wijmo-wijtree-child")) : (e.addClass("wijmo-wijtree-item"), n.$nodeBody.addClass("wijmo-wijtree-node " + i.wijCSS.stateDefault)), n._setField("nodes", r) }, n.prototype._createChildNode = function () { var e = this, n = e.options, r = [], i = { nIndex: undefined, treeClass: undefined, cfli: undefined, nodes: undefined }; return n.nodes && n.nodes.length ? (e.$nodes && e.$nodes.length ? e.$nodes.empty() : e.$nodes = t("<ul>").appendTo(e.element), t.each(n.nodes, function (t, s) { var o = e._generateMarkup(s), u; e.$nodes.append(o), o.data("owner", e), i.nIndex = t, i.treeClass = n.treeClass, o.wijtreenode(i), u = e._getNodeWidget(o), u._index = t, r.push(u) })) : (n.nodes || (n.nodes = []), e.$nodes.children("li").each(function (s, o) { var u = t(o), a; u.data("owner", e), i.cfli = !0, i.nIndex = s, i.treeClass = n.treeClass, i.nodes = [], u.wijtreenode(i), a = e._getNodeWidget(u), a._index = s, r.push(a) })), r }, n.prototype._generateMarkup = function (e) { var n, r, i = e.navigateUrl || ""; if (!t.isPlainObject(e)) return; return n = t("<li></li>"), r = t("<a>").attr("src", typeof i == "string" && i ? i : "#"), r.appendTo(n), typeof e.text == "string" && e.text && t("<span>").html(e.text).appendTo(r), n }, n.prototype._initNode = function () { var e = this, t = e.options; e._initialized || (e._initialized = !0, e._initNavigateUrl(), !e._isTemplate && e.$text && (e._text = e.$text.html(), t.text = e.$text.html()), e._hasChildren = e._getChildren(), e._initNodesUL(), e._initNodeClass(), e._initNodeImg(), e._initCheckBox(), e.$navigateUrl.one("mousedown", e, e._onMouseDown)) }, n.prototype._initNodeClass = function () { var e = this, n = e.options, r, i = "wijmo-wijtree-node " + n.wijCSS.stateDefault + " " + n.wijCSS.cornerAll, s = n.wijCSS.icon + " " + (n.expanded ? n.wijCSS.iconArrowRightDown : n.wijCSS.iconArrowRight); e._tree.options.showExpandCollapse && (e._hasChildren || !!n.hasChildren ? (e.$hitArea !== null ? e.$hitArea.removeClass([n.wijCSS.icon, n.wijCSS.iconArrowRightDown, n.wijCSS.iconArrowRight].join(" ")).addClass(s) : (e.$hitArea = t("<span>").addClass(s).prependTo(e.$inner), e.element.removeClass(i).addClass("wijmo-wijtree-parent")), e._hasChildren && (r = n.expanded ? "" : "none", e.$nodes.css({ display: r }))) : e.$hitArea && (e.$hitArea.remove(), e.$hitArea = null, e.element.removeClass("wijmo-wijtree-parent").addClass(i))), n.selected && e.$inner && e.$inner.addClass(n.wijCSS.stateActive) }, n.prototype._initCheckBox = function () { var e = this, t = e.options; if (e.$checkBox && t.checkState) switch (t.checkState) { case "checked": e.$checkBox.wijtreecheck("option", "checkState", "check"); break; case "indeterminate": e.$checkBox.wijtreecheck("option", "checkState", "triState"); break; case "unChecked": e.$checkBox.wijtreecheck("option", "checkState", "unCheck"); break; default: e.$checkBox.wijtreecheck("option", "checkState", "unCheck") } }, n.prototype._initNodesUL = function () { var e = this; e._tree.options.showExpandCollapse && e._hasChildren && e.$nodes[e._expanded ? "show" : "hide"]() }, n.prototype._initNavigateUrl = function () { var e = this, t = e.$navigateUrl.attr("href"); e.$navigateUrl.bind("blur." + e.widgetName, e, e._onBlur), this._isTemplate || (e._navigateUrl = t ? t : "", e._setNavigateUrlHref(t)) }, n.prototype._applyIconClass = function (e, t) { e.attr("expandediconclass") && (t.expandedIconClass = e.attr("expandediconclass"), e.removeAttr("expandediconclass")), e.attr("collapsediconclass") && (t.collapsedIconClass = e.attr("collapsediconclass"), e.removeAttr("collapsediconclass")), e.attr("itemiconclass") && (t.itemIconClass = e.attr("itemiconclass"), e.removeAttr("itemiconclass")) }, n.prototype._initNodeImg = function () { var e = this, n = e.options, r = e.element; if (e.$nodeImage === null || !e.$nodeImage.length) e.$nodeImage = t("<span>"); e._applyIconClass(r, n), n.collapsedIconClass !== "" && n.expandedIconClass !== "" ? (e.$nodeImage.removeClass().addClass(n.wijCSS.icon).addClass(n.expanded ? n.expandedIconClass : n.collapsedIconClass), e._tree.options.showExpandCollapse || e.$nodeImage.addClass(n.expandedIconClass), e.$nodeImage.insertBefore(e.$checkBox)) : n.itemIconClass !== "" && (e.$nodeImage.removeClass().addClass(n.wijCSS.icon), e.$nodeImage.addClass(n.itemIconClass), e.$nodeImage.insertBefore(e.$checkBox)) }, n.prototype._setNavigateUrlHref = function (e) { if (this.$navigateUrl) { if (e === "" || typeof e == "undefined") e = "#"; this.$navigateUrl.attr("href", e) } }, n.prototype._editNode = function () { this._tree._editMode = !0, this.$navigateUrl.hide(), this.$editArea || (this.$editArea = t('<input type="text">').wijtextbox()), this.$editArea.val(this.$text.html()), this.$editArea.insertBefore(this.$navigateUrl), this.$editArea.bind("blur", this, this._editionComplete), this.$editArea.focus() }, n.prototype._editionComplete = function (e) { var t = e.data, n; t._tree._editMode = !1, t.$editArea && (n = t.$editArea.val(), t.$editArea.remove()), t.$navigateUrl.show(), t.$editArea = null, t._changeText(n) }, n.prototype._changeText = function (e) { var t = this, n = t.options; t.$text !== null && e !== "" && (t.$text.text(e), n.text = e, t._tree._trigger("nodeTextChanged", null, t)) }, n.prototype._expandCollapseItem = function () { var e = this, t = e.options; !e._tree.options.disabled && !e._isClosestDisabled() && (e._hasChildren || t.hasChildren) && e._setExpanded(!t.expanded) }, n.prototype._expandNode = function (e) { var t = this, n = t._tree.options, r = e ? "nodeExpanding" : "nodeCollapsing"; if (t._tree._trigger(r, null, { node: this, params: this.options.params }) === !1) return; t.$nodeBody.attr("aria-expanded", e), t._expanded = e, t.options.expanded = e, !n.disabled && !t._isClosestDisabled() && (e ? n.expandDelay > 0 ? (typeof t._expandTimer != "undefined" && (t._expandTimer = window.clearTimeout(t._expandTimer)), t._expandTimer = window.setTimeout(function () { t._expandNodeVisually() }, n.expandDelay)) : t._expandNodeVisually() : n.collapseDelay > 0 ? (t._collapseTimer = window.clearTimeout(t._collapseTimer), t._collapseTimer = window.setTimeout(function () { t._collapseNodeVisually() }, n.collapseDelay)) : t._collapseNodeVisually()) }, n.prototype._expandNodeVisually = function () { var e = this, n, r = e.options; e._tree.options.autoCollapse && (n = e.element.siblings(":" + this.widgetFullName), t.each(n, function (t) { var r = e._getNodeWidget(n[t]); r.options.expanded && r._setExpanded(!1) })), r.collapsedIconClass !== "" && r.expandedIconClass !== "" && e.$nodeImage.removeClass(r.collapsedIconClass).addClass(r.expandedIconClass), e._internalSetNodeClass(!0), e._show() }, n.prototype._collapseNodeVisually = function () { var e = this; e.options.collapsedIconClass !== "" && e.options.expandedIconClass !== "" && e.$nodeImage.removeClass(e.options.expandedIconClass).addClass(e.options.collapsedIconClass), e._internalSetNodeClass(!1), e._hide() }, n.prototype._internalSetNodeClass = function (e) { var t = this.options.wijCSS, n = [t.icon, t.iconArrowRightDown, t.iconArrowRight].join(" "); this.$hitArea.removeClass(n).addClass(t.icon + " " + (e ? t.iconArrowRightDown : t.iconArrowRight)) }, n.prototype._show = function () { this._animation(!0) }, n.prototype._hide = function () { this._animation(!1) }, n.prototype._animation = function (e) { var n = this, r = n.$nodes, i = e ? "expandAnimation" : "collapseAnimation", s = e ? "nodeExpanded" : "nodeCollapsed", o, u = n._tree.options[i]; r && (u ? (o = u.animated || u.effect, t.effects && !!o ? r[e ? "show" : "hide"](o, { easing: u.easing }, u.duration, function () { n._tree._trigger(s, null, n) }) : r[e ? "show" : "hide"](u.duration, function () { n._tree._trigger(s, null, n) })) : (r[e ? "show" : "hide"](), n._tree._trigger(s, null, n))) }, n.prototype._getBounds = function (e) { var t = e.height(), n = e.width(), r = e.offset().top, i = e.offset().left; return { h: t, w: n, t: r, l: i } }, n.prototype._isMouseInsideRect = function (e, t) { return e.x < t.l || e.x >= t.l + t.w ? !1 : e.y <= t.t + 1 || e.y >= t.t + t.h ? !1 : !0 }, n.prototype._getNodeByMouseOn = function (e) { return t("li").each(function () { var n = this._getBounds(t(this)); if (t.ui.isOver(e.y, e.x, n.t, n.l, n.h, n.w)) return t(this) }), null }, n.prototype._drowTemplate = function (e, t, n) { var r = "unKnown", i = n.is(".wijmo-wijtree-node") ? n : n.children(".wijmo-wijtree-node"), s = this._getBounds(i); return t.width(i.width()), e.y > s.t && e.y < s.t + s.h / 2 ? (t.offset({ left: s.l, top: s.t }), r = "before") : e.y > s.t + s.h / 2 && e.y < s.t + s.h && (t.offset({ left: s.l, top: s.t + s.h }), r = "after"), r }, n.prototype._beginDrag = function (e) { var n = this, r = n.element, i, s = n._tree.options, o = s.draggable, u = { cursor: "point", cursorAt: { top: 15, left: -25 }, helper: function () { return t("<div>" + n.$navigateUrl.html() + "</div>").addClass(s.wijCSS.header + " " + s.wijCSS.cornerAll) }, distance: t.browser.msie ? 1 : 10, handle: n.$navigateUrl, scope: "tree", stop: undefined, start: undefined, drag: undefined }, a = t("<div>").addClass("wijmo-wijtree-insertion " + s.wijCSS.stateDefault); typeof s.dropVisual == "string" ? (i = t(s.dropVisual), a = i.length ? i : a) : t.isFunction(s.dropVisual) && (i = t(s.dropVisual.call()), a = i.length ? i : a), a.hide(), t.extend(u, o), u.start = function (e, i) { n._tree._isDragging = !0, n._tree.widgetDom.prepend(a), n._tree._trigger("nodeDragStarted", e, n), o && t.isFunction(o.start) ? o.start.call(n.element, e, i) : r.hide() }, u.drag = function (e, r) { var i = e.srcElement || e.originalEvent.target, s = t(i), u, f = { x: e.pageX, y: e.pageY }; a && a.hide(), s && (u = n._getNodeWidget(s), u && !u._tree.options.disabled ? (s.closest(".wijmo-wijtree-inner", n.element).length ? n._insertPosition = "end" : (a.show(), n._insertPosition = n._drowTemplate(f, a, u.element)), u != n && (n._dropTarget = u)) : s.is(":" + n.options.treeClass) && (n._dropTarget = s.data(n.options.treeClass), n._insertPosition = "end")), n._tree._trigger("nodeDragging", e, n), o && t.isFunction(o.drag) && o.drag.call(n.element, e, r) }, u.stop = function (e, i) { a.remove(), n._dropTarget = null, n._insertPosition = "unKnown", n._tree._isDragging = !1, o && t.isFunction(o.stop) ? o.stop.call(n.element, e, i) : (r.show(), n._resetDrag()) }, t.fn.draggable && (r.draggable(u).trigger(e), t.browser.mozilla && n._setFocused(!0)) }, n.prototype._resetDrag = function () { var e = this, t, n; !e._tree.options.allowDrag && e.element.data("uiDraggable") && e.element.draggable("destroy"), t = e._getField("nodes"); for (n = 0; n < t.length; n++) t[n]._resetDrag() }, n.prototype._checkClick = function () { var e = this, t = e.options; !e._tree.options.disabled && !e._isClosestDisabled() && (t.checked && e._checkState === "indeterminate" ? (e._checkState = "checked", e._checkItem()) : (e._checkState = t.checked ? "unChecked" : "checked", e._setChecked(!t.checked)), e._tree._trigger("nodeCheckChanged", null, e)) }, n.prototype._checkItem = function () { var e = this, t = !1, n = e._tree; if (n === null || !n.options.showCheckBoxes) return; n.options.autoCheckNodes && e._checkState !== "indeterminate" && (t = !0, e._changeCheckState(e.options.checked)), n.options.allowTriState && e._setParentCheckState(), e[e.options.checked ? "_checkNode" : "_unCheckNode"](t) }, n.prototype._checkNode = function (e) { var t = this, n = t.options, r = this._getField("nodes"), i; t._checkState === "checked" ? (t.$checkBox.wijtreecheck("option", "checkState", "check"), n.checkState = "checked") : t._checkState === "indeterminate" && (t.$checkBox.wijtreecheck("option", "checkState", "triState"), n.checkState = "indeterminate"); if (e) for (i = 0; i < r.length; i++) r[i]._checkNode(!0) }, n.prototype._unCheckNode = function (e) { var t = this._getField("nodes"), n = this.options, r; this.$checkBox.wijtreecheck("option", "checkState", "unCheck"), n.checkState = "unChecked"; if (e) for (r = 0; r < t.length; r++) t[r]._unCheckNode(!0) }, n.prototype._changeCheckState = function (e) { var n = this._getField("nodes"); t.each(n, function (t, n) { n.options.checked = e, n.$nodeBody.attr("aria-checked", e), n._checkState = e ? "checked" : "unChecked", n._changeCheckState(e) }) }, n.prototype._setParentCheckState = function () { var e = this._getOwner(), t, n = !0, r = !1, i = !1, s, o = this; if (e.element.is(":" + o.options.treeClass)) return; t = e._getField("nodes"); for (s = 0; s < t.length; s++) { t[s]._checkState === "indeterminate" && (i = !0), t[s].options.checked ? r = !0 : n = !1; if (!n && r) break } i ? (e._checkState = "indeterminate", e._setChecked(!0)) : r ? (n ? (e._checkState = "checked", e._checkNode(!1)) : e._checkState = "indeterminate", e._setChecked(!0)) : (e._checkState = "unChecked", e._setChecked(!1), e._unCheckNode(!1)), e._setParentCheckState() }, n.prototype._onKeyDown = function (e) { var n = t(e.target), r = this; n.closest(".wijmo-wijtree-inner", r.element).length > 0 && r._keyAction(e) }, n.prototype._onClick = function (e) { var n = t(e.target), r = this; n.closest(".wijmo-checkbox", r.element).length > 0 ? (r._checkClick(), e.preventDefault(), e.stopPropagation()) : r.$hitArea && r.$hitArea[0] === n[0] ? (r._expandCollapseItem(), e.preventDefault(), e.stopPropagation()) : n.closest(".wijmo-wijtree-inner", r.element).length > 0 && r._click(e) }, n.prototype._onMouseDown = function (e) { var n = t(e.target), r = e.data; !r._tree.options.disabled && r._tree.options.allowDrag && n.closest(".wijmo-wijtree-node", r.element).length > 0 && r._beginDrag(e) }, n.prototype._onMouseOver = function (e) { var n = t(e.target), r = this, i = t(e.relatedTarget); n.closest(".wijmo-wijtree-inner", r.element).length > 0 && (this._tree._overNode !== r || i.is(":" + this.widgetFullName)) && (r._mouseOver(e), this._tree._overNode = r), r._mouseOverHitArea(e) }, n.prototype._onMouseOut = function (e) { var n = t(e.target), r = this, i = t(e.relatedTarget), s = this._getNodeWidget(i); n.closest(".wijmo-wijtree-inner", r.element).length > 0 && (this._tree._overNode !== s || i.is(":" + this.widgetFullName) || i.is(".wijmo-wijtree-list") || i.is(".ui-effects-wrapper")) && (r._mouseOut(e), s || (this._tree._overNode = null)), r._mouseOutHitArea(e) }, n.prototype._onFocus = function (e) { var n = t(e.target), r = this, i = r.options.wijCSS; n.closest(".wijmo-wijtree-inner", r.element).length > 0 && !r._tree.options.disabled && !r._isClosestDisabled() && !n.hasClass(i.iconArrowRightDown) && !n.hasClass(i.iconArrowRight) && !n.closest(".wijmo-checkbox", r.element).length && (r._tree._focusNode && r._tree._focusNode.$navigateUrl.blur(), r._focused = !0, r._tree._focusNode = this, r.$inner.addClass(i.stateFocus), r._tree._trigger("nodeFocus", e, r)) }, n.prototype._onBlur = function (e) { var n = t(e.target), r = e.data, i = r.options.wijCSS; !r._tree.options.disabled && !r._isClosestDisabled() && (r._focused = !1, n.closest(".wijmo-wijtree-inner", r.element).length > 0 && r.$inner.removeClass(i.stateFocus), r._tree._trigger("nodeBlur", e, r)) }, n.prototype._click = function (e) { var n = this, r = n.options, i = n._tree, s = n.$navigateUrl.attr("href"); if (!i.options.disabled && !n._isClosestDisabled()) { if (!/^[#,\s]*$/.test(s)) { if (!t.browser.msie || !/^7\.[\d]*/.test(t.browser.version)) return; if (s.indexOf(window.location.href) < 0) return } n._isClick = !0, i._ctrlKey = e.ctrlKey, r.selected && i._ctrlKey ? n._setSelected(!1) : r.selected && !n._tree._editMode && i.options.allowEdit && !n._isTemplate ? n._editNode() : n._setSelected(!r.selected), n._isTemplate || (e.preventDefault(), e.stopPropagation()) } else n._setNavigateUrlHref("") }, n.prototype._selectNode = function (e, n) { var r = this, i = r.options, s, o; !r._tree.options.disabled && !r._isClosestDisabled() && !r._tree._isDragging && (s = r._tree._ctrlKey, s ? (o = t.inArray(r, r._tree._selectedNodes), o !== -1 && !e && (r._tree._selectedNodes.splice(o, 1), r.$inner.removeClass(i.wijCSS.stateActive))) : (t.each(r._tree._selectedNodes, function (e, t) { t.$inner.removeClass(i.wijCSS.stateActive), t.options.selected = !1, t.$nodeBody.attr("aria-selected", !1) }), r._tree._selectedNodes = []), e ? (o = t.inArray(r, r._tree._selectedNodes), o === -1 && this._tree._selectedNodes.push(r), r.$inner.addClass(i.wijCSS.stateActive)) : r.$inner.removeClass(i.wijCSS.stateActive), r._isClick && r._tree._trigger("nodeClick", n, r), r._isClick = !1, r._tree._ctrlKey = !1, r._tree._trigger("selectedNodeChanged", n, r)) }, n.prototype.getKeyCodeEnum = function () { if (t.ui && t.ui.keyCode) return t.ui.keyCode; if (t.mobile && t.mobile.keyCode) return t.mobile.keyCode; throw "keyCode object is not found" }, n.prototype._keyAction = function (e) { var t = e.target, n = this, r = !1, i = n.getKeyCodeEnum(); if (n._tree.options.disabled || n._isClosestDisabled()) return; if (t) { if (n._tree._editMode && e.keyCode !== i.ENTER) return; switch (e.keyCode) { case i.UP: n._moveUp(); break; case i.DOWN: n._moveDown(); break; case i.RIGHT: n._tree.options.showExpandCollapse && n._moveRight(); break; case i.LEFT: n._tree.options.showExpandCollapse && n._moveLeft(); break; case 83: !n._tree._editMode && n._tree.options.allowSorting && n.sortNodes(); break; case 113: n._tree.options.allowEdit && n._editNode(); break; case 109: n._tree.options.showExpandCollapse && this._expanded && n._setExpanded(!1); break; case 107: n._tree.options.showExpandCollapse && !this._expanded && n._setExpanded(!0); break; case i.ENTER: n._tree._editMode && (e.data = n, n._editionComplete(e), n._setFocused(!0), r = !0, e.preventDefault()); break; case i.SPACE: n._tree.options.showCheckBoxes && (n._checkState = n.options.checked ? "unChecked" : "checked", n._setChecked(!n.options.checked)) } n._customKeyDown(e.keyCode, r), !n._isTemplate && e.keyCode !== i.ENTER && (e.preventDefault(), e.stopPropagation()) } }, n.prototype._customKeyDown = function (e, t) { }, n.prototype._prevNode = function (e) { var t = e.element; if (t.prev().length > 0) return t.prev().data(t.data("widgetName")) }, n.prototype._nextNode = function (e) { var t = e.element; if (t.next().length > 0) return t.next().data(t.data("widgetName")) }, n.prototype._getNextExpandedNode = function (e) { var t = e, n = e._getField("nodes"), r; return e._expanded && n.length > 0 && (r = n[n.length - 1], r !== null && (t = this._getNextExpandedNode(r))), t }, n.prototype._getNextNode = function (e) { var t = null, n = this; return e.element.is(":" + n.options.treeClass) ? null : (t = n._nextNode(e), t ? t : n._getNextNode(e._getOwner())) }, n.prototype._moveUp = function () { var e = this._getCurrentLevel(), t = this._prevNode(this); t ? this._getNextExpandedNode(t)._setFocused(!0) : e > 0 && this._getOwner()._setFocused(!0) }, n.prototype._moveDown = function () { var e = this._getField("nodes"), t, n, r; this._expanded && e.length > 0 ? e[0]._setFocused(!0) : (t = this._nextNode(this), t ? t._setFocused(!0) : (n = this._getOwner(), r = this._getNextNode(n), r && r._setFocused(!0))) }, n.prototype._moveLeft = function () { var e = this._getOwner(); this._expanded ? this._setExpanded(!1) : e !== null && !e.element.is(":" + this.options.treeClass) && e._setFocused(!0) }, n.prototype._moveRight = function () { if (this._hasChildren) if (!this._expanded) this._setExpanded(!0); else { var e = this._getField("nodes")[0]; e !== null && e._setFocused(!0) } }, n.prototype._mouseOver = function (e) { var t = this, n = t._tree; !n.options.disabled && !t._isClosestDisabled() && !n._editMode && (t._mouseOverNode(), n._isDragging || n._trigger("nodeMouseOver", e, t)) }, n.prototype._mouseOut = function (e) { var t = this, n = t._tree; !n.options.disabled && !t._isClosestDisabled() && !n._editMode && (t._mouseOutNode(), n._isDragging || n._trigger("nodeMouseOut", e, t)) }, n.prototype._mouseOverNode = function () { this.$inner !== null && !this._isOverNode && (this.$inner.addClass(this.options.wijCSS.stateHover), this._isOverNode = !0) }, n.prototype._mouseOutNode = function () { this.$inner !== null && this._isOverNode && (this.$inner.removeClass(this.options.wijCSS.stateHover), this._isOverNode = !1) }, n.prototype._mouseOverHitArea = function (e) { var t, n, r = this, i = r._tree; !i.options.disabled && !r._isClosestDisabled() && i.options.expandCollapseHoverUsed && r._hasChildren && !r._isOverHitArea && (t = r._getBounds(r.element), n = { x: e.pageX, y: e.pageY }, r._isMouseInsideRect(n, t) && (r._isOverHitArea = !0, r._setExpanded(!0))) }, n.prototype._mouseOutHitArea = function (e) { var t = { x: e.pageX, y: e.pageY }, n, r = this, i = r._tree; !i.options.disabled && !r._isClosestDisabled() && i.options.expandCollapseHoverUsed && (r._hasChildren && !!r._isOverHitArea ? (n = r._getBounds(r.element), r._isMouseInsideRect(t, n) || (r._isOverHitArea = !1, r._setExpanded(!1))) : r._getOwner().element.is(":" + r.widgetFullName) && (n = r._getBounds(r._getOwner().element), r._isMouseInsideRect(t, n) || (r._getOwner()._isOverHitArea = !1, r._getOwner()._setExpanded(!1)))) }, n.prototype.destroy = function () { var e = this, n, r = e.options; e.element.data("uiDraggable") && e.element.draggable("destroy"), e.$hitArea && e.$hitArea.remove(), e.$checkBox && e.$checkBox.remove(), e.$nodeImage && e.$nodeImage.remove(), e.$navigateUrl.unwrap().unwrap().removeClass(r.wijCSS.stateDefault + " " + r.wijCSS.stateActive).unbind("mousedown").unbind("blur"), n = this.element.find("ul:first").show(), n.removeClass(), n.children("li").each(function () { var n = e._getNodeWidget(t(this)); n.destroy() }), e.element.removeData("nodes").removeData("owner").removeData("widgetName").removeClass(), t.Widget.prototype.destroy.apply(this) }, n.prototype.add = function (e, n) { var r = null, i, s, o = this, u, a, f = "<li><a href='{0}'>{1}</a></li>", l; typeof e == "string" ? (i = t(f.replace(/\{0\}/, "#").replace(/\{1\}/, e)), o._createNodeWidget(i), r = i.data(i.data("widgetName"))) : e.jquery ? (e.data("widgetName") || o._createNodeWidget(e), r = e.data(e.data("widgetName"))) : e.nodeType ? (i = t(e), o._createNodeWidget(i), r = i.data(i.data("widgetName"))) : t.isPlainObject(e) && (i = t(f.replace(/\{0\}/, e.url ? e.url : "#").replace(/\{1\}/, e.text)), o._createNodeWidget(i, e), r = i.data(i.data("widgetName"))); if (r === null) return; s = o._getField("nodes"), (!n || n > s.length) && n !== 0 && (n = s.length), t.mobile && r.element.find("a").addClass("ui-link"), u = r._getField("nodes"), r._tree = o._tree; for (a = 0; a < u.length; a++) u[a]._tree = o._tree; r._setField("owner", o), l = s.length, o.$nodes || (o.$nodes = t("<ul></ul>").addClass("wijmo-wijtree-list " + o.options.wijCSS.helperReset + " wijmo-wijtree-child"), o.element.append(o.$nodes)), l > 0 && l !== n ? r.element.get(0) !== s[n].element.get(0) && r.element.insertBefore(s[n].element) : o.$nodes.append(r.element), o._changeCollection(n, r), o._collectionChanged(), r._initNodeClass() }, n.prototype.remove = function (e) { var t = -1, n, r = this, i = this._getField("nodes"); e.jquery ? t = e.index() : typeof e == "number" && (t = e); if (t < 0 || t >= i.length) return; n = i[t], n.element.detach(), r._changeCollection(t), r._collectionChanged() }, n.prototype.getNodes = function () { return this._getField("nodes") }, n.prototype._changeCollection = function (e, t) { var n = this._getField("nodes"), r = this.options.nodes; t ? (n.splice(e, 0, t), r.splice(e, 0, t.options)) : (n.splice(e, 1), r.splice(e, 1)) }, n.prototype.sortNodes = function () { var e = this._getField("nodes"); this._sort(), t.each(e, function (e, t) { t._index = e, t._insertBefore(e) }), this._refreshNodesClass() }, n.prototype.check = function (e) { this._setOption("checked", e) }, n.prototype.select = function (e) { this._setOption("selected", e) }, n.prototype.getOwner = function () { var e = this._getOwner(); return e && e.element.is("li") ? e : null }, n.prototype.expand = function () { this._setOption("expanded", !0) }, n.prototype.collapse = function () { this._setOption("expanded", !1) }, n.prototype._insertBefore = function (e) { var t = this.element.parent().children("li"); this.element.index() !== e && this.element.insertBefore(t.eq(e)) }, n.prototype._sort = function () { var e = this._getField("nodes"); this._isSorted ? this._isDecsSort ? (e.sort(this._compare2NodeTextDesc), this._isDecsSort = !1) : (e.sort(this._compare2NodeTextAcs), this._isDecsSort = !0) : (e.sort(this._compare2NodeTextAcs), this._isSorted = !0, this._isDecsSort = !0) }, n.prototype._compare2NodeTextAcs = function (e, t) { if (e !== null && t !== null) return e._text.localeCompare(t._text) }, n.prototype._compare2NodeTextDesc = function (e, t) { if (e !== null && t !== null) return -1 * e._text.localeCompare(t._text) }, n.prototype._collectionChanged = function () { this._hasChildren = this._getChildren(), this._initNodeClass() }, n.prototype._refreshNodesClass = function () { var e = this._getField("nodes"), t; for (t = 0; t < e.length; t++) e[t]._initNodeClass() }, n.prototype._setChecked = function (e) { var t = this; if (t.options.checked === e && t._checkState !== "indeterminate") return; t.options.checked = e, t.$nodeBody.attr("aria-checked", e), this._checkItem() }, n.prototype._isClosestDisabled = function () { var e = this; return e.element.closest(".wijmo-wijtree-disabled,.wijmo-wijtreenode-disabled", e._tree.element).length ? !0 : !1 }, n.prototype._setExpanded = function (e) { var t = this, n = t.options; if (t._expanded === e) return; (t._hasChildren || n.hasChildren) && t._expandNode(e) }, n.prototype._setFocused = function (e) { e ? (this.$navigateUrl.focus(), this._setFocusNode()) : this.$navigateUrl.blur() }, n.prototype._setFocusNode = function () { this._tree._focusNode && t.browser.webkit && this._tree._focusNode.$navigateUrl.blur(), this._focused = !0, this._tree._focusNode = this, this.$inner.addClass(this.options.wijCSS.stateFocus), this._tree._trigger("nodeFocus", null, this) }, n.prototype._setToolTip = function (e) { e.length ? this.element.attr("title", e) : this.element.removeAttr("title") }, n.prototype._setText = function (e) { this._text !== e && e.length && (this._text = e, this._changeText(e)) }, n.prototype._setSelected = function (e) { var t = this, n = t.options; n.selected !== e && (n.selected = e, t.$nodeBody.attr("aria-selected", e), t._selectNode(e), t._setFocused(e)) }, n.prototype._setCheckBoxes = function (e) { var n = this; n.$checkBox ? n.$checkBox[e ? "show" : "hide"]() : e && (n.$checkBox = t("<div>"), n.$checkBox.insertBefore(n.$navigateUrl), n.$checkBox.wijtreecheck()), n.$nodes && n.$nodes.children("li").each(function (r, i) { var s = n._getNodeWidget(t(i)); s !== null && s._setCheckBoxes(e) }) }, n.prototype._setHitArea = function (e) { var n = this; n._hasChildren && (e ? (n._initNodeClass(), n.$hitArea && n.$hitArea.show()) : (n._expanded = !0, n.options.expanded = !0, n.$nodeBody.attr("aria-expanded", !0), n.$nodes && n.$nodes.show(), n._initNodeClass(), n.$hitArea && n.$hitArea.hide())), n.$nodes && n.$nodes.children("li").each(function (r, i) { var s = n._getNodeWidget(t(i)); s !== null && s._setHitArea(e) }) }, n.prototype._getOwner = function () { return this._getField("owner") }, n.prototype._getTree = function () { var e = this._getOwner(); return e ? e.element.is(":" + this.options.treeClass) ? e : e._getTree() : null }, n.prototype._getInitElement = function () { var e = t("<li>"), n = this, r = t("<ul>"), i = n._getField("nodes"); return e.append(n.$navigateUrl.clone()), i.length && (e.append(r), t.each(i, function (e, t) { var n = t._getInitElement(); r.append(n) })), e }, n.prototype._getChildren = function () { return this.element.find(">ul:first>li").length > 0 && this.element.children("ul:first") || !!this.options.nodes && !!this.options.nodes.length }, n.prototype._getNodeWidget = function (e) { var t = this._getNodeByDom(e), n; return t.length > 0 ? (n = t.data(t.data("widgetName")), n) : null }, n.prototype._createNodeWidget = function (e, n) { return t.fn.wijtreenode && (e.data("owner", this), !!n && t.isPlainObject(n) ? (t.extend(n, { treeClass: this.options.treeClass }), e.wijtreenode(n)) : e.wijtreenode({ treeClass: this.options.treeClass })), e }, n.prototype._getNodeByDom = function (e) { return t(e).closest(":" + this.widgetFullName) }, n.prototype._getCurrentLevel = function () { return this.element.parentsUntil(":" + this.options.treeClass).length - 1 }, n.prototype._getField = function (e) { return this.element.data(e) }, n.prototype._setField = function (e, t) { return this.element.data(e, t) }, n }(e.wijmoWidget); e.wijtreenode = i; var s = "", o = "", u = function (e) { function n() { e.apply(this, arguments) } return __extends(n, e), n.prototype._initCSS = function (e) { var t = e.wijCSS; s = t.icon + " " + t.iconCheck, o = t.icon + " " + t.iconStop }, n.prototype._create = function () { var e = this, n = this.options, r = n.wijCSS; e._initCSS(n), e.element.is("div") && (e.element.addClass("wijmo-checkbox " + r.widget).attr("role", "checkbox"), e.$icon = t("<span>"), e.$icon.addClass("wijmo-checkbox-icon"), n.checkState === "check" ? e.$icon.addClass(s) : n.checkState === "triState" && e.$icon.addClass(o), e.$body = t("<div></div>").addClass(["wijmo-checkbox-box", r.widget, r.cornerAll, r.stateDefault].join(" ")).css({ position: "relative" }).append(e.$icon), e.element.append(e.$body), e.element.bind("mouseover.wijtreecheck", function () { e.options.disabled || e.$body.addClass(r.stateHover) }).bind("mouseout.wijtreecheck", function () { e.options.disabled || e.$body.removeClass(r.stateHover).not(r.stateFocus).addClass(r.stateDefault) })) }, n.prototype._setOption = function (e, n) { var r = this, i = r.options.wijCSS; e === "checkState" && (n === "unCheck" ? (r.$body.removeClass(i.stateActive), r.$icon.removeClass(s + " " + o + " " + i.stateActive)) : n === "check" ? (r.$body.addClass(i.stateActive), r.$icon.removeClass(o).addClass(s)) : n === "triState" && (r.$body.addClass(i.stateActive), r.$icon.removeClass(s).addClass(o))), t.Widget.prototype._setOption.apply(r, arguments) }, n.prototype.destory = function () { this.element.children().remove(), this.element.removeClass("wijmo-checkbox " + this.options.wijCSS.widget), t.Widget.prototype.destroy.apply(this) }, n }(e.wijmoWidget); e.wijtreecheck = u, u.prototype.options = t.extend(!0, {}, e.wijmoWidget.prototype.options, { wijMobileCSS: { header: "ui-header ui-bar-a", content: "ui-body-c", stateHover: "ui-btn-down-b", stateActive: "ui-btn-down-b" }, checkState: "unCheck" }); var a = function () { function e() { this.wijMobileCSS = { header: "ui-header ui-bar-a", content: "ui-body-c", stateDefault: "ui-btn-up-c", stateHover: "ui-btn-down-c", stateActive: "ui-btn-down-b" }, this.treeClass = "wijmo-wijtree", this.initSelector = ":jqmData(role='wijtreenode')", this.accessKey = "", this.checked = !1, this.collapsedIconClass = "", this.expanded = !1, this.expandedIconClass = "", this.itemIconClass = "", this.navigateUrl = "", this.selected = !1, this.text = "", this.toolTip = "", this.hasChildren = !1, this.params = {}, this.nodes = null } return e }(), f = function () { function e() { this.wijMobileCSS = { header: "ui-header ui-bar-a", content: "ui-body-c", stateDefault: "ui-btn-up-c", stateHover: "ui-btn-down-b", stateActive: "ui-btn-down-c" }, this.allowDrag = !1, this.allowDrop = !1, this.allowEdit = !1, this.allowSorting = !0, this.allowTriState = !0, this.autoCheckNodes = !0, this.autoCollapse = !1, this.disabled = !1, this.expandCollapseHoverUsed = !1, this.showCheckBoxes = !1, this.showExpandCollapse = !0, this.expandAnimation = { effect: "blind", easing: "linear", duration: 200 }, this.expandDelay = 0, this.collapseAnimation = { effect: "blind", easing: "linear", duration: 200 }, this.collapseDelay = 0, this.draggable = null, this.droppable = null, this.dropVisual = null, this.nodes = null, this.nodeBlur = null, this.nodeFocus = null, this.nodeClick = null, this.nodeCheckChanged = null, this.nodeCollapsed = null, this.nodeExpanded = null, this.nodeDragging = null, this.nodeDragStarted = null, this.nodeBeforeDropped = null, this.nodeDropped = null, this.nodeMouseOver = null, this.nodeMouseOut = null, this.nodeTextChanged = null, this.selectedNodeChanged = null, this.nodeExpanding = null, this.nodeCollapsing = null } return e }(); i.prototype.options = t.extend(!0, {}, e.wijmoWidget.prototype.options, new a), r.prototype.options = t.extend(!0, {}, e.wijmoWidget.prototype.options, new f), t.wijmo.registerWidget("wijtree", r.prototype), t.wijmo.registerWidget("wijtreenode", i.prototype), t.wijmo.registerWidget("wijtreecheck", u.prototype) })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; var t = jQuery, n = "wijupload", r = "wijmo-wijupload", i = "wijmo-wijupload-fileRow", s = "." + i, o = "wijmo-wijupload-filesList", u = "wijmo-wijupload-commandRow", a = "wijmo-wijupload-uploadAll", f = "wijmo-wijupload-cancelAll", l = "wijmo-wijupload-buttonContainer", c = "wijmo-wijupload-upload", h = "." + c, p = "wijmo-wijupload-cancel", d = "." + p, v = "wijmo-wijupload-file", m = "wijmo-wijupload-progress", g = "wijmo-wijupload-loading", y = "ui-widget-content", b = "ui-corner-all", w = "ui-state-highlight", E, S, x = function (e) { return e.indexOf("\\") > -1 && (e = e.substring(e.lastIndexOf("\\") + 1)), e }, T = function (e) { var n = e.files, r = ""; return n ? (t.each(n, function (e, t) { r += x(t.name) + "; " }), r.length && (r = r.substring(0, r.lastIndexOf(";")))) : r = x(e.value), r }, N = function (e) { var n = e.files, r = 0; return n && n.length > 0 && t.each(n, function (e, t) { t.size && (r += t.size) }), r }; E = function (e, n, r) { var i, s = t("input", n), o = function (e) { e && (e.abort(), e = null) }, u = function (e) { e && (e = null) }, a = function () { var e = this, i = s.get(0).files, a = [], f = 0, l = 0, c = function (n, r) { var o = new XMLHttpRequest; return o.open("POST", r, !0), o.setRequestHeader("Wijmo-RequestType", "XMLHttpRequest"), o.setRequestHeader("Cache-Control", "no-cache"), o.setRequestHeader("Wijmo-FileName", n), o.setRequestHeader("Content-Type", "application/octet-stream"), o.upload.onprogress = function (n) { if (n.lengthComputable) { var r; t.isFunction(e.onProgress) && (r = { supportProgress: !0, loaded: l + n.loaded, total: N(s[0]), fileName: x(e.currentFile.name), fileNameList: T(s[0]).split("; ") }, e.onProgress(r)) } }, o.onreadystatechange = function (n) { if (this.readyState === 4) { var r = this.responseText, s; l += i[f].size, f++, i.length > f ? h(i[f]) : t.isFunction(e.onComplete) && (s = { e: n, response: r, supportProgress: !0 }, e.onComplete(s)) } }, a.push(o), o }, h = function (t) { var n = x(t.name), i = c(n, r); e.handleRequest(i, t), e.currentFile = t, i.send(t) }; e.fileRow = n, e.inputFile = s, e.upload = function () { h(i[f]) }, e.cancel = function () { t.each(a, function (e, t) { o(t) }), t.isFunction(e.onCancel) && e.onCancel() }, e.destroy = function () { t.each(a, function (e, t) { u(t) }) }, e.updateAction = function (e) { r = e }, e.handleRequest = null, e.onCancel = null, e.onComplete = null, e.onProgress = null }; return i = new a, i }, S = function (e, n, r) { var i, s = t("input", n), o = s.attr("id"), u = "wijUploadForm_" + e, a = t("#" + u), f = "wijUploadIfm_" + o, l = !0, c = t('<iframe id="' + f + '" name="' + f + '">'), h = function (e, t) { a.empty(), a.attr("target", e.attr("name")), t && (t.parent().append(t.clone()), a.append(t)), a.submit() }, p = function (e) { e.attr("src", "javascript".concat(":false;")) }, d = function (e, t) { t && a && (a.remove(), a = null), e && (e.remove(), e = null) }, v; return a.length === 0 && (a = t('<form method="post" enctype="multipart/form-data"></form>'), a.attr("action", r).attr("id", u).attr("name", u).appendTo("body")), c.css("position", "absolute").css("top", "-1000px").css("left", "-1000px"), c.appendTo("body"), v = function () { var e = this; e.fileRow = n, e.iframe = c, e.inputFile = s, e.upload = function () { var n; h(c, s), t.isFunction(e.onProgress) && (n = { supportProgress: !1, loaded: 1, total: 1 }, e.onProgress(n)) }, e.doPost = function () { h(c) }, e.cancel = function () { p(c), t.isFunction(e.onCancel) && e.onCancel() }, e.updateAction = function (e) { r = e, a.attr("action", e) }, e.destroy = function (e) { d(c, e) }, e.onCancel = null, e.onComplete = null, e.onProgress = null, c.bind("load", function (n) { if (!t.browser.safari && l && !e.autoSubmit) { l = !1; return } if (c.attr("src") === "javascript".concat(":false;")) return; var r = n.target, i, s, o; try { s = r.contentDocument ? r.contentDocument : window.frames[0].document, s.XMLDocument ? i = s.XMLDocument : s.body ? i = s.body.innerHTML : i = s, t.isFunction(e.onComplete) && (o = { e: n, response: i, supportProgress: !1 }, e.onComplete(o)) } catch (u) { i = "" } finally { } }) }, i = new v, i }; var C = function (e) { function n() { e.apply(this, arguments) } return __extends(n, e), n.prototype._swfAppendAddtionalData = function (e) { e.queueData = { files: {}, filesSelected: 0, filesQueued: 0, filesReplaced: 0, filesCancelled: 0, filesErrored: 0, uploadsSuccessful: 0, uploadsErrored: 0, averageSpeed: 0, queueLength: 0, queueSize: 0, uploadSize: 0, queueBytesUploaded: 0, uploadQueue: [], errorMsg: "" }, e.widget = this }, n.prototype._swfGetHandlers = function () { var e = this, n = e.element; return { onSelect: function (t) { var n = this, r = {}; if (e._trigger("change", null, t) === !1) return !1; e._createFileRow(t), this.queueData.queueSize += t.size, this.queueData.files[t.id] = t }, onSelectError: function (e, t) { t == SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT ? alert("File size exceeds the limitation!") : t == SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED && alert("Too many files!") }, onDialogOpen: function () { this.queueData.filesReplaced = 0, this.queueData.filesCancelled = 0 }, onDialogClose: function (t, n, r) { var i = this.settings; this.queueData.filesErrored = t - n, this.queueData.filesSelected = t, this.queueData.filesQueued = n - this.queueData.filesCancelled, this.queueData.queueLength = r, e.isStartUpload = !1, e.options.autoSubmit && (e.uploadAll = !0, e._swfUploadFile()), i.onDialogClose && i.onDialogClose.call(this, this.queueData) }, onUploadStart: function (t) { this.bytesLoaded = 0, this.queueData.uploadQueue.length == 0 && (this.queueData.uploadSize = t.size); if (!e.isStartUpload && e.uploadAll) { if (e._trigger("totalUpload", null, null) === !1) return this.cancelUpload(), !1; e.isStartUpload = !0 } if (e._trigger("upload", null, t) === !1) return this.cancelUpload(t.id), !1 }, onUploadProgress: function (r, i, s) { var o = t("#" + r.id, n), u, a, f = Math.round(i / s * 100), l = t("." + m, o), c = { sender: r.name, loaded: i, total: s }, h = this.queueData; l.html(f + "%"), e._trigger("progress", null, c), u = h.queueBytesUploaded + i, a = h.queueSize, e._updateSwfProgress(u, a), e._trigger("totalProgress", null, { loaded: u, total: a }) }, onUploadError: function (e, r, i) { var s = this.settings, o = t("#" + e.id, n), u = t("." + m, o), a = "Error"; switch (r) { case SWFUpload.UPLOAD_ERROR.HTTP_ERROR: a = "HTTP Error (" + i + ")"; break; case SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL: a = "Missing Upload URL"; break; case SWFUpload.UPLOAD_ERROR.IO_ERROR: a = "IO Error"; break; case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR: a = "Security Error"; break; case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED: alert("The upload limit has been reached (" + i + ")."), a = "Exceeds Upload Limit"; break; case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED: a = "Failed"; break; case SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND: break; case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED: a = "Validation Error"; break; case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED: a = "Cancelled", this.queueData.queueSize -= e.size, this.queueData.queueLength -= 1; if (e.status == SWFUpload.FILE_STATUS.IN_PROGRESS || t.inArray(e.id, this.queueData.uploadQueue) >= 0) this.queueData.uploadSize -= e.size; s.onCancel && s.onCancel.call(this, e), delete this.queueData.files[e.id]; break; case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED: a = "Stopped" } u.text(a); var f = this.getStats(); this.queueData.uploadsErrored = f.upload_errors }, onUploadSuccess: function (r, i, s) { var o = this.getStats(); this.queueData.uploadsSuccessful = o.successful_uploads, this.queueData.queueBytesUploaded += r.size, this.queueData.response = s; var u = t("#" + r.id, n), a = this; a.queueData.queueLength -= 1, u.fadeOut(1500, function () { u.remove(), e.options.showUploadedFiles && e._createUploadedFiles(r.name), a.queueData.queueLength || e.commandRow.hide() }), e._trigger("complete", null, { response: s }) }, onUploadComplete: function (t, n, r) { var i = this; !i.queueData.queueLength && e.uploadAll && (e._cleanSwfProgress(), e._trigger("totalComplete", null, i.queueData)), e.uploadAll && e._swfUploadFile() } } }, n.prototype._cleanSwfProgress = function () { }, n.prototype._updateSwfProgress = function (e, t) { }, n.prototype._initSwfUploadOptions = function (e, n) { var r = this, i = r.element, s, o = r._swfGetHandlers(), u = r.options, a = r.options.swfUploadOptions, f = i.attr("id"), l = f + "_SWFUpload"; return t("<input type='file' id='" + l + "'>").appendTo(i), s = t.extend({ id: l, swf: "SWFUpload.swf", auto: !1, buttonClass: "", buttonCursor: "hand", buttonImage: null, checkExisting: !1, debug: !1, fileObjName: "Filedata", fileSizeLimit: u.maximumFileSize ? u.maximumFileSize : 0, fileTypeDesc: "All Files", fileTypeExts: u.accept ? u.accept : "*.*", height: n, itemTemplate: !1, method: "post", multi: u.multiple, formData: {}, preventCaching: !0, progressData: "percentage", queueID: !1, queueSizeLimit: u.maximumFiles ? u.maximumFiles : 999, removeCompleted: !0, removeTimeout: 3, requeueErrors: !1, successTimeout: 30, uploadLimit: 0, width: e, uploader: u.action, overrideEvents: [] }, a), { assume_success_timeout: s.successTimeout, button_placeholder_id: s.id, button_width: s.width, button_height: s.height, button_text: null, button_text_style: null, button_text_top_padding: 0, button_text_left_padding: 0, button_action: u.multiple ? SWFUpload.BUTTON_ACTION.SELECT_FILES : SWFUpload.BUTTON_ACTION.SELECT_FILE, button_disabled: !1, button_cursor: s.buttonCursor == "arrow" ? SWFUpload.CURSOR.ARROW : SWFUpload.CURSOR.HAND, button_window_mode: SWFUpload.WINDOW_MODE.TRANSPARENT, debug: s.debug, requeue_on_error: s.requeueErrors, file_post_name: s.fileObjName, file_size_limit: s.fileSizeLimit, file_types: s.fileTypeExts, file_types_description: s.fileTypeDesc, file_queue_limit: s.queueSizeLimit, file_upload_limit: s.uploadLimit, flash_url: s.swf, prevent_swf_caching: s.preventCaching, post_params: s.formData, upload_url: s.uploader, use_query_string: s.method == "get", file_dialog_complete_handler: o.onDialogClose, file_dialog_start_handler: o.onDialogOpen, file_queued_handler: o.onSelect, file_queue_error_handler: o.onSelectError, swfupload_loaded_handler: s.onSWFReady, upload_complete_handler: o.onUploadComplete, upload_error_handler: o.onUploadError, upload_progress_handler: o.onUploadProgress, upload_start_handler: o.onUploadStart, upload_success_handler: o.onUploadSuccess } }, n.prototype._createSWFUpload = function () { var e = this, n = e.element, r = e.addBtn, i, s = e.options.swfUploadOptions, o, u = r.width(), a = r.height(), f = swfobject.getFlashPlayerVersion(), l = f.major >= 9; l ? (i = e._initSwfUploadOptions(u, a), o = new SWFUpload(i), e.swfupload = o, t("#" + o.movieName).css({ position: "absolute", "z-index": 100, top: 0, left: 0, width: u, height: a }), e._swfAppendAddtionalData(o)) : (alert("Please install flash player."), s && s.onFallback && s.onFallback.call()) }, n.prototype._create = function () { var e = this, n = e.options, r = (new Date).getTime(), i = e.supportXhr(); window.wijmoApplyWijTouchUtilEvents && (t = window.wijmoApplyWijTouchUtilEvents(t)), e.filesLen = 0, e.totalUploadFiles = 0, e.useXhr = i, e.id = r, e._createContainers(), e._createUploadButton(), n.enableSWFUploadOnIE && t.browser.msie || n.enableSWFUpload ? e._createSWFUpload() : e._createFileInput(), e._bindEvents(), n.disabled && e.disable(), e.element.is(":hidden") && e.element.wijAddVisibilityObserver && e.element.wijAddVisibilityObserver(function () { e._applyInputPosition(), e.element.wijRemoveVisibilityObserver && e.element.wijRemoveVisibilityObserver() }, "wijupload") }, n.prototype._setOption = function (e, n) { var r = this; t.Widget.prototype._setOption.apply(this, arguments), e === "disabled" ? r._handleDisabledOption(n, r.upload) : e === "accept" && r.input && r.input.attr("accept", n) }, n.prototype._handleDisabledOption = function (e, t) { var n = this; e ? (n.disabledDiv || (n.disabledDiv = n._createDisabledDiv(t)), n.disabledDiv.appendTo("body")) : n.disabledDiv && (n.disabledDiv.remove(), n.disabledDiv = null) }, n.prototype._createDisabledDiv = function (e) { var n = this, r, i = e ? e : n.upload, s = i.offset(), o = i.outerWidth(), u = i.outerHeight(); return r = t("<div></div>").addClass("ui-disabled").css({ "z-index": "99999", position: "absolute", width: o, height: u, left: s.left, top: s.top }), t.browser.msie && (r.css("background-color", "white"), parseInt(t.browser.version) >= 9 && r.css("opacity", "0.1")), r }, n.prototype.destroy = function () { var e = this; e.upload.removeClass(r), e.upload.undelegate(e.widgetName).undelegate("." + e.widgetName), e.input.remove(), e.addBtn.remove(), e.filesList.remove(), e.commandRow.remove(), e.isCreateByInput === !0 && e.element.css({ display: "" }).unwrap(), e.uploaders && (t.each(e.uploaders, function (e, t) { t.destroy && t.destroy(!0), t = null }), e.uploaders = null), e.disabledDiv && (e.disabledDiv.remove(), e.disabledDiv = null) }, n.prototype.widget = function () { return this.upload }, n.prototype.supportXhr = function () { var e = !1; return typeof (new XMLHttpRequest).upload == "undefined" ? e = !1 : e = !0, e }, n.prototype._createContainers = function () { var e = this, n, i, s = e.element; if (s.is(":input") && s.attr("type") === "file") e.isCreateByInput = !0, e.maxDisplay = s.attr("multiple") || e.options.multiple ? 0 : 1, e.upload = s.css({ display: "none" }).wrap("<div>").parent(); else { if (!e.element.is("div")) throw 'The initial markup must be "DIV", "INPUT[type=file]"'; e.maxDisplay = e.options.multiple ? 0 : 1, e.upload = s } e.upload.addClass(r), n = t("<ul>").addClass(o).appendTo(e.upload), i = t("<div>").addClass(u).appendTo(e.upload), e.filesList = n, i.hide(), e.commandRow = i, e._createCommandRow(i) }, n.prototype._createCommandRow = function (e) { var n = this, r = t("<a>").attr("href", "#").text("uploadAll").addClass(a).button({ icons: { primary: "ui-icon-circle-arrow-n" }, label: n._getLocalization("uploadAll", "Upload All") }), i = t("<a>").attr("href", "#").text("cancelAll").addClass(f).button({ icons: { primary: "ui-icon-cancel" }, label: n._getLocalization("cancelAll", "Cancel All") }); e.append(r).append(i) }, n.prototype._getLocalization = function (e, t) { var n = this.options.localization; return n && n[e] || t }, n.prototype._createUploadButton = function () { var e = this, n = t("<a>").attr("href", "#").button({ label: e._getLocalization("uploadFiles", "Upload files") }); n.mousemove(function (t) { var r = n.data("uiButton").options.disabled; if (e.input) { var i = t.pageX, s = t.pageY; r || e.input.offset({ left: i + 10 - e.input.width(), top: s + 10 - e.input.height() }) } }), e.addBtn = n, e.upload.prepend(n) }, n.prototype._applyInputPosition = function () { var e = this, t = e.addBtn, n = t.offset(), r = e.cuurentInput; r.offset({ left: n.left + t.width() - r.width(), top: n.top }).height(t.height()) }, n.prototype._createFileInput = function () { var e = this, n = e.addBtn, r = n.offset(), i = e.element.attr("accept") || e.options.accept, s = "wijUpload_" + e.id + "_input" + e.filesLen, o = t("<input>").attr("type", "file").prependTo(e.upload), u = e.options.maximumFiles || e.maxDisplay; u !== 1 && e.maxDisplay === 0 && o.attr("multiple", "multiple"), i && o.attr("accept", i), e.cuurentInput = o, e.filesLen++, o.attr("id", s).attr("name", s).css("position", "absolute").offset({ left: r.left + n.width() - o.width(), top: r.top }).css("z-index", "9999").css("opacity", 0).height(n.height()).css("cursor", "pointer"), e.input = o, o.bind("change", function (n) { var r, i; if (e._trigger("change", n, t(this)) === !1) return !1; e._createFileInput(), r = e._createFileRow(t(this)), e._setAddBtnState(), e.options.autoSubmit && (i = t(h, r), i && i.click()), o.unbind("change") }), e.uploadAll = !1 }, n.prototype._createUploadedFiles = function (e) { }, n.prototype._setAddBtnState = function () { var e = this, n = e.options.maximumFiles || e.maxDisplay, r = e.addBtn, i; if (!n) return; if (!r) return; e.maskDiv || (e.maskDiv = t("<div></div>").css("position", "absolute").css("z-index", "9999").width(r.outerWidth()).height(r.outerHeight()).appendTo(e.upload).offset(r.offset())), i = t("li", e.filesList), i.length >= n ? (r.button({ disabled: !0 }), e.maskDiv.show(), e.input && e.input.css("left", "-1000px")) : (r.button({ disabled: !1 }), e.maskDiv.hide()) }, n.prototype._createFileRow = function (e) { var n = this, r = n.options, o = t("<li>"), u = "", a, f, h, d = t("<span>").addClass(l), g = t("<a>").attr("href", "#").text("upload").addClass(c).button({ text: !1, icons: { primary: "ui-icon-circle-arrow-n" }, label: n._getLocalization("upload", "upload") }), E = t("<a>").attr("href", "#").text("cancel").addClass(p).button({ text: !1, icons: { primary: "ui-icon-cancel" }, label: n._getLocalization("cancel", "cancel") }); return o.addClass(i).addClass(y).addClass(b), r.enableSWFUploadOnIE && t.browser.msie || r.enableSWFUpload ? (u = e.name, o.attr("id", e.id).data("file", e)) : (o.append(e), e.hide(), u = T(e[0])), a = t("<span>" + u + "</span>").addClass(v).addClass(w).addClass(b), o.append(a), o.append(d), f = t("<span />").addClass(m), d.append(f), d.append(g).append(E), o.appendTo(n.filesList), h = t(s, n.upload), h.length && (n.commandRow.show(), (!r.enableSWFUploadOnIE || !t.browser.msie) && !r.enableSWFUpload && n._createUploader(o), n._resetProgressAll()), o }, n.prototype._createUploader = function (e) { var n = this, r = t("input", e), i = n.options.action, s = n.options.handleRequest, o; n.useXhr ? (o = E(n.id, e, i), o.handleRequest = function (e, r) { t.isFunction(s) && s.call(n, e, r) }) : o = S(n.id, e, i), o.onCancel = function () { var e = this; n._trigger("cancel", null, e.inputFile), n.totalUploadFiles === 0 && n.uploadAll && n._trigger("totalComplete") }, n._wijUpload() && (o.onProgress = function (e) { var r = t("." + m, this.fileRow), i = { sender: e.fileName, loaded: e.loaded, total: e.total, fileNameList: undefined }, s = this.inputFile.attr("id"); e.supportProgress ? (r.html(Math.round(1e3 * e.loaded / e.total) / 10 + "%"), e.fileNameList && (i.fileNameList = e.fileNameList), n._trigger("progress", null, i), n._progressTotal(s, e.loaded)) : r.addClass(g) }, o.onComplete = function (e) { var r = this, i = r.inputFile.attr("id"), s = n.uploaders[i], o = N(r.inputFile[0]), u = t("." + m, r.fileRow); n._trigger("complete", e.e, r.inputFile), u.removeClass(g), u.html("100%"), n._removeFileRow(r.fileRow, s, !0), n._progressTotal(i, o), n.totalUploadFiles--, n.totalUploadFiles === 0 && (n.uploadAll || n.options.autoSubmit) && n._trigger("totalComplete", e.e, e) }), typeof n.uploaders == "undefined" && (n.uploaders = {}), n.uploaders[r.attr("id")] = o }, n.prototype._progressTotal = function (e, t) { var n = this, r = n.progressAll, i, s; if (!n.uploadAll) return; r && r.loadedSize && (r.loadedSize[e] = t, i = n._getLoadedSize(r.loadedSize), s = r.totalSize), n._trigger("totalProgress", null, { loaded: i, total: s }) }, n.prototype._getLoadedSize = function (e) { var n = 0; return t.each(e, function (e, t) { n += t }), n }, n.prototype._getTotalSize = function () { var e = this, n = 0; return e.uploaders && t.each(e.uploaders, function (e, t) { n += N(t.inputFile[0]) }), n }, n.prototype._resetProgressAll = function () { this.progressAll = { totalSize: 0, loadedSize: {} } }, n.prototype._wijUpload = function () { return !0 }, n.prototype._wijcancel = function (e) { }, n.prototype._upload = function (e, t) { }, n.prototype._swfUploadFile = function (e) { this.swfupload.startUpload(e) }, n.prototype._bindEvents = function () { var e = this, n = e.options, r = e.progressAll; e.upload.delegate(d, "click." + e.widgetName, function (i) { var o = t(this), u = o.parents(s), a, f; if (n.enableSWFUploadOnIE && t.browser.msie || n.enableSWFUpload) { var l = u.data("file"); e.swfupload.cancelUpload(l.id), u.fadeOut(1500, function () { u.remove(), e.swfupload.queueData.queueLength == 0 && e.commandRow.hide() }) } else a = t("input", u[0]), f = e.uploaders[a.attr("id")], e._wijcancel(a), e._wijUpload() && f && f.cancel(), r && (r.totalSize -= N(a[0]), r.loadedSize[a.val()] && delete r.loadedSize[a.val()]), e._removeFileRow(u, f, !1) }), e.upload.delegate(h, "click." + e.widgetName, function (r) { var i = t(this), o = i.parents(s), u, a; if (n.enableSWFUploadOnIE && t.browser.msie || n.enableSWFUpload) { var f = o.data("file"); e.uploadAll = !1, e._wijUpload() ? e._swfUploadFile(f.id) : e._upload(f.id, !0) } else { u = t("input", o[0]), a = e.uploaders[u.attr("id")]; if (e._trigger("upload", r, u) === !1) return !1; if (e.options.autoSubmit) { a.autoSubmit = !0; if (e._trigger("totalUpload", r, null) === !1) return !1 } e.totalUploadFiles++, e._upload(o), a && e._wijUpload() && a.upload() } r.preventDefault() }), e.upload.delegate("." + a, "click." + e.widgetName, function (r) { if (n.enableSWFUploadOnIE && t.browser.msie || n.enableSWFUpload) e.uploadAll = !0, e._wijUpload() ? e._swfUploadFile() : e._upload(!0, !0); else { e.uploadAll = !0, e.progressAll || e._resetProgressAll(); if (e._trigger("totalUpload", r, null) === !1) return !1; e.progressAll.totalSize = e._getTotalSize(), e._wijuploadAll(t(h, e.filesList[0])), e._wijUpload() && t(h, e.filesList[0]).each(function (e, n) { return t(n).click(), e }) } }), e.upload.delegate("." + f, "click." + e.widgetName, function (r) { n.enableSWFUploadOnIE && t.browser.msie || n.enableSWFUpload ? (t.each(e.swfupload.queueData.files, function (t, n) { e.swfupload.cancelUpload(t) }), t(s, e.element).fadeOut(1500, function () { t(this).remove(), e.commandRow.hide() })) : (e._resetProgressAll(), t(d, e.filesList[0]).each(function (e, n) { t(n).click() })) }) }, n.prototype._wijuploadAll = function (e) { }, n.prototype._wijFileRowRemoved = function (e, t, n) { this._setAddBtnState() }, n.prototype._removeFileRow = function (e, n, r) { var i = this, o, u; n && (o = n.inputFile.attr("id")), e.fadeOut(1500, function () { e.remove(), i._wijFileRowRemoved(e, n.inputFile, r), i.uploaders[o] && delete i.uploaders[o], u = t(s, i.upload), u.length ? (i.commandRow.show(), n && n.destroy && n.destroy()) : (i.commandRow.hide(), i.totalUploadFiles = 0, i._resetProgressAll(), n && n.destroy && n.destroy(!0)) }) }, n.prototype._getFileName = function (e) { return x(e) }, n.prototype._getFileNameByInput = function (e) { return T(e) }, n.prototype._getFileSize = function (e) { return N(e) }, n }(e.wijmoWidget); e.wijupload = C; var k = function () { function e() { this.action = "", this.autoSubmit = !1, this.change = null, this.upload = null, this.totalUpload = null, this.progress = null, this.totalProgress = null, this.complete = null, this.totalComplete = null, this.maximumFiles = 0, this.multiple = !0, this.accept = "", this.enableSWFUploadOnIE = !1, this.enableSWFUpload = !1, this.swfUploadOptions = {}, this.localization = {}, this.handleRequest = null } return e }(), L = "wijmo-wijupload", A = L + "-"; C.prototype.options = t.extend(!0, {}, e.wijmoWidget.prototype.options, new k), t.wijmo.registerWidget("wijupload", C.prototype) })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; var t = jQuery, n = function (e) { function n() { e.apply(this, arguments) } return __extends(n, e), n.prototype._create = function () { var e = this; if (this.element.is(":hidden") && this.element.wijAddVisibilityObserver) { this.element.wijAddVisibilityObserver(function () { e.element.wijRemoveVisibilityObserver && e.element.wijRemoveVisibilityObserver(), e._pageLize(!0) }, "wijwizard"); return } this._pageLize(!0) }, n.prototype._init = function () { var e = this.options, t = e.disabled; e.disabledState ? (this.disable(), e.disabled = t) : e.autoPlay && this.play() }, n.prototype._setOption = function (t, n) { e.prototype._setOption.call(this, t, n); switch (t) { case "activeIndex": this.show(n); break; case "navButtons": this._createButtons(); break; default: this._pageLize(!1) } }, n.prototype.destroy = function () { var e = this.options; return this.abort(), this.stop(), this._removeScroller(), this._removeButtons(), this.element.unbind(".wijwizard").removeClass(e.wijCSS.wijwizard).removeClass(e.wijCSS.widget).removeClass(e.wijCSS.helperClearFix).removeData("wijwizard"), this.list && this.list.removeClass(e.wijCSS.widget).removeClass(e.wijCSS.helperReset).removeClass(e.wijCSS.wijwizardSteps).removeClass(e.wijCSS.helperClearFix).removeAttr("role"), this.lis && (this.lis.removeClass(e.wijCSS.header).removeClass(e.wijCSS.cornerAll).removeClass(e.wijCSS.priorityPrimary).removeClass(e.wijCSS.prioritySecondary).removeAttr("role"), t.each(this.lis, function () { t.data(this, "destroy.wijwizard") ? t(this).remove() : t(this).removeAttr("aria-selected") })), t.each(this.panels, function () { var n = t(this).unbind(".wijwizard"); t.each(["load", "cache"], function (e, t) { n.removeData(t + ".wijwizard") }), t.data(this, "destroy.wijwizard") ? n.remove() : n.removeClass(e.wijCSS.stateDefault).removeClass(e.wijCSS.wijwizardActived).removeClass(e.wijCSS.stateActive).removeClass(e.wijCSS.stateHover).removeClass(e.wijCSS.stateFocus).removeClass(e.wijCSS.stateDisabled).removeClass(e.wijCSS.wijwizardPanel).removeClass(e.wijCSS.content).removeClass(e.wijCSS.wijwizardHide).css({ position: "", left: "", top: "" }).removeAttr("aria-hidden") }), this.container.replaceWith(this.container.contents()), e.cookie && this._cookie(null, e.cookie), this }, n.prototype._pageLize = function (e) { var n = this.options, r = /^#.+/; this.list = this.element.children("ol,ul").eq(0), this.list && this.list.length === 0 && (this.list = this.element.find("." + n.wijCSS.wijwizardSteps).eq(0), this.list && this.list.length === 0 && (this.list = null)), this.list && (this.lis = t("li", this.list)), e ? (this.panels = t("> div", this.element), t.each(this.panels, function (e, n) { var i = t(n).attr("src"); i && !r.test(i) && t.data(n, "load.wijwizard", i.replace(/#.*$/, "")) }), this.element.addClass(n.wijCSS.wijwizard).addClass(n.wijCSS.widget).addClass(n.wijCSS.helperClearFix), this.list && (this.list.addClass(n.wijCSS.widget).addClass(n.wijCSS.helperReset).addClass(n.wijCSS.wijwizardSteps).addClass(n.wijCSS.helperClearFix).attr("role", "tablist"), this.lis.addClass(n.wijCSS.header).addClass(n.wijCSS.cornerAll).attr("role", "tab")), this.container = t("<div/>"), this.container.addClass(n.wijCSS.wijwizardContent).addClass(n.wijCSS.widget).addClass(n.wijCSS.content).addClass(n.wijCSS.cornerAll), this.container.append(this.panels), this.container.appendTo(this.element), this.panels.addClass(n.wijCSS.wijwizardPanel).addClass(n.wijCSS.content).attr("role", "tabpanel"), n.activeIndex === undefined ? (typeof n.activeIndex != "number" && n.cookie && (n.activeIndex = parseInt(this._cookie(undefined, undefined), 10)), typeof n.activeIndex != "number" && this.panels.filter("." + n.wijCSS.wijwizardActived).length && (n.activeIndex = this.panels.index(this.panels.filter("." + n.wijCSS.wijwizardActived))), n.activeIndex = n.activeIndex || (this.panels.length ? 0 : -1)) : n.activeIndex === null && (n.activeIndex = -1), n.activeIndex = n.activeIndex >= 0 && this.panels[n.activeIndex] || n.activeIndex < 0 ? n.activeIndex : 0, this.panels.addClass(n.wijCSS.wijwizardHide).attr("aria-hidden", !0), n.activeIndex >= 0 && this.panels.length && (this.panels.eq(n.activeIndex).removeClass(n.wijCSS.wijwizardHide).addClass(n.wijCSS.wijwizardActived).attr("aria-hidden", !1), this.load(n.activeIndex)), this._createButtons()) : (this.panels = t("> div", this.container), n.activeIndex = this.panels.index(this.panels.filter("." + n.wijCSS.wijwizardActived))), this._refreshStep(), this._initScroller(), n.cookie && this._cookie(n.activeIndex, n.cookie), n.cache === !1 && this.panels.removeData("cache.wijwizard"); if (n.showOption === undefined || n.showOption === null) n.showOption = {}; this._normalizeBlindOption(n.showOption); if (n.hideOption === undefined || n.hideOption === null) n.hideOption = {}; this._normalizeBlindOption(n.hideOption), this.panels.unbind(".wijwizard") }, n.prototype._removeButtons = function () { this.buttons && (this.buttons.remove(), this.buttons = undefined) }, n.prototype._createButtons = function () { var e = this, n = this, r = this.options, i, s, o, u = r.backBtnText, a = r.nextBtnText; this._removeButtons(); if (r.navButtons === "none") return; this.buttons || (i = r.navButtons, i === "auto" && (i = this.list ? "common" : "edge"), this.buttons = t("<div/>"), this.buttons.addClass(r.wijCSS.wijwizardButtons), s = function (e, t) { if (r.disabled) return; t.is(":not(." + r.wijCSS.stateDisabled + ")") && t.addClass(e) }, o = function (e, t) { if (r.disabled) return; t.removeClass(e) }, i === "common" ? (this.backBtn = t("<a href='#'><span class='" + r.wijCSS.buttonText + "'>" + u + "</span></a>").addClass(r.wijCSS.widget).addClass(r.wijCSS.stateDefault).addClass(r.wijCSS.cornerAll).addClass(r.wijCSS.button).addClass(r.wijCSS.buttonTextOnly).appendTo(this.buttons).bind({ click: function () { return e.back(), !1 }, mouseover: function () { s(r.wijCSS.stateHover, t(this)) }, mouseout: function () { o(r.wijCSS.stateHover, t(this)) }, mousedown: function () { s(r.wijCSS.stateActive, t(this)) }, mouseup: function () { o(r.wijCSS.stateActive, t(this)) } }).attr("role", "button"), this.nextBtn = t("<a href='#'><span class='" + r.wijCSS.buttonText + "'>" + a + "</span></a>").addClass(r.wijCSS.widget).addClass(r.wijCSS.stateDefault).addClass(r.wijCSS.cornerAll).addClass(r.wijCSS.button).addClass(r.wijCSS.buttonTextOnly).appendTo(this.buttons).bind({ click: function () { return n.next(), !1 }, mouseover: function () { s(r.wijCSS.stateHover, t(this)) }, mouseout: function () { o(r.wijCSS.stateHover, t(this)) }, mousedown: function () { s(r.wijCSS.stateActive, t(this)) }, mouseup: function () { o(r.wijCSS.stateActive, t(this)) } }).attr("role", "button")) : (this.backBtn = t("<a href='#'/>").addClass(r.wijCSS.wijwizardPrev).addClass(r.wijCSS.stateDefault).addClass(r.wijCSS.cornerRight).append("<span class='" + r.wijCSS.icon + " " + r.wijCSS.iconArrowLeft + "'></span>").appendTo(this.buttons).bind({ click: function () { return n.back(), !1 }, mouseover: function () { s(r.wijCSS.stateHover, t(this)) }, mouseout: function () { o(r.wijCSS.stateHover, t(this)) }, mousedown: function () { s(r.wijCSS.stateActive, t(this)) }, mouseup: function () { o(r.wijCSS.stateActive, t(this)) } }).attr("role", "button"), this.nextBtn = t("<a href='#'/>").addClass(r.wijCSS.wijwizardNext).addClass(r.wijCSS.stateDefault).addClass(r.wijCSS.cornerLeft).append("<span class='" + r.wijCSS.icon + " " + r.wijCSS.iconArrowRight + "'></span>").appendTo(this.buttons).bind({ click: function () { return n.next(), !1 }, mouseover: function () { s(r.wijCSS.stateHover, t(this)) }, mouseout: function () { o(r.wijCSS.stateHover, t(this)) }, mousedown: function () { s(r.wijCSS.stateActive, t(this)) }, mouseup: function () { o(r.wijCSS.stateActive, t(this)) } }).attr("role", "button")), this.buttons.appendTo(this.element)) }, n.prototype._refreshStep = function () { var e = this.options; this.lis && (this.lis.removeClass(e.wijCSS.priorityPrimary).addClass(e.wijCSS.prioritySecondary).attr("aria-selected", !1), e.activeIndex >= 0 && e.activeIndex <= this.lis.length - 1 && (this.lis && this.lis.eq(e.activeIndex).removeClass(e.wijCSS.prioritySecondary).addClass(e.wijCSS.priorityPrimary).attr("aria-selected", !0), this.scrollWrap && this.scrollWrap.wijsuperpanel("scrollChildIntoView", this.lis.eq(e.activeIndex)))), this.buttons && !e.loop && (this.backBtn[e.activeIndex <= 0 ? "addClass" : "removeClass"](e.wijCSS.stateDisabled).attr("aria-disabled", e.activeIndex === 0), this.nextBtn[e.activeIndex >= this.panels.length - 1 ? "addClass" : "removeClass"](e.wijCSS.stateDisabled).attr("aria-disabled", e.activeIndex >= this.panels.length - 1)) }, n.prototype._initScroller = function () { if (!this.lis) return; var e = 0; t.each(this.lis, function () { e += t(this).outerWidth(!0) }), this.element.innerWidth() < e ? (this.scrollWrap === undefined && (this.list.wrap("<div class='scrollWrap'></div>"), this.scrollWrap = this.list.parent(), t.effects && t.effects.save ? t.effects.save(this.list, ["width", "height", "overflow"]) : t.save && t.save(this.list, ["width", "height", "overflow"])), this.list.width(e + 8), this.scrollWrap.height(this.list.outerHeight(!0)), this.scrollWrap.wijsuperpanel({ allowResize: !1, hScroller: { scrollBarVisibility: "hidden" }, vScroller: { scrollBarVisibility: "hidden" } })) : this._removeScroller() }, n.prototype._removeScroller = function () { this.scrollWrap && (this.scrollWrap.wijsuperpanel("destroy").replaceWith(this.scrollWrap.contents()), this.scrollWrap = undefined, t.effects && t.effects.restore ? t.effects.restore(this.list, ["width", "height", "overflow"]) : t.restore && t.restore(this.list, ["width", "height", "overflow"])) }, n.prototype._cookie = function (e, n) { var r = this.cookie || (this.cookie = this.options.cookie.name); return t.cookie.apply(null, [r].concat(t.makeArray(arguments))) }, n.prototype._normalizeBlindOption = function (e) { e.blind === undefined && (e.blind = !1), e.fade === undefined && (e.fade = !1), e.duration === undefined && (e.duration = 200); if (typeof e.duration == "string") try { e.duration = parseInt(e.duration, 10) } catch (t) { e.duration = 200 } }, n.prototype._ui = function (e) { return { panel: e, index: this.panels.index(e) } }, n.prototype._removeSpinner = function () { this.element.removeClass(this.options.wijCSS.tabsLoading); var e = this.element.data("spinner.wijwizard"); e && (this.element.removeData("spinner.wijwizard"), e.remove()) }, n.prototype._showPanel = function (e) { var n = this, r = this.options, i = t(e), s; i.addClass(r.wijCSS.wijwizardActived), (r.showOption.blind || r.showOption.fade) && r.showOption.duration > 0 ? (s = { duration: r.showOption.duration }, r.showOption.blind && (s.height = "toggle"), r.showOption.fade && (s.opacity = "toggle"), i.hide().removeClass(r.wijCSS.wijwizardHide).animate(s, r.showOption.duration || "normal", "linear", function () { n._resetStyle(i), i.wijTriggerVisibility && i.wijTriggerVisibility(), n._trigger("show", null, n._ui(i[0])), n._removeSpinner(), i.attr("aria-hidden", !1), n._trigger("activeIndexChanged", null, n._ui(i[0])) })) : (i.removeClass(r.wijCSS.wijwizardHide).attr("aria-hidden", !1), i.wijTriggerVisibility && i.wijTriggerVisibility(), this._trigger("show", null, this._ui(i[0])), this._removeSpinner(), this._trigger("activeIndexChanged", null, this._ui(i[0]))) }, n.prototype._hidePanel = function (e) { var n = this, r = this, i = this.options, s = t(e), o; s.removeClass(i.wijCSS.wijwizardActived), (i.hideOption.blind || i.hideOption.fade) && i.hideOption.duration > 0 ? (o = { duration: i.hideOption.duration }, i.hideOption.blind && (o.height = "toggle"), i.hideOption.fade && (o.opacity = "toggle"), s.animate(o, i.hideOption.duration || "normal", "linear", function () { s.addClass(i.wijCSS.wijwizardHide).attr("aria-hidden", !0), n._resetStyle(s), n.element.dequeue("wijwizard") })) : (s.addClass(i.wijCSS.wijwizardHide).attr("aria-hidden", !0), this.element.dequeue("wijwizard")) }, n.prototype._resetStyle = function (e) { e.css({ display: "" }), t.support.opacity || e[0].style.removeAttribute("filter") }, n.prototype.add = function (e, n, r) { e === undefined && (e = this.panels.length), n === undefined && (n = "Step " + e); var i = this, s = this.options, o = t(s.panelTemplate || i._defaults.panelTemplate).data("destroy.wijwizard", !0), u; return o.addClass(s.wijCSS.wijwizardPanel).addClass(s.wijCSS.content).addClass(s.wijCSS.cornerAll).addClass(s.wijCSS.wijwizardHide).attr("aria-hidden", !0), e >= this.panels.length ? this.panels.length > 0 ? o.insertAfter(this.panels[this.panels.length - 1]) : o.appendTo(this.container) : o.insertBefore(this.panels[e]), this.list && this.lis && (u = t((s.stepHeaderTemplate || i._defaults.stepHeaderTemplate).replace(/#\{title\}/g, n).replace(/#\{desc\}/g, r)), u.addClass(s.wijCSS.header).addClass(s.wijCSS.cornerAll).addClass(s.wijCSS.prioritySecondary).data("destroy.wijwizard", !0), e >= this.lis.length ? u.appendTo(this.list) : u.insertBefore(this.lis[e])), this._pageLize(!1), this.panels.length === 1 && (s.activeIndex = 0, u.addClass(s.wijCSS.priorityPrimary), o.removeClass(s.wijCSS.wijwizardHide).addClass(s.wijCSS.wijwizardActived).attr("aria-hidden", !1), this.element.queue("wijwizard", function () { i._trigger("show", null, i._ui(i.panels[0])) }), this._refreshStep(), this.load(0)), this._trigger("add", null, this._ui(this.panels[e])), this }, n.prototype.remove = function (e) { var t = this.options, n = this.panels.eq(e).remove(); return this.lis.eq(e).remove(), e < t.activeIndex && t.activeIndex--, this._pageLize(!1), n.hasClass(t.wijCSS.wijwizardActived) && this.panels.length >= 1 && this.show(e + (e < this.panels.length ? 0 : -1)), this._trigger("remove", null, this._ui(n[0])), this }, n.prototype.show = function (e) { var n = this; if (e < 0 || e >= this.panels.length) return this; if (this.element.queue("wijwizard").length > 0) return this; var r = this.options, i = { nextIndex: 0, nextPanel: null }, s, o; t.extend(i, this._ui(this.panels[r.activeIndex])), i.nextIndex = e, i.nextPanel = this.panels[e]; if (this._trigger("validating", null, i) === !1) return this; s = this.panels.filter(":not(." + r.wijCSS.wijwizardHide + ")"), o = this.panels.eq(e), r.activeIndex = e, this.abort(), r.cookie && this._cookie(r.activeIndex, r.cookie), this._refreshStep(); if (!o.length) throw "jQuery UI wijwizard: Mismatching fragment identifier."; return s.length && this.element.queue("wijwizard", function () { n._hidePanel(s) }), this.element.queue("wijwizard", function () { n._showPanel(o) }), this.load(e), this }, n.prototype.next = function () { var e = this.options, t = e.activeIndex + 1; return e.disabled ? !1 : (e.loop && (t %= this.panels.length), t < this.panels.length ? (this.show(t), !0) : !1) }, n.prototype.back = function () { var e = this.options, t = e.activeIndex - 1; return e.disabled ? !1 : (e.loop && (t = t < 0 ? this.panels.length - 1 : t), t >= 0 ? (this.show(t), !0) : !1) }, n.prototype.load = function (e) { var n = this, r = n.options, i = n.panels.eq(e)[0], s = t.data(i, "load.wijwizard"), o; n.abort(); if (!s || n.element.queue("wijwizard").length !== 0 && t.data(i, "cache.wijwizard")) { n.element.dequeue("wijwizard"); return } return this.element.addClass(r.wijCSS.tabsLoading), r.spinner && (o = this.element.data("spinner.wijwizard"), o || (o = t("<div/>"), o.addClass(r.wijCSS.wijwizardSpinner), o.html(r.spinner || n._defaults.spinner), o.appendTo(document.body), this.element.data("spinner.wijwizard", o), o.wijpopup({ showEffect: "blind", hideEffect: "blind" })), o.wijpopup("show", { of: this.element, my: "center center", at: "center center" })), this.xhr = t.ajax(t.extend({}, r.ajaxOptions, { url: s, dataType: "html", success: function (s, o) { t(i).html(s), r.cache && t.data(i, "cache.wijwizard", !0), n._trigger("load", null, n._ui(n.panels[e])); try { r.ajaxOptions && r.ajaxOptions.success && r.ajaxOptions.success(s, o) } catch (u) { } }, error: function (t, s, o) { n._trigger("load", null, n._ui(n.panels[e])); try { r.ajaxOptions && r.ajaxOptions.error && r.ajaxOptions.error(t, s, e, i) } catch (u) { } } })), n.element.dequeue("wijwizard"), n }, n.prototype.abort = function () { return this.element.queue([]), this.panels.stop(!1, !0), this.element.queue("wijwizard", this.element.queue("wijwizard").splice(-2, 2)), this.xhr && (this.xhr.abort(), delete this.xhr), this._removeSpinner(), this }, n.prototype.url = function (e, t) { return this.panels.eq(e).removeData("cache.wijwizard").data("load.wijwizard", t), this }, n.prototype.count = function () { return this.panels.length }, n.prototype.stop = function () { var e = this.element.data("intId.wijwizard"); e && (window.clearInterval(e), this.element.removeData("intId.wijwizard")) }, n.prototype.play = function () { var e = this, t = this.options, n, r = this.panels.length; this.element.data("intId.wijwizard") || (n = window.setInterval(function () { var n = t.activeIndex + 1; if (n >= r) { if (!t.loop) { e.stop(); return } n = 0 } e.show(n) }, t.delay), this.element.data("intId.wijwizard", n)) }, n }(e.wijmoWidget); e.wijwizard = n, n.prototype._defaults = { stepHeaderTemplate: "<li><h1>#{title}</h1>#{desc}</li>", panelTemplate: "<div></div>", spinner: "<em>Loading&#8230;</em>" }; var r = function () { function e() { this.wijCSS = { wijwizard: "wijmo-wijwizard", wijwizardButtons: "wijmo-wijwizard-buttons", wijwizardPrev: "wijmo-wijwizard-prev", wijwizardNext: "wijmo-wijwizard-next", wijwizardSteps: "wijmo-wijwizard-steps", wijwizardContent: "wijmo-wijwizard-content", wijwizardPanel: "wijmo-wijwizard-panel", wijwizardActived: "wijmo-wijwizard-actived", wijwizardHide: "wijmo-wijwizard-hide", wijwizardSpinner: "wijmo-wijwizard-spinner" }, this.wijMobileCSS = { header: "ui-header ui-bar-a", content: "ui-body-c", stateDefault: "ui-btn-up-a", stateHover: "ui-btn-down-a", stateActive: "ui-btn-down-a" }, this.navButtons = "auto", this.autoPlay = !1, this.delay = 3e3, this.loop = !1, this.hideOption = { fade: !0 }, this.showOption = { fade: !0, duration: 400 }, this.ajaxOptions = null, this.cache = !1, this.cookie = null, this.stepHeaderTemplate = "", this.panelTemplate = "", this.spinner = "", this.backBtnText = "back", this.nextBtnText = "next", this.add = null, this.remove = null, this.activeIndexChanged = null, this.show = null, this.load = null, this.validating = null } return e }(); n.prototype.options = t.extend(!0, {}, e.wijmoWidget.prototype.options, new r), t.wijmo.registerWidget("wijwizard", n.prototype) })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; var t = jQuery, n = "wijribbon", r = "wijmo-wijribbon", i = r + "-disabled", s = r + "-bigbutton", o = r + "-panel", u = r + "-groups", a = r + "-group", f = a + "-content", l = a + "-label", c = r + "-dropdown", h = r + "-dropdowngroup", p = r + "-abbrev", d = p + "group", v = r + "-text", m = r + "-icon", g = r + "-abbrevicon", y = function (e) { function n() { e.apply(this, arguments) } return __extends(n, e), n.prototype._create = function () { var e = this; window.wijmoApplyWijTouchUtilEvents && (t = window.wijmoApplyWijTouchUtilEvents(t)), e._ribbonify(), e.element.is(":hidden") && e.element.wijAddVisibilityObserver && e.element.wijAddVisibilityObserver(function () { e.updateRibbonSize(), e.options.disabled && e._setDisabled(!0), e.element.wijRemoveVisibilityObserver && e.element.wijRemoveVisibilityObserver() }, "wijribbon"), e.options.disabled && e._setDisabled(!0) }, n.prototype._setOption = function (e, n) { t.wijmo.widget.prototype._setOption.apply(this, arguments), e === "disabled" && this._setDisabled(n) }, n.prototype._setDisabled = function (e) { var n = this, r = n.element, s = r.offset(), o = s.top, u = s.left, a = t("body"), f = this.options.wijCSS, l = n.disabledModal; r.data("wijmoWijtabs") && r.wijtabs("option", "disabled", e), r.closest(".wijmo-wijeditor").length !== 0 && (o = 0, u = 0, a = r.parent()), e ? (l || (l = t("<div></div>").addClass(f.stateDisabled + " " + i).css({ top: o, left: u, "background-color": "lightgray", position: "absolute" }).appendTo(a).bind("click mousedown mouseup mouseover mouseout focus keydown keypress", function (e) { return e.stopPropagation(), e.preventDefault(), !1 }), n.disabledModal = l), n.disabledModal.width(r.width()).height(r.outerHeight()).show()) : n.disabledModal && n.disabledModal.hide() }, n.prototype._ribbonify = function () { var e = this, n = this.options.wijCSS; e.buttons = {}, e.listUis = {}, e._getButtonSets(), e._createButtons(), e._createGroup(), e._createSplit(), e._createDropdwon(), e._hideShowedList(), e._createTab(), t("." + n.helperReset + ":not(." + u + ", ." + n.tabsNav + ")", e.element).hover(function () { t(this).addClass(n.stateHover) }, function () { t(this).removeClass(n.stateHover) }), t(".ui-button", e.element).bind("mouseenter", function () { t("." + n.buttonText, this).addClass(n.stateHover) }).bind("mouseleave", function () { t("." + n.buttonText, this).removeClass(n.stateHover) }), t("button.ui-button", e.element).bind("mousedown", function () { e._addActiveClassToButtonText(this) }).bind("mouseup", function () { e._addActiveClassToButtonText(this) }) }, n.prototype._addActiveClassToButtonText = function (e) { var n = this.options.wijCSS; e && (t(e).hasClass(n.stateActive) ? t("." + n.buttonText, e).addClass(n.stateActive) : t("." + n.buttonText, e).removeClass(n.stateActive)) }, n.prototype._addActiveClassToLabelButtonText = function (e) { var n = this, r, i, s; e && (i = t(e).attr("for"), r = t("#" + i, n.element), r.is(":checkbox") ? n._addActiveClassToButtonText(e) : r.is(":radio") && (s = n.element.find("[name='" + r.attr("name") + "']"), t.each(s, function () { n._updateGroupElementTextState(this) }))) }, n.prototype._updateGroupElementTextState = function (e) { var n, r = this.options.wijCSS; if (!e) return; n = t("[for='" + t(e).attr("id") + "']", t(e).parent()), n && (n.hasClass(r.stateActive) ? n.children("." + r.buttonText).addClass(r.stateActive) : n.children("." + r.buttonText).removeClass(r.stateActive)) }, n.prototype._getButtonSets = function () { var e = this, n; e.groups = [], e.splits = [], e.dropdowns = [], t("span>button, span>:checkbox, span>:radio, div>button, div>:checkbox, div>:radio", e.element).each(function (r, i) { return n = t(i).parent(), t(">ul", n).length === 0 ? e.groups.push(n) : t(">button", n).length === 2 ? e.splits.push(n) : t(">button", n).length === 1 && e.dropdowns.push(n), this }), e.groups = e._unique(e.groups), e.splits = e._unique(e.splits) }, n.prototype._unique = function (e) { var n = t.makeArray(t.map(e, function (e) { return e.get(0) })); return t.map(t.unique(n), function (e) { return t(e) }) }, n.prototype._createButtons = function () { var e = this, n = e.element; t(":checkbox", n).each(function () { return e._createButton(t(this), "checkbox"), t(this).bind("change", function () { e._addActiveClassToLabelButtonText(t(this).button("widget")[0]) }), this }), t(":radio", n).each(function () { return e._createButton(t(this), "radio"), t(this).bind("change", function () { e._addActiveClassToLabelButtonText(t(this).button("widget")[0]) }), this }), t("button", n).each(function () { return e._createButton(t(this), "button"), this }) }, n.prototype._createButton = function (e, n) { var r = this, i = this.options.wijCSS, s = r._buildButtonOption(e, n), o = e.data("commandName"), u; e.button(s), s.text || (n === "button" ? e.children("." + i.buttonText).text(o) : (u = t("[for='" + e.attr("id") + "']", e.parent()), u && u.children("." + i.buttonText).text(o))), r._triggerEvent(e) }, n.prototype._createGroup = function () { t.each(this.groups, function (e, t) { t.buttonset() }) }, n.prototype._createSplit = function () { var e = this, n = this.options.wijCSS; t.each(e.splits, function (i, s) { var o = s.children("ul"), u = s.children("button:eq(0)"), a = u.data("commandName"), f = s.children("button:eq(1)"), l; o.children("li").addClass(n.cornerAll), s.addClass(r + "-" + a), f.button({ icons: { primary: n.iconArrowDown }, text: !1 }).data("list", o).unbind("click").bind("click", function (e) { e.stopPropagation(), e.preventDefault() }).bind("mouseup", function (n) { o = t(this).data("list"), o.is(":visible") ? (e.showList.hide().css("z-index", ""), e.showList = null) : (o.show().position({ my: "left top", at: "left bottom", of: s }).css("z-index", 9999), e.showList = o), n.stopPropagation(), n.preventDefault() }), f.children("." + n.buttonText).text("foo"), s.after(o), o.css("position", "absolute").addClass(n.helperReset + " " + n.helperClearFix + " " + n.cornerAll + " " + c).hide(), s.buttonset(), l = { ui: u, defaultValue: u.button("option", "label"), buttons: [], type: "split", trigger: f, list: o }, t("button, :checkbox, :radio", o).bind("click", function (t) { o.hide().css("z-index", ""), e.showList = null, t.preventDefault() }), o.find(">li>button,>li>:radio,>li>:checkbox").each(function (n, r) { var i = t(r).data("commandName"); i !== "" && e.buttons[i] && (e.buttons[i].parent = u, e.buttons[i].type = "split"), l.buttons.push(t(r)) }), a !== "" && (e.listUis[a] = l) }) }, n.prototype._createDropdwon = function () { var e = this, n = this.options.wijCSS; e.dropdownLabels = {}, t.each(e.dropdowns, function (i, s) { var o = s.children("ul"), u = s.children("button:eq(0)"), a = u.data("commandName"), f; o.children("li").addClass(n.cornerAll), s.addClass(r + "-" + a), u.button({ icons: { secondary: n.iconArrowDown } }).unbind("click").bind("click", function (e) { e.stopPropagation(), e.preventDefault() }).bind("mouseup", function (t) { o.is(":visible") ? (e.showList.hide().css("z-index", ""), e.showList = null) : (e.showList && (e.showList.hide(), e.showList = null), o.show().position({ my: "left top", at: "left bottom", of: u }).css("z-index", 9999), e.showList = o, e.isShow = !0), t.stopPropagation(), t.preventDefault() }), f = { ui: u, defaultValue: u.button("option", "label"), buttons: [], type: "dropdown", list: o }, t("button, :checkbox, :radio", o).bind("click", function (r) { var i = t(this).data("commandName"), s, a = u.children("." + n.buttonText).width(); e.dropdownLabels[i] || (e.dropdownLabels[i] = e._getDropdownLabelSubstr(t(this).button("option", "label"), u.children("." + n.buttonText), a)), s = e.dropdownLabels[i], u.button("option", "label", s), u.attr("title", t(this).button("option", "label")), o.hide().css("z-index", ""), e.showList = null, r.preventDefault() }), o.css("position", "absolute").addClass(n.helperReset + " " + n.helperClearFix + " " + n.cornerAll + " " + c).hide(), s.buttonset(), o.find(">li>button,>li>:radio,>li>:checkbox").each(function (n, r) { var i = t(r).data("commandName"); i !== "" && e.buttons[i] && (e.buttons[i].parent = u, e.buttons[i].type = "dropdown"), f.buttons.push(t(r)) }), a !== "" && (e.listUis[a] = f) }) }, n.prototype._createTab = function () { var e = this, n = this.options.wijCSS, i = e.element; return i.addClass(r), e.tabEle = i, t(">ul", i).length > 0 ? (i.wijtabs(), e._createRibbonGroups(), !0) : (i.addClass(r + "-simple").addClass(n.stateDefault).addClass(n.helperClearFix), !1) }, n.prototype.updateRibbonSize = function () { var e = this, n, i = this.options.wijCSS, s; e.tabEle.children("div").each(function (o, u) { var a = t(u), f = a.is(":visible"), l = a.find(">ul>li"), c = [], p; return p = a.width(), f || (a.removeClass(i.wijtabsHide), p = a.width()), l.each(function (e, i) { var o = t(i), u = o.find(">div:last"), a = u.attr("displayname") ? u.attr("displayname") : t.trim(u.text()); return n = o.children("." + h), s = o.children("." + d), n && (o.addClass(r + "-" + a.toLowerCase()).prepend(n.children()), n.remove(), s && s.remove()), c.push({ width: o.outerWidth(!0), text: a }), this }), e._adjustRibbonGroupIfNeeded(l, c, p), f || a.addClass(i.wijtabsHide), this }), e.options.disabled && e._setDisabled(!0) }, n.prototype._createRibbonGroups = function () { var e = this, n = this.options.wijCSS; e.tabEle.children("div").each(function (i, s) { var c = t(s), h = c.is(":visible"), p = c.find(">ul>li"), d = [], v; if (c.data("destroy.tabs")) { c.remove(); return } return h || c.removeClass(n.wijtabsHide), v = c.width(), c.addClass(o), c.find(">ul").addClass(n.helperReset + " " + n.helperClearFix + " " + n.content + " " + n.cornerAll + " " + u), p.each(function (e, i) { var s = t(i), o = s.find(">div:last"), u = n.stateDefault + " " + a, c = o.attr("displayname") ? o.attr("displayname") : t.trim(o.text()); return o && (u += " " + r + "-" + c.toLowerCase()), s.addClass(u), o.addClass(l).bind("click", function () { return !1 }), s.wrapInner("<div class = '" + f + "'></div>"), s.children().bind("mouseover", function () { t(this).addClass(n.stateHover) }).bind("mouseout", function () { t(this).removeClass(n.stateHover) }), o.appendTo(s), d.push({ width: s.outerWidth(!0), text: c }), this }), e._originalGroupInfo = d, e._adjustRibbonGroupIfNeeded(p, d, v), h || c.addClass(n.wijtabsHide), this }) }, n.prototype._adjustRibbonGroupIfNeeded = function (e, n, i) { var s = this, o = e.length - 1, u = 0, a = 0, f = 0, l, c, p; for (; o >= 0; o--) { f = 0; for (u = 0; u < o; u++) f += n[u].width; f + a + n[o].width <= i ? (l = t(e[o]).children("." + h), c = t(e[o]).children("." + d), l && (t(e[o]).addClass(r + "-" + n[o].text.toLowerCase()).prepend(l.children()), l.remove(), c && c.remove())) : (p = n[o], a += s._createDropDownRibbonGroup(p.text, e[o])) } }, n.prototype._createDropDownRibbonGroup = function (e, n) { var i = this, s = r + "-" + e.toLowerCase(), o = this.options.wijCSS, u = t(n).removeClass(s), f = u.find(">div:last").text() || e, l; return u.wrapInner("<div class='" + h + " " + a + "'></div>").children().hide().addClass(s).bind("mouseup." + i.widget, function (e) { i.showDrpDwnGroup !== null && (i.showDrpDwnGroup.hide().css("z-index", ""), i.showDrpDwnGroup = null) }), l = t("<div class='" + d + "'>" + "<span class='" + p + e.toLowerCase() + " " + m + " " + g + "'></span>" + "<span class='" + v + "'>" + f + "</span>" + "<span class='" + o.icon + " " + o.iconArrowDown + " " + m + "'></span></div>").appendTo(u).unbind(i.widget).bind("mouseover." + i.widget, function (e) { t(this).addClass(o.stateHover) }).bind("mouseout." + i.widget, function (e) { t(this).removeClass(o.stateHover) }).bind("click." + i.widget, function (e) { var n = t(this).siblings("." + h); n.is(":visible") ? (n.hide().css("z-index", ""), i.showDrpDwnGroup = null) : (i.showDrpDwnGroup && i.showDrpDwnGroup.hide().css("z-index", ""), n.show().position({ my: "left top", at: "left bottom", of: this }).css("z-index", "10000"), i.showDrpDwnGroup = n, e.stopPropagation()) }), u.outerWidth(!0) }, n.prototype._hideShowedList = function () { var e = this; t(document).bind("mouseup", function (n) { var r = n.target; e.showList && (t(r).is(document) || !t.contains(e.showList.get(0), r)) && (e.showList.hide().css("z-index", ""), e.showList = null), e.showDrpDwnGroup && (t(r).is(document) || !t.contains(e.showDrpDwnGroup.get(0), r)) && (e.showDrpDwnGroup.hide().css("z-index", ""), e.showDrpDwnGroup = null) }) }, n.prototype._buildButtonOption = function (e, n) { var r = !0, i = this, o = e.attr("class"), u, a, f, l, c, h, p; if (o && o !== "" && o !== s) a = o.split(" ")[0], e.removeClass(a), c = t.trim(e.text()), c === "" && (r = !1); else { if (n === "checkbox" || n === "radio") { if (t.trim(e.attr("id")) === "") return; h = t("[for='" + e.attr("id") + "']", e.parent()); if (!h.is("label")) return; o = h.attr("class"), o && o !== "" && o !== s ? (a = o.split(" ")[0], h.removeClass(a), c = t.trim(h.text()), c === "" && (r = !1)) : u = h.children("span,div") } else n === "button" && (u = e.children("span,div")); u && (u.length === 1 ? u.eq(0).attr("class") !== "" && (f = u.eq(0), a = f.attr("class"), r = !1) : u.length === 2 ? u.eq(0).attr("class") && (f = u.eq(0), a = f.attr("class"), f.is("span") ? l = "left" : f.is("div") && (l = "top"), c = u.eq(1).text()) : n === "button" && t.trim(e.text()) !== "" && (c = t.trim(e.text()))) } return n === "button" ? (e.empty(), p = t.trim(e.attr("name")), p !== "" && e.removeAttr("name")) : (p = t.trim(h.attr("name")), p !== "" && h.removeAttr("name")), p !== "" && (e.data("commandName", p), i.buttons[p] = { button: e }), { label: c, icons: { primary: a }, position: l, text: r } }, n.prototype._triggerEvent = function (e) { var t = this; e.bind("click", function (n) { if (t.options.disabled) { n.preventDefault(), n.stopPropagation(); return } var r = e.data("commandName"), i = t.buttons[r], s = { name: undefined, commandName: undefined }; i && i.parent && (s.name = i.parent.data("commandName")), s.commandName = r, t._trigger("click", n, s), e.is("button") && (n.preventDefault(), n.stopPropagation()) }) }, n.prototype._getDropdownLabelSubstr = function (e, n, r) { var i = this, s = e.length, o = 0, u = s, a = Math.floor((o + u) / 2), f = t("<span></span>"), l = e.substr(0, a), c; f.appendTo(n.parent()), c = i._calculateWidth(l, f); while (c !== r && u > o) l = e.substr(0, a + 1), c = i._calculateWidth(l, f), c > r ? u = a - 1 : c < r && (o = a + 1), a = Math.floor((o + u) / 2); return f.remove(), l }, n.prototype._calculateWidth = function (e, t) { return t.text(e), t.width() }, n.prototype.hideDropdown = function (e) { var t = this, n = t.listUis[e]; n && n.list && n.list.hide() }, n.prototype.destroy = function () { this.disabledModal && this.disabledModal.remove(), t.Widget.prototype.destroy.call(this) }, n.prototype.getDropdownList = function (e) { var n = this, r = n.listUis[e], i = {}; return r && t.each(r.buttons, function (e, t) { i[t.data("commandName")] = t.button("option", "label") }), i }, n.prototype.setButtonDisabled = function (e, n) { var r = this.buttons[e], i = this.options.wijCSS, s = !1, o, u; r && r.button && (o = r.button, s = o.is("button"), o.button("option", "disabled", n), s ? e !== "save" && o.children("." + i.buttonText).text(e) : t("[for='" + o.attr("id") + "']", o.parent()).children("." + i.buttonText).text(e), u = this.listUis[e], u && u.type === "split" && (u.trigger.button("option", "disabled", n), u.trigger.children("." + i.buttonText).text(e))) }, n.prototype.setButtonsDisabled = function (e) { var n = this; t.each(e, function (e, t) { n.setButtonDisabled(e, t) }) }, n.prototype.setButtonsChecked = function (e) { var n = this; t.each(e, function (e, r) { t.isPlainObject(r) ? n.setButtonChecked(e, r.checked, r.name) : n.setButtonChecked(e, r, null) }) }, n.prototype.setButtonChecked = function (e, n, r) { var i = this, s, o = i.buttons[e], u = this.options.wijCSS, a, f, l; o && o.button ? (a = o.button, a.is("button") ? n ? a.addClass(u.stateActive) : a.removeClass(u.stateActive) : (a.prop("checked", n), a.button("refresh")), o.parent ? o.type === "dropdown" && n && (i.dropdownLabels[e] || (i.dropdownLabels[e] = i._getDropdownLabelSubstr(a.button("option", "label"), o.parent.children("." + u.buttonText), o.parent.children("." + u.buttonText).width())), l = i.dropdownLabels[e], o.parent.button("option", "label", l), o.parent.attr("title", a.button("option", "label")), s = t(":radio", o.button.closest("ul")), s && t.each(s, function () { i._updateGroupElementTextState(this) })) : i._addActiveClassToButtonText(a.button("widget"))) : r && (f = i.listUis[r], f && (f.ui.button("option", "label", f.defaultValue), f.buttons && t.each(f.buttons, function (e, t) { t.prop("checked", !1), t.button("refresh"), i._addActiveClassToButtonText(t.button("widget")) }))) }, n }(e.wijmoWidget); e.wijribbon = y; var b = function () { function e() { this.initSelector = ":jqmData(role='wijribbon')", this.wijCSS = { wijtabsHide: "wijmo-wijtabs-hide" }, this.click = null } return e }(); y.prototype.options = t.extend(!0, {}, e.wijmoWidget.prototype.options, new b), t.wijmo.registerWidget("wijribbon", y.prototype) })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; var t = jQuery, n = "wijeditor", r = alert, i = window, s = document, o = parseInt, u, a, f, l = [], c = null, h = !0, p = !0, d = 0, v = [], m = null, g = null, y = "setButtonDisabled", b = "setButtonsDisabled", w = "setButtonChecked", E = "setButtonsChecked", S = "form", x = "imagebutton", T = "textarea", N = "button", C = "textbox", k = "list", L = "passwordfield", A = "dropdownlist", O = "hiddenfield", M = "radio", _ = "checkbox", D = "insertcol", P = "insertrow", H = "insertcell", B = "splitcell", j = "mergecell", F = "deletecol", I = "deleterow", q = "deletecell", R = "justifyleft", U = "justifycenter", z = "justifyright", W = "justifyfull", X = "borders", V = "insertorderedlist", $ = "insertunorderedlist", J = "outdent", K = "indent", Q = "backcolor", G = "fontcolor", Y = "bold", Z = "italic", et = "strikethrough", tt = "underline", nt = "subscript", rt = "superscript", it = "template", st = "removeformat", ot = "insertbreak", ut = "insertparagraph", at = "insertprintpagebreak", ft = "inserthorizontalrule", lt = "tablebutton", ct = "inserttable", ht = "edittable", pt = "wysiwyg", dt = "split", vt = "code", mt = "wordwrap", gt = "fullscreen", yt = "undo", bt = "redo", wt = "preview", Et = "cleanup", St = "cut", xt = "copy", Tt = "paste", Nt = "selectall", Ct = "media", kt = "specialchar", Lt = "datetime", At = "find", Ot = "inspect", Mt = "save", _t = "spelling", Dt = "imagebrowser", Pt = "link", Ht = "xx-small", Bt = "x-small", jt = "small", Ft = "medium", It = "large", qt = "x-large", Rt = "xx-large", Ut = "fontname", zt = "fontsize", Wt = "blockquote", Xt = "insertcode", Vt = "wijmo-wijribbon", $t = Vt + "-bigbutton", Jt = Vt + "-dropdownbutton", Kt = Vt + "-splitbutton", Qt = Vt + "-list", Gt = Vt + "-save", Yt = Vt + "-save16", Zt = Vt + "-undo", en = Vt + "-redo", tn = Vt + "-preview", nn = Vt + "-cleanup", rn = Vt + "-cut", sn = Vt + "-copy", on = Vt + "-paste", un = Vt + "-selectall", an = Vt + "-bgcolor", fn = Vt + "-color", ln = Vt + "-bold", cn = Vt + "-italic", hn = Vt + "-underline", pn = Vt + "-strike", dn = Vt + "-sub", vn = Vt + "-sup", mn = Vt + "-template", gn = Vt + "-removeformat", yn = Vt + "-justifyleft", bn = Vt + "-justifycenter", wn = Vt + "-justifyright", En = Vt + "-justifyfull", Sn = Vt + "-borders", xn = Vt + "-orderlist", Tn = Vt + "-unorderlist", Nn = Vt + "-outdent", Cn = Vt + "-indent", kn = Vt + "-inspect", Ln = Vt + "-find", An = Vt + "-table", On = Vt + "-inserttable", Mn = Vt + "-edittable", _n = Vt + "-insertcol", Dn = Vt + "-insertrow", Pn = Vt + "-insertcell", Hn = Vt + "-splitcell", Bn = Vt + "-mergecell", jn = Vt + "-deletecol", Fn = Vt + "-deleterow", In = Vt + "-deletecell", qn = Vt + "-insertbreak", Rn = Vt + "-insertparagraph", Un = Vt + "-insertprintpagebreak", zn = Vt + "-inserthr", Wn = Vt + "-form", Xn = Vt + "-textarea", Vn = Vt + "-textbox", $n = Vt + "-password", Jn = Vt + "-hiddenfield", Kn = Vt + "-imagebutton", Qn = Vt + "-button", Gn = Vt + "-listbox", Yn = Vt + "-dropdownlist", Zn = Vt + "-radio", er = Vt + "-checkbox", tr = Vt + "-link", nr = Vt + "-link16", rr = Vt + "-imagebrowser", ir = Vt + "-media", sr = Vt + "-specialchar", or = Vt + "-datetime", ur = Vt + "-blockquote", ar = Vt + "-insertcode", fr = Vt + "-modes", lr = Vt + "-designview", cr = Vt + "-sourceview", hr = Vt + "-splitview", pr = Vt + "-wordwrap", dr = Vt + "-fullscreen", vr = "wijmo-wijeditor", mr = vr + "-container", gr = vr + "-header", yr = vr + "-content", br = vr + "-footer", wr = vr + "-pathselector", Er = vr + "-fullscreen", Sr = vr + "-dialog", xr = Sr + "-hr", Tr = Sr + "-buttons", Nr = Sr + "-button", Cr = Sr + "-text", kr = vr + "-imagedlg", Lr = kr + "-content", Ar = kr + "-fields", Or = kr + "-imagefield", Mr = kr + "-imagelist", _r = kr + "-preview", Dr = kr + "-imagesrc", Pr = kr + "-imagealt", Hr = kr + "-imagewidth", Br = kr + "-imageheight", jr = kr + "-css", Fr = kr + "-hideimagelist", Ir = vr + "-templatedlg", qr = Ir + "-toplabels", Rr = Ir + "-topleftlabel", Ur = Ir + "-toprightlabel", zr = Ir + "-content", Wr = Ir + "-templatelist", Xr = Ir + "-preview", Vr = Ir + "-templateinfo", $r = Ir + "-nameinfo", Jr = Ir + "-descriptioninfo", Kr = Ir + "-fields", Qr = Ir + "-name", Gr = Ir + "-description", Yr = Ir + "-buttons", Zr = Ir + "-delete", ei = Ir + "-save", ti = vr + "-linkdlg", ni = ti + "-address", ri = ti + "-linktype", ii = ti + "-anchor", si = ti + "-text", oi = ti + "-target", ui = ti + "-css", ai = ti + "-src", fi = ti + "-width", li = ti + "-height", ci = ti + "-imagecontainer", hi = ti + "-linkicontype", pi = vr + "-codedlg", di = pi + "-source", vi = pi + "-sourcelabel", mi = vr + "-taginsdlg", gi = mi + "-caption", yi = mi + "-taglabel", bi = mi + "-tagtext", wi = mi + "-filterempty", Ei = mi + "-attribs", Si = mi + "-attriblist", xi = mi + "-innerhtml", Ti = mi + "-css", Ni = vr + "-colordlg", Ci = Ni + "-picker", ki = Ni + "-color", Li = vr + "-tabledlg", Ai = Li + "-rows", Oi = Li + "-columns", Mi = Li + "-width", _i = Li + "-height", Di = Li + "-border", Pi = Li + "-cellpadding", Hi = Li + "-cellspacing", Bi = Li + "-csstext", ji = Li + "-bgcolor", Fi = vr + "-previewdlg", Ii = Fi + "-caption", qi = Fi + "-navigator", Ri = Fi + "-prev", Ui = Fi + "-next", zi = Fi + "-printall", Wi = Fi + "-printone", Xi = Fi + "-ok", Vi = Fi + "-printdocument", $i = Fi + "-previewiframe", Ji = vr + "-cleanupdlg", Ki = Ji + "-caption", Qi = Ji + "-document", Gi = Ji + "-actions", Yi = vr + "-finddlg", Zi = Yi + "-find", es = Yi + "-replace", ts = vr + "-mediadlg", ns = ts + "-type", rs = ts + "-src", is = ts + "-width", ss = ts + "-height", os = vr + "-specialchardlg", us = os + "-chars", as = os + "-preview", fs = os + "-content", ls = os + "-list", cs = os + "_label", hs = os + "-punctuation", ps = os + "-symbols", ds = os + "-diacritics", vs = "wijmo-formatspan", ms = "." + Tr + " input:first", gs = "." + Tr + " input:last", ys = "." + Tr + " input[value='OK']", bs = "." + Tr + " input[engValue='Cancel']", ws = ["Bold", "Italic", "UnderLine", "StrikeThrough", "SubScript", "SuperScript", "JustifyLeft", "JustifyCenter", "JustifyRight", "JustifyFull", "Border", "NumberedList", "BulletedList", "Outdent", "Indent"], Es = ["Bold", "Italic", "Link", "BlockQuote", "StrikeThrough", "InsertDate", "InsertImage", "NumberedList", "BulletedList", "InsertCode"], Ss = ["Bold", "Italic", "StrikeThrough", "UnderLine", "ForeColor", "FontSize", "Link", "InsertImage", "NumberedList", "BulletedList", "BlockQuote"], xs = { Form: { name: "form", tip: "Form", css: Wn }, Image: { name: "imagebutton", tip: "Image Button", css: Kn }, TextArea: { name: "textarea", tip: "TextArea", css: Xn }, Button: { name: "button", tip: "Button", css: Qn }, TextBox: { name: "textbox", tip: "TextBox", css: Vn }, List: { name: "list", tip: "ListBox", css: Gn }, PasswordField: { name: "passwordfield", tip: "Password Field", css: $n }, DropDownList: { name: "dropdownlist", tip: "DropDownList", css: Yn }, HiddenField: { name: "hiddenfield", tip: "Hidden Field", css: Jn }, Radio: { name: "radio", tip: "RadioButton", css: Zn }, CheckBox: { name: "checkbox", tip: "CheckBox", css: er }, InsertColumn: { name: "insertcol", tip: "Insert Column", css: _n }, InsertRow: { name: "insertrow", tip: "Insert Row", css: Dn }, InsertCell: { name: "insertcell", tip: "Insert Cell", css: Pn }, SplitCell: { name: "splitcell", tip: "Split Cell", css: Hn }, MergeCell: { name: "mergecell", tip: "Merge Cell", css: Bn }, DeleteColumn: { name: "deletecol", tip: "Delete Column", css: jn }, DeleteRow: { name: "deleterow", tip: "Delete Row", css: Fn }, DeleteCell: { name: "deletecell", tip: "Delete Cell", css: In }, JustifyLeft: { name: "justifyleft", tip: "Justify Left", css: yn, grpname: "alignment" }, JustifyCenter: { name: "justifycenter", tip: "Justify Center", css: bn, grpname: "alignment" }, JustifyRight: { name: "justifyright", tip: "Justify Right", css: wn, grpname: "alignment" }, JustifyFull: { name: "justifyfull", tip: "Justify Full", css: En, grpname: "alignment" }, Border: { name: "borders", tip: "Border", css: Sn }, NumberedList: { name: "insertorderedlist", tip: "Numbered List", css: xn, grpname: "list" }, BulletedList: { name: "insertunorderedlist", tip: "Bulleted List", css: Tn, grpname: "list" }, Outdent: { name: "outdent", tip: "Outdent", css: Nn, grpname: "block" }, Indent: { name: "indent", tip: "Indent", css: Cn, grpname: "block" }, BackColor: { name: "backcolor", tip: "Background Color", css: an }, ForeColor: { name: "fontcolor", tip: "Font Color", css: fn }, Bold: { name: "bold", tip: "Bold", css: ln }, Italic: { name: "italic", tip: "Italic", css: cn }, StrikeThrough: { name: "strikethrough", tip: "Strikethrough", css: pn }, UnderLine: { name: "underline", tip: "Underline", css: hn }, SubScript: { name: "subscript", tip: "Subscript", css: dn }, SuperScript: { name: "superscript", tip: "Superscript", css: vn }, Template: { name: "template", tip: "Template", css: mn }, RemoveFormat: { name: "removeformat", tip: "RemoveFormat", css: gn }, InsertBreak: { name: "insertbreak", tip: "Insert Break", css: qn }, InsertParagraph: { name: "insertparagraph", tip: "Insert Paragraph", css: Rn }, InsertPrint: { name: "insertprintpagebreak", tip: "Insert Print Page Break", css: Un }, InsertHR: { name: "inserthorizontalrule", tip: "Insert Horizontal Line", css: zn }, Table: { name: "tablebutton", tip: "Table", css: An }, InsertTable: { name: "inserttable", tip: "Insert Table", css: On }, EditTable: { name: "edittable", tip: "Edit Table", css: Mn }, Wysiwyg: { name: "wysiwyg", tip: "Design View", css: lr, grpname: "modes" }, Split: { name: "split", tip: "Split View", css: hr, grpname: "modes" }, Code: { name: "code", tip: "Source View", css: cr, grpname: "modes" }, Wordwrap: { name: "wordwrap", tip: "Wordwrap", css: pr }, FullScreen: { name: "fullscreen", tip: "Fullscreen", css: dr }, Undo: { name: "undo", tip: "Undo", css: Zt }, Redo: { name: "redo", tip: "Redo", css: en }, Preview: { name: "preview", tip: "Preview", css: tn }, Cleanup: { name: "cleanup", tip: "Clean up", css: nn }, Cut: { name: "cut", tip: "Cut", css: rn }, Copy: { name: "copy", tip: "Copy", css: sn }, Paste: { name: "paste", tip: "Paste", css: on }, SelectAll: { name: "selectall", tip: "Select All", css: un }, Media: { name: "media", tip: "Media", css: ir }, InsertSpecialChar: { name: "specialchar", tip: "Insert Special Character", css: sr }, InsertDate: { name: "datetime", tip: "Insert Date Time", css: or }, Find: { name: "find", tip: "Find And Replace", css: Ln, text: "Find" }, Inspect: { name: "inspect", tip: "Tag Inspect", css: kn, text: "Inspect" }, Save: { name: "save", tip: "Save", css: Gt, text: "Save" }, Spelling: { name: "spelling", tip: "Form", css: "" }, InsertImage: { name: "imagebrowser", tip: "Image Browser", css: rr }, Link: { name: "link", tip: "Link", css: tr, text: "Link" }, FontName: { name: "fontname", tip: "Font Name", css: Jt }, FontSize: { name: "fontsize", tip: "Font Size", css: Jt }, BlockQuote: { name: "blockquote", tip: "Block Quote", css: ur }, InsertCode: { name: "insertcode", tip: "Insert Code", css: ar } }, Ts = function () { var e = this, t = []; e.append = function (e) { t.push(e) }, e.toString = function () { return t.join("") }, e.dispose = function () { t = null } }, Ns = function (e) { this.text = e, this.render = function () { return this.text } }, Cs = function (e, n, r) { var i = this, s = { br: !0, img: !0, hr: !0, input: !0 }; i.tagName = e || "div", i.attributes = r || {}, i.innerText = n || "", i.children = [], t.isPlainObject(n) && (i.innerText = "", i.attributes = n), i._isShortTag = !1, s[i.tagName] === !0 && (i._isShortTag = !0), i.render = function () { var e = new Ts, n = ""; return e.append(i._renderBeginTag(i.tagName, i.attributes)), i.innerText !== "" && e.append(i.innerText), i.children.length > 0 && t.each(i.children, function (t, n) { e.append(n.render()) }), e.append(i._renderEndTag(i.tagName)), n = e.toString(), e.dispose(), n }, i.add = function (e) { this.children.push(e) }, i._renderBeginTag = function (e, n) { var r = new Ts, i = ""; return r.append("<"), r.append(e), t.each(n, function (e, t) { r.append(" "), r.append(e), r.append("="), r.append('"'), r.append(t ? t.toString() : ""), r.append('"') }), this._isShortTag ? r.append(" ") : r.append(">"), i = r.toString(), r.dispose(), i }, i._renderEndTag = function (e) { var t = new Ts, n = ""; return this._isShortTag ? t.append("/>") : (t.append("</"), t.append(e), t.append(">")), n = t.toString(), t.dispose(), n } }, ks = function (e) { function n() { e.apply(this, arguments) } return __extends(n, e), n.prototype.wijeditor = function () { this._curPageIdx = 0, this.tRange = null, this.txtFoundInIE = !1, this.txtFoundInNoneIE = !1 }, n.prototype._create = function () { var e = this; window.wijmoApplyWijTouchUtilEvents && (t = window.wijmoApplyWijTouchUtilEvents(t)); if (e.element.is("input")) return; e.id_prefix = "wijeditor-" + e.element.attr("id") + "-", e.$ribbon = undefined, e.$modes = undefined, e._editorify(), e._initElements(), i.setTimeout(function () { e.options.disabled && e._handleDisabledOption(!0, e.editor) }, 40), e._continueSavingInputTextForUndo = !1, e.element.is(":hidden") && e.element.wijAddVisibilityObserver && e.element.wijAddVisibilityObserver(function (n) { if (t.contains(e.editor[0], n.target)) return; e.refresh(), e.element.wijRemoveVisibilityObserver && e.element.wijRemoveVisibilityObserver() }, "wijeditor") }, n.prototype._contextMenuWidgetName = function () { return "wijmenu" }, n.prototype._createBigButton = function (e, t, n, r) { var i = this, s = i._createElement("button", { title: e, name: n, "class": $t }); return s.add(i._createDiv(t)), s.add(i._createSpan("", r)), s }, n.prototype._createTextButton = function (e, t, n) { return this._createElement("button", n, { title: e, name: t }) }, n.prototype._createButton = function (e, t, n, r) { var i = this, s; return r ? (s = i._createElement("button", { title: e, name: n }), s.add(i._createSpan(t)), s.add(i._createSpan("", r)), s) : i._createElement("button", { title: e, name: n, "class": t }) }, n.prototype._createTextRadioButton = function (e, t, n, r, i) { var s = this, o = []; return o.push(s._createElement("input", { id: t + n, type: "radio", name: r })), o.push(s._createElement("label", i, { "for": t + n, title: e, name: n })), o }, n.prototype._createImageRadioButton = function (e, t, n, r, i) { var s = this, o = []; return o.push(s._createElement("input", { id: t + r, type: "radio", name: i })), o.push(s._createElement("label", { "for": t + r, title: e, name: r, "class": n })), o }, n.prototype._createImageCheckButton = function (e, t, n, r) { var i = this, s = []; return s.push(i._createElement("input", { id: t + r, type: "checkbox" })), s.push(i._createElement("label", { "for": t + r, title: e, name: r, "class": n })), s }, n.prototype._createRibbonList = function () { return this._createSpan(Qt) }, n.prototype._createDropdownButton = function (e, n, r, i, s) { var o = this, u = o._createElement("div", { title: e, "class": Jt }), a = o._createElement("ul"); return u.add(o._createTextButton(e, n, r)), u.add(a), t.each(i, function (e, r) { var i = o._createElement("li"), u = o._createTextRadioButton(r.tip, s, r.name, n, r.text); t.each(u, function (e, t) { i.add(t) }), a.add(i) }), u }, n.prototype._createSplitButton = function (e, n, r, i, s) { var o = this, u = o._createElement("div", { title: e, "class": Kt }), a = o._createElement("ul"); return u.add(o._createBigButton(e, n, r, i)), u.add(o._createElement("button", { "class": $t })), u.add(a), t.each(s, function (e, t) { var n = o._createElement("li"); n.add(o._createButton(t.tip, t.css, t.name, t.text)), a.add(n) }), u }, n.prototype._createButtonByCommand = function (e) { var t = this, n, r = xs[e], i; if (!r) return; i = r.name; switch (i) { case Wt: case S: case x: case T: case N: case C: case k: case L: case A: case O: case M: case _: case D: case P: case H: case B: case j: case F: case I: case q: case st: case ot: case ut: case at: case gt: case yt: case bt: case St: case xt: case Tt: case Lt: case mt: case Q: case G: case wt: case Et: case Ct: case kt: case it: case Dt: case Xt: case ft: case Nt: n = t._createButton(r.tip, r.css, i); break; case At: case Ot: n = t._createButton(r.tip, r.css, i, r.text); break; case X: case nt: case rt: case Y: case Z: case tt: case et: n = t._createImageCheckButton(r.tip, t.id_prefix, r.css, i); break; case pt: case dt: case vt: case R: case U: case z: case W: case J: case K: case V: case $: n = t._createImageRadioButton(r.tip, t.id_prefix, r.css, i, r.grpname); break; case lt: n = t._createSplitButton("Table", An, lt, "Table", [{ tip: "Insert Table", css: On, name: ct, text: "Insert" }, { tip: "Edit Table", css: Mn, name: ht, text: "Edit" }]); break; case Mt: t.options.mode === "ribbon" ? n = t._createBigButton(r.tip, r.css, i, r.text) : n = t._createButton(r.tip, Yt, i); break; case Pt: t.options.mode === "ribbon" ? n = t._createBigButton(r.tip, r.css, i, r.text) : n = t._createButton(r.tip, nr, i); break; case Ut: n = t._createDropdownButton("Font Name", Ut, "Font Name", [{ tip: "Arial", name: "fn1", text: "Arial" }, { tip: "Courier New", name: "fn2", text: "Courier New" }, { tip: "Garamond", name: "fn3", text: "Garamond" }, { tip: "Tahoma", name: "fn4", text: "Tahoma" }, { tip: "Times New Roman", name: "fn5", text: "Times New Roman" }, { tip: "Verdana", name: "fn6", text: "Verdana" }, { tip: "Wingdings", name: "fn7", text: "Wingdings" }], t.id_prefix); break; case zt: n = t._createDropdownButton("Font Size", zt, "Font Size", [{ tip: "VerySmall", name: "xx-small", text: "VerySmall" }, { tip: "Smaller", name: "x-small", text: "Smaller" }, { tip: "Small", name: "small", text: "Small" }, { tip: "Medium", name: "medium", text: "Medium" }, { tip: "Large", name: "large", text: "Large" }, { tip: "Larger", name: "x-large", text: "Larger" }, { tip: "VeryLarge", name: "xx-large", text: "VeryLarge" }], t.id_prefix); break; case _t: } return n }, n.prototype._createActionGroup = function () { var e = this, t = e._createElement("li"), n = e._createRibbonList(); return t.add(e._createButtonByCommand("Save")), t.add(n), n.add(e._createButtonByCommand("Undo")), n.add(e._createButtonByCommand("Redo")), n = e._createRibbonList(), t.add(n), n.add(e._createButtonByCommand("Preview")), n.add(e._createButtonByCommand("Cleanup")), n = e._createRibbonList(), t.add(n), n.add(e._createButtonByCommand("Cut")), n.add(e._createButtonByCommand("Copy")), n.add(e._createButtonByCommand("Paste")), n.add(e._createButtonByCommand("SelectAll")), t.add(e._createElement("div", "Actions")), t }, n.prototype._createFontGroup = function () { var e = this, n = e._createElement("li"), r = e._createRibbonList(); return n.add(e._createButtonByCommand("FontName")), n.add(e._createButtonByCommand("FontSize")), n.add(r), r.add(e._createButtonByCommand("BackColor")), r.add(e._createButtonByCommand("ForeColor")), r = e._createRibbonList(), n.add(r), t.each(e._createButtonByCommand("Bold"), function (e, t) { r.add(t) }), t.each(e._createButtonByCommand("Italic"), function (e, t) { r.add(t) }), t.each(e._createButtonByCommand("UnderLine"), function (e, t) { r.add(t) }), t.each(e._createButtonByCommand("StrikeThrough"), function (e, t) { r.add(t) }), t.each(e._createButtonByCommand("SubScript"), function (e, t) { r.add(t) }), t.each(e._createButtonByCommand("SuperScript"), function (e, t) { r.add(t) }), r = e._createRibbonList(), n.add(r), r.add(e._createButtonByCommand("Template")), r = e._createRibbonList(), n.add(r), r.add(e._createButtonByCommand("RemoveFormat")), n.add(e._createElement("div", "Font")), n }, n.prototype._createParaGroup = function () { var e = this, n = e._createElement("li"), r = e._createRibbonList(); return n.add(r), t.each(e._createButtonByCommand("JustifyLeft"), function (e, t) { r.add(t) }), t.each(e._createButtonByCommand("JustifyCenter"), function (e, t) { r.add(t) }), t.each(e._createButtonByCommand("JustifyRight"), function (e, t) { r.add(t) }), t.each(e._createButtonByCommand("JustifyFull"), function (e, t) { r.add(t) }), r = e._createRibbonList(), n.add(r), t.each(e._createButtonByCommand("Border"), function (e, t) { r.add(t) }), r = e._createRibbonList(), n.add(r), t.each(e._createButtonByCommand("NumberedList"), function (e, t) { r.add(t) }), t.each(e._createButtonByCommand("BulletedList"), function (e, t) { r.add(t) }), r = e._createRibbonList(), n.add(r), t.each(e._createButtonByCommand("Outdent"), function (e, t) { r.add(t) }), t.each(e._createButtonByCommand("Indent"), function (e, t) { r.add(t) }), n.add(e._createElement("div", "Paragraph")), n }, n.prototype._createReviewGroup = function () { var e = this, t = e._createElement("li"); return t.add(e._createButtonByCommand("Inspect")), t.add(e._createButtonByCommand("Find")), t.add(e._createElement("div", "Review")), t }, n.prototype._createTablesGroup = function () { var e = this, t = e._createElement("li"), n = e._createRibbonList(); return t.add(e._createButtonByCommand("Table")), t.add(n), n.add(e._createButtonByCommand("InsertColumn")), n.add(e._createButtonByCommand("InsertRow")), n.add(e._createButtonByCommand("InsertCell")), n = e._createRibbonList(), t.add(n), n.add(e._createButtonByCommand("SplitCell")), n.add(e._createButtonByCommand("MergeCell")), n = e._createRibbonList(), t.add(n), n.add(e._createButtonByCommand("DeleteColumn")), n.add(e._createButtonByCommand("DeleteRow")), n.add(e._createButtonByCommand("DeleteCell")), t.add(e._createElement("div", "Tables")), t }, n.prototype._createBreaksGroup = function () { var e = this, t = e._createElement("li"); return t.add(e._createButtonByCommand("InsertBreak")), t.add(e._createButtonByCommand("InsertParagraph")), t.add(e._createButtonByCommand("InsertPrint")), t.add(e._createButtonByCommand("InsertHR")), t.add(e._createElement("div", "Breaks")), t }, n.prototype._createFormsGroup = function () { var e = this, t = e._createElement("li"), n = e._createRibbonList(); return t.add(n), n.add(e._createButtonByCommand("Form")), n = e._createRibbonList(), t.add(n), n.add(e._createButtonByCommand("TextArea")), n.add(e._createButtonByCommand("TextBox")), n.add(e._createButtonByCommand("PasswordField")), n.add(e._createButtonByCommand("HiddenField")), n = e._createRibbonList(), t.add(n), n.add(e._createButtonByCommand("Image")), n.add(e._createButtonByCommand("Button")), n = e._createRibbonList(), t.add(n), n.add(e._createButtonByCommand("List")), n.add(e._createButtonByCommand("DropDownList")), n.add(e._createButtonByCommand("Radio")), n.add(e._createButtonByCommand("CheckBox")), t.add(e._createElement("div", "Forms")), t }, n.prototype._createSpecialGroup = function () { var e = this, t = e._createElement("li"); return t.add(e._createButtonByCommand("Link")), t.add(e._createButtonByCommand("InsertImage")), t.add(e._createButtonByCommand("Media")), t.add(e._createButtonByCommand("InsertSpecialChar")), t.add(e._createButtonByCommand("InsertDate")), t.add(e._createElement("div", "Special")), t }, n.prototype._getDefaultRibbonMarkup = function () { var e = this, t = e._createElement("div"), n = e._createElement("ul"), r = e._createElement("li"), i = e._createElement("li"), s = e._createElement("div", { id: e.id_prefix + "format" }), o = e._createElement("div", { id: e.id_prefix + "insert" }), u = e._createElement("ul"), a = e._createElement("ul"); return t.add(n), t.add(s), t.add(o), n.add(r), n.add(i), r.add(e._createElement("a", "Format", { href: "#" + e.id_prefix + "format" })), i.add(e._createElement("a", "Insert", { href: "#" + e.id_prefix + "insert" })), s.add(u), u.add(e._createActionGroup()), u.add(e._createFontGroup()), u.add(e._createParaGroup()), u.add(e._createReviewGroup()), o.add(a), a.add(e._createTablesGroup()), a.add(e._createBreaksGroup()), a.add(e._createFormsGroup()), a.add(e._createSpecialGroup()), t.render() }, n.prototype._getRibbonModesMarkup = function () { var e = this, n = e._createDiv(fr), r = e._createRibbonList(), i = e.element.find(".wijeditor-footer"), s, o, u, a, f; return i.length > 0 && (s = t(i.find("." + lr)), s.length > 0 && (xs.Wysiwyg.tip = s.attr("title") || xs.Wysiwyg.tip), o = t(i.find("." + hr)), o.length > 0 && (xs.Split.tip = o.attr("title") || xs.Split.tip), u = t(i.find("." + cr)), u.length > 0 && (xs.Code.tip = u.attr("title") || xs.Code.tip), a = t(i.find("." + pr)), s.length > 0 && (xs.Wordwrap.tip = a.attr("title") || xs.Wordwrap.tip), f = t(i.find("." + dr)), s.length > 0 && (xs.FullScreen.tip = f.attr("title") || xs.FullScreen.tip), i.remove()), n.add(r), t.each(e._createButtonByCommand("Wysiwyg"), function (e, t) { r.add(t) }), t.each(e._createButtonByCommand("Code"), function (e, t) { r.add(t) }), t.each(e._createButtonByCommand("Split"), function (e, t) { r.add(t) }), n.add(e._createButtonByCommand("Wordwrap")), n.add(e._createButtonByCommand("FullScreen")), n.render() }, n.prototype._getSimpleToolBar = function (e) { var n = this, r, i = n._createDiv(""); return t.each(e, function (e, s) { r = n._createButtonByCommand(s), r && (t.inArray(s, ws) !== -1 ? t.each(r, function (e, t) { i.add(t) }) : i.add(r)) }), i.render() }, n.prototype._editorify = function () { var e = this, n = e.element, r = n.width(), i = n.height(), s = e.options, o = s.mode, u, a, f, l, c, h, p; e._oriStyle = n.attr("style"), e._oriContent = n.html(), e._oriEleWidth = r, e._oriEleHeight = i, n.is("textarea") ? (o === "ribbon" ? e.$ribbon = t(e._getDefaultRibbonMarkup()) : o === "bbcode" ? e.$ribbon = t(e._getSimpleToolBar(Ss)) : s.simpleModeCommands && s.simpleModeCommands.length !== 0 ? (f = t.grep(s.simpleModeCommands, function (e, t) { return e !== "Table" }, undefined), e.$ribbon = t(e._getSimpleToolBar(f))) : e.$ribbon = t(e._getSimpleToolBar(Es)), s.text && n.val(s.text), e.sourceView = n, e.editor = n.wrap("<div></div>").parent(), e.editor.width(r).height(i)) : (e.editor = n, e.$ribbon = n.children(":eq(0)"), h = n.children(":eq(1)"), h.is("textarea") ? (s.text && h.val(s.text), e.sourceView = h) : (s.text ? p = s.text : p = h.html(), h.remove(), e.sourceView = t("<textarea></textarea>").val(p))), u = t("<div class='" + mr + "'></div>"), e.dialog = t("<div class ='" + vr + "'></div>"), e.subDialog = t("<div class ='" + vr + "'></div>"), e.editor.addClass(vr).append(u).append(e.dialog).append(e.subDialog), e._createMenuMarkUp(e, s), e.$ribbon.wrap("<a href='javascript:void(null)'></a>").parent().appendTo("<div class='" + gr + " ui-widget-header ui-helper-clearfix ui-corner-top'></div>").parent().appendTo(u), a = t("<div class='" + yr + "'></div>").appendTo(u), e.designView = t("<iframe frameborder='0'></iframe>"), e.designView.wrap("<div></div>").parent().appendTo(a), e.sourceView.wrap("<div></div>").parent().appendTo(a), l = [e.$ribbon], e.$modes = t(e._getRibbonModesMarkup()), s.showFooter && (c = t("<div class='" + br + " " + "ui-widget ui-widget-content ui-state-default'></div>"), u.append(c), c.append("<div class='" + wr + "'></div>"), e.$modes.appendTo(c), l.push(e.$modes)), t.each(l, function (t, n) { n.wijribbon({ click: function (t, n) { e._ribbonCommand(n.commandName, n.name), e._trigger("commandButtonClick", t, n) } }) }) }, n.prototype._createMenuMarkUp = function (e, n) { n.customContextMenu && !t.browser.webkit && (e.contextMenu = t("<ul><li _c1buttoncmd='cut'><a>" + this.localizeString("contextMenuCut", "Cut") + "</a></li>" + "<li _c1buttoncmd='copy'><a>" + this.localizeString("contextMenuCopy", "Copy") + "</a></li>" + "<li _c1buttoncmd='paste'><a>" + this.localizeString("contextMenuPaste", "Paste") + "</a></li></ul>"), t("<a href='#'></a>").append(e.contextMenu).appendTo(e.editor)) }, n.prototype._handleDisabledOption = function (e, n) { var r = this; e ? (r.disabledDiv || (r.disabledDiv = r._createDisabledDiv(n)), t("body").focus(), r.disabledDiv.appendTo(r.editor)) : r.disabledDiv && (r.disabledDiv.remove(), r.disabledDiv = null) }, n.prototype._createDisabledDiv = function (e) { var n = this, r = e ? e : n.element, i = r.outerWidth(), s = r.outerHeight(); return t("<div></div>").addClass("ui-state-disabled").css({ "z-index": "99999", position: "relative", "background-color": "lightgray", width: i, height: s, left: 0, top: -s }) }, n.prototype._initElements = function () { var e = this, t = e.options, n = e.element.height() - e._getHeader().outerHeight(!0) - e._getFooter().outerHeight(!0), r = {}; e._getContent().height(n).wijsplitter({ showExpander: !1, orientation: "horizontal", panel1: { scrollBars: "none", collapsed: !1 }, panel2: { scrollBars: "none", collapsed: !0 } }), e.sourceView.css("width", "").css("height", ""), e._addHandlerToDesignView(), e._addDefaultFontStyleToDesignView(), e._createWijMenu(), (!t.showPathSelector || e.options.mode === "bbcode") && e._getPathSelector().hide(), e._ribbonCommand(t.editorMode), t.fullScreenMode && e._setFullScreen(t.fullScreenMode), r[bt] = !0, r[yt] = !0, e.$ribbon.wijribbon(b, r), e._handleWinDocumentKeyDown() }, n.prototype._handleWinDocumentKeyDown = function () { var e = this; t(document).keydown(function (t) { if (e.options.disabled) return; switch (t.keyCode) { case 27: e._escActionAssociated() } }) }, n.prototype._setOption = function (e, n) { var r = this, i = r.options, s = i.mode, o = r.$ribbon.parent(), u = i.customContextMenu; t.Widget.prototype._setOption.apply(r, arguments); if (e === "fullScreenMode") i.fullScreenMode = n, r._setFullScreen(n); else if (e === "showPathSelector") i.showPathSelector = n, n ? r._getPathSelector().show() : r._getPathSelector().hide(); else if (e === "editorMode") i.editorMode = n, r._ribbonCommand(n); else if (e === "fullScreenContainerSelector") i.fullScreenContainerSelector = n, r.options.fullScreenMode && r._setFullScreen(!0); else if (e === "disabled") r._handleDisabledOption(n, r.editor); else if (e === "showFooter") n ? t("." + br).is(":visible") || t("." + br).show() : t("." + br).is(":visible") && t("." + br).hide(); else if (e === "commandButtonClick") i.commandButtonClick = n; else if (e === "text") i.text = n, r.setText(n); else if (e === "customContextMenu") { if (u === n) return; n ? (r.contextMenu || r._createMenuMarkUp(r, i), r._createWijMenu()) : (r.contextMenu[r._contextMenuWidgetName()]("destroy").remove(), r.contextMenu = undefined) } else e === "mode" && n !== s && (r.$ribbon.wijribbon("destroy"), r.$ribbon.remove(), n === "ribbon" ? r.$ribbon = t(r._getDefaultRibbonMarkup()) : n === "bbcode" ? r.$ribbon = t(r._getSimpleToolBar(Ss)) : r.$ribbon = t(r._getSimpleToolBar(Es)), o.append(r.$ribbon), r.$ribbon.wijribbon({ click: function (e, t) { r._ribbonCommand(t.commandName, t.name), r._trigger("commandButtonClick", e, t) } }), r._ribbonCommand(i.editorMode)) }, n.prototype._getHeader = function () { return t("." + gr, this.editor) }, n.prototype._getContent = function () { return t("." + yr, this.editor) }, n.prototype._getFooter = function () { return t("." + br, this.editor) }, n.prototype._getPathSelector = function () { return t("." + wr, this.editor) }, n.prototype._getModes = function () { return t("." + fr, this.editor) }, n.prototype._getDesignView = function () { return this.designView }, n.prototype._getDesignViewWindow = function () { var e = this.designView; return e && e.length > 0 ? e[0].contentWindow : null }, n.prototype._getDesignViewDocument = function () { var e = this._getDesignViewWindow(); return e ? e.document : null }, n.prototype._getDesignViewText = function () { var e = this._getDesignViewDocument(); return e && e.body && e.body.innerHTML ? e.body.innerHTML : "" }, n.prototype._setDesignViewText = function (e) { var t = this, n = this._getDesignViewDocument(); this.options.mode === "bbcode" && (e = t._convertBBCodeToHtml(e)), n && n.body && (n.body.innerHTML = e), t.options.text = e }, n.prototype._getDialog = function () { return this.dialog }, n.prototype._getSubDialog = function () { return this.subDialog }, n.prototype._initContentDocument = function () { var e = this, n = e.sourceView.val(), r = e._getDesignViewDocument(); e.options.mode === "bbcode" && (n = e._convertBBCodeToHtml(t.trim(n))), r.open(), r.write('<html style="width:100%;height:100%;' + (e.options.enabled ? "cursor:text;" : "") + '"><head><title></title><style id="__wijStyle" ' + ' type="text/css" >table,td,tr{border: 1px #acacac dashed;}' + "</style></head><body>" + n + "</body></html>"), r.close(), p || t("#__wijStyle", r).prop("disabled", !p), e.element.attr("accesskey") && (t(r.body).attr("accesskey", e.element.attr("accesskey")), e.element.removeAttr("accesskey")), v = [], v.push(n), d = 0 }, n.prototype._addHandlerToDesignView = function () { var e = this, t = e._getDesignViewWindow(), n = t.document; e._initContentDocument(), e._loadDesignView() }, n.prototype._loadDesignView = function () { var e = this, n = e._getDesignViewWindow(), r = n.document; t.browser.mozilla ? setTimeout(e._setDesignModeForFF, 1e3, e) : e._setContentEditable(r, !0), t.browser.msie && e._setContentSpellCheck(r, !1), e.sourceView.bind("blur." + e.widgetName, function (t) { e._onSourceViewBlur() }), e.sourceView.bind("keyup." + e.widgetName, function (t) { e._onSourceViewBlur() }), t.browser.mozilla ? t(r).bind("blur." + e.widgetName, function (t) { e._onDesignViewBlur(t) }) : t(n).blur(function (t) { e._onDesignViewBlur(t) }), t(r).bind("mouseup." + e.widgetName, function (t) { e._onDesignViewMouseUp(t) }).bind("keydown." + e.widgetName, function (t) { e._onDesignViewKeyDown(t) }).bind("keyup." + e.widgetName, function (t) { e._onDesignViewKeyUp(t), e._onDesignViewBlur(t) }) }, n.prototype._addDefaultFontStyleToDesignView = function () { var e = this, n = e.options, r = e._getDesignViewDocument(), i = n.defaultFontName, s = n.defaultFontSize, o = '<style type="text/css"> body {'; if (!(i !== "" && i !== null || s !== "" && s !== null)) return; i !== "" && i !== null && (o += "font-family: " + i + ";"), n.defaultFontSize !== "" && n.defaultFontSize !== null && (o += " font-size: " + s + ";"), o += "}</style>", window.setTimeout(function () { t(o).appendTo(t("head", r)) }, 200), e._setFontStyleButtonState(i, Ut), e._setFontStyleButtonState(s, zt) }, n.prototype._setFontStyleButtonState = function (e, n) { var r = ""; if (!e || e === null) return; t.each(this.$ribbon.wijribbon("getDropdownList", n), function (t, n) { if (n.toUpperCase() === e.toUpperCase()) return r = t, !1 }), this.$ribbon.wijribbon(w, r, !0, n) }, n.prototype._setDesignModeForFF = function (e) { var t = e._getDesignViewDocument(); t && (t.designMode = "on") }, n.prototype.destroy = function () { var e = this; e.element.html(e._oriContent), e.element.removeAttr("tabindex"), e._oriStyle === undefined ? e.element.removeAttr("style") : e.element.attr("style", e._oriStyle), e.element.insertBefore(e.editor), e.element.unbind("." + e.widgetName), e.editor.remove(), t.Widget.prototype.destroy.call(e) }, n.prototype.showEditorDialog = function (e) { switch (e) { case ct: case it: case Dt: case Ot: case At: case kt: case Ct: case Et: case Pt: case Q: case G: case Xt: this._ribbonCommand(e); break; default: r("Cannot find the dialog with command name '" + e + "'!") } }, n.prototype.executeEditorAction = function (e, t) { this._ribbonCommand(e, t) }, n.prototype._isFontSizeCustomized = function () { if (c !== null) return c; var e = this.$ribbon.wijribbon("getDropdownList", zt), n = [Ht, Bt, jt, Ft, It, qt, Rt]; return c = !1, t.each(e, function (e, r) { if (t.inArray(e, n) === -1) return c = !0, !1 }), c }, n.prototype._fontSizeCommand = function (e) { var n = this, r = n._getDesignViewDocument(), i, s = 4, u = "font-size", a = []; n._getDesignViewWindow().getSelection && (i = n._getDesignViewWindow().getSelection()); switch (e) { case Ht: s = 1; break; case Bt: s = 2; break; case jt: s = 3; break; case Ft: s = 4; break; case It: s = 5; break; case qt: s = 6; break; case Rt: s = 7 } n._isFontSizeCustomized() ? t.browser.msie ? n._formatFontSpan(r, u, e) : (r.execCommand("FontSize", !1, s), t.each(t("font[size]", r), function (r, i) { a.push(n._replaceFontWithSpan(t(i), "size", u, e)) }), n._setSelection(a)) : t.browser.msie && o(t.browser.version) >= 9 ? i && i.rangeCount > 0 && r.execCommand("FontSize", !1, s) : r.execCommand("FontSize", !1, s), n.options.mode === "bbcode" && !t.browser.msie && n._convertFontStyleToStandTag(), n._addtoUndoBuffer() }, n.prototype._fontNameCommand = function (e) { var n = this, r = n._getDesignViewDocument(), i, s = n.$ribbon.wijribbon("getDropdownList", Ut), u; n._getDesignViewWindow().getSelection && (i = n._getDesignViewWindow().getSelection()), t.each(s, function (t, n) { if (e === t) return u = n, !1 }), t.browser.msie && o(t.browser.version) >= 9 ? i && i.rangeCount > 0 && r.execCommand("FontName", !1, u) : r.execCommand("FontName", !1, u), n._isFontSizeCustomized() && t.browser.msie && n._formatFontSpan(r, "font-family", u), n._addtoUndoBuffer() }, n.prototype._formatFontSpan = function (e, n, r) { var i = this, s = r, o = "fontFamily", u = []; n !== "font-family" && (s = "c1-temp", o = "fontSize"), e.execCommand("FontName", !1, s), t.each(t("font[face='" + s + "']", e), function (e, s) { var a = i._replaceFontWithSpan(t(s), "face", n, r), f, l; u.push(a), f = t("span." + vs, a); for (l = f.length - 1; l >= 0; l--) i._removeSpecifiedStyleSpan(t(f[l]), o, n); t.each(a, function (e, r) { t.each(t(r).parents("span." + vs), function (e, s) { var u = t(s); if (u.children().length > 1) return !1; u.text() === t(r).text() && i._removeSpecifiedStyleSpan(u, o, n) }) }) }), i._setSelection(u) }, n.prototype._setSelection = function (e, n, r) { var i = this._getDesignViewWindow(), s = i.document, o, u, a, f, l = 0; try { t.browser.msie ? (o = s.selection.createRange(), e ? (t.each(e, function (e, t) { l += t.text().length }), o.moveToElementText(e[0][0]), o.collapse(!0), o.moveEnd("character", l)) : (o.moveStart("textedit", -1), o.collapse(!0), o.moveStart("character", n), o.moveEnd("character", r)), o.select()) : (f = i.getSelection(), o = s.createRange(), u = e[0][0], a = e[e.length - 1][0], o.setStart(u, 0), o.setEnd(a, a.childNodes.length), f.removeAllRanges(), f.addRange(o)) } catch (c) { } }, n.prototype._replaceFontWithSpan = function (e, t, n, r) { e.wrap("<span class = '" + vs + "' style='" + n + ":" + r + "'></span>"); var i = e.parent(); return e.removeAttr(t), /<font\s*>/ig.test(i.html()) && (i.html(e.html()), e.remove()), i }, n.prototype._removeSpecifiedStyleSpan = function (e, n, r) { var i, s = !0; e[0].style[n] !== "" && e.css(r, ""), i = e.attr("style"), i && t.each(i.split(";"), function (e, n) { var i = t.trim(n).toLowerCase(); if (i !== "" && i.indexOf(r) !== -1) return s = !1, !1 }), s && e.replaceWith(e.html()) }, n.prototype._removeFormat = function () { var e = this, n = e._getDesignViewDocument(), r = {}; n.execCommand(st, !1, null), e._isFontSizeCustomized() && t.browser.msie && e._removeFormatForIE(n), e._addtoUndoBuffer(), r[Y] = !1, r[Z] = !1, r[et] = !1, r[tt] = !1, r[nt] = !1, r[rt] = !1, r[V] = !1, r[$] = !1, r[R] = !1, r[U] = !1, r[z] = !1, r[W] = !1, e.$ribbon.wijribbon(E, r) }, n.prototype._removeFormatForIE = function (e) { var n = e.selection.createRange(), r = n.htmlText, i = n.text, s = 0, o = t(n.parentElement()), u = t(e.body), a = "", f = "", l = "__c1temp", c = "c1-temp", h = "<span class='" + c + "'>" + l + "</span>", p, d, v, m, g, y; o.addClass("c1-app-parent"), n.pasteHTML(h), s = u.text().indexOf(l), p = t("span." + c, e), d = p, p.parentsUntil("body").each(function (e) { if (t(this).is(".c1-app-parent")) return !1; d = t(this) }), p.html(r), v = t("span." + vs, p); for (g = v.length - 1; g >= 0; g--) m = t(v[g]), m.replaceWith(m.html()); d.is("." + c) || d.after(p), t.each(d.parents("span." + vs), function (e, n) { a += "</span>", f = "<span class='" + vs + "' style = '" + t(n).attr("style") + "'>" + f }), r = p.html(), p.replaceWith(l), y = u.html().split(l), u.html(y[0] + a + r + f + y[1]), v = t("span." + vs, e); for (g = v.length - 1; g >= 0; g--) m = t(v[g]), m.text() === "" && m.replaceWith(m.html()); t(".c1-app-parent", e).removeClass("c1-app-parent"), this._setSelection(null, s, i.length) }, n.prototype._toggleFullScreen = function () { var e = this, t = e.options; t.fullScreenMode = !t.fullScreenMode, e._setFullScreen(t.fullScreenMode) }, n.prototype._setFullScreen = function (e) { var n = this, r = 1, s = n._getHeader(), l = n._getFooter(), c = n._getContent(), h = n.options.fullScreenContainerSelector, p = t(h), d = n._getDesignViewText(), v, m, g; e ? (p.length === 0 && (p = t(i), h = "body", n._oriDocOverFlow = t(document.documentElement).css("overflow"), t(document.documentElement).css({ overflow: "hidden" }), t.browser.mozilla || window.scrollTo(0, 0), t(i).bind("resize.wijeditor", function () { n._fullscreenOnWindowResize() })), v = p.width(), m = p.height() - 2 * r, u = n.editor.width(), a = n.editor.height(), f || (f = n.editor.parent()), n._replacedDiv || (n._replacedDiv = t("<div />")), n.editor.after(n._replacedDiv), t(h).append(n.editor), n.editor.css({ width: v, height: m, position: "" }).addClass(Er), n.$ribbon.wijribbon("updateRibbonSize")) : (n._replacedDiv.after(n.editor).remove(), n.editor.css({ width: u, height: a, position: "static" }).removeClass(Er), n.options.fullScreenContainerSelector || t(document.documentElement).css({ overflow: n._oriDocOverFlow }), t(i).unbind("resize.wijeditor"), n.$ribbon.wijribbon("updateRibbonSize")), g = n.editor.height() - s.outerHeight(!0) - l.outerHeight(!0), c.height(g).wijsplitter("refresh"), n._addHandlerToDesignView(), n._addDefaultFontStyleToDesignView(), n._createWijMenu(), t.browser.msie && window.setTimeout(function () { n.options.mode === "bbcode" && (d = n._convertHtmlToBBCode(t.trim(d))), n._setDesignViewText(d), o(t.browser.version) >= 9 && n.sourceView.val(d) }, 40) }, n.prototype._createWijMenu = function () { var e = this, n = e._getDesignViewDocument(); e.contextMenu && e.contextMenu[e._contextMenuWidgetName()]({ orientation: "vertical", trigger: e.designView, triggerEvent: "rtclick", showing: function (r, i) { t.browser.msie && (m = n.selection.createRange()); var s = e.designView.offset(), o = t(t(e.designView)[0].contentWindow).scrollLeft(), u = t(t(e.designView)[0].contentWindow).scrollTop(), a = s.left + 2 - o, f = s.top - u; i.options.position = { my: "left+" + a + " " + "top+" + f, at: "right top", of: r, collision: "none none" } }, animation: { animated: "fade" }, select: function (t, n) { e._setIESelection(), e._contextMenuItemClick(t, n), e.contextMenu[e._contextMenuWidgetName()]("deactivate") } }) }, n.prototype._fullscreenOnWindowResize = function () { var e = this, n = e._getHeader(), r = e._getFooter(), i = e._getContent(), s, o = t(window).width(), u = t(window).height(); e.editor.css({ width: o, height: u }), s = e.editor.height() - n.height() - r.height(), i.height(s).wijsplitter("refresh") }, n.prototype._saveText = function (e) { }, n.prototype._doSpellCheck = function () { }, n.prototype._ribbonCommand = function (e, n) { var r = this, i = r._getDesignViewDocument(), s = r._getContent(), o, u, a; if (n === Ut) { r._fontNameCommand(e), r._onDesignViewBlur(null); return } if (n === zt) { r._fontSizeCommand(e), r._onDesignViewBlur(null); return } r.editor.hasClass("ui-helper-hidden-accessible") || r._setIEFocus(); switch (e) { case Wt: t.browser.msie ? (i.execCommand("FormatBlock", !1, "<ADDRESS>"), a = i.selection.createRange(), a = t(a.parentElement()).closest("address"), a.length && (a.replaceWith("<blockquote>" + a.html() + "</blockquote>"), i.body.innerHTML = i.body.innerHTML.replace(/<BLOCKQUOTE>\s*?<BLOCKQUOTE>/gi, "<BLOCKQUOTE>"), i.body.innerHTML = i.body.innerHTML.replace(/<\/BLOCKQUOTE>\s*?<\/BLOCKQUOTE>/gi, "</BLOCKQUOTE>"), i.body.innerHTML = i.body.innerHTML.replace(/<BLOCKQUOTE>\s*?<\/BLOCKQUOTE>/gi, ""))) : i.execCommand("FormatBlock", !1, "<BLOCKQUOTE>"), r._addtoUndoBuffer(); break; case S: o = r._generateUniqueName("form"), r.insertHTML('<form id="' + o + '" name="' + o + '" method="post">' + o + "</form>"); break; case x: o = r._generateUniqueName("image"), r.insertHTML('<input id="' + o + '" name="' + o + '" type="image"' + ' value="' + o + '"/>'); break; case T: o = r._generateUniqueName("textarea"), r.insertHTML('<textarea id="' + o + '" name="' + o + '" rows="4" cols="48"></textarea>'); break; case N: o = r._generateUniqueName("button"), r.insertHTML('<input id="' + o + '" name="' + o + '" type="button"' + ' value="' + o + '"/>'); break; case C: o = r._generateUniqueName("textbox"), r.insertHTML('<input id="' + o + '" name="' + o + '" type="text"' + ' value="' + o + '"/>'); break; case k: o = r._generateUniqueName("list"), r.insertHTML('<select id="' + o + '" name="' + o + '" style="width: 120px" size="8"></select>'); break; case L: o = r._generateUniqueName("password"), r.insertHTML('<input id="' + o + '" name="' + o + '" type="password" value="' + o + '"/>'); break; case A: o = r._generateUniqueName("dropdown"), r.insertHTML('<select id="' + o + '" name="' + o + '"></select>'); break; case O: o = r._generateUniqueName("hidden"), r.insertHTML('<input id="' + o + '" name="' + o + '" type="hidden" value="' + o + '" />'); break; case M: o = r._generateUniqueName("radiobox"), r.insertHTML('<input id="' + o + '" name="' + o + '" type="radio"' + ' value="' + o + '">' + '<label for="' + o + '">' + o + "</label></input>"); break; case _: o = r._generateUniqueName("checkbox"), r.insertHTML('<input id="' + o + '" name="' + o + '" type="checkbox"' + ' value="' + o + '">' + '<label for="' + o + '">' + o + "</label></input>"); break; case D: case P: case H: case B: case j: case F: case I: case q: r._tableAction(e); break; case X: r._toggleTableBorders(); break; case nt: try { i.queryCommandState(rt) && (i.execCommand(rt, !1, null), r.$ribbon.wijribbon(w, rt, !1)) } catch (f) { } i.execCommand(nt, !1, null), r._addtoUndoBuffer(); break; case rt: try { i.queryCommandState(nt) && (i.execCommand(nt, !1, null), r.$ribbon.wijribbon(w, nt, !1)) } catch (l) { } i.execCommand(rt, !1, null), r._addtoUndoBuffer(); break; case st: r._removeFormat(); break; case ot: r.insertHTML("<br/>"); break; case ut: u = r._getSelectedContent(); if (!u || u === "") u = "&nbsp;"; r.insertHTML("<p>" + u + "</p>"); break; case at: r.insertHTML('<div title="Print Page Break" style="font-size:1px;page-break-before:always;vertical-align:middle;height:1px;background-color:#c0c0c0">&nbsp;</div>'); break; case gt: r._toggleFullScreen(); break; case yt: r._undoAction(); break; case bt: r._redoAction(); break; case St: r._execCut(); break; case xt: r._execCopy(); break; case Tt: r._execPaste(); break; case Lt: r.insertDateAndTime(); break; case pt: r.$modes.data("wijmoWijribbon") && r.$modes.wijribbon(y, mt, !0).wijribbon(w, pt, !0), r.$ribbon.wijribbon("option", "disabled", !1), s.wijsplitter("option", "panel2", { collapsed: !0 }); break; case dt: r.$modes.data("wijmoWijribbon") && r.$modes.wijribbon(y, mt, !0).wijribbon(w, dt, !0), r.$ribbon.wijribbon("option", "disabled", !1), s.wijsplitter("option", { panel1: { collapsed: !1 }, panel2: { collapsed: !1 } }); break; case vt: r.$modes.data("wijmoWijribbon") && r.$modes.wijribbon(y, mt, !1).wijribbon(w, vt, !0), r.$ribbon.wijribbon("option", "disabled", !0), s.wijsplitter("option", "panel1", { collapsed: !0 }), t.browser.msie && r.sourceView.focus(); break; case mt: s.wijsplitter("option", "panel1").collapsed && r._toggleWordWrap(); break; case Q: r._saveSelectionForIE(), r._createDialog(this.localizeString("backColorDialogTitle", "Set BackColor"), r._getDialogRes_BackColor(), r.initBackColorDialog); break; case G: r._saveSelectionForIE(), r._createDialog(this.localizeString("foreColorDialogTitle", "Set ForeColor"), r._getDialogRes_ForeColor(), r.initForeColorDialog); break; case ct: r._saveSelectionForIE(), r._createDialog(this.localizeString("insertTableDialogTitle", "Insert Table"), r._getDialogRes_Table(), r.initInsertTableDialog); break; case ht: r._getEditableTable() && r._createDialog(this.localizeString("editTableDialogTitle", "Edit Table"), r._getDialogRes_Table(), r.initEditTableDialog); break; case wt: r._createDialog(this.localizeString("previewDialogPreview", "Preview"), r._getDialogRes_Preview(), r.initPreviewDialog); break; case Et: r._createDialog(this.localizeString("cleanUpDialogTitle", "Clean up source HTML document"), r._getDialogRes_CleanUp(), r.initCleanUpDialog); break; case Ct: r._saveSelectionForIE(), r._createDialog(this.localizeString("mediaDialogTitle", "Insert media"), r._getDialogRes_Media(), r.initMediaDialog); break; case kt: r._saveSelectionForIE(), r._createDialog(this.localizeString("specialCharacterDialogTitle", "Insert special character"), r._getDialogRes_SpecialCharacter(), r.initSpecialCharacterDialog); break; case At: r._createDialog(this.localizeString("findAndReplaceTitle", "Find and replace"), r._getDialogRes_FindAndReplace(), r.initFindDialog); break; case Ot: g = r._getSelectedElement(), r._createDialog(this.localizeString("tagInspectorDialogTitle", "Tag Inspector"), r._getDialogRes_TagInspector(), r.initTagInspectorDialog); break; case it: r._saveSelectionForIE(), r._createDialog(this.localizeString("templateDialogApplyTemplate", "Apply Template"), r._getDialogRes_Template(), r.initTemplateDialog); break; case Dt: r._saveSelectionForIE(), r._createDialog(this.localizeString("imageEditorDialogImageBrowser", "Image Browser"), r._getDialogRes_ImageBrowser(), r.initImageBrowserDialog); break; case Pt: r._saveSelectionForIE(), r._createDialog(this.localizeString("hyperLinkDialogInserthyperLink", "Insert hyperLink"), r._getDialogRes_Link(), r.initHyperLinkDialog); break; case Xt: r._saveSelectionForIE(), r._createDialog("Insert Code", r._getDialogRes_Code(), r.initInsertCodeDialog); break; case R: case U: case z: case W: case J: case K: case Y: case Z: case tt: case V: case $: case et: case ft: case Nt: i.execCommand(e, !1, null), r.options.mode === "bbcode" && !t.browser.msie && r._convertStyleToStandTag(), r._addtoUndoBuffer(); break; case Mt: r._saveText(); break; case _t: r._doSpellCheck() } r._onDesignViewBlur(null) }, n.prototype._saveSelectionForIE = function () { var e = this._getDesignViewWindow(), n; t.browser.msie && (n = e.document.selection, m = n.createRange()) }, n.prototype._createDialog = function (e, n, r) { var i = this, s, u = i.dialog; u.html("").undelegate(i.widgetName).undelegate("." + i.widgetName).append(n), i.subDialog && i.subDialog.html("").undelegate(i.widgetName).undelegate("." + i.widgetName), s = { width: "auto", height: "auto", modal: !0, title: e, position: "center", resizable: !1, captionButtons: { pin: { visible: !1 }, refresh: { visible: !1 }, toggle: { visible: !1 }, minimize: { visible: !1 }, maximize: { visible: !1 } } }, u.data("wijmoWijdialog") ? (u.wijdialog("reset"), u.wijdialog("option", { width: "auto", height: "auto", title: e })) : t.browser.msie && o(t.browser.version) === 6 ? window.setTimeout(function () { u.wijdialog(s) }, 0) : u.wijdialog(s), i._adjustDialogLayoutForIE7(), r && r.call(i), u.wijdialog("open") }, n.prototype._adjustDialogLayoutForIE7 = function () { var e = this.dialog; t.browser.msie && /^7\.[0-9]+/.test(t.browser.version) && e.wijdialog("option", "width", e.parent().width()) }, n.prototype._contextMenuItemClick = function (e, t, n) { var r = this, i = t.item.element.attr("_c1buttoncmd"); switch (i) { case St: r._execCut(); break; case xt: r._execCopy(); break; case Tt: r.focus(), r._execPaste() } }, n.prototype._execCut = function () { var e = this, n = e._getDesignViewDocument(); t.browser.safari ? r(this.localizeString("errorMessageCutError", "This function is not supported in current browser.  Plesse use (Ctrl + X).")) : t.browser.msie ? (n.execCommand("Cut", !1, null), e._addtoUndoBuffer()) : (e._execCopy(), e._deleteSelectionContent(), e._addtoUndoBuffer()) }, n.prototype._execCopy = function () { var e = this, n = e._getDesignViewDocument(); t.browser.safari ? r(this.localizeString("errorMessageCopyError", "This function is not supported in current browser. Plesse use (Ctrl + C).")) : t.browser.msie ? (n.execCommand("Copy", !1, null), e._addtoUndoBuffer()) : e._copyToClipboard(e._getSelectedContent()) }, n.prototype._execPaste = function () { var e = this, n, i = e._getDesignViewDocument(); if (t.browser.safari) r(this.localizeString("errorMessagePasteError", "This function is not supported in current browser. Plesse use (Ctrl + V).")); else if (t.browser.msie) i.execCommand("Paste", !1, null), e._addtoUndoBuffer(); else try { n = e._copyFromClipboard(), n && n !== "" && e.insertHTML(n) } catch (s) { } }, n.prototype._getFontSizeCollection = function () { return { "10px": Ht, "13px": Bt, "16px": jt, "18px": Ft, "24px": It, "32px": qt, "48px": Rt, 1: Ht, 2: Bt, 3: jt, 4: Ft, 5: It, 6: qt, 7: Rt } }, n.prototype._updateButtonStates = function (e) { var n = this, r = n._getDesignViewDocument(), i, s, o = {}, u = [Y, Z, et, tt, nt, rt, V, $, R, U, z, W], a, f = e.target, l = t(f); t.each(u, function (e, t) { o[t] = r.queryCommandState(t) }), n.$ribbon.wijribbon(E, o), i = n._queryCommandValue(Ut) || "", t.each(n.$ribbon.wijribbon("getDropdownList", Ut), function (e, t) { if (t.toUpperCase() === i.toUpperCase()) return s = e, !1 }), n.$ribbon.wijribbon(w, s, !0, Ut), n._isFontSizeCustomized() ? (l.is("span") ? s = f.style.fontSize : s = "", s === "" && (a = l.parents("span." + vs), t.each(a, function (e, t) { s = t.style.fontSize; if (s && s !== "") return !1 })), s === "" && (s = l.css("font-size"))) : (i = n._queryCommandValue(zt) || "", i === "" && (i = l.css("font-size")), t.each(n._getFontSizeCollection(), function (e, t) { if (e.toString() === i.toString()) return s = t, !1 })), n.$ribbon.wijribbon(w, s, !0, zt) }, n.prototype._queryCommandValue = function (e) { var t = this._getDesignViewDocument(); try { if (!t.queryCommandEnabled(e)) return null } catch (n) { return null } try { return t.queryCommandValue(e) } catch (r) { } return null }, n.prototype._escActionAssociated = function () { var e = this, t = e._getDesignViewWindow(); t.document.selection !== undefined && t.document.selection.empty(), t.getSelection !== undefined && t.getSelection().removeAllRanges(), e._hideAllDropdownsMenus() }, n.prototype._hideAllDropdownsMenus = function () { var e = this; e.contextMenu && e.contextMenu[e._contextMenuWidgetName()]("hideAllMenus"), e.$ribbon.wijribbon("hideDropdown", Ut).wijribbon("hideDropdown", zt).wijribbon("hideDropdown", lt) }, n.prototype._onDesignViewKeyDown = function (e) { var t = this, n; t._setSaveBtnEnabled(); try { if (e.ctrlKey) n = String.fromCharCode(e.keyCode).toLowerCase(); else switch (e.keyCode) { case 27: t._escActionAssociated(); break; case 13: case 46: t._addtoUndoBuffer(), t._continueSavingInputTextForUndo = !1; break; default: t._continueSavingInputTextForUndo = !0 } } catch (r) { } }, n.prototype._onDesignViewKeyUp = function (e) { var t = this, n; (e.keyCode === 37 || e.keyCode === 38 || e.keyCode === 39 || e.keyCode === 40 || e.keyCode === 33 || e.keyCode === 34 || e.keyCode === 35 || e.keyCode === 36) && t._updateButtonStates(e); if (e.ctrlKey) { n = String.fromCharCode(e.keyCode).toLowerCase(); switch (n) { case "y": t._redoAction(), e.preventDefault(), e.stopPropagation(); break; case "z": t._undoAction(), e.preventDefault(), e.stopPropagation(); break; case "x": case "v": t._addtoUndoBuffer(), t._continueSavingInputTextForUndo = !1 } } }, n.prototype._onDesignViewMouseUp = function (e) { var n = this, r; if (e.button === 2) return; n._updateButtonStates(e), n._refreshPathSelector(), n._hideAllDropdownsMenus(), t(document).mouseup(); if (t.browser.msie) { r = t(e.target).closest("a"); if (e.ctrlKey && r.length > 0) try { r.focus(), i.open(r[0].href, "_blank") } catch (s) { } } }, n.prototype._onDesignViewBlur = function (e) { var n = this, r = n.options, i; i = n._getDesignViewText(), n._onTextChange(e), r.mode === "bbcode" && (i = n._convertHtmlToBBCode(t.trim(i))), n.sourceView.val(i), r.text = i }, n.prototype._onTextChange = function (e) { var t = this; t._continueSavingInputTextForUndo && (t._addtoUndoBuffer(), t._continueSavingInputTextForUndo = !1), t._trigger("textChanged", e, { text: t.options.text }) }, n.prototype._onSourceViewBlur = function () { var e = this, t; t = e.sourceView.val(), e._setDesignViewText(t), e.options.text = t }, n.prototype._convertBBCodeToHtml = function (e) { return e ? (e = e.replace(/</g, "&lt;"), e = e.replace(/>/g, "&gt;"), e = e.replace(/(?:\r\n|\n|\r)/g, "<br>"), e = e.replace(/\[EMAIL\]([\s\S]*?)\[\/EMAIL\]/gim, '<a href="mailto:$1">$1</a>'), e = e.replace(/\[EMAIL\=([^\]]+)]([\s\S]*?)\[\/EMAIL\]/gim, '<a href="mailto:$1">$2</a>'), e = e.replace(/\[URL\]([\s\S]*?)\[\/URL\]/gim, '<a href="$1">$1</a>'), e = e.replace(/\[URL\=([^\]]+)]([\s\S]*?)\[\/URL\]/gim, '<a href="$1">$2</a>'), e = e.replace(/\[B\]/gim, "<b>"), e = e.replace(/\[\/B\]/gim, "</b>"), e = e.replace(/\[I\]/gim, "<i>"), e = e.replace(/\[\/I\]/gim, "</i>"), e = e.replace(/\[S\]/gim, "<strike>"), e = e.replace(/\[\/S\]/gim, "</strike>"), e = e.replace(/\[U\]/gim, "<u>"), e = e.replace(/\[\/U\]/gim, "</u>"), e = e.replace(/\[IMG height=(.*?) width=(.*?)](.+?)\[\/IMG\]/gim, '<img height="$1" width = "$2" src="$3"/>'), e = e.replace(/\[BLOCK\]/gim, "<blockquote>"), e = e.replace(/\[\/BLOCK\]/gim, "</blockquote>"), e = e.replace(/\[LIST\=1\]\[\*\]([\s\S]*?)\[\/LIST\]/gim, "<ol><li>$1</li></ol>"), e = e.replace(/\[LIST\]\[\*\]([\s\S]*?)\[\/LIST\]/gim, "<ul><li>$1</li></ul>"), e = e.replace(/\[\*\]/gim, "</li><li>"), e = e.replace(/\[size=([^\]]*?)\]/gi, '<font size="$1">'), e = e.replace(/\[\/size\]/gim, "</font>"), e = e.replace(/\[color=([^\]]*?)\]/gi, '<font color="$1">'), e = e.replace(/\[\/color\]/gim, "</font>"), e) : "" }, n.prototype._replaceComplexHtml = function (e) { var n, r, i, s, o = t("<div/>").html(e); n = t("img", o), t.each(n, function () { i = "[IMG height=" + t(this).height() + " width=" + t(this).width() + "]" + t(this).attr("src").toString() + "[/IMG]", t(this).replaceWith(i) }), r = t("font", o); for (s = r.length - 1; s >= 0; s--) t(r[s]).attr("color") && t(t(r[s])).attr("size") ? i = "[Color=" + t(t(r[s])).attr("color") + "]" + "[Size=" + t(t(r[s])).attr("size") + "]" + t(t(r[s])).html() + "[/Size][/Color]" : t(t(r[s])).attr("color") && !t(t(r[s])).attr("size") ? i = "[Color=" + t(t(r[s])).attr("color") + "] " + t(t(r[s])).html() + "[/Color]" : t(t(r[s])).attr("size") && !t(t(r[s])).attr("color") && (i = "[Size=" + t(t(r[s])).attr("size") + "]" + t(t(r[s])).html() + "[/Size]"), t(t(r[s])).replaceWith(i); return o.html() }, n.prototype._convertHtmlToBBCode = function (e) { var t = this; if (e === "") return; return e = t._replaceComplexHtml(e), e = e.replace(/<br(?=[ \/>]).*?>/gim, "\r\n"), e = e.replace(/<a .*?href=(["'])(.+?)\1.*?>(.+?)<\/a>/gi, "[URL=$2]$3[/URL]"), e = e.replace(/<a .*?href=(["'])mailto:(.+?)\1.*?>(.+?)<\/a>/gi, "[EMAIL=$2]$3[/EMAIL]"), e = e.replace(/<(?:b|strong)>/gim, "[B]"), e = e.replace(/<\/(?:b|strong)>/gim, "[/B]"), e = e.replace(/<(?:i|em)>/gim, "[I]"), e = e.replace(/<\/(?:i|em)>/gim, "[/I]"), e = e.replace(/<(?:strike|s)>/gim, "[S]"), e = e.replace(/<\/(?:strike|s)>/gim, "[/S]"), e = e.replace(/<u>/gim, "[U]"), e = e.replace(/<\/u>/gim, "[/U]"), e = e.replace(/<blockquote.*?\>/gim, "[BLOCK]"), e = e.replace(/\s{0,}<\/blockquote>/gim, "[/BLOCK]"), e = e.replace(/(?:\r\n|\r|\n){0,1}<(?:ol)>[\s]*/gim, "[LIST=1]"), e = e.replace(/<\/(?:ol)>/gim, "[/LIST]"), e = e.replace(/(?:\r\n|\r|\n){0,1}\<(?:ul)>[\s]*/gim, "[LIST]"), e = e.replace(/<\/(?:ul)>/gim, "[/LIST]"), e = e.replace(/\s{0,}<li\s{0,1}.*?>([\s\S]*?)\n{0,}\s{0,}<\/li>/gim, "[*]$1"), e = e.replace(/&nbsp;/gi, " "), e = e.replace(/(<[^>]+>)/gm, ""), e }, n.prototype._convertFontStyleToStandTag = function () { var e = this, n = e._getDesignViewDocument(), r = t(n.body), i, s, o = t("[style*='color: ']", r); o.length !== 0 && (i = o, s = "<font color='" + e._getWebColorFromRgb(o.css("color")) + "'></font>"), i && t.each(i, function (e) { t(this).is("span") ? t(this).replaceWith(t(s).html(t(this).html())) : t(this).is("font") && t(this).attr("size") && t(this).removeAttr("style").html(t(s).html()) }) }, n.prototype._convertStyleToStandTag = function () { var e = this, n = e._getDesignViewDocument(), r = t(n.body), i, s, o, u = t("[style*='font-weight: bold;']", r), a = t("[style*='font-style: italic;']", r), f = t("[style*='text-decoration: line-through;']", r), l = t("[style*='text-decoration: underline;']", r); u.length !== 0 ? (i = u, s = "<b></b>", o = "font-weight") : a.length !== 0 ? (i = a, s = "<i></i>", o = "font-style") : f.length !== 0 ? (i = f, s = "<strike></strikes>", o = "text-decoration") : l.length !== 0 && (i = l, s = "<u></u>", o = "text-decoration"), i && t.each(i, function (e) { t(this).is("span") && this.style.fontSize === "" ? t(this).replaceWith(t(s).html(t(this).html())) : t(this).removeAttr("style").html(t(s).html()) }) }, n.prototype._getWebColorFromRgb = function (e) { var t = this, n; return e.indexOf("rgb(") === 0 && (n = e.substring(4, e.length - 1).split(","), e = t._convertToWebColor(o(n[0]), o(n[1]), o(n[2]))), e }, n.prototype._updateList = function (e, n) { var r; t("option", n).remove(); for (r in e) e[r] && n.append("<option>" + r + "</option>") }, n.prototype._triggerEvent = function (e, t) { var n = this, r = n.options[e]; return r && typeof r == "function" ? r.call(n, t) : r }, n.prototype._closeDialog = function () { this.dialog.wijdialog("close") }, n.prototype._onTemplateList = function (e) { return this._triggerEvent("templateList", e) }, n.prototype.updateTemplateList = function (e, n) { var r = this, i = n || t("select", r.dialog); r._updateList(e, i), r._templateList = e }, n.prototype.initTemplateDialog = function () { var e = this, n = e.dialog, r = t("select", n), i = e._onTemplateList(); n.delegate("select", "change." + e.widgetName, function () { e.templateListOnChanged() }).delegate("." + Zr, "click." + e.widgetName, function () { e.deleteTemplate() }).delegate("." + ei, "click." + e.widgetName, function () { e.saveTemplate() }).delegate(ms, "click." + e.widgetName, function () { e.applyTemplate() }).delegate(gs, "click." + e.widgetName, function () { e._closeDialog() }); if (!i) { i = e._templateList; if (!i) return } e.updateTemplateList(i, r) }, n.prototype.templateListOnChanged = function () { var e = this, n = e.dialog, r = t("select", n).val(), i = t("iframe", n), s = e._templateList, o; if (!s) return; o = s[r], o.src && i.attr("src", o.src + "?d=" + (new Date).getMilliseconds().toString()), o.text && i.length > 0 && i[0].contentWindow.document.write(o.text), r && (t("." + $r, n).html(r), t("." + Qr, n).val(r)), o.desc && (t("." + Jr, n).html(o.desc), t("." + Gr, n).val(o.desc)) }, n.prototype._onSaveTemplate = function (e) { this._triggerEvent("saveTemplate", e) }, n.prototype.saveTemplate = function () { var e = this, n = e.dialog, i = t("." + Qr, n).val(), s = t("." + Gr, n).val(), o = e._templateList, u = this._getDesignViewText(); if (t.trim(i) === "") { r(this.localizeString("errorMessageTemplateNameError", "Please input a template name!")); return } o || (e._templateList = [], o = e._templateList), o[i] || t("select", n).append("<option>" + i + "</option>"), o[i] = { desc: s, text: u }, e._onSaveTemplate({ name: i, desc: s, text: u }) }, n.prototype._onDeleteTemplate = function (e) { this._triggerEvent("deleteTemplate", e) }, n.prototype.deleteTemplate = function () { var e = this, n = e.dialog, i = t("select", n), s = i.val(), o = e._templateList; if (t.trim(s) === "") { r(this.localizeString("errorMessageTemplateFileError", "Please select a template file.")); return } t("option:selected", i).remove(), t("iframe", n).attr("src", "about:blank"), t("." + $r, n).empty(), t("." + Qr, n).val(""), t("." + Jr, n).empty(), t("." + Gr, n).val(""), delete o[s], e._onDeleteTemplate(s) }, n.prototype.applyTemplate = function () { var e = this, n = e.dialog, i = t("select", n), s = i.val(), o = t("iframe", n)[0], u = t("." + Qr, n).val(), a = o.contentWindow.document.body.innerHTML; if (t.trim(u) === "" || t.trim(s) === "") { r(this.localizeString("errorMessageValidTemplateFileError", "Please select a valid template file.")); return } e._setDesignViewText(a), e._addtoUndoBuffer(), e._setSaveBtnEnabled(), e._closeDialog() }, n.prototype._onImageList = function () { var e = this, t = e.options.imageList; return t && typeof t == "function" ? t.call(e) : t }, n.prototype.updateImageList = function (e, n) { var r = this, i = r.dialog, s = n || t("select", i), o = t("." + Or, i); r._updateList(e, s), r._imgList = e; if (!e) { o.addClass(Fr); return } o.removeClass(Fr) }, n.prototype.initImageBrowserDialog = function () { var e = this, n = e.dialog, r = e._onImageList(); t("img", n).hide(), n.delegate("select", "change." + e.widgetName, function () { e.imageListOnChanged() }).delegate(ms, "click." + e.widgetName, function (t) { e.submitInsertImageDialog(), e._onDesignViewBlur(t) }).delegate(gs, "click." + e.widgetName, function () { e._closeDialog() }), t("." + Dr + " input", n).bind("change." + e.widgetName, function () { e.imageUrlChanged(this) }); if (!r) { r = e._imgList; if (!r) { t("." + Or, n).addClass(Fr); return } } e.updateImageList(r, t("select", n)) }, n.prototype.imageUrlChanged = function (e) { var n = this, r = n.dialog; t("img", this.dialog).attr("src", t(e).val() + "?" + (new Date).getTime()).show().bind("load", function () { t("." + Hr + " input", r).val(t("img", r).width().toString()), t("." + Br + " input", r).val(t("img", r).height().toString()) }) }, n.prototype.imageListOnChanged = function () { var e = this, n = e.dialog, r = t("select", n).val(), s = e._imgList, o; if (!s) return; o = s[r], t("img", n).prop("src", o).show(), t("." + Dr + " input", n).prop("value", o), i.setTimeout(function () { t("." + Hr + " input", n).val(t("img", n).width().toString()), t("." + Br + " input", n).val(t("img", n).height().toString()) }, 200) }, n.prototype.submitInsertImageDialog = function () { var e = this, n, i = e.dialog, s = t("." + Dr + " input", i).val(), o = t("." + Pr + " input", i).val(), u = t("." + Hr + " input", i).val(), a = t("." + Br + " input", i).val(), f = t("." + jr + " input", i).val(); if (t.trim(s) === "") { r(this.localizeString("errorMessageSelectImageError", "Please select a image.")); return } if (!e._isNumeric(u)) { r(this.localizeString("errorMessageImageWidthError", "Please input a number for 'Image width' textbox.")); return } if (!e._isNumeric(a)) { r(this.localizeString("errorMessageImageHeightError", "Please input a number for 'Image height' textbox.")); return } e.focus(), t.browser.msie ? (n = '<img src="' + s + '" alt="' + o + '" style="width:' + u + "px;height:" + a + "px", e.options.mode !== "bbcode" && f !== null && f !== undefined && f.length > 0 && (n += ";" + f)) : (n = '<img src="' + s + '" alt="' + o + '" width="' + u + '" height="' + a, e.options.mode !== "bbcode" && (n += '" style="' + f)), n += '"/>', e.insertHTML(n), e._closeDialog() }, n.prototype.initHyperLinkDialog = function () { var e = this, n = e.dialog, r = e.getLinkHrefField(), s = t("." + ci, n), o, u, a, f = t("." + ni + " input", n); n.delegate(ms, "click." + e.widgetName, function (t) { e.submitHyperLinkDialog(), e._onDesignViewBlur(t) }).delegate(gs, "click." + e.widgetName, function () { e._closeDialog() }).delegate("." + ii, "change." + e.widgetName, function () { e.anchorListOnChanged(this) }).delegate("." + ri + ">div", "click." + e.widgetName, function () { e.radioListOnChanged() }).delegate("." + hi + ">div", "click." + e.widgetName, function () { e.linkIconTypeOnChanged() }).delegate("." + ai + " input", "change." + e.widgetName, function () { e.tempImg = t('<img src="' + t("." + ai + " input", n).val() + '">').appendTo("body"), i.setTimeout(function () { t("." + fi + " input", n).val(e.tempImg.width().toString()), t("." + li + " input", n).val(e.tempImg.height().toString()), e.tempImg.remove(), e.tempImg = undefined }, 200) }); try { f.val(r), u = e._getLinkInnerHTML() } catch (l) { } a = t(u), u && u.substring(0, 3) === "<img" ? o = !0 : o = !1, o ? (s.show(), t("." + si + " input", n).hide(), t("." + ai + " input", n).val(a.attr("src")), t("." + fi + " input", n).val(a.attr("width")), t("." + li + " input", n).val(a.attr("heigth"))) : (t("." + si + " input", n).show(), s.hide(), t("." + si + " input", n).val(u)), t("." + ui + " input", n).val(e._getLinkCssField()), t("." + oi + " select", n).val(e._getLinkTarget()), t("#radAnchor", n).attr("checked", "checked"), t("#radLinkTypeIsText", n).attr("checked", "checked"), r.length > 6 && (r.substring(0, 4) === "http" ? t("#radUrl", n).attr("checked", "checked") : r.substring(0, 6) === "mailto" ? t("#radMail", n).attr("checked", "checked") : r.substring(0, 1) === "#" ? t("#radAnchor", n).attr("checked", "checked") : t("#radFile", n).attr("checked", "checked")), a = undefined }, n.prototype._getLinkInnerHTML = function () { var e = this, t; e.focus(), t = e._getInspectElement(); try { if (t && t.tagName === "A") return t.innerHTML || "" } catch (n) { } return "" }, n.prototype.getLinkHrefField = function () { var e = this, t; e.focus(), t = e._getInspectElement(); try { if (t && t.tagName === "A") return e.fixAbsoluteUrlsIfNeeded(t.href || "") } catch (n) { } return "" }, n.prototype._getLinkTarget = function () { var e = this, t; e.focus(), t = e._getInspectElement(); try { if (t && t.tagName === "A") return t.target || "" } catch (n) { } return "" }, n.prototype._getLinkCssField = function () { var e = this, t; e.focus(), t = e._getInspectElement(); try { if (t && t.tagName === "A") return t.style.cssText || "" } catch (n) { } return "" }, n.prototype.submitHyperLinkDialog = function () { var e = this, n = e.dialog, i = t("#radMail", n), s = t("." + ni + " input", n), o = t("." + si + " input", n), u = t("." + ui + " input", n), a = t("." + oi + " select", n), f = s.val(), l = o.val(), c = a.val(), h = t("#radLinkTypeIsImage", n), p = h.prop("checked"), d = t("." + ai + " input", n).val(), v = t("." + fi + " input", n).val(), m = t("." + li + " input", n).val(), g = u.val(); if (f === "") { r(this.localizeString("errorMessageAddressError", "Please input address!")); return } if (l === "" && !p) { r(this.localizeString("errorMessageDisplayTextError", "Please input display text!")); return } if (d === "" && p) { r(this.localizeString("errorMessageHyperLinkImageUrlError", "Please input image url!")); return } if (!e._isNumeric(v) && p) { r(this.localizeString("errorMessageHyperLinkImageWidthError", "Please input correct image width!")); return } if (!e._isNumeric(m) && p) { r(this.localizeString("errorMessageHyperLinkImageHeightError", "Please input correct image height!")); return } if (i.attr("checked") && !e._isEmail(f)) { r(this.localizeString("errorMessageHyperLinkEmail", "Please input correct email!")); return } p && (l = '<img src="' + d + '" width="' + v + '" height="' + m, l += '"/>'), e._editLink(l, f, g, c), e._closeDialog() }, n.prototype._editLink = function (e, t, n, r) { var i = this, s, o = ""; i.focus(), s = i._getInspectElement(); try { if (s && s.tagName === "A") { s.innerHTML = e, s.href = t, s.target = r, n !== s.style.cssText && (s.style.cssText = n), i._addtoUndoBuffer(), i._setSaveBtnEnabled(); return } } catch (u) { } o = '<a href="' + t + '" target="' + r + '"', n !== "" && (o += ' style="' + n + '"'), o += ">" + e + "</a>", i._setIESelection(), i.insertHTML(o) }, n.prototype.anchorListOnChanged = function (e) { var n = this, r = n.dialog, i = t(e).val(); i !== "" && (t("." + ni + " input", r).val(i), t("#radAnchor", r).attr("checked", "checked")) }, n.prototype.radioListOnChanged = function () { var e = this, n = e.dialog, r = t("." + ii, n), i = t("." + ni + " input", n); i.val(""), t("#radUrl", n).is(":checked") ? r.hide() : t("#radAnchor", n).is(":checked") ? r.show() : t("#radMail", n).is(":checked") ? (r.hide(), i.val("mailto:")) : t("#radFile", n).is(":checked") && r.hide() }, n.prototype.linkIconTypeOnChanged = function () { var e = this, n = e.dialog, r = t("." + ci, n), i = t("." + si, n); t("#radLinkTypeIsText", n).is(":checked") ? (i.show(), r.hide()) : t("#radLinkTypeIsImage", n).is(":checked") && (i.hide(), r.show()) }, n.prototype._getDialogRes_Code = function () { var e = this, t = e._createDiv(ti); return t.add(e._createElement("div", "Enter source code", { "class": vi })), t.add(e._createElement("textarea", "", { "class": di })), t.add(e._createSeparator()), t.add(e._createOKCancelButtons()), t.render() }, n.prototype.initInsertCodeDialog = function () { var e = this, t = e.dialog; t.delegate(ms, "click." + e.widgetName, function (t) { e.submitCodeDialog(), e._onDesignViewBlur(t) }).delegate(gs, "click." + e.widgetName, function () { e._closeDialog() }) }, n.prototype.submitCodeDialog = function () { var e = this, n = e.dialog, r = t("." + di, n), i = r.val(); if (i === "") return; i = i.replace(/</g, "&lt;"), i = i.replace(/>/g, "&gt;"), i = "<pre>" + i + "</pre>", e._setIESelection(), e.insertHTML(i), e._closeDialog() }, n.prototype.initTagInspectorDialog = function () { var e = this, n = e.dialog, r = t("." + xi); n.delegate(ms, "click." + e.widgetName, function (t) { e.submitTagInspectorDialog(), e._onDesignViewBlur(t) }).delegate(gs, "click." + e.widgetName, function () { e._closeDialog() }).delegate("#displayNoEmpty", "click." + e.widgetName, function () { e.tagInspectorDialogSwitchAttList(this) }), e._laySelectedElementAttributes(t("." + Si, n), t("." + bi, n)), t("." + Ti + " input", n).val(e._getSelectedElementStyle()), e._selectedElementCanHaveChildren() ? (r.show(), t("textarea", r).val(e._getSelectedElementInnerHTML())) : r.hide() }, n.prototype.submitTagInspectorDialog = function () { var e = this, n = e.dialog, r = e._getInspectElement(), i = t("." + Si, n), s = t("." + Ti + " input").val(), o = t("." + xi + " textarea").val(); try { t.each(t("input:checkbox", i), function (e, n) { var i, s, o = t(n); o.is(":checked") && (i = o.siblings("span").text(), i = i.substring(0, i.length - 1), s = o.siblings("input:text").val(), t(r).attr(i, s)) }), t.trim(s) !== "" && (r.style.cssText = s), e._selectedElementCanHaveChildren() && t(r).html(o) } catch (u) { } e._closeDialog(), e._addtoUndoBuffer(), e._setSaveBtnEnabled() }, n.prototype.tagInspectorDialogSwitchAttList = function (e) { var n = t("." + Si, this.dialog), r = !e.checked; t.each(t("input:text", n), function (e, n) { t(n).val() === "" && t(n).parent("li")[r ? "show" : "hide"]() }) }, n.prototype._laySelectedElementAttributes = function (e, n) { var r = this, i = r._getInspectElement(), s, o, u, a = this.localizeString("tagInspectorDialogSave", "Save"), f = ""; if (!i) return; n.html(i.tagName), s = r._getDictionaryDeclare(), o = i.tagName.toLowerCase(), u = s[o]; switch (o) { case "ul": case "u": case "textarea": case "tbody": case "tr": case "th": case "td": case "table": case "select": case "strong": case "span": case "p": case "option": case "ol": case "li": case "label": case "input": case "img": case "i": case "hr": case "form": case "font": case "em": case "div": case "code": case "button": case "body": case "b": case "a": f += "<ul class='ui-helper-reset'>", t.each(u, function (e, t) { var n = i.getAttribute(t) || ""; f += "<li><span class='" + Cr + "'>", f += t + ":</span>", f += "<input type='text' value='" + n + "'/>", f += "<input type='checkbox' id='save" + e + "'/>", f += "<label for='save" + e + "'>" + a + "</label></li>" }) } e.html(f) }, n.prototype._getSelectedElementStyle = function () { var e = this._getInspectElement(); return e && e.style ? e.style.cssText || "" : "" }, n.prototype._getSelectedElementInnerHTML = function () { var e = this._getInspectElement(); return e ? e.innerHTML : "" }, n.prototype._selectedElementCanHaveChildren = function () { return !t(this._getInspectElement()).is("input,hr,br,img") }, n.prototype.initBackColorDialog = function () { this._initColorDialog("BackColor") }, n.prototype.initForeColorDialog = function () { this._initColorDialog("ForeColor") }, n.prototype._initColorDialog = function (e) { var n = this, r = n.dialog, i = n._getDesignViewDocument(), s = i.queryCommandValue(e), u, a, f; r.delegate(ms, "click." + n.widgetName, function (t) { n.submitColorDialog(e), n._onDesignViewBlur(t) }).delegate(gs, "click." + n.widgetName, function () { n._closeDialog() }), s && (f = s.toString(), t.browser.mozilla && f === "transparent" && (f = "#ffffff"), t.browser.msie && (u = o(f), f = "rgb(" + (u & 255) + ", " + ((u & 65280) >> 8) + ", " + ((u & 16711680) >> 16) + ")"), f.indexOf("rgb(") === 0 ? (a = f.substring(4, f.length - 1).split(","), f = n._convertToWebColor(o(a[0]), o(a[1]), o(a[2]))) : f.indexOf("rgba(") === 0 && (a = f.substring(5, f.length - 1).split(","), f = n._convertToWebColor(o(a[0]), o(a[1]), o(a[2]))), t("." + ki + " input", r).attr("value", f)), t("." + Ci, r).wijeditorcolorcanvas("." + ki + " input", f) }, n.prototype.submitColorDialog = function (e) { var n = this, r = t("." + ki + " input", n.dialog); n.setColor(e, r.val()), n._closeDialog() }, n.prototype.setColor = function (e, n) { var r = this, i = r._getDesignViewDocument(), s = r._getDesignViewWindow(), o; r._setIESelection(), t.browser.mozilla && e === "BackColor" ? (o = s.getSelection(), r.insertHTML('<span style="background-color:' + n + ';">' + o + "</span>")) : (i.execCommand(e, !1, n), r.options.mode === "bbcode" && !t.browser.msie && r._convertFontStyleToStandTag()), r._addtoUndoBuffer(), r._setSaveBtnEnabled() }, n.prototype.initInsertTableDialog = function () { var e = this, t = e.dialog; t.delegate(ms, "click." + e.widgetName, function (t) { e.submitInsertTableDialog(), e._onDesignViewBlur(t) }).delegate(bs, "click." + e.widgetName, function () { e._closeDialog() }).delegate("." + ji + " input:button", "click." + e.widgetName, function () { e.showTableColorDialog(this) }) }, n.prototype.submitInsertTableDialog = function () { var e = this, t = e._getValuesFromTableDialog(); if (!t) return; e._insertTable(t), e._closeDialog() }, n.prototype._insertTable = function (e) { var n = this, r = "", i, s; if (!e) return !1; n.focus(), r += '<table width="' + e.width + '" height="' + e.height + '" cellspacing="' + e.cspacing + '" cellpadding="' + e.cpadding + '" border="' + e.border + '" bgcolor="' + e.bgcolor + '" style="' + e.css + '">'; for (i = 0; i < e.rows; i++) { r += "<tr>"; for (s = 0; s < e.cols; s++) r += "<td>Cell " + (i + 1) + "-" + (s + 1) + "</td>"; r += "</tr>" } r += "</table>"; if (t.browser.mozilla || t.browser.msie && o(t.browser.version) >= 9) r += "<br />"; n.insertHTML(r) }, n.prototype.initEditTableDialog = function () { var e = this, n = e.dialog, r = e._getInspectElement(), i, s; n.delegate(ms, "click." + e.widgetName, function (t) { e.submitEditTableDialog(), e._onDesignViewBlur(t) }).delegate(bs, "click." + e.widgetName, function () { e._closeDialog() }).delegate("." + ji + " input:button", "click." + e.widgetName, function () { e.showTableColorDialog(this) }); if (!r) return; try { i = r.rows, i.length > 0 ? s = i[0].cells.length : s = 0, i = i.length } catch (o) { } t("." + Ai + " input", n).val(i), t("." + Oi + " input", n).val(s), t("." + Mi + " input", n).val(r.getAttribute("width")), t("." + _i + " input", n).val(r.getAttribute("height")), t("." + Di + " input", n).val(r.getAttribute("border")), t("." + Pi + " input", n).val(r.getAttribute("cellPadding")), t("." + Hi + " input", n).val(r.getAttribute("cellSpacing")), t("." + ji + " input", n).val(r.getAttribute("bgcolor") || "#ffffff"), t("." + Bi + " input", n).val(r.style.cssText) }, n.prototype.submitEditTableDialog = function () { var e = this, n = e._getInspectElement(), r = t(n), i = e._getValuesFromTableDialog(), s = i && o(i.rows), u = i && o(i.cols), a, f; if (!i) return; if (n) { r.attr("width", i.width), r.attr("height", i.height), r.attr("bgcolor", i.bgcolor), r.attr("border", i.border), r.attr("cellSpacing", i.cspacing), r.attr("cellPadding", i.cpadding), n.style.cssText = i.css; if (!s || isNaN(s)) return; if (!u || isNaN(u)) return; while (n.rows.length > s) n.deleteRow(0); while (n.rows.length < s) { a = n.insertRow(0); while (a.cells.length < u) f = a.insertCell(0), f.innerHTML = "&nbsp;" } t.each(n.rows, function (e, t) { while (t.cells.length > u) t.deleteCell(0); while (t.cells.length < u) f = t.insertCell(0), f.innerHTML = "&nbsp;" }) } e._closeDialog() }, n.prototype._getValuesFromTableDialog = function () { var e = this, n = e.dialog, i = t("." + Ai + " input", n).val(), s = t("." + Oi + " input", n).val(), u = t("." + Mi + " input", n).val(), a = t("." + _i + " input", n).val(), f = t("." + Di + " input", n).val(), l = t("." + Pi + " input", n).val(), c = t("." + Hi + " input", n).val(), h = t("." + Bi + " input", n).val(), p = t("." + ji + " input", n).val(); return e._isNumeric(i) ? e._isNumeric(s) ? e._isNumeric(u) ? e._isNumeric(a) ? e._isNumeric(f) ? e._isNumeric(l) ? e._isNumeric(c) ? { rows: i, cols: s, width: o(u), height: o(a), border: f, cpadding: l, cspacing: c, css: h, bgcolor: p } : (r(this.localizeString("tableDialogCellSpacingError", "Please input a number for 'Cell Spacing' textbox.")), !1) : (r(this.localizeString("tableDialogCellPaddingError", "Please input a number for 'Cell Padding' textbox.")), !1) : (r(this.localizeString("tableDialogBorderError", "Please input a number for 'Border thickness' textbox.")), !1) : (r(this.localizeString("errorMessageTableHeightError", "Please input a number for 'Table Height' textbox.")), !1) : (r(this.localizeString("errorMessageTableWidthError", "Please input a number for 'Table Width ' textbox.")), !1) : (r(this.localizeString("errorMessageColumnsError", "Please input a number for 'Columns' textbox.")), !1) : (r(this.localizeString("errorMessageRowsError", "Please input a number for 'Rows' textbox.")), !1) }, n.prototype.showTableColorDialog = function (e) { var n = this, r, i = n.subDialog, s = t(e).prev().val(), u = n._getDialogRes_Color(); r = { width: "auto", height: "auto", modal: !0, title: "Set Background Color", position: "center", resizable: !1, captionButtons: { pin: { visible: !1 }, refresh: { visible: !1 }, toggle: { visible: !1 }, minimize: { visible: !1 }, maximize: { visible: !1 } } }, i.empty().append(u), t.browser.msie && o(t.browser.version) === 6 ? window.setTimeout(function () { i.wijdialog(r) }, 0) : i.wijdialog(r), i.delegate(ys, "click." + n.widgetName, function () { n.submitTableColorDialog() }).delegate(bs, "click." + n.widgetName, function () { n.closeSubDialog() }), s !== "" && t("." + ki + " input", i).val(s), t("." + Ci, i).wijeditorcolorcanvas("." + ki + " input", s), i.wijdialog("open") }, n.prototype.submitTableColorDialog = function () { var e = this, n = e.subDialog, r = e.dialog, i = t("." + ki + " input", n).val(); t("." + ji + " input:text", r).val(i), e.closeSubDialog() }, n.prototype.closeSubDialog = function () { this.subDialog.wijdialog("close") }, n.prototype._getEditableTable = function () { var e = this, n, i, s; i = e._getSelectedElement(); if (!i) return r(this.localizeString("errorMessageSelectTableError", "Please select a table!")), !1; s = t(i); if (s.is("td,tr,tbody")) i = s.parents("table:first")[0]; else { n = s.find("table:only-child"); if (!t.browser.msie || !n.length) return r(this.localizeString("errorMessageSelectTableError", "Please select a table!")), !1; i = n[0] } return g = i, !0 }, n.prototype.initPreviewDialog = function () { var e = this, t = e.dialog; e._setPreviewContent(0), t.delegate("#rad640_480", "click." + e.widgetName, function () { e._setPreviewDialogSize(640, 480) }).delegate("#rad800_600", "click." + e.widgetName, function () { e._setPreviewDialogSize(800, 600) }).delegate("#rad1024_768", "click." + e.widgetName, function () { e._setPreviewDialogSize(1024, 768) }).delegate("#chkSplit", "click." + e.widgetName, function () { e._splitPreviewPages(this.checked) }).delegate("." + zi, "click." + e.widgetName, function () { e._printPreviewPage(!0) }).delegate("." + Wi, "click." + e.widgetName, function () { e._printPreviewPage(!1) }).delegate("." + Xi, "click." + e.widgetName, function () { e._closeDialog() }).delegate("." + Ri, "click." + e.widgetName, function () { e._navigatePreviewPage(!1) }).delegate("." + Ui, "click." + e.widgetName, function () { e._navigatePreviewPage(!0) }) }, n.prototype._setPreviewContent = function (e) { var n = this, r = n.dialog, i = t("iframe", r), s = t("." + qi + " span", r), o = i[0].contentWindow.document; o.open(), e === -1 ? (o.write(n._getPreviewAllPageContent()), s.html("1 / 1")) : (o.write(n._getPreviewPageContent(e)), s.html(e + 1 + " / " + n._getPreviewPageCount())), o.close() }, n.prototype._setPreviewDialogSize = function (e, n) { var r = this, i = r.dialog, s = t("iframe", i), o = i.wijdialog("option", "width"), u = i.wijdialog("option", "height"); o === "auto" ? o = i.parent(".wijmo-wijdialog").width() - s.width() : o -= s.width(), u === "auto" ? u = i.parent(".wijmo-wijdialog").height() - s.height() : u -= s.height(), s.css("width", e).css("height", n), i.wijdialog("option", { width: e + o, height: n + u }) }, n.prototype._getPreviewPageCount = function () { return this._getPreviewPages().length }, n.prototype._getPreviewPageContent = function (e) { var t = this._getPreviewPages(); return t.length > e ? t[e] : null }, n.prototype._getPreviewAllPageContent = function () { return this._getDesignViewText() }, n.prototype._getPreviewPages = function () { var e = this._getPreviewAllPageContent(), t = new RegExp("<(DIV|div)[^>]*(page-break-before|PAGE-BREAK-BEFORE)[ ]*:[ ]*always[^>]*>(.*?)<\\/(DIV|div)>", "g"), n = e.replace(t, "!-~U^n#i@q,P|.a=g~e+br!"); return n.split("!-~U^n#i@q,P|.a=g~e+br!") }, n.prototype._splitPreviewPages = function (e) { var n = this, r = n.dialog, i = t("." + Vi, r), s = t("." + qi, r); e ? (n._setPreviewContent(0), s.show(), i.hide()) : (n._setPreviewContent(-1), s.hide(), i.show()), n._curPageIdx = 0 }, n.prototype._navigatePreviewPage = function (e) { var n = this, r = t("#chkSplit", n.dialog), i = n._curPageIdx, s = n._getPreviewPageCount(); r.is(":checked") && (e ? (i++, i < s ? n._setPreviewContent(i) : i = s - 1) : (i--, i >= 0 ? n._setPreviewContent(i) : i = 0), n._curPageIdx = i) }, n.prototype._printPreviewPage = function (e) { var n = this, r = n.dialog, i = t("#chkSplit", r), s = t("iframe", r)[0].contentWindow; e && (i.removeAttr("checked"), n._setPreviewContent(-1)), s.focus(), s.print() }, n.prototype.initCleanUpDialog = function () { var e = this, n = e.dialog; t("textarea", n).val(e.sourceView.val()), n.delegate(ms, "click." + e.widgetName, function (t) { e.submitCleanUpDialog(), e._onDesignViewBlur(t) }).delegate(gs, "click." + e.widgetName, function () { e._closeDialog() }) }, n.prototype.submitCleanUpDialog = function () { var e = this, n = e.dialog, r = e.sourceView, i = r.val(), s; t("#replaceSpans", n).is(":checked") && (s = new RegExp("<\\/?SPAN[^>]*>", "g"), i = i.replace(s, "")), t("#replaceClass", n).is(":checked") && (s = new RegExp("<(\\w[^>]*) class=([^ |>]*)([^>]*)", "g"), i = i.replace(s, "<$1$3")), t("#replaceStyle", n).is(":checked") && (s = new RegExp('<(\\w[^>]*) style="([^"]*)"([^>]*)', "g"), i = i.replace(s, "<$1$3"), s = new RegExp("<(\\w[^>]*) lang=([^ |>]*)([^>]*)", "g"), i = i.replace(s, "<$1$3"), s = new RegExp("<\\\\?\\?xml[^>]*>", "g"), i = i.replace(s, ""), s = new RegExp("<\\/?\\w+:[^>]*>", "g"), i = i.replace(s, "")), t("#replaceNbsp", n).is(":checked") && (s = new RegExp("&nbsp;", "g"), i = i.replace(s, " ")), t("#transformPtoDiv", n).is(":checked") && (s = new RegExp("(<P)([^>]*>.*?)(<\\/P>)", "g"), i = i.replace(s, "<div$2</div>")), r.val(i), e._setDesignViewText(i), e._addtoUndoBuffer(), e._closeDialog() }, n.prototype.initFindDialog = function () { var e = this, t = e.dialog; e.tRange && (e.tRange = null), t.delegate(ms, "click." + e.widgetName, function () { e.submitFindAction() }).delegate(gs, "click." + e.widgetName, function (t) { e.submitReplaceAction(), e._onDesignViewBlur(t) }) }, n.prototype.submitFindAction = function () { var e = this, n = t("textarea:first", e.dialog).val(); if (t.trim(n) === "") return; e._findAndReplaceString(n) }, n.prototype.submitReplaceAction = function () { var e = this, n = e.dialog, i = t("textarea:first", n).val(), s = t("textarea:last", n).val(); if (t.trim(i) === "") return; if (t.trim(s) === "") { r(this.localizeString("errorMessageReplaceStringError", "please input replace string!")); return } e._findAndReplaceString(i, s) }, n.prototype._findAndReplaceString = function (e, n) { var i = this, s = i._getDesignViewWindow(), o = 0, u = !1, a = n && n !== e; n || (n = e); if (t.browser.msie) i.tRange && (i.txtFoundInIE && a ? (o = i.tRange.findText(e), o && (i.tRange.pasteHTML(n), i.tRange.collapse(!1), u = !0, i.txtFoundInIE = !1)) : (i.tRange.collapse(!1), o = i.tRange.findText(e), o && i.tRange.select())), !u && (!i.tRange || !o) && (i.tRange = s.document.body.createTextRange(), o = i.tRange.findText(e), o && (i.tRange.select(), a && (i.tRange.pasteHTML(n), u = !0))); else { if (i.txtFoundInNoneIE && a) i._replaceSelectionForNoneIE(n), u = !0, i.txtFoundInNoneIE = !1; else { o = s.find(e); if (!o) { o = s.find(e, 0, 1); while (s.find(e, 0, 1)) continue } } i.txtFoundInNoneIE = i.txtFoundInNoneIE || o, i.txtFoundInNoneIE && a && (i._replaceSelectionForNoneIE(n), u = !0, i.txtFoundInNoneIE = !1) } !o && !u ? (r('"' + e + '"' + this.localizeString("errorMessageFindTextError", " String Not Found!")), i.tRange = null, i.txtFoundInNoneIE = !1, i.txtFoundInIE = !1) : i.txtFoundInIE = !0 }, n.prototype._replaceSelectionForNoneIE = function (e) { var t = this._getDesignViewDocument(); t.execCommand("inserthtml", !1, e) }, n.prototype.initMediaDialog = function () { var e = this, t = e.dialog; t.delegate(ms, "click." + e.widgetName, function (t) { e.submitMediaDialog(), e._onDesignViewBlur(t) }).delegate(gs, "click." + e.widgetName, function () { e._closeDialog() }) }, n.prototype.submitMediaDialog = function () { var e = this, n = e.dialog, i = t("select", n).val(), s = t("." + rs + " input", n).val(), o = t("." + is + " input", n).val(), u = t("." + ss + " input", n).val(); if (s === "") { r(this.localizeString("errorMessageUrlEmptyError", "URL is empty!")); return } if (!e._isUrl(s)) { r(this.localizeString("errorMessageUrlCorrectError", "please input correct URL!")); return } if (!e._isNumeric(o)) { r(this.localizeString("errorMessageMediaWidthError", "please input width of the media!")); return } if (!e._isNumeric(u)) { r(this.localizeString("errorMessageMediaHeightError", "please input height of the media!")); return } e._insertMedia(i, s, o, u), e._closeDialog() }, n.prototype._insertMedia = function (e, t, n, r) { var i = this, s = ""; i._setIESelection(); switch (e) { case "video": s += '<embed src="' + t + '" width="' + n + '" ' + 'height="' + r + '" ' + 'type=audio/x-pn-realaudio-plugin console="Clip1" ' + 'controls="IMAGEWINDOW,ControlPanel,StatusBar" ' + 'autostart="true"></embed>'; break; case "flash": s += '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,29,0" width="' + n + '" height="' + r + '">', s += '<param name="movie" value="' + t + '">', s += '<param name="quality" value="high">', s += '<embed src="' + t + '" quality="high" ' + 'pluginspage="http://www.macromedia.com/go/getflashplayer" ' + 'type="application/x-shockwave-flash" ' + 'width="' + n + '" height="' + r + '"></embed>', s += "</object>"; break; case "applet": s += '<applet code="' + t + '" width="' + n + '" ' + 'height="' + r + '"></applet>'; break; case "other": s += '<embed src="' + t + '" width="' + n + '" ' + 'height="' + r + '"></embed>' } i.insertHTML(s) }, n.prototype.initSpecialCharacterDialog = function () { var e = this, n = e.dialog, r = t("." + fs + " span", n); n.delegate("label", "click." + e.widgetName, function (t) { e.submitSpecialCharacterDialog(this), e._onDesignViewBlur(t) }).delegate(ms, "click." + e.widgetName, function () { e._closeDialog() }).delegate("label", "mouseover." + e.widgetName, function () { r.html(t(this).html()) }).delegate("label", "mouseout." + e.widgetName, function () { r.empty() }) }, n.prototype.submitSpecialCharacterDialog = function (e) { var n = this; n._setIESelection(), n.insertHTML(t(e).html()), n._closeDialog() }, n.prototype._setSaveBtnEnabled = function () { this.$ribbon.wijribbon(y, Mt, !1) }, n.prototype._undoAction = function () { var e = this._getDesignViewDocument().body, t = {}; d--, d <= 0 && (d = 0), e.innerHTML = v[d], d ? this.$ribbon.wijribbon(y, bt, !1) : (t[yt] = !0, t[bt] = !1, this.$ribbon.wijribbon(b, t)) }, n.prototype._redoAction = function () { var e = this._getDesignViewDocument().body, t = v.length, n = {}; d++, d >= t - 1 && (d = t - 1), e.innerHTML = v[d], d === t - 1 ? (n[yt] = !1, n[bt] = !0, this.$ribbon.wijribbon(b, n)) : this.$ribbon.wijribbon(y, yt, !1) }, n.prototype._addtoUndoBuffer = function () { var e = v.length - 1 - d, t; for (t = 0; t < e; t++) v.pop(); d++, v.push(this._getDesignViewText()), this.$ribbon.wijribbon(y, yt, !1) }, n.prototype._deleteSelectionContent = function () { var e = this._getDesignViewWindow(), n, r, i, s = "rangeCount"; if (t.browser.msie) n = e.document.selection, n.type.toLowerCase() !== "none" && n.clear(); else { n = e.getSelection(); for (r = 0; r < n[s]; r++) i = n.getRangeAt(r), i.deleteContents() } }, n.prototype._refreshPathSelector = function () { var e = this, n = e._getParentElement(e._getDesignViewWindow()), r, i = e._getPathSelector(), s = t(n).parents(), o = s.length, u = "wijmo-wijeditor-label ui-state-default ui-corner-all", a; if (!n) return; r = n.tagName ? n.tagName.toLowerCase() : "", i.empty(); for (a = o - 1; a >= 0; a--) i.append("<label class='" + u + "'>&lt;" + s[a].tagName.toLowerCase() + "&gt;</label>"); i.append("<label class='" + u + " wijmo-wijeditor-selectlabel ui-state-highlight ui-corner-all'>&lt;" + r + "&gt;</label>") }, n.prototype._toggleTableBorders = function () { var e = this._getDesignViewDocument(), n = t("#__wijStyle", e); p = !p, t.browser.safari ? p ? n.html("table,td,tr{border: 1px #acacac dashed;}") : n.empty() : n.prop("disabled", !p) }, n.prototype._tableAction = function (e) { var n = this, i = n._getParentElement(n._getDesignViewWindow()), s = t(i).closest("td"), o, u, a, f, l, c, h, p, d, v, m = 0; n._setSaveBtnEnabled(); if (s.length === 0 && e !== j) return !1; e !== j && (o = s.parent(), u = o.closest("table"), a = s[0], f = o[0], l = u[0], c = f.rowIndex, h = a.cellIndex); try { switch (e) { case P: p = f.cells.length, v = l.insertRow(c); for (m = 0; m < p; m++) n._insertCell(v, m); break; case I: l.deleteRow(c); break; case D: d = l.rows.length; for (m = 0; m < d; m++) n._insertCell(l.rows[m], h); break; case F: n._removeColumn(l, h); break; case H: n._insertCell(f, h + 1); break; case q: p = f.cells.length, p === 1 ? l.deleteRow(c) : f.deleteCell(h); break; case B: n._splitCell(l, f, c, h); break; case j: n._mergeCell(n._getSelectedCells(i)) } this._addtoUndoBuffer() } catch (g) { return r(g.message), !1 } return !0 }, n.prototype._removeColumn = function (e, t) { var n = e.rows.length, r = 0, i, s, o, u, a; while (r < n) i = e.rows[r], s = i.cells, o = s.length, u = t > o - 1 ? o - 1 : t, a = s[u].colSpan, a > 1 && o > 1 && (u + 1 < o ? s[u + 1].colSpan += a - 1 : s[u - 1].colSpan += a + 1), o === 1 ? (e.deleteRow(r), n = e.rows.length) : (i.deleteCell(u), r++) }, n.prototype._splitCell = function (e, t, n, r) { var i = e.rows.length, s = 0, o = 0, u, a, f, l, c; while (s <= r) t.cells[s].colSpan > 1 && (o += t.cells[s].colSpan - 1), s++; this._insertCell(t, r + 1); for (f = 0; f < i; f++) { u = e.rows[f]; if (f !== n) { l = r, s = 0, a = 0; while (s <= l) u.cells[s].colSpan > 1 && (a += u.cells[s].colSpan - 1, l -= a), s++; c = r + o - a, c < 0 && (c = 0), u.cells[c].colSpan++ } } }, n.prototype._mergeCell = function (e) { var t = e.length, n, r, i, s; if (t < 2 || e[0].parentNode !== e[t - 1].parentNode) return !1; n = e[0].parentNode, r = e[0].cellIndex, i = r + t; for (s = r + 1; s < i; s++) n.cells[r].innerHTML += n.cells[r + 1].innerHTML, n.cells[r].colSpan++, n.deleteCell(r + 1) }, n.prototype._getSelectedCells = function (e) { var n = this._getDesignViewWindow(), r = n.document, i = [], s, o, u, a, f, l, c, h; if (t.browser.msie) s = r.selection.createRange(), o = t(e).closest("tr")[0], o && t.each(o.cells, function (e, t) { var n = r.selection.createRange(), o = "compareEndPoints"; n.moveToElementText(t), (s.inRange(n) || s[o]("StartToStart", n) >= 0 && s[o]("StartToEnd", n) <= 0 || s[o]("EndToStart", n) >= 0 && s[o]("EndToEnd", n) <= 0) && i.push(t) }); else if (t.browser.mozilla) { u = n.getSelection(), f = u.rangeCount; for (a = 0; a < f; a++) s = u.getRangeAt(a), l = s.startContainer, c = l.nodeName.toLowerCase(), c === "td" || c === "th" ? i.push(l) : c === "tr" && (h = s.startOffset, i.push(l.cells[h])) } else { u = n.getSelection(), o = t(e).closest("tr")[0]; if (o) { f = o.cells.length; for (a = 0; a < f; a++) i.push(o.cells[a]) } } return i }, n.prototype.insertDateAndTime = function () { var e = new Date; this.options.culture && this.options.culture !== "" ? this.insertHTML(Globalize.format(e, "dddd ", Globalize.findClosestCulture(this.options.culture)) + Globalize.format(e, "F", Globalize.findClosestCulture(this.options.culture))) : this.insertHTML(e.toDateString() + " " + e.toTimeString()) }, n.prototype._toggleWordWrap = function () { var e = this, n = e.sourceView, r = "wrap", s; h = !h, s = h ? "soft" : "off", n.attr(r, s), n[0].focus(), t.browser.mozilla && (n.hide(), i.setTimeout(function () { n.show() }, 40)) }, n.prototype.insertHTML = function (e) { var n = this, r = n._getDesignViewDocument(), i; try { t.browser.msie ? (i = r.selection.createRange(), i.pasteHTML(e), i.collapse(!1), i.select()) : r.execCommand("insertHTML", !1, e) } catch (s) { } n._addtoUndoBuffer(), n._setSaveBtnEnabled() }, n.prototype._getSelectedContent = function () { var e = this._getDesignViewWindow(), t = e.document, n = "", r = "cloneContents", i, s, o; return t.selection ? (i = t.selection.createRange(), i.htmlText) : (i = e.getSelection().getRangeAt(0), i && i[r] && (s = i[r](), o = document.createElement("div"), o.appendChild(s), n = o.innerHTML, o = null), n || "") }, n.prototype._setIESelection = function () { t.browser.msie && m && m.select() }, n.prototype._setIEFocus = function () { var e = this._getDesignViewDocument(); if (t.browser.msie) try { e.body.focus() } catch (n) { } }, n.prototype.focus = function () { var e = this._getDesignViewWindow(), n = e.document; t.browser.msie ? m ? m.select() : n.body.focus() : e.focus() }, n.prototype._getInspectElement = function () { return g || this._getSelectedElement() }, n.prototype._getSelectedElement = function () { return this._getParentElement(this._getDesignViewWindow()) }, n.prototype._createElement = function (e, t, n) { return new Cs(e, t, n) }, n.prototype._createDiv = function (e, t) { return this._createElement("div", { "class": e }) }, n.prototype._createSpan = function (e, t) { var n = this; return t ? e.length === 0 ? n._createElement("span", t) : this._createElement("span", t, { "class": e }) : n._createElement("span", { "class": e }) }, n.prototype._createTextBox = function (e, t) { var n = { "class": e, type: "text", value: undefined }; return t && (n.value = t), this._createElement("input", n) }, n.prototype._createLabel = function (e, t) { return t ? new Cs("label", e, { "for": t }) : new Cs("label", e) }, n.prototype._createRadio = function (e, t, n) { var r = { name: t, id: e, value: n, type: "radio" }; return this._createElement("input", r) }, n.prototype._createCheckbox = function (e) { var t = { type: "checkbox", id: e }; return this._createElement("input", "", t) }, n.prototype._createSelect = function (e, n) { var r = this, i = { "class": e }, s = r._createElement("select", i); return e === "" && (s = r._createElement("select")), t.each(n, function (e, n) { t.isPlainObject(n) && n.selected ? s.add(r._createElement("option", n.text, { selected: "selected" })) : s.add(r._createElement("option", n)) }), s }, n.prototype._createInputButton = function (e, t) { var n = { "class": e, type: "button", value: undefined }; return t && (n.value = t), this._createElement("input", n) }, n.prototype._createTextField = function (e, t, n, r) { var i = this, s = i._createDiv(t), o = { type: "text", value: "" }; return r && (o.value = r), s.add(i._createSpan(Cr, e)), s.add(i._createElement("input", o)), n && s.add(new Ns(n)), s }, n.prototype._createSeparator = function () { var e = this, t = e._createDiv(xr); return t.add(e._createElement("hr")), t }, n.prototype._createOKCancelButtons = function () { var e = this, t = e._createDiv(Tr); return t.add(e._createElement("input", { type: "button", "class": Nr, value: this.localizeString("dialogOK", "OK") })), t.add(e._createElement("input", { type: "button", "class": Nr, engValue: "Cancel", value: this.localizeString("dialogCancel", "Cancel") })), t }, n.prototype._getDialogRes_Template = function () { var e = this, t = e._createDiv(Ir), n = e._createDiv(qr), r = e._createDiv(zr), i = e._createDiv(Wr), s = e._createDiv(Xr), o = e._createDiv(Vr), u = e._createElement("div", this.localizeString("templateDialogName", "Name :")), a = e._createElement("div", this.localizeString("templateDialogDescription", "Description :")), f = e._createDiv(Kr), l = e._createDiv(Yr); return n.add(e._createElement("div", this.localizeString("templateDialogSelectTemplate", "Select Template:"), { "class": Rr })), n.add(e._createElement("div", this.localizeString("templateDialogTemplatePreview", "Template Preview:"), { "class": Ur })), t.add(n), i.add(e._createElement("select", { size: 8 })), s.add(e._createElement("iframe", { frameborder: 0 })), r.add(i), r.add(s), t.add(r), u.add(e._createSpan($r)), a.add(e._createSpan(Jr)), o.add(u), o.add(a), t.add(o), f.add(e._createSpan(Cr, this.localizeString("templateDialogName", "Name :"))), f.add(e._createTextBox(Qr)), f.add(e._createSpan(Cr, this.localizeString("templateDialogDescription", "Description :"))), f.add(e._createTextBox(Gr)), t.add(f), l.add(e._createInputButton(Nr + " " + Zr, this.localizeString("templateDialogDeleteSelected", "Delete selected"))), l.add(e._createInputButton(Nr + " " + ei, this.localizeString("templateDialogSaveCurrentPage", "Save current page as template"))), t.add(l), t.add(e._createSeparator()), t.add(e._createOKCancelButtons()), t.render() }, n.prototype._getDialogRes_ImageBrowser = function () { var e = this, t = e._createDiv(kr), n = e._createDiv(Lr), r = e._createDiv(Ar), i = e._createDiv(Or), s = e._createDiv(Mr), o = e._createDiv(_r); return r.add(e._createTextField(this.localizeString("imageEditorDialogImageSrc", "Image Src:"), Dr)), r.add(e._createTextField(this.localizeString("imageEditorDialogImageAltText", "Image alt text:"), Pr)), r.add(e._createTextField(this.localizeString("imageEditorDialogImageWidth", "Image width:"), Hr, this.localizeString("dialogPixel", "px"))), r.add(e._createTextField(this.localizeString("imageEditorDialogImageHeight", "Image height:"), Br, this.localizeString("dialogPixel", "px"))), r.add(e._createTextField(this.localizeString("imageEditorDialogCssText", "Css text:"), jr)), n.add(r), i.add(s), s.add(e._createElement("select", { size: 8 })), i.add(o), o.add(e._createElement("img", { src: "", alt: "" })), n.add(i), n.add(e._createSeparator()), n.add(e._createOKCancelButtons()), t.add(n), t.render() }, n.prototype._getDialogRes_Link = function () { var e = this, n = e._createDiv(ti), r = e._createTextField(this.localizeString("hyperLinkDialogAddress", "Address :"), ni), i = e._createDiv(ri + " ui-helper-clearfix"), s = e._createElement("div"), o = e._createDiv(ci), u = e._createDiv(hi), a = e._createElement("div"), f = [{ id: "radUrl", value: "url", text: this.localizeString("hyperLinkDialogUrl", "url") }, { id: "radAnchor", value: "anchor", checked: !0, text: this.localizeString("hyperLinkDialogAnchor", "anchor") }, { id: "radMail", value: "email", text: this.localizeString("hyperLinkDialogEmail", "email") }], l = [{ id: "radLinkTypeIsText", value: "text", checked: !0, text: this.localizeString("hyperLinkDialogText", "text") }, { id: "radLinkTypeIsImage", value: "image", text: this.localizeString("hyperLinkDialogImage", "image") }], c = [], h = e._createTextField(this.localizeString("hyperLinkDialogTextToDisplay", "Text to display :"), si), p = e._createSpan(Cr, this.localizeString("hyperLinkDialogIconType", "Icon Type :")), d = e._createDiv(oi), v = e._createSpan(Cr, this.localizeString("hyperLinkDialogTarget", "Target :")), m = [{ text: "_blank", selected: !0 }, "_parent", "_self", "_top"], g = e._createSelect(oi, m), y = e._createTextField(this.localizeString("hyperLinkDialogCss", "Css :"), ui), b; o.add(e._createTextField(this.localizeString("imageEditorDialogImageSrc", "Image Src:"), ai)), o.add(e._createTextField(this.localizeString("imageEditorDialogImageWidth", "Image width:"), fi, this.localizeString("dialogPixel", "px"))), o.add(e._createTextField(this.localizeString("imageEditorDialogImageHeight", "Image height:"), li, this.localizeString("dialogPixel", "px"))), n.add(r), n.add(i), i.add(s), u.add(a), a.add(p), t.each(f, function (t, n) { s.add(e._createRadio(n.id, "radioList", n.value)), s.add(e._createLabel(n.text, n.id)) }), t.each(l, function (t, n) { a.add(e._createRadio(n.id, "linkIconRadioList", n.value)), a.add(e._createLabel(n.text, n.id)) }); for (b = 1; b < 8; b++) c.push("#anchor" + b.toString()); return i.add(e._createSelect(ii, c)), n.add(e._createSeparator()), n.add(u), n.add(h), n.add(o), n.add(d), d.add(v), d.add(g), n.add(y), n.add(e._createSeparator()), n.add(e._createOKCancelButtons()), n.render() }, n.prototype._getDialogRes_TagInspector = function () { var e = this, t = e._createDiv(mi), n = e._createDiv(gi), r = e._createDiv(wi), i = e._createDiv(Ei), s = e._createDiv(xi); return t.add(n), n.add(e._createSpan(yi, this.localizeString("tagInspectorDialogSelectedTag", "Selected tag :"))), n.add(e._createSpan(bi, "")), t.add(r), r.add(e._createCheckbox("displayNoEmpty")), r.add(e._createLabel(this.localizeString("tagInspectorDialogDisplayNotEmptyAttributes", "Display not empty attributes only"), "displayNoEmpty")), t.add(i), i.add(e._createSpan(Cr, this.localizeString("tagInspectorDialogAttributes", "Attributes:"))), i.add(e._createDiv(Si)), t.add(s), s.add(e._createSpan(Cr, this.localizeString("tagInspectorDialogInnerHTML", "Inner HTML:"))), s.add(e._createElement("textarea")), t.add(e._createTextField(this.localizeString("tagInspectorDialogCSSText", "Css Text:"), Ti)), t.add(e._createSeparator()), t.add(e._createOKCancelButtons()), t.render() }, n.prototype._getDialogRes_Color = function () { return this._getDialogRes_CommonColor("#FFFFFF") }, n.prototype._getDialogRes_ForeColor = function () { return this._getDialogRes_CommonColor("#000000") }, n.prototype._getDialogRes_BackColor = function () { return this._getDialogRes_CommonColor("#FFFFFF") }, n.prototype._getDialogRes_CommonColor = function (e) { var t = this, n = t._createDiv(Ni), r = t._createDiv(ki); return n.add(t._createDiv(Ci)), n.add(r), r.add(t._createSpan(Cr, this.localizeString("backColorDialogSelectedColor", "Selected Color:"))), r.add(t._createElement("input", { type: "text", value: e })), n.add(t._createSeparator()), n.add(t._createOKCancelButtons()), n.render() }, n.prototype._getDialogRes_Table = function () { var e = this, t = e._createDiv(Li), n = e._createDiv(ji); return t.add(e._createTextField(this.localizeString("tableDialogRows", "Rows :"), Ai, "", 3)), t.add(e._createTextField(this.localizeString("tableDialogColumns", "Columns :"), Oi, "", 3)), t.add(e._createTextField(this.localizeString("tableDialogTableWidth", "Table Width :"), Mi, this.localizeString("tableDialogPixels", "pixels"), 200)), t.add(e._createTextField(this.localizeString("tableDialogTableHeight", "Table Height :"), _i, this.localizeString("tableDialogPixels", "pixels"), 200)), t.add(e._createTextField(this.localizeString("tableDialogBorder", "Border thickness:"), Di)), t.add(e._createTextField(this.localizeString("tableDialogCellPadding", "Cell Padding :"), Pi)), t.add(e._createTextField(this.localizeString("tableDialogCellSpacing", "Cell Spacing :"), Hi)), t.add(e._createTextField(this.localizeString("tableDialogCssText", "Css Text :"), Bi)), t.add(n), n.add(e._createSpan(Cr, this.localizeString("tableDialogBackgroundColor", "Background Color:"))), n.add(e._createElement("input", { type: "text" })), n.add(e._createElement("input", { type: "button", value: "..." })), t.add(e._createSeparator()), t.add(e._createOKCancelButtons()), t.render() }, n.prototype._getDialogRes_Preview = function () { var e = this, t = e._createDiv(Fi), n = e._createDiv(Ii), r = e._createDiv(Tr), i = e._createDiv(qi), s = e._createDiv($i); return t.add(n), n.add(e._createSpan(Cr, this.localizeString("previewDialogPreviewSize", "Preview Size:"))), n.add(e._createElement("input", { id: "rad640_480", name: "preview", type: "radio", checked: "checked" })), n.add(e._createLabel("640x480", "rad640_480")), n.add(e._createElement("input", { id: "rad800_600", name: "preview", type: "radio" })), n.add(e._createLabel("800x600", "rad800_600")), n.add(e._createElement("input", { id: "rad1024_768", name: "preview", type: "radio" })), n.add(e._createLabel("1024x768", "rad1024_768")), n.add(e._createElement("input", { id: "chkSplit", type: "checkbox", checked: "checked" })), n.add(e._createLabel(this.localizeString("previewDialogSplit", "Split pages"), "chkSplit")), t.add(e._createSeparator()), t.add(r), r.add(e._createInputButton(Nr + " " + zi, this.localizeString("previewDialogPrintAll", "Print All"))), r.add(e._createInputButton(Nr + " " + Wi, this.localizeString("previewDialogPrintPage", "Print Page"))), r.add(e._createInputButton(Nr + " " + Xi, this.localizeString("dialogOK", "OK"))), t.add(e._createSeparator()), t.add(i), i.add(e._createElement("a", this.localizeString("previewDialogPrevPage", "Prev page"), { "class": Ri, href: "#" })), i.add(e._createElement("span", "1 / 1")), i.add(e._createElement("a", this.localizeString("previewDialogNextPage", "Next page"), { "class": Ui, href: "#" })), t.add(e._createDiv(Vi)), t.add(s), s.add(e._createElement("iframe", { src: "about:blank" })), t.render() }, n.prototype._getDialogRes_CleanUp = function () { var e = this, n = e._createDiv(Ji), r = e._createDiv(Ki), i = e._createDiv(Qi), s = e._createDiv(Gi), o = [{ id: "replaceSpans", label: this.localizeString("cleanUpDialogStripSpanTag", "Strip SPAN tag") }, { id: "replaceClass", label: this.localizeString("cleanUpDialogStripClass", "Strip CLASS tag") }, { id: "replaceStyle", label: this.localizeString("cleanUpDialogStripStyle", "Strip STYLE attribute") }, { id: "replaceNbsp", label: this.localizeString("cleanUpDialogReplaceSymbol", "Replace &amp;nbsp; symbol") }, { id: "transformPtoDiv", label: this.localizeString("cleanUpDialogTransformParagraphToDIV", "Transform Paragraph to DIV") }]; return n.add(r), r.add(e._createSpan(Cr, this.localizeString("cleanUpDialogDocumentSource", "Document source :"))), n.add(i), i.add(e._createElement("textarea", { readonly: "readonly" })), n.add(s), t.each(o, function (t, n) { s.add(e._createCheckbox(n.id)), s.add(e._createLabel(n.label, n.id)) }), n.add(e._createSeparator()), n.add(e._createOKCancelButtons()), n.render() }, n.prototype._getDialogRes_FindAndReplace = function () { var e = this, t = e._createDiv(Yi), n = e._createDiv(Zi), r = e._createDiv(es), i = e._createDiv(Tr); return t.add(n), n.add(e._createSpan(Cr, this.localizeString("findAndReplaceFind", "Find:"))), n.add(e._createElement("textarea", "text")), t.add(r), r.add(e._createSpan(Cr, this.localizeString("findAndReplaceReplace", "Replace:"))), r.add(e._createElement("textarea")), t.add(e._createSeparator()), t.add(i), i.add(e._createInputButton(Nr, this.localizeString("findAndReplaceFindButton", "Find"))), i.add(e._createInputButton(Nr, this.localizeString("findAndReplaceReplaceButton", "Replace"))), t.render() }, n.prototype._getDialogRes_Media = function () { var e = this, t = e._createDiv(ts), n = e._createDiv(ns); return t.add(n), n.add(e._createSpan(Cr, this.localizeString("mediaDialogMediaType", "Media Type :"))), n.add(e._createSelect("", ["flash", "video", "applet", "other"])), t.add(e._createTextField(this.localizeString("mediaDialogMediaUrl", "Media Url :"), rs)), t.add(e._createTextField(this.localizeString("mediaDialogWidth", "Width :"), is, this.localizeString("dialogPixel", "px"), 200)), t.add(e._createTextField(this.localizeString("mediaDialogHeight", "Height :"), ss, this.localizeString("dialogPixel", "px"), 200)), t.add(e._createSeparator()), t.add(e._createOKCancelButtons()), t.render() }, n.prototype._getDialogRes_SpecialCharacter = function () { var e = this, n = e._createDiv(os), r = e._createDiv(us), i = e._createDiv(as), s = e._createDiv(fs), o = e._createDiv(ls), u = e._createDiv(cs, "Punctuation"), a = e._createDiv(hs), f = ["&#8211;", "&#8212;", "&iexcl;", "&iquest;", "&quot;", "&laquo;", "&raquo;", "&nbsp;"], l = e._createDiv(cs, "Symbols"), c = e._createDiv(ps), h = ["&amp;", "&cent;", "&copy;", "&divide;", "&gt;", "&lt;", "&micro;", "&#8226;", "&para;", "&plusmn;", "&#8364;", "&pound;", "&reg;", "&sect;", "&yen;"], p = e._createDiv(cs, "Diacritics"), d = e._createDiv(ds), v = ["&aacute;", "&Aacute;", "&agrave;", "&Agrave;", "&acirc;", "&Acirc;", "&aring;", "&Aring;", "&atilde;", "&Atilde;", "&auml;", "&Auml;", "&aelig;", "&AElig;", "&ccedil;", "&Ccedil;", "&eacute;", "&Eacute;", "&egrave;", "&Egrave;", "&ecirc;", "&Ecirc;", "&euml;", "&Euml;", "&iacute;", "&Iacute;", "&igrave;", "&Igrave;", "&icirc;", "&Icirc;", "&iuml;", "&Iuml;", "&ntilde;", "&Ntilde;", "&oacute;", "&Oacute;", "&ograve;", "&Ograve;", "&ocirc;", "&Ocirc;", "&oslash;", "&Oslash;", "&otilde;", "&Otilde;", "&ouml;", "&Ouml;", "&uacute;", "&Uacute;", "&ugrave;", "&Ugrave;", "&ucirc;", "&Ucirc;", "&uuml;", "&Uuml;", "&szlig;", "&yuml;", "&#8216;", "&#8217;"], m = e._createDiv(Tr); return n.add(r), r.add(i), i.add(s), s.add(new Cs("span")), r.add(o), o.add(u), u.add(a), t.each(f, function (t, n) { a.add(e._createLabel(n)) }), o.add(l), l.add(c), t.each(h, function (t, n) { c.add(e._createLabel(n)) }), o.add(p), p.add(d), t.each(v, function (t, n) { d.add(e._createLabel(n)) }), n.add(e._createSeparator()), m.add(e._createInputButton(Nr, "Cancel")), n.add(m), n.render() }, n.prototype._copyFromClipboard = function () { var e, n, r, s; if (i.clipboardData) return i.clipboardData.getData("Text"); if (t.browser.mozilla) { try { netscape.security.PrivilegeManager.enablePrivilege && netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect") } catch (o) { } return e = Components.classes["@mozilla.org/widget/clipboard;1"].getService(Components.interfaces.nsIClipboard), e ? (n = Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable), n ? (n.addDataFlavor("text/unicode"), e.getData(n, e.kGlobalClipboard), n.getTransferData("text/unicode", r, s), r && (r = r.value.QueryInterface(Components.interfaces.nsISupportsString)), r ? r.data.substring(0, s.value / 2) : "") : !1) : !1 } }, n.prototype._copyToClipboard = function (e) { var n, s, o, u = {}, a = {}; if (i.clipboardData && e) i.clipboardData.setData("Text", e); else if (t.browser.mozilla) try { netscape.security.PrivilegeManager.enablePrivilege && netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect"), n = Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard); if (!n) return; s = Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable); if (!s) return; s.addDataFlavor("text/unicode"), a = {}, u = Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString), u.data = e, s.setTransferData("text/unicode", u, e.length * 2), o = Components.interfaces.nsIClipboard; if (!n) return !1; n.setData(s, null, o.kGlobalClipboard) } catch (f) { u = "Copy text to Clipboard \n", u += "If you are using firefox please do the following :\n ", u += "1. Write in your url box : 'about:config'\n", u += "2. Change signed.applets.codebase_principal_support = true\n", r(this.localizeString("errorMessageCopyToClipboardError", u)) } }, n.prototype.fixAbsoluteUrlsIfNeeded = function (e) { var t = this, n = s.URL, r = s.URL, i = s.URL, o = !1, u = r.length, a = e, f, l, c, h, p, d, v, m; for (v = u - 1; v > 0; v--) { f = r.charAt(v), l = r.charAt(v - 1); if (f === "/" || f === "\\") { if (f === l) break; i = r.substring(0, v) + f, o || (r = i, o = !0) } } return c = t._prepareLiteralRegexText(n + "?"), h = new RegExp(c, "g"), a = a.replace(h, "?"), p = t._prepareLiteralRegexText(r), h = new RegExp(p, "g"), a = a.replace(h, ""), d = t._prepareLiteralRegexText(i), h = new RegExp(d, "g"), a = a.replace(h, "/"), m = a.indexOf("#"), m > -1 && (a = a.substr(m)), a }, n.prototype._insertCell = function (e, t) { var n = e.insertCell(t); return n.innerHTML = "&nbsp;", n }, n.prototype._getDictionaryDeclare = function () { var e = {}; return e.a = ["accesskey", "charset", "class", "coords", "dir", "href", "hreflang", "id", "lang", "name", "rel", "rev", "shape", "tabindex", "target", "title"], e.b = ["class", "dir", "id", "lang", "title"], e.body = ["alink", "background", "bgColor", "bgproperties", "bottommargin", "class", "dir", "id", "lang", "leftmargin", "link", "marginheight", "marginwidth", "rightmargin", "text", "title", "topmargin", "vlink"], e.button = ["accesskey", "class", "dir", "disabled", "id", "lang", "name", "tabindex", "title", "type", "value"], e.code = ["class", "dir", "id", "lang", "title"], e.div = ["align", "class", "dir", "id", "lang", "title"], e.em = ["class", "dir", "id", "lang", "title"], e.font = ["class", "color", "dir", "face", "id", "lang", "pointsize", "size", "title"], e.form = ["action", "class", "dir", "enctype", "id", "lang", "method", "name", "runat", "target", "title"], e.hr = ["align", "class", "color", "id", "noshade", "size", "title", "width"], e.i = ["class", "dir", "id", "lang", "title"], e.img = ["align", "alt", "border", "class", "controls", "dir", "dynsrc", "height", "hspace", "id", "ismap", "lang", "longdesc", "loop", "lowsrc", "name", "src", "start", "title", "usemap", "vspace", "width"], e.input = ["accept", "accesskey", "align", "alt", "border", "checked", "class", "dir", "disabled", "height", "hspace", "id", "lang", "maxlength", "name", "readonly", "size", "src", "tabindex", "title", "type", "usemap", "value", "vspace", "width"], e.label = ["accesskey", "class", "dir", "for", "id", "lang", "title"], e.li = ["class", "dir", "id", "lang", "title", "type", "value"], e.ol = ["class", "compact", "dir", "id", "lang", "start", "title", "type"], e.option = ["class", "dir", "disabled", "id", "label", "lang", "selected", "title", "value"], e.p = ["align", "class", "dir", "id", "lang", "title"], e.span = ["class", "dir", "id", "lang", "title"], e.strong = ["class", "dir", "id", "lang", "title"], e.select = ["accesskey", "class", "dir", "disabled", "id", "lang", "multiple", "name", "size", "tabindex", "title"], e.table = ["align", "background", "bgColor", "border", "bordercolor", "bordercolordark", "bordercolorlight", "cellpadding", "cellspacing", "class", "cols", "datapagesize", "dir", "frame", "height", "hspace", "id", "lang", "rules", "summary", "title", "vspace", "width"], e.td = ["abbr", "align", "axis", "background", "bgColor", "bordercolor", "bordercolordark", "bordercolorlight", "class", "colspan", "dir", "headers", "height", "id", "lang", "nowrap", "rowspan", "scope", "title", "valign", "width"], e.th = ["abbr", "align", "axis", "background", "bgColor", "bordercolor", "bordercolordark", "bordercolorlight", "class", "colspan", "dir", "headers", "height", "id", "lang", "nowrap", "rowspan", "scope", "title", "valign", "width"], e.tr = ["align", "bgColor", "bordercolor", "bordercolordark", "bordercolorlight", "class", "dir", "height", "id", "lang", "nowrap", "title", "valign"], e.tbody = ["align", "bgColor", "class", "dir", "id", "lang", "title", "valign"], e.textarea = ["accesskey", "class", "cols", "dir", "disabled", "id", "label", "lang", "name", "readonly", "rows", "tabindex", "title", "wrap"], e.u = ["class", "id", "xml:lang"], e.ul = ["class", "compact", "dir", "id", "lang", "title", "type"], e }, n.prototype._getParentElement = function (e) { var t = this, n = t._getRange(e), r, i, s, o, u; if (!n) return null; if (n.commonAncestorContainer) return r = e.getSelection(), i = n.startContainer || r.baseNode, s = n.endContainer || r.extentNode, o = n.startOffset, o === null && (o = r.baseOffset), u = n.endOffset, u === null && (u = r.extentOffset), i === s && u - o === 1 ? r.anchorNode.childNodes[r.anchorOffset] : n.commonAncestorContainer.tagName ? n.commonAncestorContainer : e.document === n.commonAncestorContainer && r.baseNode ? r.baseNode.parentNode : n.commonAncestorContainer.parentNode; return n.length ? n.item(0) : n.parentElement ? n.parentElement() : null }, n.prototype._getRange = function (e) { var t, n; if (e.document.selection && !i.opera) return e.document.selection.createRange(); if (e.getSelection) return t = e.getSelection(), !t || t.rangeCount < 1 ? null : (t.getRangeAt ? n = t.getRangeAt(0) : n = e.document.createRange(), n) }, n.prototype._generateUniqueName = function (e) { var t = l[e]; return t || (t = 0), l[e] = ++t, e + t }, n.prototype._setContentEditable = function (e, n) { var r = "designMode", i = "contentEditable"; try { e.body[i] && (e.body[i] = n.toString()), e[r] && (!n && e[r] !== "off" ? e[r] = "off" : n && e[r] !== "on" && (t.browser.msie && o(t.browser.version) >= 9 || (e[r] = "on"))), n && !t.browser.msie && e.execCommand("useCSS", !1, !0) } catch (s) { } }, n.prototype._setContentSpellCheck = function (e, t) { var n = "spellcheck"; try { e.body[n] !== undefined && (e.body[n] = t) } catch (r) { } }, n.prototype._formatString = function (e, t) { var n = e.length, r; for (r = 0; r < t - n; r++) e = "0" + e; return e }, n.prototype._convertToWebColor = function (e, t, n) { var r = this, i, s, u, a; if (isNaN(e) || 255 - e < 0) e = 0; if (isNaN(t) || 255 - t < 0) t = 0; if (isNaN(n) || 255 - n < 0) n = 0; return i = r._formatString(o(e).toString(16), 2), s = r._formatString(o(t).toString(16), 2), u = r._formatString(o(n).toString(16), 2), a = "#" + i + s + u, a }, n.prototype._prepareLiteralRegexText = function (e) { var t = e; return t = t.replace("\\", "\\\\"), t = t.replace(".", "\\."), t = t.replace("?", "\\?"), t }, n.prototype._isNumeric = function (e) { return (new RegExp("^\\d+$")).test(e) }, n.prototype._isEmail = function (e) { return (new RegExp("mailto:(\\S)+[@]{1}(\\S)+[.]{1}(\\w)+")).test(e) }, n.prototype._isUrl = function (e) { return (new RegExp("[a-zA-z]+://[^s]+")).test(e) }, n.prototype.refresh = function () { var e = this, t = e.element, n = e._getHeader(), r = e._getFooter(), i = e._oriEleWidth, s = e._oriEleHeight, o = e._getContent(), u; e.editor.width(i).height(s), this.$ribbon.wijribbon("updateRibbonSize"), u = e.editor.height() - n.outerHeight(!0) - r.outerHeight(!0), o.height(u).wijsplitter("refresh") }, n.prototype.getText = function () { var e = this; return e._getDesignViewText() }, n.prototype.setText = function (e) { var t = this; e && (t._setDesignViewText(e), t.sourceView.val(e)) }, n.prototype.localizeString = function (e, t) { var n = this.options; return n.localization && n.localization[e] ? n.localization[e] : t }, n }(e.wijmoWidget); e.wijeditor = ks; var Ls = function () { function e() { this.initSelector = ":jqmData(role='wijeditor')", this.fullScreenContainerSelector = "", this.editorMode = "wysiwyg", this.fullScreenMode = !1, this.showPathSelector = !0, this.mode = "ribbon", this.commandButtonClick = null, this.simpleModeCommands = null, this.showFooter = !0, this.customContextMenu = !0, this.text = null, this.textChanged = null, this.localization = null } return e }(); ks.prototype.options = t.extend(!0, {}, e.wijmoWidget.prototype.options, new Ls), t.wijmo.registerWidget("wijeditor", ks.prototype); var As = vr + "-colorcanvas", Os = vr + "-color", Ms = vr + "-wheel", _s = vr + "-overlay", Ds = vr + "-marker"; t.fn.wijeditorcolorcanvas = function (e, t) { var n = this.get(0); return n.wijeditorcolorcanvas || (n.wijeditorcolorcanvas = new Ps(n, e, t)) }; var Ps = function () { function e(e, n, r) { var i = this, u = "", a, f; f = "progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, ", u += "<div class='" + As + "'>", u += "<div class='" + Os + "'></div>", u += "<div class='" + Ms + "'></div>", u += "<div class='" + _s + "'></div>", u += "<div class='h-marker " + Ds + "'></div>", u += "<div class='sl-marker " + Ds + "'></div></div>", t(e).html(u), a = t("." + As, e), i.wheel = t("." + Ms, e).get(0), i.radius = 84, i.square = 100, i.width = 194, t.browser.msie && parseInt(t.browser.version, 10) < 7 && t("*", a).each(function () { var e = this, n = e.currentStyle.backgroundImage; return n !== "none" && (n = n.substring(5, n.length - 2), t(e).css({ backgroundImage: "none", filter: f + "src='" + n + "')" })), this }), i.linkTo = function (e) { typeof i.callback == "object" && t(i.callback).unbind("keyup", i.updateValue), i.color = null; if (typeof e == "function") i.callback = e; else if (typeof e == "object" || typeof e == "string") i.callback = t(e), i.callback.bind("keyup", i.updateValue), i.callback.get(0).value && i.setColor(i.callback.get(0).value); return this }, i.updateValue = function (e) { var t = this; t.value && t.value !== i.color && i.setColor(t.value) }, i.setColor = function (e) { var t = i.unpack(e); return i.color !== e && t && (i.color = e, i.rgb = t, i.hsl = i.RGBToHSL(i.rgb), i.updateDisplay()), this }, i.setHSL = function (e) { return i.hsl = e, i.rgb = i.HSLToRGB(e), i.color = i.pack(i.rgb), i.updateDisplay(), this }, i.widgetCoords = function (e) { var n, r, s, o, u; return s = e.target || e.srcElement, o = i.wheel, u = i.absolutePosition(o), n = (e.pageX || 0 * (e.clientX + t("html").get(0).scrollLeft)) - u.x, r = (e.pageY || 0 * (e.clientY + t("html").get(0).scrollTop)) - u.y, { x: n - i.width / 2, y: r - i.width / 2 } }, i.mousedown = function (e) { s.dragging || (t(s).bind("mousemove", i.mousemove).bind("mouseup", i.mouseup), s.dragging = !0); var n = i.widgetCoords(e); return i.circleDrag = Math.max(Math.abs(n.x), Math.abs(n.y)) * 2 > i.square, i.mousemove(e), !1 }, i.mousemove = function (e) { var t = i.widgetCoords(e), n, r, s; return i.circleDrag ? (n = Math.atan2(t.x, -t.y) / 6.28, n < 0 && (n += 1), i.setHSL([n, i.hsl[1], i.hsl[2]])) : (r = Math.max(0, Math.min(1, -(t.x / i.square) + .5)), s = Math.max(0, Math.min(1, -(t.y / i.square) + .5)), i.setHSL([i.hsl[0], r, s])), !1 }, i.mouseup = function () { t(s).unbind("mousemove", i.mousemove).unbind("mouseup", i.mouseup), s.dragging = !1 }, i.updateDisplay = function () { var e = i.hsl[0] * 6.28, n; t(".h-marker", a).css({ left: Math.round(Math.sin(e) * i.radius + i.width / 2) + "px", top: Math.round(-Math.cos(e) * i.radius + i.width / 2) + "px" }), t(".sl-marker", a).css({ left: Math.round(i.square * (.5 - i.hsl[1]) + i.width / 2) + "px", top: Math.round(i.square * (.5 - i.hsl[2]) + i.width / 2) + "px" }), t("." + Os, a).css("backgroundColor", i.pack(i.HSLToRGB([i.hsl[0], 1, .5]))), typeof i.callback == "object" ? (t(i.callback).css({ backgroundColor: i.color, color: i.hsl[2] > .5 ? "#000" : "#fff" }), t(i.callback).each(function () { return n = this, n.value && n.value !== i.color && (n.value = i.color), this })) : typeof i.callback == "function" && i.callback.call(i, i.color) }, i.absolutePosition = function (e) { var t = { x: e.offsetLeft, y: e.offsetTop }, n; return e.offsetParent && (n = i.absolutePosition(e.offsetParent), t.x += n.x, t.y += n.y), t }, i.pack = function (e) { var t = Math.round(e[0] * 255), n, r; return n = Math.round(e[1] * 255), r = Math.round(e[2] * 255), "#" + (t < 16 ? "0" : "") + t.toString(16) + (n < 16 ? "0" : "") + n.toString(16) + (r < 16 ? "0" : "") + r.toString(16) }, i.unpack = function (e) { if (e.length === 7) return [o("0x" + e.substring(1, 3)) / 255, o("0x" + e.substring(3, 5)) / 255, o("0x" + e.substring(5, 7)) / 255]; if (e.length === 4) return [o("0x" + e.substring(1, 2)) / 15, o("0x" + e.substring(2, 3)) / 15, o("0x" + e.substring(3, 4)) / 15] }, i.HSLToRGB = function (e) { var t, n, r, i, s, o = this; return r = e[0], i = e[1], s = e[2], n = s <= .5 ? s * (i + 1) : s + i - s * i, t = s * 2 - n, [o.hueToRGB(t, n, r + .33333), o.hueToRGB(t, n, r), o.hueToRGB(t, n, r - .33333)] }, i.hueToRGB = function (e, t, n) { return n = n < 0 ? n + 1 : n > 1 ? n - 1 : n, n * 6 < 1 ? e + (t - e) * n * 6 : n * 2 < 1 ? t : n * 3 < 2 ? e + (t - e) * (.66666 - n) * 6 : e }, i.RGBToHSL = function (e) { var t, n, r, i, s, o, u, a, f; return u = e[0], a = e[1], f = e[2], t = Math.min(u, Math.min(a, f)), n = Math.max(u, Math.max(a, f)), r = n - t, o = (t + n) / 2, s = 0, o > 0 && o < 1 && (s = r / (o < .5 ? 2 * o : 2 - 2 * o)), i = 0, r > 0 && (n === u && n !== a && (i += (a - f) / r), n === a && n !== f && (i += 2 + (f - u) / r), n === f && n !== u && (i += 4 + (u - a) / r), i /= 6), [i, s, o] }, t("*", a).mousedown(i.mousedown), i.setColor(r || "#000000"), n && i.linkTo(n) } return e }(); e._wijeditorcolorcanvas = Ps })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { var t = this; "use strict"; var n = jQuery, r = function (e) { function t() { e.apply(this, arguments) } return __extends(t, e), t.prototype._setOption = function (t, r) { var i = this.options, s = n("." + i.wijCSS.wijratingResetButton, this.ratingElement[0]), o = n("." + i.wijCSS.wijratingStarContainer, this.ratingElement[0]), u = n("." + i.wijCSS.wijratingNormalStar, this.ratingElement[0]); if (n.isPlainObject(i[t])) { switch (t) { case "resetButton": typeof r.disabled != "undefined" && r.disabled !== i[t].disabled && (r.disabled ? (s.hide(), s.attr("aria-hidden", !0)) : i.disabled || (s.show(), s.attr("aria-hidden", !1))), typeof r.hint != "undefined" && r.hint !== i[t].hint && (r.hint === null ? s.attr("title", "") : s.attr("title", r.hint)), r.position && r.position.length && r.position !== i[t].position && (r.position === "rightOrBottom" ? s.parent().append(s) : s.parent().prepend(s)), typeof r.customizedClass != "undefined" && r.customizedClass !== i[t].customizedClass && (i[t].customizedClass.length && s.removeClass(i[t].customizedClass), r.customizedClass.length && s.addClass(r.customizedClass)); break; case "hint": typeof r.disabled != "undefined" && r.disabled !== i[t].disabled && (r.disabled ? u.removeAttr("title") : this._resetHint(i.hint.content)), typeof r.content != "undefined" && r.content !== i[t].content && (i[t].disabled || this._resetHint(r.content)); break; case "icons": typeof r.iconsClass != "undefined" && (i[t].iconsClass && i[t].iconsClass.length && this._removeCustomizedIconsClass(i[t].iconsClass), this._addCustomizedIconsClass(r.iconsClass, i.split)), typeof r.hoverIconsClass != "undefined" && i[t].hoverIconsClass && i[t].hoverIconsClass.length && this._removeCustomizedIconsClass(i[t].hoverIconsClass), typeof r.ratedIconsClass != "undefined" && (i[t].ratedIconsClass && i[t].ratedIconsClass.length && this._removeCustomizedIconsClass(i[t].ratedIconsClass), this._resetValue(i.value, i.ratingMode, r.ratedIconsClass)); break; default: } n.extend(!0, i[t], r) } else { if (r === i[t]) return; switch (t) { case "disabled": r ? (this._unbindLiveEvents(), s.hide(), s.attr("aria-hidden", !0)) : (this._bindLiveEvents(), i.resetButton.disabled || (s.show(), s.attr("aria-hidden", !1))); break; case "count": this._createStars(i.split, r, o); break; case "split": this._createStars(r, i.count, o); break; case "totalValue": this._resetTotalValue(r); break; case "orientation": r === "vertical" ? this.ratingElement.addClass(i.wijCSS.wijvRating) : this.ratingElement.removeClass(i.wijCSS.wijvRating), i.split > 1 && (i[t] = r, this._createStars(i.split, i.count, o)); break; case "direction": i[t] = r, this._createStars(i.split, i.count, o); break; case "ratingMode": this._resetValue(i.value, r, i.icons.ratedIconsClass); break; case "value": if (i.min && r < i.min) return; if (i.max && r > i.max) return; this._resetValue(r, i.ratingMode, i.icons.ratedIconsClass); break; case "iconWidth": i[t] = r, this._createStars(i.split, i.count, o); break; case "iconHeight": i[t] = r, this._createStars(i.split, i.count, o); break; default: } e.prototype._setOption.call(this, t, r) } }, t.prototype._create = function () { var t = this.options, r; if (this.element.is("select")) this._parseSelect(), this.element.hide(), r = n("<div></div>"), this.element.after(r); else { if (!this.element.is("div")) return; this.element.children("input[type='radio']").length > 0 ? (this._parseRadio(), this.element.hide(), r = n("<div></div>"), this.element.after(r)) : r = this.element } this.ratingElement = r, this._createRating(), t.disabled || this._bindLiveEvents(), e.prototype._create.call(this) }, t.prototype.destroy = function () { var t = this.options; this._unbindLiveEvents(), this.element !== this.ratingElement ? (this.ratingElement.remove(), this.element.show()) : this.element.removeClass(t.wijCSS.widget).removeClass(t.wijCSS.wijrating).removeClass(t.wijCSS.wijvRating).empty(), e.prototype.destroy.call(this) }, t.prototype._unbindLiveEvents = function () { var e = this.options; this.ratingElement.off(".wijrating", "." + e.wijCSS.wijratingNormalStar).off(".wijrating", "." + e.wijCSS.wijratingResetButton) }, t.prototype._bindLiveEvents = function () { var e = this, t = e.options, r = "." + t.wijCSS.wijratingNormalStar, i = "." + t.wijCSS.wijratingResetButton, s, o = { element: e.ratingElement, mouseover: function (i) { var o = n(i.target), u = n(r, e.ratingElement[0]); o.is(r) && (u.removeClass(t.wijCSS.wijratingHoverStar), o.addClass(t.wijCSS.wijratingHoverStar), t.ratingMode === "continuous" && (t.direction === "reversed" ? o.parent().nextAll().children().addClass(t.wijCSS.wijratingHoverStar) : o.parent().prevAll().children().addClass(t.wijCSS.wijratingHoverStar)), e._addCustomizedHoverIconsClass(t.icons.hoverIconsClass, t.split, o), s = { value: parseFloat(o.html()), target: o }, e._trigger("hover", i, s)) }, mouseout: function (i) { var s = n(i.target), o = n(r, e.ratingElement[0]); s.is(r) && (o.removeClass(t.wijCSS.wijratingHoverStar), e._removeCustomizedIconsClass(t.icons.hoverIconsClass)) }, click: function (i) { var o = n(i.target), u = parseFloat(o.html()), a = n(r, e.ratingElement[0]), f = { duration: 500, easing: null, delay: 250, animated: null }, l = n.wijmo.wijrating.animations, c; n.extend(!0, f, t.animation), c = f.animated; if (!o.is(r)) return; if (t.max && u > t.max) return; if (t.min && u < t.min) return; s = { oldValue: t.value, newValue: u, target: o }; if (e._trigger("rating", i, s) === !1) return !1; t.value = u, e._resetValue(u, t.ratingMode, t.icons.ratedIconsClass), a.removeClass(t.wijCSS.wijratingHoverStar), e._removeCustomizedIconsClass(t.icons.hoverIconsClass), s = { value: u, target: o }, c ? l && l[c] ? l[c](t, a, function () { e._trigger("rated", i, s) }) : n.effects && (n.effects[c] || n.effects.effect && n.effects.effect[c]) ? e._playJqueryAnimation(f, a, function () { n.browser.msie && parseInt(n.browser.version) < 9 && a.css("filter", ""), e._trigger("rated", i, s) }) : e._trigger("rated", i, s) : e._trigger("rated", i, s) } }, u = { element: e.ratingElement, mouseover: function (e) { var r = n(e.target); r = r.closest("." + t.wijCSS.wijratingResetButton), r.addClass(t.wijCSS.wijratingHoverResetButton).addClass(t.wijCSS.stateHover), t.resetButton.customizedHoverClass && t.resetButton.customizedHoverClass.length && r.addClass(t.resetButton.customizedHoverClass) }, mouseout: function (e) { var r = n(e.target); r = r.closest("." + t.wijCSS.wijratingResetButton), r.removeClass(t.wijCSS.wijratingHoverResetButton).removeClass(t.wijCSS.stateHover), t.resetButton.customizedHoverClass && t.resetButton.customizedHoverClass.length && r.removeClass(t.resetButton.customizedHoverClass) }, click: function (t) { var r = n(t.target); e._setOption("value", 0), s = { target: r }, e._trigger("reset", t, s) } }; this.ratingElement.on("mouseover.wijrating", r, n.proxy(o.mouseover, o)).on("mouseout.wijrating", r, n.proxy(o.mouseout, o)).on("click.wijrating", r, n.proxy(o.click, o)).on("mouseover.wijrating", i, n.proxy(u.mouseover, u)).on("mouseout.wijrating", i, n.proxy(u.mouseout, u)).on("click.wijrating", i, n.proxy(u.click, u)) }, t.prototype._createRating = function () { var e = this.ratingElement, t = this.options, r, i, s; e.addClass(t.wijCSS.wijrating).addClass(t.wijCSS.widget), t.orientation === "vertical" && e.addClass(t.wijCSS.wijvRating), r = n("<div></div>").addClass(t.wijCSS.wijratingResetButton).addClass(t.wijCSS.cornerAll).addClass(t.wijCSS.stateDefault), t.resetButton.customizedClass && t.resetButton.customizedClass.length && r.addClass(t.resetButton.customizedClass), r.appendTo(e), r.attr("role", "button").attr("aria-label", "reset").attr("aria-hidden", !1), t.resetButton.hint && t.resetButton.hint.length && r.attr("title", t.resetButton.hint); if (t.resetButton.disabled || t.disabled) r.hide(), r.attr("aria-hidden", !0); i = n("<span></span>"), i.addClass(t.wijCSS.icon).addClass(t.wijCSS.iconClose), r.append(i), s = n("<div></div>"), s.attr("role", "radiogroup").addClass(t.wijCSS.wijratingStarContainer), t.resetButton.position === "leftOrTop" ? s.appendTo(e) : s.prependTo(e), this._createStars(t.split, t.count, s) }, t.prototype._createStars = function (e, t, r) { var i = this.options, s = i.hint, o, u, a, f = 0, l = 0, c = Math.ceil(i.iconWidth / e), h = Math.ceil(i.iconHeight / e), p = i.icons.ratedIconsClass, d, v, m = p && p.length; r.empty(); for (f; f < t * e; f++, l++) a = Math.round((f + 1) * i.totalValue * 100 / t / e) / 100, l === e && (l = 0), u = n("<div></div>"), u.attr("role", "radio").attr("aria-checked", !1), i.orientation === "vertical" ? u.width(i.iconWidth).height(h) : u.width(c).height(i.iconHeight), u.addClass(i.wijCSS.wijratingStar), o = n("<div>" + a + "</div>"), o.addClass(i.wijCSS.wijratingNormalStar).width(i.iconWidth).height(i.iconHeight), u.attr("aria-label", a), l > 0 && i.direction === "normal" ? i.orientation === "vertical" ? o.css({ "margin-top": "-" + l * h + "px" }) : o.css({ "margin-left": "-" + l * c + "px" }) : l < e - 1 && i.direction === "reversed" && (i.orientation === "vertical" ? o.css({ "margin-top": "-" + (e - 1 - l) * h + "px" }) : o.css({ "margin-left": "-" + (e - 1 - l) * c + "px" })), s.disabled || (s.content && s.content.length ? f <= s.content.length && (o.attr("title", s.content[f]), u.attr("aria-label", s.content[f])) : o.attr("title", a)), m && (typeof p == "string" ? v = p : n.isArray(p) && (d = Math.floor(f / e), p.length > d && (v = p[d]))), a === i.value ? (o.addClass(i.wijCSS.wijratingRatedStar), m && o.addClass(v), u.attr("aria-checked", !0)) : a < i.value && i.ratingMode === "continuous" && (o.addClass(i.wijCSS.wijratingRatedStar), m && o.addClass(v)), o.appendTo(u), i.direction === "reversed" ? u.prependTo(r) : u.appendTo(r); this._addCustomizedIconsClass(i.icons.iconsClass, e) }, t.prototype._resetValue = function (e, t, r) { var i = this.options, s = n("." + i.wijCSS.wijratingNormalStar, this.ratingElement[0]), o = t || i.ratingMode, u = r && r.length, a = 0, f; n.each(s, function (t, l) { var c = n(l), h = parseFloat(c.html()); c.removeClass(i.wijCSS.wijratingRatedStar), c.parent().attr("aria-checked", !1), u && (typeof r == "string" ? (c.removeClass(r), f = r) : n.isArray(r) && (n.each(r, function (e, t) { c.removeClass(t) }), i.direction === "reversed" ? a = Math.floor((s.length - 1 - t) / i.split) : a = Math.floor(t / i.split), r.length > a && (f = r[a]))), h === e ? (c.addClass(i.wijCSS.wijratingRatedStar), u && c.addClass(f), c.parent().attr("aria-checked", !0)) : o === "continuous" && h < e && (c.addClass(i.wijCSS.wijratingRatedStar), u && c.addClass(f)) }) }, t.prototype._resetTotalValue = function (e) { var t = this.options, r = t.hint, i = n("." + t.wijCSS.wijratingNormalStar, this.ratingElement[0]), s = i.length; n.each(i, function (i, u) { var a = n(u), f = Math.round((i + 1) * e * 100 / s) / 100, l = parseFloat(a.html()); l === t.value && (t.value = f), a.html(f.toString()), r && r.length && r.length >= i && r[i] && r[i].length ? a.attr("title", r[i]) : a.attr("title", f) }) }, t.prototype._resetHint = function (e) { var t = this.options, r = n("." + t.wijCSS.wijratingNormalStar, this.ratingElement[0]); n.each(r, function (t, r) { var i = n(r), s = parseFloat(i.html()); e && e.length && e.length >= t && e[t] && e[t].length ? i.attr("title", e[t]) : i.attr("title", s) }) }, t.prototype._clearIntentTimer = function () { this.intentTimers && this.intentTimers.length && n.each(this.intentTimers, function (e, t) { t && (window.clearTimeout(t), t = null) }), this.intentTimers = [] }, t.prototype._playJqueryAnimation = function (e, t, r) { var i = this, s = this, o = s.options, u = { easing: e.easing }, a = e.animated; s._clearIntentTimer(), n.each(t, function (f, l) { var c = Math.floor(f / o.split) * e.delay, h; h = window.setTimeout(function () { n(l).hide(a, u, e.duration, function () { if (f !== t.length - 1) return; n.each(t, function (f, l) { var c = Math.floor(f / o.split) * e.delay, h; h = window.setTimeout(function () { n(l).show(a, u, e.duration, function () { f === t.length - 1 && r && n.isFunction(r) && r.call(i) }) }, c), s.intentTimers.push(h) }) }) }, c), s.intentTimers.push(h) }) }, t.prototype._addCustomizedIconsClass = function (e, t) { var r = this, i = r.options, s, o = 0, u = 0; e && e.length && (s = n("." + i.wijCSS.wijratingNormalStar, r.ratingElement[0]), n.each(s, function (i, s) { o === t && (o = 0, u++); if (typeof e == "string") n(s).addClass(e); else if (n.isArray(e)) { var a = e.length; u < a && (r.options.direction === "reversed" ? n(s).addClass(e[a - u - 1]) : n(s).addClass(e[u])) } o++ })) }, t.prototype._addCustomizedHoverIconsClass = function (e, t, r) { var i = this.options, s = i.direction, o = i.ratingMode, u = n("." + i.wijCSS.wijratingNormalStar, this.ratingElement[0]), a = u.index(r), f = 0, l; if (e && e.length) if (typeof e == "string") r.addClass(e), o !== "single" && (s === "reversed" ? r.parent().nextAll().children().addClass(e) : r.parent().prevAll().children().addClass(e)); else if (n.isArray(e)) if (o === "single") s === "reversed" ? l = u.length - 1 - a : l = a, f = Math.floor(l / t), e.length > f && r.addClass(e[f]); else if (s === "reversed") for (l = u.length - 1; l >= a; l--) f = Math.floor((u.length - 1 - l) / t), e.length > f && n(u[l]).addClass(e[f]); else for (l = 0; l <= a; l++) f = Math.floor(l / t), e.length > f && n(u[l]).addClass(e[f]) }, t.prototype._removeCustomizedIconsClass = function (e) { var t = this.options, r = n("." + t.wijCSS.wijratingNormalStar, this.ratingElement[0]); e && e.length && (typeof e == "string" ? r.removeClass(e) : n.isArray(e) && n.each(e, function (e, t) { r.removeClass(t) })) }, t.prototype._parseSelect = function () { var e = this.options, t = [], r = n("option", this.element); r.length && (e.count = r.length, e.totalValue = r.length, n.each(r, function (r, i) { var s = n(i); t.push(s.html()), s.is(":selected") && (e.value = r + 1) }), e.hint.content = t) }, t.prototype._parseRadio = function () { var e = this, t = e.options, r = [], i = n("input[type='radio']", e.element); i.length && (t.count = i.length, t.totalValue = i.length, n.each(i, function (i, s) { var u = n(s), a = u.attr("id"), f; a && a.length > 0 ? (f = n("label[for='" + a + "']", e.element), f.length ? r.push(f.html()) : r.push("")) : r.push(""), u.is(":checked") && (t.value = i + 1) }), t.hint.content = r) }, t }(e.wijmoWidget); e.wijrating = r; var i = function () { function e() { this.wijCSS = { wijrating: "wijmo-wijrating", wijratingStarContainer: "wijmo-wijrating-starcontainer", wijratingResetButton: "wijmo-wijrating-reset", wijratingHoverResetButton: "wijmo-wijrating-resethover", wijratingStar: "wijmo-wijrating-star", wijratingNormalStar: "wijmo-wijrating-normal", wijratingHoverStar: "wijmo-wijrating-hover", wijratingRatedStar: "wijmo-wijrating-rated", wijvRating: "wijmo-wijrating-vertical" }, this.wijMobileCSS = { iconClose: "ui-icon-delete" }, this.disabled = !1, this.count = 5, this.split = 1, this.totalValue = 5, this.value = 0, this.min = null, this.max = null, this.resetButton = { disabled: !1, hint: "cancel this rating!", position: "leftOrTop", customizedClass: "", customizedHoverClass: "" }, this.hint = { disabled: !1, content: null }, this.orientation = "horizontal", this.direction = "normal", this.ratingMode = "continuous", this.icons = { iconsClass: null, hoverIconsClass: null, ratedIconsClass: null }, this.iconWidth = 16, this.iconHeight = 16, this.animation = null, this.rating = null, this.rated = null, this.reset = null, this.hover = null } return e }(); r.prototype.options = n.extend(!0, {}, e.wijmoWidget.prototype.options, new i), n.wijmo.registerWidget("wijrating", r.prototype), n.mobile && (n.mobile.selectmenu.prototype.options.initSelector = n.mobile.selectmenu.prototype.options.initSelector + ":not( :jqmData(role='wijrating') )"), n.extend(n.wijmo.wijrating, { animations: { scroll: function (e, r, i) { var s = e, o = i, u = 250, a = 500, f = "linear", l = 250, c = jQuery.makeArray(r); c.reverse(), n.each(c, function (e, t) { var i = Math.floor(e / s.split) * l, c = { width: 0 }, h, p; h = window.setTimeout(function () { n(t).animate(c, u, f, function () { window.clearTimeout(h); if (e !== r.length - 1) return; p = window.setTimeout(function () { n.each(r, function (e, t) { var i = Math.floor(e / s.split) * l, a = { width: s.iconWidth }, c; c = window.setTimeout(function () { var i = this; n(t).animate(a, u, f, function () { window.clearTimeout(c), e === r.length - 1 && o && n.isFunction(o) && o.call(i) }) }, i) }), window.clearTimeout(p) }, a) }) }, i) }), i && n.isFunction(i) && i.call(t) } } }) })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { var t = function (e) { function t() { e.apply(this, arguments) } return __extends(t, e), t.prototype._create = function () { var t = this; t._handleChartStyles(), e.prototype._create.call(this), t.chartElement.addClass(t.options.wijCSS.scatter) }, t.prototype.destroy = function () { var t = this; t.chartElement.removeClass(t.options.wijCSS.scatter), e.prototype.destroy.call(this) }, t.prototype.getScatter = function (e, t) { var n = this, r = n.chartElement.data("fields"), i, s, o, u; if (r && r.chartElements) { o = r.chartElements.scatters; if (o && o.length) { s = o.length; if (e < 0 || e >= s) return i; u = o[e]; if (typeof t == "undefined") return u; s = u.length; if (u && s) return t < 0 || t >= s ? i : u[t] } return i } }, t.prototype._paintLegendIcon = function (e, t, n, r, i, s, o, u, a, f) { var l = this, c = Math.min(n, r), h, p = a.markerType, d; return h = a.markerStyle, h = $.extend({ fill: i.stroke, stroke: i.stroke, opacity: 1 }, h), p || (p = "circle"), d = l.canvas.paintMarker(p, e + n / 2, t + r / 2, 3), $(d.node).data("legendIndex", s).data("index", o), l.legendIcons.push(d), d.attr(h), $.wijraphael.addClass($(d.node), u), a.visible === !1 && ($(f.node).data("dotOpacity", d.attr("opacity") || 1), d.attr("opacity", .3)), d }, t.prototype._paintLegend = function () { var t = this, n = t.options, r = [].concat(n.seriesList), i = n.seriesStyles, s = 0; $.extend(!0, n, { legend: { size: { width: 20, height: 10 } } }), e.prototype._paintLegend.call(this) }, t.prototype._showSerieEles = function (e) { $.each(e, function (e, t) { t.show(), t.label && t.label.show(), $(t.element).data("wijchartDataObj") && ($(t.element).data("wijchartDataObj").visible = !0) }) }, t.prototype._hideSerieEles = function (e) { $.each(e, function (e, t) { t.hide(), t.label && t.label.hide(), $(t.element).data("wijchartDataObj") && ($(t.element).data("wijchartDataObj").visible = !1) }) }, t.prototype._indicatorLineShowing = function (t) { e.prototype._indicatorLineShowing.call(this, t), $.each(t, function (e, t) { t.dot && (t.dot.attr(t.hoverStyle), t.dot.scale(1.5, 1.5)) }) }, t.prototype._removeIndicatorStyles = function (e) { $.each(e, function (e, t) { t.dot && (t.dot.attr(t.style), t.dot.scale(1, 1)) }) }, t.prototype._paintTooltip = function () { var t = this, n = t.chartElement, r = n.data("fields"); e.prototype._paintTooltip.call(this), t.tooltip && r && r.chartElements && r.chartElements.tooltipTars && (t.tooltip.setTargets(r.chartElements.tooltipTars), t.tooltip.setOptions({ mouseTrailing: !1 })) }, t.prototype._getTooltipText = function (e, t) { var n = $(t).data("wijchartDataObj"), r = { data: n, label: n.label, x: n.x, y: n.y, type: n.markerType, target: t, fmt: e }; return $.proxy(e, r)() }, t.prototype._onBeforeTooltipShowing = function (t) { var n = this, r = t.options, i = n.options.hint.style, s = t.target, o, u; s && ($.browser.msie && parseInt($.browser.version) < 9 ? (o = $(s).data().wijchartDataObj, u = o.style, r.style.stroke = i.stroke || u.stroke || u.fill || "#ffffff") : r.style.stroke = i.stroke || s.getAttribute("stroke") || s.getAttribute("fill") || "#ffffff", s.attrs = { stroke: r.style.stroke }), e.prototype._onBeforeTooltipShowing.call(this, t) }, t.prototype._clearChartElement = function () { var e = this, t = e.chartElement.data("fields"); e.headerEles.length && ($.each(e.headerEles, function (e, t) { t.wijRemove(), t = null }), e.headerEles = []), e.footerEles.length && ($.each(e.footerEles, function (e, t) { t.wijRemove(), t = null }), e.footerEles = []), e.legendEles.length && ($.each(e.legendEles, function (e, t) { t.wijRemove(), t = null }), e.legendEles = []), e.legends.length && ($.each(e.legends, function (e, t) { t.wijRemove(), t = null }), e.legends = []), e.legendIcons.length && ($.each(e.legendIcons, function (e, t) { t.wijRemove(), t = null }), e.legendIcons = []), e.legendDots.length && ($.each(e.legendDots, function (e, t) { t = null }), e.legendDots = []), e.axisEles.length && ($.each(e.axisEles, function (e, t) { t.wijRemove(), t = null }), e.axisEles = []), e.chartLabelEles.length && ($.each(e.chartLabelEles, function (e, t) { t.wijRemove(), t = null }), e.chartLabelEles = []), t && t.chartElements && ($.each(t.chartElements, function (e, n) { n.length && $.each(n, function (e, t) { t[0] !== null && (t.remove && t.remove(), n[e] = null) }), t.chartElements[e] = null }), t.chartElements = {}, $(t.clipRect.element).stop().remove(), t.render.destroy(), t.clipRect.destroy()), e.dataPoints = null, e.pointXs = null, e.canvas.clear(), e.innerState = {} }, t.prototype._paintPlotArea = function () { var e = this, t = e.options, n; n = new r(this.chartElement, { bounds: e.canvasBounds, widgetName: e.widgetName, canvas: e.canvas, tooltip: e.tooltip, axis: t.axis, animation: t.animation, seriesTransition: t.seriesTransition, seriesList: t.seriesList, seriesStyles: t.seriesStyles, seriesHoverStyles: t.seriesHoverStyles, hint: t.hint, disabled: t.disabled, isXTime: e.axisInfo.x.isTime, isYTime: e.axisInfo.y[0].isTime, zoomOnHover: t.zoomOnHover, mouseDown: $.proxy(e._mouseDown, e), mouseUp: $.proxy(e._mouseUp, e), mouseOver: $.proxy(e._mouseOver, e), mouseOut: $.proxy(e._mouseOut, e), mouseMove: $.proxy(e._mouseMove, e), click: $.proxy(e._click, e), showChartLabels: t.showChartLabels, chartLabelStyle: t.chartLabelStyle, chartLabelFormatString: t.chartLabelFormatString, culture: e._getCulture(), wijCSS: t.wijCSS, widget: this }), n.render() }, t }(e.wijchartcore); e.wijscatterchart = t, t.prototype.widgetEventPrefix = "wijscatterchart"; var n = function () { function e() { this.initSelector = ":jqmData(role='wijscatterchart')", this.wijCSS = { scatter: "wijmo-wijscatterchart", scatterElement: "wijscatterchart" }, this.animation = { enabled: !0, duration: 2e3, easing: ">" }, this.showChartLabels = !1, this.seriesTransition = { enabled: !0, duration: 2e3, easing: ">" }, this.zoomOnHover = !0, this.mouseDown = null, this.mouseUp = null, this.mouseOver = null, this.mouseOut = null, this.mouseMove = null, this.click = null } return e }(); t.prototype.options = $.extend(!0, {}, e.wijchartcore.prototype.options, new n), $.wijmo.registerWidget("wijscatterchart", t.prototype); var r = function () { function e(e, t) { this.scatters = [], this.chartLabels = [], this.tooltipTars = [], this.seriesEles = [], this.element = e, this.options = t, this._init() } return e.prototype._init = function () { var e = this.element, t = this.options, n = t.bounds, r = t.axis.x.min, i = t.axis.y.min, s = t.axis.x.max, o = t.axis.y.max; this.width = n.endX - n.startX, this.height = n.endY - n.startY, this.plotInfo = { minX: r, minY: i, maxX: s, maxY: o, width: this.width, height: this.height, kx: this.width / (s - r), ky: this.height / (o - i) }, this.fields = e.data("fields") || {}, e.find("svg").length > 0 ? this.chartRender = chartRender.createRender(e.find("svg").get(0), e.width(), e.height()) : this.chartRender = chartRender.createRender(e.children(":first").addClass("vmlcontainer").get(0), e.width(), e.height()), this.clipRect = this.chartRender.clipRect(0, 0, 0, e.height()), this.g = this.chartRender.g(), this.g.clip(this.clipRect), this.g.add(), this.fields.render = this.chartRender, this.fields.clipRect = this.clipRect }, e.prototype.bindLiveEvents = function () { var e = $.isFunction, t = this.options, n = t.wijCSS, r = this.element, i = t.widgetName, s = t.mouseDown, o = t.mouseUp, u = t.mouseOver, a = t.mouseOut, f = t.mouseMove, l = t.click, c = t.zoomOnHover, h = t.seriesHoverStyles, p = t.seriesStyles, d = t.disabled; $("." + n.scatterElement, r[0]).on("mousedown." + i, function (t) { if (d) return; if (e(s)) { var n = $(t.target).data("wijchartDataObj"); n || (n = $(t.target.parentNode).data("wijchartDataObj")), s.call(r, t, n) } }).on("mouseup." + i, function (t) { if (d) return; if (e(o)) { var n = $(t.target).data("wijchartDataObj"); n || (n = $(t.target.parentNode).data("wijchartDataObj")), o.call(r, t, n) } }).on("mouseover." + i, function (t) { if (d) return; var n = $(t.target).data("wijchartDataObj"), i, s, o; n || (n = $(t.target.parentNode).data("wijchartDataObj")), o = n.dot, c && (i = n.seriesIndex, o.attr && (s = $.extend(!0, {}, h[i]), o.attr(s)), document.createElementNS ? o.scale(1.5, 1.5) : o.attr("stroke-width", 5)), e(u) && u.call(r, t, n) }).on("mouseout." + i, function (t) { if (d) return; var n = $(t.target).data("wijchartDataObj"), i, s; n || (n = $(t.target.parentNode).data("wijchartDataObj")), s = n.dot, c && (i = n.seriesIndex, s.attr && s.attr($.extend(!0, {}, p[i]))), document.createElementNS && s.scale(1, 1), e(a) && a.call(r, t, n) }).on("mousemove." + i, function (t) { if (d) return; if (e(f)) { var n = $(t.target).data("wijchartDataObj"); n || (n = $(t.target.parentNode).data("wijchartDataObj")), f.call(r, t, n) } }).on("click." + i, function (t) { if (d) return; if (e(l)) { var n = $(t.target).data("wijchartDataObj"); n || (n = $(t.target.parentNode).data("wijchartDataObj")), l.call(r, t, n) } }) }, e.prototype.unbindLiveEvents = function () { var e = this.options, t = e.widgetName, n = e.wijCSS; $("." + n.scatterElement, this.element).off(t).off("." + t) }, e.prototype.paintDefaultChartLabel = function (e, t, n) { var r = this.options, i = $.extend(!0, {}, r.textStyle, r.chartLabelStyle), s, o = r.chartLabelFormatString, u; return r.isYTime ? s = Globalize.format(n, "f", r.culture) : s = $.round(n, 2), o && o.length && (s = Globalize.format(s, o, r.culture)), u = this.chartRender.text(e, t, s), u }, e.prototype.paintScatters = function () { var e = this, t = e.options, n = t.seriesList, r = t.seriesStyles, i = t.seriesHoverStyles, s = t.isXTime, o = t.isYTime, u = t.bounds, a = this.plotInfo, f = t.wijCSS, l = t.showChartLabels, c = t.chartLabelStyle, h = t.widget; $.each(n, function (t, n) { var p = n.data, d, v = n.markerWidth || 5, m = r[t], g = i[t], y = p.x, b = p.y, w = [], E = [], S; n = $.extend(!0, { visible: !0, markerType: "circle" }, n), d = n.markerType; if (n.display === "exclude") return !0; !m.fill && m.stroke && (m.fill = m.stroke); if (y === undefined) return !0; $.each(b, function (r, i) { var p = y[r], x = 0, T = 0, N, C, k, L = {}; s && (p = $.toOADate(p)), o && (i = $.toOADate(i)); if (typeof p == "undefined") return !1; isNaN(p) || typeof p == "string" ? N = r : N = p, x = u.startX + (N - a.minX) * a.kx, T = u.endY - (i - a.minY) * a.ky, m.opacity && (m["fill-opacity"] = m.opacity, m["stroke-opacity"] = m.opacity, delete m.opacity), d === "cross" && m["stroke-width"] !== undefined && m["stroke-width"] === 0 && (m["stroke-width"] = 1), C = e.chartRender.symbol(d, x, T, v), C.attr(m), C.add(e.g), C.attr({ "class": f.canvasObject + " " + f.scatterElement }), L = $.extend(!1, { dot: C, x: y[r], y: b[r], seriesIndex: t, index: r, markerType: d, type: "scatter", style: m, hoverStyle: g, visible: !0 }, n), l && (k = e.paintDefaultChartLabel(x, T - 6, b[r]), k.add(e.g), c = $.extend({ "font-size": "10px", fill: "#888", "font-family": "Arial" }, c), k.attr(c), C.label = k, e.chartLabels.push(k)), h.dataPoints = h.dataPoints || {}, h.pointXs = h.pointXs || [], S = $.round(x, 2), h.dataPoints[S.toString()] || (h.dataPoints[S.toString()] = [], h.pointXs.push(S)), h.dataPoints[S.toString()].push(L), $(C.element).data("wijchartDataObj", L), w.push(C), e.tooltipTars.push($.extend({}, C, { node: C.element })), E.push(C), n.visible === !1 && C.hide() }), e.scatters.push(w), e.seriesEles.push(E) }) }, e.prototype.playAnimation = function () { var e = this, t = e.options, n = t.animation, r = e.element, i = r.css("background-color"); n.enabled ? (i === "transparent" && (i = "white"), e.clipRect.getCSS ? $(e.clipRect.members[0].element).animate({ width: r.width() }, { duration: n.duration, step: function (t) { e.clipRect.width = t; var n = e.clipRect.getCSS(); $(this).css(n) } }) : $(e.clipRect.element).animate({ width: r.width() }, { duration: n.duration, step: function (t) { e.clipRect.attr("width", t) } })) : e.clipRect.getCSS ? ($(e.clipRect.members[0].element).css({ width: r.width() }), e.clipRect.width = r.width(), $(e.clipRect.members[0].element).css(e.clipRect.getCSS())) : ($(e.clipRect.element).css({ width: r.width() }), e.clipRect.attr("width", r.width())) }, e.prototype.render = function () { this.paintScatters(), this.playAnimation(), this.unbindLiveEvents(), this.bindLiveEvents(), this.chartEles = { animationSet: this.animationSet, tooltipTars: this.tooltipTars, scatters: this.scatters, labels: this.chartLabels }, this.fields.chartElements || (this.fields.chartElements = {}), this.fields.seriesEles = this.seriesEles, $.extend(!0, this.fields.chartElements, this.chartEles), this.element.data("fields", this.fields) }, e }(); e.ScatterChartRender = r })(wijmo || (wijmo = {})); var chartRender; (function (e) { function w(e) { return typeof e == "string" } function E(e) { return typeof e == "number" } function S(e) { return e !== undefined && e !== null } function x(e, t, n) { var r = "setAttribute", i; return w(t) ? S(n) ? e[r](t, n) : e && e.getAttribute && (i = e.getAttribute(t)) : S(t) && $.isPlainObject(t) && $.each(t, function (t, n) { e[r](t, n) }), i } function T(e, t) { r && t && t.opacity !== undefined && (t.filter = "alpha(opacity=" + t.opacity * 100 + ")"), $.extend(e.style, t) } function N(e, n, r) { var i = t.createElement(e); return n && $.extend(i, n), r && T(i, r), i } function C(e) { $.each(e, function (t, n) { e[t] && e[t].destroy && e[t].destroy(), delete e[t] }) } function D(e, t, n) { return o ? new O(e, t, n) : new _(e, t, n) } var t = document, n = $.each, r = $.browser.msie, i = t.documentMode === 8, s = "http://www.w3.org/2000/svg", o = !!t.createElementNS && !!t.createElementNS(s, "svg").createSVGRect, u = 0, a = "div", f = "absolute", l = "hidden", c = "scatterchart-", h = "visible", p = "visibility", d = "px", v = "none", m = "M", g = "L", y = /^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/, b = /^(\d{1,3})\-(?:((?:[a-zA-Z]+)|(?:\#[0-9a-fA-F]{6})|(?:\#[0-9a-fA-F]{3}))\-)(?:(?:((?:(?:[a-zA-Z]+)|(?:\#[0-9a-fA-F]{6})|(?:\#[0-9a-fA-F]{3}))(?:\:\d{1,3})?)\-)?)*((?:[a-zA-Z]+)|(?:\#[0-9a-fA-F]{6})|(?:\#[0-9a-fA-F]{3}))$/, k = function () { function e() { } return e.prototype.attr = function (e, t) { }, e.prototype.scale = function (e, t) { }, e.prototype.symbolAttr = function (e) { }, e.prototype.clip = function (e) { }, e.prototype.crisp = function (e, t, n, r, i) { }, e.prototype.css = function (e) { }, e.prototype.getBBox = function () { }, e.prototype.show = function () { }, e.prototype.hide = function () { }, e.prototype.add = function (e) { }, e.prototype.destroy = function () { }, e.prototype.empty = function () { }, e.prototype.remove = function () { }, e }(); e.ChartElement = k; var L = function () { function e(e, t, n) { } return e.prototype.destroy = function () { }, e.prototype.createElement = function (e) { }, e.prototype.path = function (e) { return this._element }, e.prototype.circle = function (e, t, n) { return this._element }, e.prototype.rect = function (e, t, n, r, i, s) { return this._element }, e.prototype.setSize = function (e, t) { }, e.prototype.g = function (e) { return this._element }, e.prototype.text = function (e, t, n) { return this._element }, e.prototype.symbol = function (e, t, n, r, i) { return this._element }, e.prototype.clipRect = function (e, t, n, r) { return this._element }, e }(); e.ChartRender = L; var A = function (e) { function i() { e.apply(this, arguments) } return __extends(i, e), i.prototype.init = function (e, n) { this.element = t.createElementNS(s, n), this.renderer = e }, i.prototype.attr = function (e, t) { var n, r, i = this.element, s = this.renderer, o = i.nodeName, u, a = this; if (e === undefined) return; return w(e) && S(t) && (n = e, e = {}, e[n] = t), w(e) ? (n = e, o === "circle" && (n = { x: "cx", y: "cy" }[n] || n), a = x(i, n) || this[n] || 0, n !== "d" && n !== p && (a = parseFloat(a))) : e && $.each(e, function (t, n) { u = !1, r = e[t], t === "d" ? (r && r.join && (r = r.join(" ")), /(NaN| {2}|^$)/.test(r) && (r = "M 0 0"), this.d = r) : t === "fill" ? r = s._color(r, i, t) : o === "circle" && (t === "x" || t === "y") && (t = { x: "cx", y: "cy" }[t] || t), jQuery.browser.safari && t === "stroke-width" && r === 0 && (r = 1e-6), u || x(i, t, r), i.attrs = i.attrs || {}, i.attrs[t] = r }), a }, i.prototype.scale = function (e, t) { var n = this, r = n.getBBox(), i = -(r.x + r.width / 2) / 2, s = -(r.y + r.height / 2) / 2; e === 1 && (i = 0), t === 1 && (s = 0), n.attr("transform", "matrix(" + e + ",0,0, " + t + "," + i + "," + s + ")") }, i.prototype.symbolAttr = function (e) { var t = this; n(["x", "y", "r", "start", "end", "width", "height", "innerR"], function (n, r) { e[r] ? t[r] = e[r] : t[r] = t[r] }), t.attr({ d: t.renderer.symbols[t.symbolName](Math.round(t.x * 2) / 2, Math.round(t.y * 2) / 2, t.r, { start: t.start, end: t.end, width: t.width, height: t.height, innerR: t.innerR }) }) }, i.prototype.clip = function (e) { return this.attr("clip-path", "url(" + this.renderer.url + "#" + e.id + ")") }, i.prototype.crisp = function (e, t, n, r, i) { var s = this, o, u = {}, a = {}, f; e = e || s.strokeWidth || 0, f = e % 2 / 2, a.x = Math.floor(t || s.x || 0) + f, a.y = Math.floor(n || s.y || 0) + f, a.width = Math.floor((r || s.width || 0) - 2 * f), a.height = Math.floor((i || s.height || 0) - 2 * f), a.strokeWidth = e; for (o in a) s[o] !== a[o] && (s[o] = u[o] = a[o]); return u }, i.prototype.css = function (e) { var t = this, n = t.element, i = e && e.width && n.nodeName === "text", s = "", u = function (e, t) { return "-" + t.toLowerCase() }; return e && e.color && (e.fill = e.color), e = $.extend(t.styles, e), t.styles = e, r && !o ? (i && delete e.width, T(t.element, e)) : ($.each(e, function (t, n) { s += n.replace(/([A-Z])/g, u) + ":" + e[n] + ";" }), t.attr({ style: s })), t }, i.prototype.getBBox = function () { var e, t, n, r = this.rotation, i = r * Math.PI * 2 / 360; try { e = $.extend({}, this.element.getBBox()) } catch (s) { e = { width: 0, height: 0 } } return t = e.width, n = e.height, r && (e.width = Math.abs(n * Math.sin(i)) + Math.abs(t * Math.cos(i)), e.height = Math.abs(n * Math.cos(i)) + Math.abs(t * Math.sin(i))), e }, i.prototype.show = function () { return this.attr({ visibility: h }) }, i.prototype.hide = function () { return this.attr({ visibility: l }) }, i.prototype.add = function (e) { var t = this, n = t.renderer, r = e || n, i = r.element || n.box, s = i.childNodes, o = t.element, u = x(o, "zIndex"), a, f, l; e && t.htmlNode && (e.htmlNode || (e.htmlNode = []), e.htmlNode.push(t)), u && (r.handleZ = !0, u = parseInt(u, 10)); if (r.handleZ) for (l = 0; l < s.length; l++) { a = s[l], f = x(a, "zIndex"); if (a !== o && (parseInt(f, 10) > u || !S(u) && S(f))) return i.insertBefore(o, a), t } return i.appendChild(o), t.added = !0, t }, i.prototype._safeRemoveChild = function (e) { var t = e.parentNode; t && t.removeChild(e) }, i.prototype.destroy = function () { var e = this, t = e.element || {}, r = e.shadows, i = e.box, s; t.onclick = t.onmouseout = t.onmouseover = t.onmousemove = null, e.clipPath && (e.clipPath = e.clipPath.destroy()); if (e.stops) { for (s = 0; s < e.stops.length; s++) e.stops[s] = e.stops[s].destroy(); e.stops = null } return e._safeRemoveChild(t), r && n(r, function (t) { e._safeRemoveChild(t) }), i && i.destroy(), $.each(e, function (t, n) { delete e[t] }), null }, i.prototype.empty = function () { var e = this.element, t = e.childNodes, n = t.length; while (n--) e.removeChild(t[n]), $(t[n]).remove() }, i.prototype.remove = function () { var e = this.element, t = e.parentNode; t.removeChild(e), $(e).remove() }, i }(k), O = function (e) { function n(t, n, r) { e.call(this, t, n, r), this.gradientCache = {}, this.init(t, n, r) } return __extends(n, e), n.prototype.init = function (e, i, o) { var u = this, a = t.location, f; this.symbols = n._symbols, this.Element = A, $(e).is("svg") ? (u.box = e, f = new u.Element, f.element = e, f.render = u, u.defs = $("defs", e).get(0), u.gradients = {}) : (f = u.createElement("svg").attr({ xmlns: s, version: "1.1" }), e.appendChild(f.element), u.box = f.element, u.boxWrapper = f, u.defs = this.createElement("defs").add(), u.gradients = {}, u.setSize(i, o)), u.url = r ? "" : a.href.replace(/#.*?$/, "") }, n.prototype.destroy = function () { var e = this; return e.box = null, C(e.gradients || {}), e.gradients = null, null }, n.prototype.createElement = function (e) { var t = new this.Element; return t.init(this, e), t }, n.prototype.path = function (e) { var t = this.createElement("path"); return t.attr({ d: e, fill: v }), t }, n.prototype.circle = function (e, t, n) { var r = $.isPlainObject(e) ? e : { x: e, y: t, r: n }, i = this.createElement("circle"); return i.attr(r), i }, n.prototype.rect = function (e, t, n, r, i, s) { $.isPlainObject(e) && (t = e.y, n = e.width, r = e.height, i = e.r, s = e.strokeWidth, e = e.x); var o = this.createElement("rect"); return o.attr({ rx: i, ry: i, fill: v }), o.attr(o.crisp(s, e, t, Math.max(n, 0), Math.max(r, 0))), o }, n.prototype.setSize = function (e, t) { var n = this; n.width = e, n.height = t, n.boxWrapper.attr({ width: e, height: t }) }, n.prototype.g = function (e) { var t = this.createElement("g"); return S(e) && t.attr({ "class": c + e }), t }, n.prototype.text = function (e, t, n) { $.isPlainObject(e) && (t = e.y, n = e.text, e = e.x); var r = this.createElement("text"); return r.attr({ x: e, y: t, "text-anchor": "middle" }), r.element.textContent = n, r }, n.prototype.symbol = function (e, t, n, r, i) { var s, o = this, u = o.symbols[e], a = u && u(Math.round(t), Math.round(n), r, i); return a ? (s = o.path(a), $.extend(s, { symbolName: e, x: t, y: n, r: r }), i && $.extend(s, i)) : s = o.circle(t, n, r), s }, n._symbols = { box: function (e, t, n) { var r = .707 * n; return [m, e - r, t - r, g, e + r, t - r, e + r, t + r, e - r, t + r, "Z"] }, tri: function (e, t, n) { return [m, e, t - 1.33 * n, g, e + n, t + .67 * n, e - n, t + .67 * n, "Z"] }, invertedTri: function (e, t, n) { return [m, e, t + 1.33 * n, g, e - n, t - .67 * n, e + n, t - .67 * n, "Z"] }, diamond: function (e, t, n) { return [m, e, t - n, g, e + n, t, e, t + n, e - n, t, "Z"] }, cross: function (e, t, n) { var r = .707 * n; return [m, e - r, t - r, g, e + r, t + r, m, e - r, t + r, g, e + r, t - r] }, arc: function (e, t, n, r) { var i = r.start, s = r.end - 1e-6, o = r.innerR, u = Math.cos(i), a = Math.sin(i), f = Math.cos(s), l = Math.sin(s), c = r.end - i < Math.PI ? 0 : 1; return [m, e + n * u, t + n * a, "A", n, n, 0, c, 1, e + n * f, t + n * l, g, e + o * f, t + o * l, "A", o, o, 0, c, 0, e + o * u, t + o * a, "Z"] } }, n.prototype.clipRect = function (e, t, n, r) { var i, s = c + u++, o = this.createElement("clipPath"); return o.attr({ id: s }), $(this.defs).append(o.element), i = this.rect(e, t, n, r, 0).add(o), i.id = s, i.clipPath = o, i }, n.prototype._parsegradientcolor = function (e) { var t = this, n = [], r, i, s, o, u, a, f, l; if (t.gradientCache[e]) return t.gradientCache[e]; for (s = 0, a = e.length; s < a; s++) { r = {}, i = e[s].match(/^([^:]*):?([\d\.]*)/), r.color = Raphael.getRGB(i[1]); if (r.color.error) return null; r.color = r.color.hex, i[2] && (r.offset = i[2] + "%"), n.push(r) } for (s = 1, a = n.length - 1; s < a; s++) if (!n[s].offset) { o = parseFloat(n[s - 1].offset || 0), u = 0; for (f = s + 1; f < a; f++) if (n[f].offset) { u = n[f].offset; break } u || (u = 100, f = a), u = parseFloat(u), l = (u - o) / (f - s + 1); for (; s < f; s++) o += l, n[s].offset = o + "%" } return t.gradientCache[e] = n, n }, n.prototype._color = function (e, t, n) { var r = this, i = "color", s = .5, o = .5, a = r.gradients, f, l, h, p, d, v, m, g, w, E, S = e, T, N, C; b.test(e) ? i = "linear" : e = e.replace(y, function (e, t, n) { i = "radial"; if (t && n) { s = parseFloat(t), o = parseFloat(n); var r = o > .5 ? 1 : -1; Math.pow(s - .5, 2) + Math.pow(o - .5, 2) > .25 && (o = Math.sqrt(.25 - Math.pow(s - .5, 2)) * r + .5) && o !== .5 && (o = parseFloat(o.toFixed(5)) - 1e-5 * r) } return "" }); if (i === "linear" || i === "radial") { l = e.split(/\s*\-\s*/); if (i === "linear") { N = l.shift(), N = -parseFloat(N); if (isNaN(N)) return e; g = [0, 0, Math.cos(Raphael.rad(N)), Math.sin(Raphael.rad(N))], w = 1 / (Math.max(Math.abs(g[2]), Math.abs(g[3])) || 1), g[2] *= w, g[3] *= w, g[2] < 0 && (g[0] = -g[2], g[2] = 0), g[3] < 0 && (g[1] = -g[3], g[3] = 0), h = g[0], p = g[1], d = g[2], v = g[3] } return a[S] ? T = x(a[S].element, "id") : (C = this._parsegradientcolor(l), $.each(C, function (e, t) { t.offset = t.offset ? t.offset : e ? "100%" : "0%" }), T = c + u++, f = r.createElement(i + "Gradient"), i === "radial" ? f.attr({ id: T, fx: s, fy: o }) : f.attr({ id: T, x1: h, y1: p, x2: d, y2: v }), $(this.defs).append(f.element), f.stops = [], $.each(C, function (e, t) { var n; m = t.color, E = 1, n = r.createElement("stop"), n.attr({ offset: t.offset, "stop-color": m, "stop-opacity": E }).add(f), f.stops.push(n) }), a[S] = f), "url(#" + T + ")" } return t.removeAttribute(n + "-opacity"), e }, n }(L), M = function (e) { function t() { e.apply(this, arguments) } return __extends(t, e), t.prototype.init = function (e, t) { var n = ["<", t, ' filled="f" stroked="f"'], r = ["position: ", f, ";"]; (t === "shape" || t === a) && r.push("left:0;top:0;width:10px;height:10px;"), i && r.push("visibility: ", t === a ? l : h), n.push(' style="', r.join(""), '"/>'), t && (n = t === a || t === "span" || t === "img" ? n.join("") : e.prepVML(n), this.element = N(n)), this.renderer = e }, t.prototype.add = function (e) { var t = this, n = t.renderer, r = t.element, s = n.box, o = e && e.inverted, u = e ? e.element || e : s; return o, i && u.gVis === l && T(r, { visibility: l }), u.appendChild(r), t.added = !0, t }, t.prototype.attr = function (e, t) { var n, r, s, o = this, u = o.element || {}, f = u.style, l = u.nodeName, c = o.symbolName, m = o.renderer, g, y, b = o.shadows, N, C, k = o; return e === undefined ? k : (w(e) && S(t) && (n = e, e = {}, e[n] = t), w(e) ? (n = e, n === "strokeWidth" || n === "stroke-width" ? k = o.strokeweight : k = o[n]) : e && $.each(e, function (t, n) { r = n, N = !1; if (c && /^(x|y|r|start|end|width|height|innerR)/.test(t)) y || (o.symbolAttr(e), y = !0), N = !0; else if (t === "d") { r = r || [], o.d = r.join(" "), s = r.length, C = []; while (s--) E(r[s]) ? C[s] = Math.round(r[s] * 10) - 5 : r[s] === "Z" ? C[s] = "x" : C[s] = r[s]; r = C.join(" ") || "x", u.path = r; if (b) { s = b.length; while (s--) b[s].path = r } N = !0 } else if (t === "zIndex" || t === p) { if (i && t === p && l === a) { u.gVis = r, g = u.childNodes, s = g.length; while (s--) T(g[s], { visibility: r }); r === h && (r = null) } r && (f[t] = r), N = !0 } else t === "class" ? u.className = r : t === "stroke" ? t = "strokecolor" : t === "stroke-width" || t === "strokeWidth" ? (u.stroked = r ? !0 : !1, t = "strokeweight", o[t] = r, E(r) && (r += d)) : t === "fill" && (l === "SPAN" ? f.color = r : (u.filled = r !== v ? !0 : !1, r = m.color(r, u, t), t = "fillcolor")); N || (t === "opacity" && (t = "fill-opacity"), i ? u[t] = r : x(u, t, r)), u.attrs = u.attrs || {}, u.attrs[t] = r }), k) }, t.prototype.scale = function (e, t) { var n = this, r = n.attr("stroke-width") || 0; n.css({ filter: "progid:DXImageTransform.Microsoft.Matrix(M11=" + e + "," + ", M12=0, M21=0, M22=" + t + ", Dx=0, Dy=0, sizingmethod='auto expand')" }).attr("stroke-width", r) }, t.prototype.clip = function (e) { var t = this, n = e.members; return n.push(t), t.css(e.getCSS(t.inverted)) }, t.prototype.css = function (e) { var t = this, n = t.element, r = e && n.tagName === "SPAN" && e.width; return r && (delete e.width, t.textWidth = r), t.styles = $.extend(t.styles, e), T(t.element, e), t }, t.prototype.destroy = function () { var e = this; return e.destroyClip && e.destroyClip(), A.prototype.destroy.apply(e) }, t.prototype.empty = function () { var e = this.element, t = e.childNodes, n = t.length, r; while (n--) r = t[n], r.parentNode.removeChild(r), $(r).remove() }, t.prototype.getBBox = function () { var e = this, t = e.element, n = e.bBox; return n || (t.nodeName === "text" && (t.style.position = f), n = e.bBox = { x: t.offsetLeft, y: t.offsetTop, width: t.offsetWidth, height: t.offsetHeight }), n }, t }(A), _ = function (e) { function r() { e.apply(this, arguments), this.isIE8 = $.browser.msie && parseInt($.browser.version) === 8 } return __extends(r, e), r.prototype.init = function (e, n, i) { var s = this, o; this.Element = M, this.symbols = r._symbols, $(e).hasClass("vmlcontainer") ? (s.box = e, o = new this.Element, o.element = e, o.render = this, s.boxWrapper = o) : (o = s.createElement(a), e.appendChild(o.element), s.box = o.element, s.boxWrapper = o, s.setSize(n, i)), t.namespaces.v || (t.namespaces.add("v", "urn:schemas-microsoft-com:vml"), t.createStyleSheet().cssText = "v\\:fill, v\\:path, v\\:shape, v\\:stroke{ behavior:url(#default#VML); display: inline-block; } ") }, r.prototype.clipRect = function (e, t, r, s) { var o = this.createElement(); return $.extend(o, { members: [], left: e, top: t, width: r, height: s, getCSS: function (e) { var t = this, n = t.top, r = t.left, s = r + t.width, o = n + t.height, u = { clip: "rect(" + Math.round(e ? r : n) + "px," + Math.round(e ? o : s) + "px," + Math.round(e ? s : o) + "px," + Math.round(e ? n : r) + "px)" }; return !e && i && $.extend(u, { width: s + d, height: o + d }), u }, updateClipping: function () { n(o.members, function (e, t) { t.css(o.getCSS(t.inverted)) }) } }), o }, r.prototype.color = function (e, t, n) { var r, i = this, s = "color", o, u, a, f, l = [], c, h, p, d, v = 0; b.test(e) ? s = "linear" : e = e.replace(y, function (e, t, n) { return s = "radial", t && n && (t = parseFloat(t), n = parseFloat(n), Math.pow(t - .5, 2) + Math.pow(n - .5, 2) > .25 && (n = Math.sqrt(.25 - Math.pow(t - .5, 2)) * ((n > .5 ? 1 : 0) * 2 - 1) + .5), p = t + " " + n), "" }); if (s !== "linear" && s !== "radial") return h = t.getElementsByTagName(n), h.length && (h[0].opacity = 1), e; o = e.split(/\s*\-\s*/), s === "linear" && (v = o.shift(), v = -parseFloat(v.toString())), d = i._parsegradientcolor(o), $.each(d, function (e, t) { t.offset = t.offset ? t.offset : e ? "100%" : "0%", l.push(t.offset + " " + t.color), u = t.color, e ? f = u : a = u }), s === "radial" ? r = ['<fill colors="', l.join(), '" angle="0"', '" focusposition="', p, '" color="', a, '" color2="', f, '" focussize="0 0"', ' type="gradientTitle" focus="100%" method="none" />'] : r = ['<fill colors="', l.join(), '" angle="', v.toString(), '" type="gradient" focus="100%" method="sigma" />'], c = N(i.prepVML(r)), $(t).append(c) }, r.prototype.prepVML = function (e) { var t = "display:inline-block;behavior:url(#default#VML);", n = this.isIE8; return e = e.join(""), n ? (e = e.replace("/>", ' xmlns="urn:schemas-microsoft-com:vml" />'), e.indexOf('style="') === -1 ? e = e.replace("/>", ' style="' + t + '" />') : e = e.replace('style="', 'style="' + t)) : e = e.replace("<", "<v:"), e }, r.prototype.path = function (e) { var t = this.createElement("shape"); return t.attr({ coordsize: "100 100", d: e }), t }, r.prototype.g = function (e) { var t, n; return e && (n = { className: c + e, "class": c + e }), t = this.createElement(a).attr(n), t }, r.prototype.text = function (e, t, n) { var r = this.createElement("span"), i = r.element, s, o; return i.innerHTML = n, $(i).appendTo("body"), s = $(i).width(), o = $(i).height(), e -= s / 2, t -= o / 2, r.x = e, r.y = t, $(i).css({ position: "absolute", "white-space": "nowrap", "font-family": "Arial", "font-size": "10", left: e + "px", top: t + "px" }), r }, r._symbols = $.extend({}, O._symbols, { arc: function (e, t, n, r) { var i = r.start, s = r.end, o = Math.cos(i), u = Math.sin(i), a = Math.cos(s), f = Math.sin(s), l = r.innerR, c = .07 / n, h = l && .1 / l || 0; return s - i === 0 ? ["x"] : (2 * Math.PI - s + i < c ? a = -c : s - i < h && (a = Math.cos(i + h)), ["wa", e - n, t - n, e + n, t + n, e + n * o, t + n * u, e + n * a, t + n * f, "at", e - l, t - l, e + l, t + l, e + l * a, t + l * f, e + l * o, t + l * u, "x", "e"]) }, circle: function (e, t, n) { return ["wa", e - n, t - n, e + n, t + n, e + n, t, e + n, t, "e"] }, rect: function (e, t, n, r) { if (!S(r)) return []; var i = r.width, s = r.height, o = e + i, u = t + s; return n = Math.min(n, i, s), [m, e + n, t, g, o - n, t, "wa", o - 2 * n, t, o, t + 2 * n, o - n, t, o, t + n, g, o, u - n, "wa", o - 2 * n, u - 2 * n, o, u, o, u - n, o - n, u, g, e + n, u, "wa", e, u - 2 * n, e + 2 * n, u, e + n, u, e, u - n, g, e, t + n, "wa", e, t, e + 2 * n, t + 2 * n, e, t + n, e + n, t, "x", "e"] } }), r }(O); e.createRender = D })(chartRender || (chartRender = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { var t = 1e4, n = 0, r = 0, i = 0, s = function (e) { function s() { e.apply(this, arguments) } return __extends(s, e), s.prototype._setOption = function (n, r) { var i = this, s = i.options; if (n === "minimumSize" || n === "minimumSize") isNaN(r) || r < 0 ? r = 0 : r > t && (r = t), s[n] = r, i.redraw(); else if (n === "chartLabel") $.extend(s.chartLabel, r), i.redraw(); else { if (n === "showChartLabels" || n === "chartLabelStyle") s[n] = r, i._setLabelOption(); e.prototype._setOption.call(this, n, r) } n === "seriesList" && (i.indexs = null, i.bubbleRadius = null) }, s.prototype._create = function () { var t = this, n = t.options, r = t._getDefFill(); this._handleChartStyles(), t._setLabelOption(), e.prototype._create.call(this), t.chartElement.addClass(n.wijCSS.bubbleChart) }, s.prototype._setLabelOption = function () { var e = this.options; e.showChartLabels !== !0 && e.chartLabel.visible === !0 && (e.chartLabel.visible = !1), !$.isPlainObject(e.chartLabel.style) && $.isPlainObject(e.chartLabelStyle) && (e.chartLabel.style = e.chartLabelStyle) }, s.prototype._clearChartElement = function () { var t = this, n = t.options, r = t.chartElement.data("fields"); e.prototype._clearChartElement.call(this), r && r.bubbleInfos && $.each(r.bubbleInfos, function (e, t) { t.bubble && t.bubble.wijRemove(), t.dcl && t.dcl.wijRemove(), t.symbol && t.symbol.wijRemove() }), r && r.bubbles && t._destroyRaphaelArray(r.bubbles), t.element.removeData("plotInfos"), n.seriesTransition.enabled || r && r.bubblesAnimationInfos && (r.bubblesAnimationInfos = null) }, s.prototype.destroy = function () { var t = this; t.chartElement.removeClass(t.options.wijCSS.bubbleChart + " ui-helper-reset"), t._destroyEles(), e.prototype.destroy.call(this) }, s.prototype.getBubble = function (e) { return this.chartElement.data("fields").bubbles[e] }, s.prototype.redraw = function (t) { this.bubbleRadius = null, e.prototype.redraw.call(this, t) }, s.prototype._destroyEles = function () { var e = this, t = e.element, n = t.data("fields"); n.bubbleInfos && $.each(n.bubbleInfos, function (t, n) { e._removeEle(n.bubble), e._removeEle(n.dcl), e._removeEle(n.symbol), n = null }), t.removeData("fields"), e.bubbleRadius = [] }, s.prototype._removeEle = function (e) { e && (e.node && $(e.node).removeData(), e.wijRemove(), e = null) }, s.prototype._paintPlotArea = function () { var e = this, t = this.chartElement, n = e.options, r = n.seriesList, i = r.length, s = [].concat(n.seriesStyles.slice(0, i)), o = [].concat(n.seriesHoverStyles.slice(0, i)), a = e.canvasBounds, f = e.axisInfo.x, l = e.axisInfo.y[0]; if (i === 0) return; e._prepBubbleData(), this.bubbleChartRender = new u(this.chartElement, { seriesList: r, seriesStyles: s, seriesHoverStyles: o, canvas: e.canvas, bounds: a, xAxisInfo: f, yAxisInfo: l, chartLabel: n.chartLabel, textStyle: n.textStyle, chartLabelStyle: n.chartLabelStyle, chartLabelFormatString: n.chartLabelFormatString, bubbleRadius: e.bubbleRadius, animation: n.animation, seriesTransition: n.seriesTransition, sizingMethod: n.sizingMethod, minimumSize: n.minimumSize, maximumSize: n.maximumSize, mouseDown: $.proxy(e._mouseDown, e), mouseUp: $.proxy(e._mouseUp, e), mouseOver: $.proxy(e._mouseOver, e), mouseOut: $.proxy(e._mouseOut, e), mouseMove: $.proxy(e._mouseMove, e), click: $.proxy(e._click, e), disabled: n.disabled, culture: e._getCulture(), wijCSS: n.wijCSS, shadow: n.shadow, widget: this }), this.bubbleChartRender.render(), e.tooltipbubbles = [], $.each(t.data("fields").bubbleInfos, function (t, n) { e.tooltipbubbles.push(n.bubble), n.dcl && e.tooltipbubbles.push(n.dcl), n.symbol && e.tooltipbubbles.push(n.symbol) }), e.tooltip && e.tooltip.setTargets(e.tooltipbubbles) }, s.prototype._paintLegendIcon = function (e, t, n, r, i, s, o, u, a, f) { var l = this, c = Math.min(n, r), h, p, d; return h = a.markerStyle, h = $.extend({ fill: i.fill, stroke: i.stroke, opacity: 1 }, h), a.markers && (p = a.markers.type), p || (p = "circle"), d = l.canvas.paintMarker(p, e + n / 2, t + r / 2, c / 2), $(d.node).data("legendIndex", s).data("index", o), l.legendIcons.push(d), d.attr(h), $.wijraphael.addClass($(d.node), u), d }, s.prototype._getbubbleIndexs = function (e, t) { var n = this, o = n.options, u = o.axis.x.max, a = o.axis.x.min, f = o.axis.y.min, l = o.axis.y.max, c = [], h = [], p = [], d = [], v = [], m = [], g = -1, y = -1, b = -1, w = -1; n.bubbleRadius = [], n._prepBubbleData(), $.each(o.seriesList, function (g, y) { var b = y.data, w = y.markers || {}, E = w.type || "circle"; if (b.y1 === undefined) return !0; $.each(b.y1, function (g, y) { var w = s.transform(y, o.maximumSize, o.minimumSize, n.canvasBounds, r, i, o.sizingMethod, E), S, x; n._isDate(b.x[g]) ? S = $.toOADate(b.x[g]) : isNaN(b.x[g]) ? S = g : S = b.x[g], x = b.y[g], n._isDate(x) && (x = $.toOADate(x)), c.push(S - w * (u - a) / e), h.push(x - w * (l - f) / t), p.push(S + w * (u - a) / e), d.push(x + w * (l - f) / t), v.push(S), m.push(x), n.bubbleRadius.push(w) }) }), g = n._getMinIndex(c), y = n._getMinIndex(h), b = n._getMaxIndex(p), w = n._getMaxIndex(d), n.indexs = { xMin: { x: v[g], y: m[g], r: n.bubbleRadius[g] }, xMax: { x: v[b], y: m[b], r: n.bubbleRadius[b] }, yMin: { x: v[y], y: m[y], r: n.bubbleRadius[y] }, yMax: { x: v[w], y: m[w], r: n.bubbleRadius[w] } } }, s.prototype._calculateParameters = function (t, n) { e.prototype._calculateParameters.call(this, t, n); var r = this; if (!n.autoMax && !n.autoMin) return; r._adjust(n, t) }, s.prototype._adjust = function (e, t) { var n = e.unitMinor, r = this, i = e.autoMin, s = e.autoMax, o = r.canvasBounds, u = { x: o.startX, y: o.startY }, a = o.endX - u.x, f = o.endY - u.y, l = t.max, c = t.min, h = e.origin; r.indexs || r._getbubbleIndexs(a, f), t.id === "x" ? (i && (c = r._getMinTick(r.indexs.xMin.x, r.indexs.xMin.r, c, l, a, n)), s && (l = r._getMaxTick(r.indexs.xMax.x, r.indexs.xMax.r, c, l, a, n))) : (i && (c = r._getMinTick(r.indexs.yMin.y, r.indexs.yMin.r, c, l, f, n)), s && (l = r._getMaxTick(r.indexs.yMax.y, r.indexs.yMax.r, c, l, f, n))); if (l !== t.max || c !== t.min) h !== null && h !== undefined && (h < c ? c = h : h > l && (l = h)), t.min = c, t.max = l, this._calculateMajorMinor(e, t), r._adjust(e, t) }, s.prototype._getMinTick = function (e, t, n, r, i, s) { return (e - n) * i / (r - n) < t ? n - s : n }, s.prototype._getMaxTick = function (e, t, n, r, i, s) { return (e - n) * i / (r - n) + t > i ? r + s : r }, s.prototype._getMinIndex = function (e) { var t = -1, n = 0; return $.each(e, function (e, t) { e === 0 ? n = t : t < n && (n = t) }), $.each(e, function (e, r) { if (r === n) return t = e, !1 }), t }, s.prototype._getMaxIndex = function (e) { var t = -1, n = 0; return $.each(e, function (e, t) { e === 0 ? n = t : t > n && (n = t) }), $.each(e, function (e, r) { if (r === n) return t = e, !1 }), t }, s.prototype._showSerieEles = function (e) { $.each(e, function (e, t) { t.bubble && (t.bubble.show(), t.bubble.shadow && t.bubble.shadow.show(), t.bubble.tracker && t.bubble.tracker.show(), $(t.bubble.node).data("wijchartDataObj") && ($(t.bubble.node).data("wijchartDataObj").visible = !0)), t.dcl && t.dcl.show(), t.symbol && t.symbol.show() }) }, s.prototype._hideSerieEles = function (e) { $.each(e, function (e, t) { t.bubble && (t.bubble.hide(), t.bubble.shadow && t.bubble.shadow.hide(), t.bubble.tracker && t.bubble.tracker.hide(), $(t.bubble.node).data("wijchartDataObj") && ($(t.bubble.node).data("wijchartDataObj").visible = !1)), t.dcl && t.dcl.hide(), t.symbol && t.symbol.hide() }) }, s.prototype._indicatorLineShowing = function (t) { e.prototype._indicatorLineShowing.call(this, t), $.each(t, function (e, t) { t.bubble && t.bubble.attr(t.hoverStyle) }) }, s.prototype._removeIndicatorStyles = function (e) { $.each(e, function (e, t) { t.bubble && t.bubble.attr(t.style) }) }, s.prototype._parseTable = function () { if (!this.element.is("table")) return; var e = this, t = e.element, n = e.options, r = $("caption", t), i = $("thead th", t), s = [], o = $("tbody tr", t), u = null, a = null, f = [], l = [], c = [], h = function (e) { var t = $.trim(e); return isNaN(e) || (t = parseFloat(e.toString())), t }; r.length && (n.header = $.extend({ visible: !0, text: $.trim($(r[0]).text()) }, n.header), r.length > 1 && (n.footer = $.extend({ visibel: !0, text: $.trim($(r[1]).text()) }, n.footer))), n.legend = $.extend({ visible: !0 }, n.legend), u = $.trim(i.eq(1).text()), o.each(function (e, t) { var n = $("td", t); return n.length >= 3 && (f.push(h(n.eq(0).text())), l.push(h(n.eq(1).text())), c.push(h(n.eq(2).text()))), this }), a = { label: u, legendEntry: !0, data: { x: f, y: l, y1: c } }, s.push(a), e.options.seriesList = s }, s.prototype._unbindLiveEvents = function () { var e = this; $("." + e.options.wijCSS.bubbleElement, e.chartElement[0]).off(".wijbubblechart").off("wijbubblechart"), e.tooltip && (e.tooltip.destroy(), e.tooltip = null) }, s.prototype._paintTooltip = function () { var t = this, n = t.chartElement.data("fields"); e.prototype._paintTooltip.call(this), t.tooltip && n && n.trackers && n.trackers.length && (t.tooltip.setTargets(n.trackers), t.tooltip.setOptions({ relatedElement: n.trackers[0] })) }, s.prototype._getTooltipText = function (e, t) { var n = $(t.node), r, i; return n.data("owner") && (n = n.data("owner")), r = n.data("wijchartDataObj"), i = { data: r, value: r.value, label: r.label, total: r.total, target: t, fmt: e, x: r.x, y: r.y, y1: r.y1 }, $.proxy(e, i)() }, s.prototype._prepBubbleData = function () { var e = this, t = e.options.seriesList, s = -999999999999, o = 9999999999999, u; $.each(t, function (e, t) { u = t.data, u && u.y1 && $.each(u.y1, function (e, t) { s = Math.max(s, t), o = Math.min(o, t) }) }), n = s, r = o, i = s - o }, s.transform = function (t, r, i, o, u, a, f, l) { var c, h = t, p = r - i, d = o.endX - o.startX, v = o.endY - o.startY; return h < 0 && (h = 0), a === 0 ? h = 1 : h /= n, h = s.transformByArea(h, f, l), h *= p, h += i, c = Math.min(d, v), h *= c / 200, h }, s.transformByArea = function (t, n, r) { var i = t; if (n === "area") switch (r) { case "circle": i = Math.sqrt(i / Math.PI); break; case "tri": case "invertedTri": i = Math.sqrt(i / (3 * Math.sin(Math.PI / 6) * Math.cos(Math.PI / 6))); break; case "box": i = Math.sqrt(i / 2); break; case "diamond": case "cross": i = Math.sqrt(i / 2); break; default: i = Math.sqrt(4 * i / Math.PI) } return i }, s }(e.wijchartcore); e.wijbubblechart = s, s.prototype.widgetEventPrefix = "wijbubblechart"; var o = function () { function e() { this.initSelector = ":jqmData(role='wijbubblechart')", this.wijCSS = { bubbleChart: "wijmo-wijbubblechart", bubbleElement: "wijbubblechart-bubble", bubbleTracker: "bubbletracker", bubbleLabel: "wijbubblechart-label", bubbleSymbol: "wijbubblechart-symbol" }, this.minimumSize = 5, this.maximumSize = 20, this.sizingMethod = "diameter", this.animation = { enabled: !0, duration: 1e3, easing: ">" }, this.seriesTransition = { enabled: !0, duration: 400, easing: ">" }, this.seriesList = [], this.seriesHoverStyles = [{ opacity: 1, "stroke-width": 5 }, { opacity: 1, "stroke-width": 5 }, { opacity: 1, "stroke-width": 5 }, { opacity: 1, "stroke-width": 5 }, { opacity: 1, "stroke-width": 5 }, { opacity: 1, "stroke-width": 5 }, { opacity: 1, "stroke-width": 5 }, { opacity: 1, "stroke-width": 5 }, { opacity: 1, "stroke-width": 5 }, { opacity: 1, "stroke-width": 5 }, { opacity: 1, "stroke-width": 5 }, { opacity: 1, "stroke-width": 5 }], this.chartLabel = { position: "inside", compass: "north", visible: !0, style: {}, chartLabelFormatString: "" }, this.mouseDown = null, this.mouseUp = null, this.mouseOver = null, this.mouseOut = null, this.mouseMove = null, this.click = null } return e }(); s.prototype.options = $.extend(!0, {}, e.wijchartcore.prototype.options, new o), $.wijmo.registerWidget("wijbubblechart", s.prototype); var u = function () { function t(e, t) { this.element = e, this.options = t, this._init() } return t.prototype._init = function () { var e = this.options, t = e.bounds; this.fields = this.element.data("fields") || {}, this.canvas = e.canvas, this.seriesList = $.arrayClone(e.seriesList), this.seriesStyles = e.seriesStyles, this.seriesHoverStyles = e.seriesHoverStyles, this.startLocation = { x: t.startX, y: t.startY }, this.width = t.endX - this.startLocation.x, this.height = t.endY - this.startLocation.y, this.seriesEles = [], this.bubbles = [], this.bubbleInfos = [], this.trackers = this.canvas.set(), this.currentIndex = 0 }, t.prototype.initAnimationState = function (e, t) { var n = e.bubble, r = e.symbol, i; n.type === "circle" ? n.attr({ r: 1e-4, cx: t.startX, cy: t.endY }) : (n.transform("s0.01"), i = n.wijGetBBox(), n.transform("t" + (t.startX - i.x) + "," + (t.endY - i.y) + "s0.001")), r && r.hide() }, t.prototype.playAnimation = function () { var e = this, t = e.options, n = t.animation, r = t.bounds, i = e.fields.bubblesAnimationInfos, s = [], o = e.fields.bubbleInfos, u = t.seriesTransition, a, f, l; n && n.enabled ? (a = n.duration || 400, f = n.easing, $.each(o, function (t, n) { var o = n.bubble, c, h, p = o.wijGetBBox(); o.type === "circle" ? c = { r: o.attr("r"), cx: o.attr("cx"), cy: o.attr("cy") } : c = { transform: "S1T0,0", "stroke-width": o.attr("stroke-width"), width: p.width, x: p.x, y: p.y }, o.shadow && o.shadow.hide(), i && u.enabled ? (h = i[t], h ? (o.type === "circle" ? o.attr({ cx: h.cx, cy: h.cy, r: h.r }) : (p = o.wijGetBBox(), l = h.width / p.width, o.transform("s" + l), p = o.wijGetBBox(), o.transform("t" + (h.x - p.x) + "," + (h.y - p.y) + "")), a = u.duration, f = u.easing) : e.initAnimationState(n, r)) : e.initAnimationState(n, r), s.push(c), o.wijAnimate(c, a, f, function () { $(n.bubble.node).data("wijchartDataObj") && $(n.bubble.node).data("wijchartDataObj").visible && (n.dcl && n.dcl.show(), n.symbol && n.symbol.show(), o.shadow && o.shadow.show()) }) }), e.fields.bubblesAnimationInfos = s) : $.each(o, function (e, t) { $(t.bubble.node).data("wijchartDataObj") && $(t.bubble.node).data("wijchartDataObj").visible && (t.dcl && t.dcl.show(), t.symbol && t.symbol.show()) }) }, t.prototype.getSymbol = function (e, t) { var n; return $.each(e, function (e, r) { if (e === t) return n = r, !1 }), n }, t.prototype.getLabelVisible = function (e, t) { var n = !0; return $.each(e, function (e, r) { if (t === r) return n = !1, !1 }), n }, t.prototype.paintMarker = function (e, t, n, r) { var i; return this.canvas[e] && (i = this.canvas[e](t, n, r)), i }, t.prototype.getLabelBox = function (e) { var t = this.canvas.text(0, 0, e), n = t.wijGetBBox(), r; return r = { width: n.width, height: n.height }, t.remove(), r }, t.prototype.applyLabelCompass = function (e, t) { var n = this.options.chartLabel.compass || "north", r = this.getLabelBox(t), i = e.r; switch (n) { case "north": e.y -= i + r.height / 2; break; case "south": e.y += i + r.height / 2; break; case "east": e.x += i + r.width / 2; break; case "west": e.x -= i + r.width / 2 } }, t.prototype.paintDefaultChartLabel = function (e, t) { var n = this.options, r = n.chartLabel, i = n.culture, s = $.extend(!0, {}, n.textStyle, n.chartLabelStyle, r.style), o = $.round(t, 2), u = r.chartLabelFormatString === "" ? n.chartLabelFormatString : r.chartLabelFormatString, a = this.options.widget, f; return u && u.length && (o = Globalize.format(o, u, i)), f = a._text.call(a, e.x, e.y, o).attr(s), f }, t.prototype.paintbubble = function (t, n, o, u, a, f, l, c) { var h = t.data, p = u.min, d = a.min, v = u.max, m = a.max, g = f / (v - p), y = l / (m - d), b = [], w = this.options, E = this, S = w.bounds, x = w.wijCSS, T = w.widget, N = w.chartLabel, C = w.bubbleRadius, k, L, A, O; if (h.y1 === undefined) return; $.each(h.y1, function (f, l) { if (h.x === undefined || h.y === undefined) return !0; var c = h.x[f], d = h.y[f], v = t.markers || {}, M = v.type || "circle", _ = v.symbol, D = t.invisibleMarkLabels || [], P, H, B, j, F, I, q, R, U, z; C ? (U = C[E.currentIndex], E.currentIndex++) : U = s.transform(l, w.maximumSize, w.minimumSize, w.bounds, r, i, w.sizingMethod, M), u.isTime ? c = $.toOADate(c) : isNaN(c) && (c = f), a.isTime && (d = $.toOADate(d)), F = S.startX + (c - p) * g, I = S.startY + (m - d) * y, _ && (q = E.getSymbol(_, f)), j = E.paintMarker(M, F, I, U), j.attr(n), q && (L = q.width || U * 2, A = q.height || U * 2, R = E.canvas.image(q.url, F - U, I - U, L, A)), E.options.shadow && e.ChartUtil.paintShadow(j, 2, null), $.wijraphael.addClass($(j.node), x.canvasObject + " " + x.bubbleElement), q && j.attr("opacity", .1), B = $.extend(!1, { index: f, bubble: j, style: n, y1: l, x: c, y: d, type: "bubble", hoverStyle: o, visible: !0 }, t), q && (B.symbol = !0, B.hoverStyle = $.extend({}, o, { opacity: .1 }), $(R.node).data("wijchartDataObj", B), $.wijraphael.addClass($(R.node), x.bubbleSymbol)), $(j.node).data("wijchartDataObj", B), T.dataPoints = T.dataPoints || {}, T.pointXs = T.pointXs || [], O = $.round(F, 2), T.dataPoints[O.toString()] || (T.dataPoints[O.toString()] = [], T.pointXs.push(O)), T.dataPoints[O.toString()].push(B), z = j.clone(), $.browser.msie && parseInt($.browser.version) < 9 ? z.attr({ opacity: .01, fill: "white", "stroke-width": 0, "fill-opacity": .01 }) : z.attr({ opacity: .01, fill: "white", "fill-opacity": .01 }), $(z.node).data("owner", $(j.node)), $.wijraphael.addClass($(z.node), x.canvasObject + " " + x.bubbleElement + " " + x.bubbleTracker), j.tracker = z, E.trackers.push(z), E.bubbles.push(j), E.fields.bubbles = E.bubbles, P = { x: F, y: I, r: U }, N.visible && E.getLabelVisible(D, f) && (N.position === "outside" && E.applyLabelCompass(P, l), k = E.paintDefaultChartLabel(P, l), k.hide(), $(k.node).data("wijchartDataObj", B), $.wijraphael.addClass($(k.node), x.bubbleLabel)), H = { bubble: j, dcl: k, symbol: R }, E.bubbleInfos.push(H), b.push(H), t.visible === !1 && (j.hide(), k && k.hide(), z.hide(), R && R.hide()) }), E.fields.bubbleInfos = E.bubbleInfos, E.seriesEles.push(b) }, t.prototype.paintBubbles = function () { var e = this, t = e.options, n = t.xAxisInfo, r = t.yAxisInfo; $.each(e.seriesList, function (t, i) { var s = e.seriesStyles[t], o = e.seriesHoverStyles[t]; e.paintbubble(i, s, o, n, r, e.width, e.height, e.startLocation) }) }, t.prototype.bindLiveEvents = function (e, t, n, r, i, s, o, u) { var a = this.options, f = a.wijCSS, l = { mousedown: function (n) { if (u) return; var r = $(n.target), i; r.data("owner") && (r = r.data("owner")), i = r.data("wijchartDataObj"), t.call(e, n, i) }, mouseup: function (t) { if (u) return; var r = $(t.target), i; r.data("owner") && (r = r.data("owner")), i = r.data("wijchartDataObj"), n.call(e, t, i) }, mouseover: function (t) { if (u) return; var n = $(t.target), i; n.data("owner") && (n = n.data("owner")), i = n.data("wijchartDataObj"), r.call(e, t, i) }, mouseout: function (t) { if (u) return; var n = $(t.target), r, s; n.data("owner") && (n = n.data("owner")), r = n.data("wijchartDataObj"), s = r.bubble; if (r.symbol) return; r.hoverStyle ? (r.hoverStyle["stroke-width"] && !r.style["stroke-width"] && s.attr("stroke-width", ""), s.attr(r.style), r.style.opacity && s.attr("opacity", r.style.opacity)) : s && s.attr({ opacity: "1" }), i.call(e, t, r) }, mousemove: function (t) { if (u) return; var n = $(t.target), r, i; n.data("owner") && (n = n.data("owner")), r = n.data("wijchartDataObj"), i = r.bubble, r.hoverStyle ? i.attr(r.hoverStyle) : i && i.attr({ opacity: "0.8" }), s.call(e, t, r) }, click: function (t) { if (u) return; var n = $(t.target), r; n.data("owner") && (n = n.data("owner")), r = n.data("wijchartDataObj"), o.call(e, t, r) } }; $.each(["click", "mouseover", "mouseout", "mousemove", "mousedown", "mouseup"], function (t, n) { $("." + f.bubbleTracker, e).on(n + ".wijbubblechart", l[n]) }) }, t.prototype.render = function () { var e = this.options, t = e.mouseDown, n = e.mouseUp, r = e.mouseOver, i = e.mouseOut, s = e.mouseMove, o = e.click, u = e.disabled; this.paintBubbles(), this.fields.seriesEles = this.seriesEles, this.playAnimation(), this.trackers.toFront(), this.fields.trackers = this.trackers, this.bindLiveEvents(this.element, t, n, r, i, s, o, u), this.element.data("fields", this.fields) }, t }(); e.BubbleChartRender = u })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; var t = jQuery, n = "wijcarousel", r = "wijmo-wijcarousel-", i = "wijmo-wijcarousel ", s = r + "list", o = r + "item ", u = r + "clip", a = r + "current", f = r + "horizontal-multi", l = r + "horizontal", c = r + "button", h = r + "vertical-multi", p = r + "vertical", d = r + "button-next", v = r + "button-previous", m = r + "preview", g = "<a><span></span></a>", y = ".wijmo-wijcarousel-pager,." + c + ",." + d + ",." + v, b = "<div></div>", w = '<li class="wijmo-wijcarousel-page"><a></a></li>', E = "li.wijmo-wijcarousel-page", S = ".wijmo-wijcarousel-text,.wijmo-wijcarousel-caption", x = 1, T = function (e) { function n() { e.apply(this, arguments) } return __extends(n, e), n.prototype._handleDisabledOption = function (e, n) { var r = this, i = r.options; r.pager && !r.pager.is(":hidden") && (r.disabledEles = r.disabledEles.add(r.pager)), e ? (r.element.addClass(i.wijCSS.stateDisabled), r.disabledDiv.length || r._createDisabledDiv(), r.disabledDiv.appendTo("body")) : r.disabledDiv && (r.element.removeClass(i.wijCSS.stateDisabled), r.disabledDiv.remove(), r.disabledDiv = t()) }, n.prototype._createDisabledDiv = function () { var e = this, n = e.options; e.disabledEles.each(function (r, i) { var s = t(i), o = s.offset(), u = s.outerWidth(), a = s.outerHeight(), f = t("<div></div>").addClass(n.wijCSS.stateDisabled).css({ "z-index": "99999", position: "absolute", width: u, height: a, left: o.left, top: o.top }); t.browser.msie && (f.css("background-color", "white"), t.browser.version === "9.0" && f.css("opacity", "0.1")), e.disabledDiv = e.disabledDiv.add(f) }) }, n.prototype._initStates = function (e, n) { var r = this; r.count = 0, r.currentIdx = e.start, r.timeout = null, r.isHorizontal = e.orientation === "horizontal", r.width = n.width() || 640, r.height = n.height() || 480, r.offset = 0, r.disabledEles = n, r.disabledDiv = t() }, n.prototype._create = function () { var e = this, n = e.options, r = e.element; window.wijmoApplyWijTouchUtilEvents && (t = window.wijmoApplyWijTouchUtilEvents(t)), e._initStates(n, r), e._createDom(e.isHorizontal), e.list.bind("click." + e.widgetName, t.proxy(e._itemClick, e)), n.showControlsOnHover && (e.container.bind("mouseenter." + e.widgetName, function () { e._showControls() }).bind("mouseleave." + e.widgetName, function () { e._hideControls() }), e.container.find(y).hide()), n.loadCallback && t.isFunction(n.loadCallback) && e._trigger("loadCallback", null, e); if (n.disabledState) { var i = n.disabled; e.disable(), n.disabled = i } else n.auto && e.play(); e.element.is(":hidden") && e.element.wijAddVisibilityObserver && e.element.wijAddVisibilityObserver(function () { e.refresh(), e.element.wijRemoveVisibilityObserver && e.element.wijRemoveVisibilityObserver() }, "wijcarousel") }, n.prototype._showControls = function () { this.container.find(y).stop(!0, !0).fadeIn(600, function () { t(this).css("opacity", "") }) }, n.prototype._hideControls = function () { this.container.find(y).stop(!0, !0).fadeOut(600) }, n.prototype._applyContainerStyle = function (e, t) { var n = this, r = n.options, i = {}, s = n.list, o = 0, u, a = 0, f = e ? "left" : "top", l = 0, c, h = e ? "width" : "height"; u = n.itemBound[e ? "w" : "h"], n.count = n.list.children("li").length, o = n.count * u, n.list[h](o), n.clip[h](r.display * u), n.clip[e ? "height" : "width"](n.itemBound[e ? "h" : "w"]); if (!r.loop) i[f] = -u * n.currentIdx, s.css(i); else { c = s.find(">li:first"), r.preview && !!t && (c = c.next()), l = c.data("itemIndex"); for (l; l < n.currentIdx; l++) s.children("li:first").appendTo(s); if (r.preview) { if (!t) for (l = 0; l < x; l++) s.children("li:last").prependTo(s); a = -u * x } i[f] = a, s.css(i) } }, n.prototype._applyListStyle = function () { var e = this, t = e.options, n = t.orientation === "horizontal", r = 0, i, s = n ? "width" : "height"; e.itemBound = e._getItemBound(), i = e.itemBound[n ? "w" : "h"], r = e.count * i, e.list[s](r) }, n.prototype._createButtons = function (e, n) { var r = this, i = r.options, s, o = i.wijCSS.stateDisabled; t.each(["prevBtn", "nextBtn"], function (u, a) { var f = i[a + "Class"], l = a === "nextBtn", c = l ? "next" : "previous", h = l ? d : v, p = l ? n : e; f && f.defaultClass ? (o = f.disableClass || o, s = f.hoverClass, r[a] = t('<a class="' + i.wijCSS.stateDefault + '"></a>').addClass(f.defaultClass).mouseover(function () { t(this).hasClass(o) || t(this).addClass(s) }).mouseout(function () { t(this).hasClass(o) || t(this).removeClass(s) })) : r[a] = t(r._createBtn(h, p)), r[a].bind("click." + r.widgetName, function (e) { var n = t(this); if (n.hasClass(i.wijCSS.stateDisabled)) return; r[c].call(r) }).appendTo(r.container) }) }, n.prototype._applyBtnClass = function () { var e = this, n = e.options, r = n.wijCSS.stateDisabled, i = n.wijCSS.stateHover; t.each(["prevBtn", "nextBtn"], function (t, s) { var o = n[s + "Class"], u, a = e[s]; o && (r = o.disableClass || r, i = o.hoverClass || i), u = s === "prevBtn" ? e.currentIdx <= 0 : e.currentIdx + n.display >= e.count, u && !n.loop ? a.removeClass(i).addClass(r) : a.hasClass(r) && a.removeClass(r) }) }, n.prototype._applyBtnStyle = function (e) { var t = this, n = 0, r, i = t.options.wijCSS, s = { collision: "none", of: t.container, my: e ? "right{offset} center" : "center bottom{offset}", at: e ? "right center" : "center bottom" }, o = { collision: "none", of: t.container, my: e ? "left{offset} center" : "center top{offset}", at: e ? "left center" : "center top" }, u = t.options.buttonPosition === "inside", a, f, l = ["cornerBottom", "cornerTop", "cornerRight", "cornerLeft"], c = (e ? 1 : 0) * 2 + (u ? 1 : 0), h = (e ? 1 : 0) * 2 + (u ? 0 : 1), p = function (e, t, n, r, i) { var s = ""; e.removeClass(t).addClass(n), !isNaN(r) && r !== 0 && (r > 0 ? s = "+" + r : s = "-" + -r), i.my = i.my.replace(/\{offset\}/, s), e.position(i) }; n = e ? t.prevBtn.width() : t.prevBtn.height(), r = u ? 0 : n, a = i[l[c]], f = i[l[h]], p(t.nextBtn, f, a, r, s), p(t.prevBtn, a, f, -r, o), t._applyBtnClass() }, n.prototype._createDom = function (e) { var n = this, r = n.options, o = n.element, u, a, c, d; if (o.is("div")) n.list = o.children("ul:eq(0)"), n.container = n.element, n.list.length || (n.list = t("<ul></ul>").appendTo(n.container)); else { if (!o.is("ul")) return; n.list = o, n.container = o.parent() } n.itemBound = n._getItemBound(), e ? (u = r.display > 1 && !r.preview ? f : l, a = r.wijCSS.iconArrowRight, c = r.wijCSS.iconArrowLeft) : (u = r.display > 1 && !r.preview ? h : p, a = r.wijCSS.iconArrowDown, c = r.wijCSS.iconArrowUp), n.list.addClass(s).addClass(r.wijCSS.helperClearFix), d = i + r.wijCSS.widget + " " + u + " " + (r.preview ? m + " " : "") + (r.display > 1 ? r.wijCSS.content + " " + r.wijCSS.cornerAll : ""), n.container.addClass(d), n._createItems(e), n._createClip(e), n._applyContainerStyle(e), n._createButtons(c, a), n._applyBtnStyle(e), r.preview && n._createPreview(), r.showTimer && n._createTimer(), r.showPager && n._createPager(), r.showControls && n._createControls() }, n.prototype._createPreview = function () { var e = this, t = e.options, n, r, i = t.orientation === "horizontal", s = i ? "left" : "top", o = i ? "right" : "bottom", u, a; r = e.itemBound[i ? "w" : "h"], n = e.offset = Math.round(r / 4), u = t.display * r + n * 2, e.clip[i ? "width" : "height"](u), e.list.css(s, function (e, t) { return parseFloat(t) + n }), e.clip.css(s, function (e, t) { return -n }), e.container.css("margin-" + s, n + "px").css("margin-" + o, n + "px"), e.list.find(S).hide(); for (a = 0; a < t.display; a++) e._getItemByIndex(e.currentIdx + a).find(S).show() }, n.prototype._createItemsFromData = function (e) { var n = this; if (!t.isArray(e) || !e.length || !t.isPlainObject(e[0]) || t.isEmptyObject(e[0])) return; n.list.empty(), t.each(e, function (e, r) { var i; if (!t.isPlainObject(r)) return !0; i = n._generateMarkup(r), n.list.append(i) }) }, n.prototype._generateMarkup = function (e) { var n, r; if (!t.isPlainObject(e)) return; return n = t("<li></li>"), typeof e.linkUrl == "string" && e.linkUrl && (r = t("<a>").attr("href", e.linkUrl), r.appendTo(n)), typeof e.imageUrl == "string" && e.imageUrl && t("<img>").attr("src", e.imageUrl).appendTo(r || n), typeof e.caption == "string" && e.caption && t("<span>").html(e.caption).appendTo(n), n }, n.prototype._createItems = function (e) { var n = this, r, i, s = n.options, o, u; if (n.list) { n._createItemsFromData(s.data), n.list.children("li").each(function (e, r) { var i = t(r); n._createItem(i, e) }), o = n.list.children("li").eq(n.currentIdx).addClass(a); if (s.preview && s.display > 1) { r = u = o; for (i = 0; i < s.display - 1; i++) u = u.next(), r = r.add(u); r.find("div.wijmo-wijcarousel-mask").css({ opacity: 0 }) } } }, n.prototype._createItem = function (e, n) { var r = this, i = r.options, s, u; return s = e.addClass(o).addClass(i.wijCSS.helperClearFix).find("img:eq(0)").attr("role", "img").addClass("wijmo-wijcarousel-image"), r._applyItemBound(e), u = e.children("span:eq(0)").hide(), r._createCaption(e, s, u), i.preview && t('<div class="wijmo-wijcarousel-mask">').appendTo(e), e.data("itemIndex", n), e }, n.prototype._applyItemBound = function (e) { var t = this, n = t.itemBound.w, r = t.itemBound.h; if (!t.itemWidth || !t.itemHeight) e.width(n).height(r), t.itemWidth = n - (e.outerWidth(!0) - n), t.itemHeight = r - (e.outerHeight(!0) - r); e.width(t.itemWidth).height(t.itemHeight) }, n.prototype._createCaption = function (e, n, r) { var i = this, s = i.options, o, u, a, f, l; s.showCaption && (o = r.html() || n.attr("title"), o && o.length && (a = t("<span></span>").html(o), f = t(b).addClass([s.wijCSS.helperClearFix, "wijmo-wijcarousel-caption"].join(" ")).appendTo(e), u = t(b).addClass([s.wijCSS.helperClearFix, s.wijCSS.content, "wijmo-wijcarousel-text"].join(" ")).append(a).appendTo(e), i._applyCaptionStyle(f, u))) }, n.prototype._applyCaptionStyle = function (e, n) { var r = e.add(n), i; r.width(this.itemWidth), t.browser.webkit ? (i = n.children("span").css("display", "inline-block").height(), n.children("span").css("display", "")) : i = n.children("span").height(), r.height(i) }, n.prototype._showCaption = function (e, t) { var n = this, r = n._getItemByIndex(e), i = r.find(".wijmo-wijcarousel-text"), s = r.find(".wijmo-wijcarousel-caption"); i.length && i.fadeIn(300, function () { e < t && n._showCaption(e + 1, t) }), s.length && (s.show(), s.animate({ opacity: .5 }, 300)) }, n.prototype._hideCaption = function () { this.element.find(S).hide() }, n.prototype._createClip = function (e) { this.clip = this.list.wrap("<div></div>").parent().addClass(u) }, n.prototype._createBtn = function (e, n) { var r = t(g), i = this.options; return r.addClass(i.wijCSS.stateDefault + " " + e).attr("role", "button").mouseover(function () { t(this).hasClass(i.wijCSS.stateDisabled) || t(this).addClass(i.wijCSS.stateHover) }).mouseout(function () { t(this).hasClass(i.wijCSS.stateDisabled) || t(this).removeClass(i.wijCSS.stateHover) }).children("span:eq(0)").addClass(i.wijCSS.icon + " " + n), r }, n.prototype._createControls = function () { var e = this, n = e.options, r = { collision: "none", of: e.container, my: "center bottom", at: "center bottom" }; n.control && (e.controls = t(n.control).css({ position: "absolute" }).appendTo(e.container), t.extend(r, n.controlPosition), e.controls.position(r)) }, n.prototype._createTimer = function () { var e = this, n = e.options; e._createPausePlay(), e.progressBar = t("<div></div>").addClass("wijmo-wijcarousel-timerbar-inner " + n.wijCSS.cornerAll).css({ width: "0%" }).attr("role", "progressbar"), e.timer = t("<div></div>").addClass("wijmo-wijcarousel-timerbar " + n.wijCSS.cornerAll).appendTo(e.container).append(e.progressBar).append(e.playPauseBtn) }, n.prototype._createPausePlay = function () { var e = this, n = e.options; e.playPauseBtn = t(e._createBtn(c, n.auto ? n.wijCSS.iconPause : n.wijCSS.iconPlay)).bind("click." + e.widgetName, function () { var r = t(this).children("span:eq(0)"); e[r.hasClass(n.wijCSS.iconPlay) ? "play" : "pause"]() }) }, n.prototype._createPagingItem = function (e, n, r, i) { var s = t(w).attr({ role: "tab", "aria-label": i + 1, title: i + 1 }).addClass(this.options.wijCSS.stateDefault), o, u; if (e) s.addClass("wijmo-wijcarousel-dot"); else { if (!(n && n.images && n.images[i])) return; o = n.imageWidth, u = n.imageHeight, o && u && s.width(o).height(u), s.children("a").append(t("<img>").attr("src", n.images[i])) } r.append(s) }, n.prototype._createPaging = function (e) { var n = this, r = n.options, i, s, o, u = r.thumbnails, a = e === "dots"; n.container.append(n.pager = t('<div><ul class="wijmo-list ' + r.wijCSS.cornerAll + " " + r.wijCSS.helperClearFix + ' role="tablist"></ul></div>')), a || n.pager.addClass("wijmo-wijcarousel-thumbnails"), s = n.pager.children("ul.wijmo-list"); for (i = 0; i < n.count; i++) n._createPagingItem(a, u, s, i); o = n.pager.find("li").eq(n.currentIdx), o.length && n._activePagerItem(o), u && t.each(["mousedown", "mouseup", "mouseover", "mouseout", "click"], function (e, t) { var n = u[t]; n && typeof n == "string" && window[n] && (u[t] = window[n]) }), n.pager.bind("mouseover." + n.widgetName, function (e) { n._pageingEvents(e, "mouseover", u, a, function (e) { e.addClass(r.wijCSS.stateHover) }) }).bind("mouseout." + n.widgetName, function (e) { n._pageingEvents(e, "mouseout", u, a, function (e) { e.removeClass(r.wijCSS.stateHover) }) }).bind("click." + n.widgetName, function (e) { n._pageingEvents(e, "click", u, a, function (e) { n.scrollTo(e.index()), n._activePagerItem(e) }) }), a || t.each(["mousedown", "mouseup"], function (e, r) { t.isFunction(u[r]) && n.pager.bind(r, function (e) { var n = t(e.target).closest(E); n.length && u[r].call(n, e) }) }) }, n.prototype._pageingEvents = function (e, n, r, i, s) { var o = t(e.target).closest(E); o.length && (t.isFunction(s) && s.call(e, o), !i && t.isFunction(r[n]) && r[n].call(o, e)) }, n.prototype._activePagerItem = function (e) { var t = this.options.wijCSS.stateActive; e.addClass(t).attr("aria-selected", "true").siblings("li").removeClass(t).removeAttr("aria-selected") }, n.prototype._createWijSlider = function () { var e = this, n = e.options.sliderOrientation, r = { orientation: n, range: !1, min: 0, max: e.count - 1, step: 1, value: e.currentIdx, buttonClick: function (t, n) { var r = n.value; e.scrollTo(r) }, slide: function (t, n) { var r = n.value; e.scrollTo(r) } }, i = t("<div></div>").css("margin-bottom", "10px").css(n === "horizontal" ? "width" : "height", "200px").appendTo(e.container); e.pager = i.wijslider(r).parent().wrap("<div>").parent().addClass("wijmo-wijcarousel-slider-wrapper") }, n.prototype._createWijPager = function () { var e = this, n = { pageCount: e.count, pageIndex: e.currentIdx, pageButtonCount: e.count, mode: "numeric", pageIndexChanged: function (t, n) { var r = n.newPageIndex; e.scrollTo(r) } }, r = t("<div></div>").appendTo(e.container); e.pager = r.wijpager(n).css({ position: "absolute" }) }, n.prototype._createPager = function () { var e = this, n = e.options, r = { collision: "none", of: e.container, my: "right top", at: "right bottom" }; if (n.pagerType === "numbers") e._createWijPager(); else if (n.pagerType === "dots" || n.pagerType === "thumbnails") e._createPaging(n.pagerType), e.pager.css({ position: "absolute" }); else { if (!t.wijmo.wijslider || n.pagerType !== "slider") return; e._createWijSlider(), n.sliderOrientation !== "horizontal" && (r.my = "left center", r.at = "right center") } e.pager.width(e.pager.width() + 1), t.extend(r, n.pagerPosition), n.pagerPosition = r, e.pager.addClass("wijmo-wijcarousel-pager").position(r) }, n.prototype._setOption = function (e, n) { var r = this, i = r.options, s, o, u, a = i.orientation === "horizontal"; if (e === "pagerPosition" || e === "animation" || e === "controlPosition") t.extend(!0, i[e], n); else { u = i[e], t.Widget.prototype._setOption.apply(r, arguments); switch (e) { case "showControls": case "showPager": case "showTimer": if (n === u) break; s = e.replace(/show/i, "").toLowerCase(), o = e.replace(/show/i, "_create"), n === !0 ? r[s] ? r[s].jquery && r[s].show() : r[o]() : r[s].hide(); break; case "loop": case "orientation": case "display": case "preview": n !== u && (r._wijdestroy(), r._create()); break; case "data": r._createItems(a), r._applyContainerStyle(a), r._applyBtnClass(), i.showPager && r._createPager(); break; case "showCaption": n ? r._createItems(a) : r.element.find(S).remove(); break; case "buttonPosition": r._applyBtnStyle(a); break; case "pagerType": n !== u && (r.pager && r.pager.jquery && (r.pager.remove(), r.pager = null), r._createPager()); break; case "disabled": r._handleDisabledOption(n, r.element); break; default: } } }, n.prototype._getItemBound = function () { var e = {}, t = this, n = t.options; return n.orientation === "horizontal" ? e = { w: Math.round(t.width / n.display), h: t.height } : e = { w: t.width, h: Math.round(t.height / n.display) }, e }, n.prototype._stopAnimation = function () { var e = this; e.isPlaying && e.progressBar && e.progressBar.stop().css({ width: "0%" }), e.list.stop(!0, !0) }, n.prototype._itemClick = function (e) { var n = t(e.target), r = this, i = r.options, s = r.currentIdx, u = n.closest("li." + o), a = u.data("itemIndex"), f, l; if (u.length > 0) { if (i.preview && a < s || a > s + i.display - 1) f = r._getItemByIndex(s).index(), l = u.index() > f ? "next" : "previous", r[l](); r._trigger("itemClick", e, { index: a, el: u }) } }, n.prototype._wijdestroy = function () { var e = this, n = e.options.wijCSS; e.container.removeClass("wijmo-wijcarousel " + n.widget).removeClass("wijmo-wijcarousel-horizontal").removeClass("wijmo-wijcarousel-vertical"), e.timeout && (e.list.stop(!0), window.clearTimeout(e.timeout), e.timeout = null), e.list.unwrap().removeClass("wijmo-wijcarousel-list").removeClass(n.helperClearFix).unbind("." + e.widgetName).removeAttr("style").children("li").each(function (e, r) { var i = t(r); i.removeClass("wijmo-wijcarousel-item").removeClass(n.helperClearFix).removeClass(a), i.children("img").removeClass("wijmo-wijcarousel-image"), i.children(S).remove(), i.css({ width: "", height: "" }), i.removeData("itemIndex") }), e.itemWidth = e.itemHeight = undefined, e.element.find(y + ",.wijmo-wijcarousel-timerbar").remove(), e.pager && e.pager.remove(), e.element.find("li>span").css("display", ""), e.disabledDiv.length && (e.disabledDiv.remove(), e.disabledDiv = t()) }, n.prototype.destroy = function () { this._wijdestroy(), t.Widget.prototype.destroy.apply(this) }, n.prototype._resetDom = function () { var e = this; e._applyListStyle(), e.list.children("li").each(function (n, r) { var i = t(r), s = i.children("div.wijmo-wijcarousel-caption"), o = i.children("div.wijmo-wijcarousel-text"); e._applyItemBound(i), e._setStyle(s.add(o), function () { e._applyCaptionStyle(s, o) }) }), e._applyContainerStyle(e.isHorizontal, !0), e.options.preview && e._createPreview(), e._setStyle(e.prevBtn.add(e.nextBtn), function () { e._applyBtnStyle(e.isHorizontal) }), e._setStyle(e.pager, function () { e.pager.position(e.options.pagerPosition) }), e._setStyle(e.controls, function () { e.controls.position(e.options.controlPosition) }) }, n.prototype._setStyle = function (e, t) { var n = !0; if (!e || e.length === 0) return; e.css("display") == "none" && (n = !1, e.css("display", "")), t.call(this), n || e.css("display", "none") }, n.prototype.refresh = function () { var e = this, t = e.options, n = e.element; e.width = n.width() || 640, e.height = n.height() || 480, e.itemWidth = e.itemHeight = 0, e._resetDom(), e.pause() }, n.prototype.play = function () { var e = this, t = e.options; if (e.isPlaying || t.disabled) return; if (t.interval === 0) return e.pause(); if (t.showTimer && e.progressBar) e.progressBar.css({ width: "0%" }), e.playPauseBtn.children("span:eq(0)").removeClass(t.wijCSS.iconPlay).addClass(t.wijCSS.iconPause), e.progressBar.animate({ width: "100%" }, t.interval, null, function () { e._scroll("next", t.step) }); else { if (e.timeout) return; e.timeout = window.setTimeout(function () { e.next() }, t.interval) } e.isPlaying = !0 }, n.prototype.pause = function () { var e = this, t = e.options; if (t.showTimer && e.progressBar) e.progressBar.stop().css({ width: "0%" }), e.playPauseBtn.children("span:eq(0)").removeClass(t.wijCSS.iconPause).addClass(t.wijCSS.iconPlay); else { if (e.timeout === null) return; window.clearTimeout(e.timeout), e.timeout = null } e.isPlaying = !1 }, n.prototype.next = function () { var e = this, t = e.options.step; if (typeof t != "number" || t < 1) return; e._stopAnimation(), e._scroll("next", t) }, n.prototype.previous = function () { var e = this, t = e.options.step; if (typeof t != "number" || t < 1) return; e._stopAnimation(), e._scroll("previous", t) }, n.prototype.scrollTo = function (e) { var t = this, n, r; t._stopAnimation(), n = e > t.currentIdx ? "next" : "previous", r = Math.abs(e - t.currentIdx), e !== t.currentIdx && t._scroll(n, r) }, n.prototype._scroll = function (e, n) { var r = this, i = r.options, s = r.list, o = 0, u, f, l = i.orientation === "horizontal", c = {}, h = r.itemBound[l ? "w" : "h"], p = l ? "left" : "top", d = n, v = {}, m = 0, g = r.currentIdx * h; if (!i.loop) { if (e === "next") if (r.currentIdx + i.display + n <= r.count) o = -g - h * d; else { if (!(r.currentIdx + i.display < r.count)) return; d = r.count - r.currentIdx - i.display, o = -g - h * d } else r.currentIdx - n >= 0 ? o = -g + h * d : r.currentIdx > 0 && (d = r.currentIdx, o = 0); o !== undefined && (c[p] = o + r.offset, r._doAnimation(e, c, d)) } else { i.preview && (o = m = -h * x + r.offset); if (e === "next") o += -h * d, c[p] = o; else { for (f = 0; f < n; f++) o -= h, s.children("li:last").prependTo(s); v[p] = o, c[p] = m, s.css(v) } r._doAnimation(e, c, n, p, h) } if (i.preview) { u = t(); for (f = 0; f < i.display; f++) u = u.add(r._getItemByIndex(r.currentIdx + f).find("div.wijmo-wijcarousel-mask:eq(0)")); u.stop(!0).animate({ opacity: .6 }, i.animation.duration / 2, function () { r._getItemByIndex(r.currentIdx).removeClass(a) }) } }, n.prototype._doAnimation = function (e, n, r, i, s) { var o = this, u = o.list, a = o.options, f, l, c = { complete: null }, h, p = {}, d; if (!o.list.children().length) return; e === "next" ? d = o.currentIdx + r : d = o.currentIdx - r, a.loop ? (d = d % o.count + (d < 0 ? o.count : 0), h = function () { var t = 0; a.preview && (t = o.offset - x * s); if (e === "next") { for (l = 0; l < r; l++) u.children("li:first").appendTo(u); i && (p[i] = t, u.css(p)) } o.currentIdx = d, o._setCurrentState(o.currentIdx) }) : h = function () { o.currentIdx = d, o._setCurrentState(o.currentIdx) }, c.complete = h, f = { index: o.currentIdx, to: d, el: o._getItemByIndex(o.currentIdx) }; if (!o._trigger("beforeScroll", null, f)) return; a.animation && a.animation.complete && (a.animation.complete = undefined), t.extend(c, a.animation), o._hideCaption(), u.animate(n, c) }, n.prototype._setCurrentState = function (e) { var n = this, r = n.options, i, s, o, u = e + r.display - 1, f, l, c; r.loop ? n.isPlaying && (window.clearTimeout(n.timeout), n.timeout = null, n.isPlaying = !1, n.play()) : (o = e + r.display < n.count, n.isPlaying && o ? (window.clearTimeout(n.timeout), n.timeout = null, n.isPlaying = !1, n.play()) : n.progressBar && n.pause(), n._applyBtnClass()); if (r.preview) { l = t(), f = n._getItemByIndex(e); for (c = 0; c < r.display; c++) l = l.add(n._getItemByIndex(e + c).find("div.wijmo-wijcarousel-mask:eq(0)")); l.animate({ opacity: 0 }, r.animation.duration / 2, function () { f.addClass(a), n._showCaption(e, u) }) } else n._showCaption(e, u); n.pager && (t.wijmo.wijslider && n.pager.find(":wijmo-wijslider").length ? n.pager.find(":wijmo-wijslider:eq(0)").wijslider("value", e) : t.wijmo.wijpager && n.pager.is(":wijmo-wijpager") ? n.pager.wijpager("option", "pageIndex", e) : n.pager.jquery && (i = n.pager.find(">ul:eq(0)>li").eq(e), i.length && n._activePagerItem(i))), s = { firstIndex: e, lastIndex: u }, n._trigger("afterScroll", null, s) }, n.prototype._getItemByIndex = function (e) { var n = this, r = n.list, i, s = e % n.count; return n.options.loop ? (r.children("li").each(function (e) { var n = t(this); if (n.data("itemIndex") === s) return i = n, !1 }), i) : r.children("li").eq(s) }, n.prototype._collectionChanged = function (e) { var t = this; t.count = t.count + (e === "add" ? 1 : -1), t._applyListStyle(), t.pager && t.pager.jquery && (t.pager.remove(), t.pager = null, t._createPager()), t._applyBtnClass() }, n.prototype.add = function (e, n) { var r = this, i, s; if (typeof e == "string") i = t(e); else if (e.jquery) i = e; else { if (!t.isPlainObject(e)) return; i = r._generateMarkup(e) } i.is("li") || (i = i.wrap("<li></li>").parent()), s = i, typeof n == "number" && n >= 0 && n < r.count ? (s.insertBefore(r._getItemByIndex(n)), r.list.children("li").each(function (e, r) { var i = t(r); i.data("itemIndex") >= n && i.data("itemIndex", i.data("itemIndex") + 1) })) : (n == 0 && s.appendTo(r.list), s.insertAfter(r._getItemByIndex(r.count - 1))), r._createItem(i, n !== undefined ? n : r.count), r._collectionChanged("add") }, n.prototype.remove = function (e) { var n = this, r; typeof e == "number" && e >= 0 && e < n.count ? (r = n._getItemByIndex(e), n.list.children("li").each(function (n, r) { var i = t(r); i.data("itemIndex") > e && i.data("itemIndex", i.data("itemIndex") - 1) })) : r = n._getItemByIndex(n.count - 1), r && r.remove(), n._collectionChanged("remove") }, n }(e.wijmoWidget); e.wijcarousel = T; var N = function () { function e() { this.wijMobileCSS = { header: "ui-header ui-bar-a", content: "ui-body-a", stateDefault: "ui-btn-up-a", stateHover: "ui-btn-down-a", stateActive: "ui-btn-down-b", iconPlay: "ui-icon-arrow-r", iconPause: "ui-icon-grid" }, this.initSelector = ":jqmData(role='wijcarousel')", this.data = [], this.auto = !1, this.interval = 5e3, this.showTimer = !1, this.buttonPosition = "inside", this.showPager = !1, this.prevBtnClass = { defaultClass: "", hoverClass: "", disableClass: "" }, this.nextBtnClass = { defaultClass: "", hoverClass: "", disableClass: "" }, this.pagerType = "numbers", this.thumbnails = { mouseover: null, mouseout: null, mousedown: null, mouseup: null, click: null, imageWidth: 58, imageHeight: 74, images: [] }, this.pagerPosition = {}, this.orientation = "horizontal", this.sliderOrientation = "horizontal", this.loop = !0, this.animation = { queue: !0, disable: !1, duration: 1e3, easing: "linear" }, this.start = 0, this.display = 1, this.preview = !1, this.step = 1, this.showControls = !1, this.control = "", this.controlPosition = {}, this.showCaption = !0, this.showControlsOnHover = !1, this.itemClick = null, this.beforeScroll = null, this.afterScroll = null, this.loadCallback = null } return e }(); T.prototype.options = t.extend(!0, {}, e.wijmoWidget.prototype.options, new N), t.wijmo.registerWidget("wijcarousel", T.prototype) })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; var t = jQuery, n = "wijgallery", r = "wijmo-wijgallery", i = "wijmo-wijgallery-", s = i + "selected", o = i + "button-", u = i + "button", a = "wijmo-wijgallery-thumbs-pointer-{0}", f = "wijmo-wijgallery-flashwrapper", l = '<div class="wijmo-wijgallery-frame"><div class="wijmo-wijgallery-content"></div></div>', c = '<div class="wijmo-wijgallery-thumbs"></div>', h = "<a><span></span></a>", p = '<div class="wijmo-wijgallery-frame-{0}"><a href="#" class="wijmo-wijgallery-frame-link"></a></div>', d = "<div></div>", v = "li.wijmo-wijcarousel-item"; !window.S && window.swfobject && (window.S = { flash: window.swfobject }); var m = function (e) { function n() { e.apply(this, arguments) } return __extends(n, e), n.prototype._setOption = function (e, n) { var r = this, i = r.options, s, o, u, a; if (e === "framePosition" || e === "thumbnailPosition" || e === "transitions" || e === "pagingPosition") t.extend(!0, i[e], n); else { u = i[e], t.Widget.prototype._setOption.apply(r, arguments); switch (e) { case "disabled": r._handleDisabledOption(n, r.element); break; case "thumbnailOrientation": r.thumbs[r.thumbWidgetName]({ orientation: n }); break; case "thumbsDisplay": r.thumbs[r.thumbWidgetName]({ display: n }); break; case "autoPlay": r[n ? "play" : "pause"](); break; case "showCounter": case "showTimer": case "showControls": s = e.replace(/show/i, "").toLowerCase(), o = e.replace(/show/i, "_create"), n !== u && (n === !0 ? r[s] ? r[s].jquery && r[s].show() : r[o]() : r[s].hide()); break; case "showCaption": n ? (r._createCaption(r.size), a = r._loadCaption(r.images[r.currentIdx]), a.show()) : r.element.find(".wijmo-wijgallery-caption,.wijmo-wijgallery-text").remove(); break; case "showPager": case "thumbsLength": case "thumbnailDirection": case "showControlsOnHover": case "mode": case "data": r._wijdestroy(), r._create(); break; default: } } }, n.prototype._handleDisabledOption = function (e, n) { var r = this; r.pager && !r.pager.is(":hidden") && (r.disabledEles = r.disabledEles.add(r.pager)), e ? (r.disabledDiv.length || r._createDisabledDiv(), r.disabledDiv.appendTo("body")) : r.disabledDiv && (r.disabledDiv.remove(), r.disabledDiv = t()) }, n.prototype._createDisabledDiv = function () { var e = this; e.disabledEles.each(function (n, r) { var i = t(r), s = i.offset(), o = i.outerWidth(), u = i.outerHeight(), a = t("<div></div>").css({ "z-index": "99999", position: "absolute", width: o, height: u, left: s.left, top: s.top }); t.browser.msie && parseInt(t.browser.version) < 10 && (a.css("background-color", "white"), t.browser.version === "9.0" && a.css("opacity", "0.1")), e.disabledDiv = e.disabledDiv.add(a) }) }, n.prototype._initLi = function (e) { var n = e.children("a:eq(0)"), r = e.find("img:eq(0)"), i = e.find("span:eq(0)"), s = { url: null, thumbUrl: null, title: r.attr("alt"), caption: undefined }; return n.length && n.attr("href") ? (s.url = n.attr("href"), s.title || (s.title = n.attr("title"))) : r.length && (s.url = r.attr("src")), i.length ? s.caption = i : r.attr("title") && (s.caption = t("<span>").html(r.attr("title"))), s.thumbUrl = r.attr("src"), s }, n.prototype._initStatus = function () { var e = this, n; e.images = [], e.ul = e.element.children("ul"), n = e.ul.children("li"), e._count = n.length, n.each(function (n) { var r = e._initLi(t(this)); e.images.push(r) }) }, n.prototype._createMarkupFromData = function () { var e = this, n = e.options, r = n.data, i = e.element, s = i.children("ul:eq(0)"); e.images = r, s.length ? s.empty() : s = t("<ul>").appendTo(i), e.ul = s, t.each(r, function (e, n) { var r = t("<a>"), i = t("<li>"), o = t("<img>"); n.url && r.attr("href", n.url), n.thumbUrl && o.attr("src", n.thumbUrl), n.title && o.attr("alt"), r.append(o).appendTo(i), i.appendTo(s) }), e._count = r.length }, n.prototype._create = function () { var e = this, n = e.options; e.container = e.element, e.container.addClass([r, n.wijCSS.widget].join(" ")), e.currentThumbIdx = 0, e.currentIdx = -1, e.disabledEles = e.element, e.disabledDiv = t(), e.timerCount = 0, window.wijmoApplyWijTouchUtilEvents && (t = window.wijmoApplyWijTouchUtilEvents(t)), n.showPager ? (n.pagingPosition = !0, n.thumbnails = !1) : n.thumbnails = !0, n.data && n.data.length ? e._createMarkupFromData() : e._initStatus(), n.loadCallback && t.isFunction(n.loadCallback) && e._trigger("loadCallback", null, e), e._createDom(), n.autoPlay && e._play(!0), n.showControlsOnHover && (e.frame.find(".wijmo-wijpager,.wijmo-wijgallery-button-next,.wijmo-wijgallery-counter,.wijmo-wijgallery-button-previous").hide(), !e.isPlaying && e.timer && e.timer.hide()), n.disabled && e.disable(), e.element.is(":hidden") && e.element.wijAddVisibilityObserver && e.element.wijAddVisibilityObserver(function () { e.element.wijRemoveVisibilityObserver && e.element.wijRemoveVisibilityObserver() }, "wijgallery") }, n.prototype._createDom = function () { var e = this, t = e.options; t.thumbnails ? e._createThumbnails() : e.ul.hide(), e._createFrame(), t.control && e._createControls(), t.showCounter && e._createCounter(), t.showTimer && e._createTimer(), t.showPager && e._createPager() }, n.prototype._getFrameSize = function () { var e = this, t = e.options.thumbnailOrientation === "horizontal", n = e.element.height() - (t ? e.thumbs ? e.thumbs.outerHeight(!0) : 0 : 0), r = e.element.width() - (t ? 0 : e.thumbs ? e.thumbs.outerWidth(!0) : 0); return { w: r < 2 || !r ? 750 : r, h: n < 2 || !n ? 300 : n } }, n.prototype._createFrame = function () { var e = this, n = e.options, r, i, s = e._getFrameSize(), o = n.thumbnailDirection === "after"; e.frame = t(l).addClass(n.wijCSS.content + " " + n.wijCSS.helperClearFix)[o ? "prependTo" : "appendTo"](e.container).setOutWidth(s.w - 1).setOutHeight(s.h).wrap('<div class="wijmo-wijgallery-framewrapper">'), e.size = s, r = e.frame.width(), i = e.frame.height(), e.frameWrapper = e.frame.parent(), n.thumbnailOrientation === "vertical" && e.frameWrapper.addClass("wijmo-wijgallery-framewrapper-vertical"), n.showControlsOnHover && e.frame.bind("mouseenter." + e.widgetName, function () { e._showControls("controls") }).bind("mouseleave." + e.widgetName, function () { e._hideControls("controls") }), e.content = e.frame.children("div.wijmo-wijgallery-content"), n.mode === "img" && e._createFrameMask(), e._createPrevNextBtn(), e._createCaption(s), e._createLoading(), e.last = t('<div class="' + n.wijCSS.overlay + ' wijmo-wijgallery-last"></div>').appendTo(e.content).width(r).height(i).css({ "line-height": s.h + "px" }), e.current = t('<div class="' + n.wijCSS.overlay + ' wijmo-wijgallery-current"></div>').appendTo(e.content).width(r).height(i).css({ "line-height": s.h + "px" }), e._show(0) }, n.prototype._createControls = function () { var e = this, n = e.options, r = { collision: "none", of: e.container, my: "center bottom", at: "center bottom" }; n.control && (e.controls = t(n.control).css({ position: "absolute" }).appendTo(e.container), t.extend(r, n.controlPosition), e.controls.position(r)) }, n.prototype._createLoading = function () { var e = this; e.loading = t("<div></div>").addClass("wijmo-wijgallery-loading").appendTo(e.content), e.loading.css({ left: (e.content.width() - e.loading.width()) / 2, top: (e.content.height() - e.loading.height()) / 2 }), e.loading.hide() }, n.prototype._createFrameMask = function () { var e = this, n = e.options; t.each(["previous", "next"], function (r, i) { var s = t(p.replace(/\{0\}/, i)).appendTo(e.frame), o = s.children("a"); t.browser.msie && parseInt(t.browser.version) <= 9 && s.css({ "background-color": "#fff" }), n.showControlsOnHover && s.bind("mouseenter." + e.widgetName, function () { e._showControls(i) }).bind("mouseleave." + e.widgetName, function () { e._hideControls(i) }), o.bind("click." + e.widgetName, function (t) { e[i](), t.preventDefault() }) }) }, n.prototype._createCounter = function () { var e = this, n = e.options; if (!n.showCounter) { e.counter && (e.counter.remove(), e.counter = undefined); return } e.counter || (e.counter = t("<div></div>").addClass("wijmo-wijgallery-counter " + n.wijCSS.stateDefault + " " + n.wijCSS.cornerTL).appendTo(e.frame)), e._refreshCounter() }, n.prototype._refreshCounter = function () { var e = this, n = e.options, r; if (!e.counter) return; e.counter.empty(), n.counter && (r = n.counter.replace(/\[i\]/, e.currentIdx + 1), r = r.replace(/\[n\]/, e._count), t("<span></span>").text(r).appendTo(e.counter)) }, n.prototype._createPrevNextBtn = function () { var e = this, n = e.options.wijCSS; t.each(["next", "previous"], function (r, i) { var s = i === "next" ? n.iconArrowRight : n.iconArrowLeft, u; u = e.frame.find(".wijmo-wijgallery-frame-" + i); if (!u.length || e.options.mode !== "img") u = e.frame; e[i + "Btn"] = t(e._createBtn(o + i, s)).bind("click." + e.widgetName, t.proxy(e[i], e)).appendTo(u), e._applyBtnStyle(i) }) }, n.prototype._applyBtnStyle = function (e) { var t = this, n = t.options, r = e === "next", i = t[e + "Btn"], s = r ? "right center" : "left center", o = s, u = n.wijCSS, a = r ? u.cornerLeft : u.cornerRight, f = e === "next" ? t.currentIdx >= t._count : t.currentIdx <= 0, l = { collision: "none", of: t.frame, my: o, at: s }; i.addClass(a).position(l), f ? i.removeClass(u.stateHover).addClass(u.stateDisabled) : i.hasClass(u.stateDisabled) && i.removeClass(u.stateDisabled) }, n.prototype._createCaption = function (e) { var n = this, r = n.options, i = r.wijCSS; r.showCaption && (n.overlay = t(d).addClass([i.content, i.helperClearFix, "wijmo-wijgallery-caption"].join(" ")).width(e.w).appendTo(n.content), n.caption = t(d).addClass([i.content, i.helperClearFix, "wijmo-wijgallery-text"].join(" ")).width(e.w).appendTo(n.content)) }, n.prototype._loadCaption = function (e) { var n = this, r = e.caption, i, s = t("<span></span>"), o = n.element.find(".wijmo-wijgallery-text,.wijmo-wijgallery-caption"); return r && (o.show(), r.jquery && r.show(), s.html(r), n.caption.empty().append(s), i = s.outerHeight(!0), o.height(i), t.browser.msie && o.height(s.css("display", "block").outerHeight(!0))), o.hide(), o }, n.prototype._showCaption = function (e) { var t = this; e && e.caption && (t.caption.length && t.caption.fadeIn(500), t.overlay.length && t.overlay.show().animate({ opacity: .5 }, 500)) }, n.prototype._createTooltip = function (e) { var n = this, r = n.options.wijCSS, i = e || "bottom"; n.pointer = t("<div>").addClass([r.content, r.stateDefault, a.replace(/\{0\}/, i)].join(" ")), n.pointer.appendTo(n.thumbsWrapper).hide() }, n.prototype._createThumbnails = function () { var e = this, n = e.options, r = n.thumbnailDirection === "after", i = "wijmo-wijgallery-thumbs-{0}", s = n.thumbnailOrientation === "horizontal", o = r ? s ? "bottom" : "right" : s ? "top" : "left"; e.thumbPosition = o, e.thumbs = t(c).appendTo(e.container).addClass(n.wijCSS.content).addClass(s ? "wijmo-wijcarousel-horizontal-multi" : "wijmo-wijcarousel-vertical-multi"), s ? e.thumbs.css({ height: n.thumbsLength + "px" }).setOutWidth(e.element.width()) : e.thumbs.css({ width: n.thumbsLength + "px" }).setOutHeight(e.element.height()), e.ul.appendTo(e.thumbs), e.ul.children("li").each(function (n, r) { var i = t(r).children("a"), s = e.images[n], o = s.thumbUrl; i.length || (i = t(r).wrapInner("<a>").children("a"), i.attr("href", o)) }), t[e.namespace][e.thumbWidgetName] && (e.thumbs.addClass(i.replace(/\{0\}/, o)).find("li").addClass(n.wijCSS.stateDefault).hover(function () { t(this).addClass(n.wijCSS.stateHover) }, function () { t(this).removeClass(n.wijCSS.stateHover) }), e.thumbsWrapper = e.thumbs[e.thumbWidgetName]({ display: n.thumbsDisplay, step: n.thumbsDisplay - 1, itemPadding: "0 10px", showCaption: n.showThumbnailCaptions, orientation: n.thumbnailOrientation, loop: !1, itemClick: function (t, n) { var r = n.index; e.show(r), t.preventDefault() }, afterScroll: function (t, n) { e.currentThumbIdx = n.firstIndex, e.activeLi && e.activeLi.is("li") && e.activeLi.index() >= n.firstIndex && e.activeLi.index() <= n.lastIndex && e._highlightThumb(e.activeLi), e.isScrolling = !1 }, beforeScroll: function (t, r) { e.isScrolling = !0, n.mode === "swf" || n.mode === "flv" ? e.pointer.hide() : e.pointer.fadeOut(100) } }).wrap('<div class="wijmo-wijgallery-thumbswrapper">').parent(), s || e.thumbsWrapper.addClass("wijmo-wijgallery-thumbswrapper-vertical"), e._createTooltip(o)) }, n.prototype._calculatePosition = function (e, t, n, r, i, s) { var o = this; o.thumbPosition === "bottom" ? (e.left = e.left + (r - t) / 2 + s, e.top = e.top - n) : o.thumbPosition === "top" ? (e.left = e.left + (r - t) / 2 + s, e.top = e.top + i + 2 * s) : o.thumbPosition === "left" ? (e.left = e.left + r + 2 * s, e.top = e.top + (i - n) / 2 + s) : o.thumbPosition === "right" && (e.left = e.left - t, e.top = e.top + (i - n) / 2 + s) }, n.prototype._highlightThumb = function (e) { var t = this, n, r, i, o, u, a, f = [s, t.options.wijCSS.stateActive].join(" "); e && e.length && (e.siblings("li." + s).removeClass(f), e.addClass(f), n = t.pointer.outerWidth(!0), r = t.pointer.outerHeight(!0), i = e.width(), o = e.height(), u = e.offset(), a = 5, t._calculatePosition(u, n, r, i, o, a), t.pointer.fadeIn(100), t.pointer.offset(u)) }, n.prototype._getSelector = function (e, t) { var n, r = ".wijmo-wijgallery-button-", i = ".wijmo-wijpager,.wijmo-wijgallery-counter"; return t && (i += ",.wijmo-wijgallery-timerbar"), e === "next" || e === "previous" ? n = r + e : e === "controls" ? n = i : n = i + "," + r + "next," + r + "previous", n }, n.prototype._showControls = function (e) { var n = this, r; r = n._getSelector(e, !n.isPlaying && n.timer), n.frame.find(r).stop(!0, !0).fadeIn(400, function () { t(this).css("opacity", "") }) }, n.prototype._hideControls = function (e) { var t = this, n; n = t._getSelector(e, !t.isPlaying && t.timer), this.frame.find(n).stop(!0, !0).fadeOut(600) }, n.prototype._createPager = function () { var e = this, n = e.options, r, i = n.thumbsDisplay, s = 1, o = e.currentIdx, u = e.currentIdx, a = { collision: "none", of: e.container, my: "right top", at: "right bottom" }; n.thumbnails ? (r = t("<div></div>").appendTo(e.thumbs), i !== 0 && (s = Math.ceil(e._count / i), o = Math.ceil(e.currentIdx / i)), e.pager = r.wijpager({ pageCount: s, pageIndex: o, pageButtonCount: s, mode: "numeric", pageIndexChanged: function (t, n) { var r = n.newPageIndex; (u < r * i || u >= (r + 1) * i) && e.thumbs[e.thumbWidgetName]("scrollTo", r * i), t.preventDefault() } }).css({ position: "absolute" })) : (r = t("<div></div>").appendTo(e.container), e.pager = r.wijpager({ pageCount: e._count, pageIndex: e.currentIdx, pageButtonCount: e._count, mode: "numeric", pageIndexChanged: function (t, n) { var r = n.newPageIndex; e._show(r) } }).css({ position: "absolute" }), t.extend(a, n.pagingPosition), e.pager.addClass("wijmo-wijgallery-pager").position(a)) }, n.prototype._createBtn = function (e, n) { var r = t(h), i = this.options; return r.addClass(i.wijCSS.stateDefault + " " + e).attr("role", "button").bind("mouseover" + this.widgetName, function () { if (t(this).hasClass(i.wijCSS.stateDisabled)) return; t(this).addClass(i.wijCSS.stateHover) }).bind("mouseout" + this.widgetName, function () { if (t(this).hasClass(i.wijCSS.stateDisabled)) return; t(this).removeClass(i.wijCSS.stateHover) }), r.children("span:eq(0)").addClass(i.wijCSS.icon + " " + n), r }, n.prototype._createTimer = function () { var e = this, n = e.options; e._createPausePlay(), e.progressBar = t("<div></div>").addClass("wijmo-wijgallery-timerbar-inner " + n.wijCSS.cornerAll).css({ width: "0%" }).attr("role", "progressbar"), e.timer = t("<div></div>").addClass("wijmo-wijgallery-timerbar " + n.wijCSS.cornerAll).appendTo(e.frame).append(e.progressBar).append(e.playPauseBtn) }, n.prototype._createPausePlay = function () { var e = this, n = e.options; e.playPauseBtn = t(e._createBtn(u, n.autoPlay ? n.wijCSS.iconPause : n.wijCSS.iconPlay)).bind("click." + e.widgetName, function () { if (!t(this).hasClass(n.wijCSS.stateDisabled)) { var r = t(this).children("span:eq(0)"); e[r.hasClass(n.wijCSS.iconPlay) ? "play" : "pause"]() } }) }, n.prototype._show = function (e) { var n = this, r = n.images[e], i, s, o, u = n._getFrameSize(), a = n.options, l = a.mode; if (n.currentIdx === e) return; r && t.isPlainObject(r) && (n.loading.delay(500).fadeIn(100), o = n.last.children("img,div." + f), o.length && o.remove(), l === "swf" || l === "flv" ? (n.last.hide(), n.current.empty(), n._wrapFlash(n.current, l, r.url), n.picture = n.current.children("div." + f), n._setCurrentStates(e), n.loading.stop().hide(), n._thumbsScroll(e)) : l === "img" ? (n.picture && n.picture.length && n.last.append(n.picture.unbind("load")), n.current.hide(), n.last.show(), n.picture = t("<img>").attr({ src: r.url, alt: r.title }).appendTo(n.current).data("itemIndex", e), t.browser.msie && n.picture[0].hasAttribute("complete") ? n._imageLoaded(n, u) : n.picture.bind("load", function () { n._imageLoaded(n, u) })) : l === "iframe" && (n.current.is(":hidden") ? (i = n.current, s = n.last) : (i = n.last, s = n.current), n.picture = t("<iframe></iframe>").addClass("wijmo-wijgallery-iframe").attr({ frameborder: "0", marginwidth: "0", marginheight: "0", scrolling: "auto", allowtransparency: "true", src: r.url }).hide().appendTo(i).data("itemIndex", e).bind("load", function () { var e = t(this), r = e.data("itemIndex"); n.loading.stop().hide(), n.pointer && n.pointer.fadeOut(100), n._setCurrentStates(r), r !== undefined && (a.showCaption, e.show(), s.fadeOut(function () { s.empty() }), i.fadeIn()) }))) }, n.prototype._imageLoaded = function (e, t) { var n = e.picture.attr("role", "img"), r = n.data("itemIndex"), i = n[0].naturalWidth || n.width(), s = n[0].naturalHeight || n.height(), o = e.images[r]; e.loading.stop().hide(), e.pointer && e.pointer.fadeOut(100), i > t.w || s > t.h ? i / s > t.w / t.h ? n.css({ width: "100%" }) : n.css({ height: "100%" }) : i < t.w && s < t.h && n.addClass(e.options.wijCSS.stateDefault).addClass("wijmo-wijgallery-small-image"), r !== undefined && (e.options.showCaption && e.caption && e._loadCaption(o), e._animate(r)) }, n.prototype._animate = function (e) { var n = this, r = n.options, i = r.transitions, s = r.thumbnailOrientation === "horizontal", o, u, a, f, l, c, h = i.animated, p = i.duration; if (!n.last.children().length) { n._setCurrentStates(e), n.last.hide(), n.current.show(); return } l = { index: n.currentIdx, to: e, toImg: n.images[e] }; if (!n._trigger("beforeTransition", null, l)) return; h ? h === "slide" ? (o = n.size.w, u = n.size.h, n.current.show(), c = n.currentIdx > e ? !0 : !1, a = t.createWrapper(n.last).css({ overflow: "hidden", width: s ? o * 2 : o, height: s ? u : u * 2, left: s ? c ? -o : 0 : 0, top: s ? 0 : c ? -u : 0 }), a[c ? "prepend" : "append"](n.current), a.animate({ left: s ? c ? 0 : -o : 0, top: s ? 0 : c ? 0 : -u }, p, function () { n.last.parent().is(".ui-effects-wrapper") && n.last.unwrap(), n.last.hide(), n._setCurrentStates(e) })) : t.mobile ? (f = p / 2, n.last.fadeOut(f, function () { n.current.stop(!0, !0).fadeIn(f, function () { n._setCurrentStates(e) }) })) : h === "explode" || h === "scale" || h === "blind" || h === "fold" ? (n.current.css({ position: "absolute" }), n.current.stop(!0, !0).show(h, p, function () { n.last.hide(), n._setCurrentStates(e) })) : h === "size" ? (n.last.hide(), n.current.stop(!0, !0).show(h, p, function () { n.last.hide(), n._setCurrentStates(e) })) : (f = p / 2, n.last.hide(h, f, function () { n.last.hide(), n.current.stop(!0, !0).show(h, f, function () { n._setCurrentStates(e) }) })) : (n.last.hide(), n.current.show(), n._setCurrentStates(e)), n._thumbsScroll(e) }, n.prototype._thumbsScroll = function (e) { var t, n = this, r = n.options; n.thumbs && n.thumbs[n.thumbWidgetName] && (r.scrollWithSelection ? (t = e - Math.ceil(r.thumbsDisplay / 2) + 1, n.thumbs[n.thumbWidgetName]("scrollTo", t)) : e > r.thumbsDisplay + n.currentThumbIdx - 1 ? n.thumbs[n.thumbWidgetName]("scrollTo", e - r.thumbsDisplay + 1) : e < n.currentThumbIdx && n.thumbs[n.thumbWidgetName]("scrollTo", e)) }, n.prototype._setCurrentStates = function (e) { var t = this, n = t.options, r, i, s; s = t.currentIdx, t.currentIdx = e, r = e + 1 < t._count, t.isPlaying && r ? (t.timeout = null, t.isPlaying = !1, t._play()) : t.progressBar && t.pause(), e + 1 >= t._count ? t.nextBtn.add(t.playPauseBtn).removeClass(n.wijCSS.stateHover).addClass(n.wijCSS.stateDisabled) : t.nextBtn.add(t.playPauseBtn).removeClass(n.wijCSS.stateDisabled), e <= 0 ? t.previousBtn.removeClass(n.wijCSS.stateHover).addClass(n.wijCSS.stateDisabled) : t.previousBtn.removeClass(n.wijCSS.stateDisabled), n.showCaption && t._showCaption(t.images[e]), t.thumbs && t.thumbs[t.thumbWidgetName] ? (t.activeLi = t.thumbs.find(v).eq(e), t.isScrolling || t._highlightThumb(t.activeLi)) : t.pager && t.pager.is(":wijmo-wijpager") && t.pager.wijpager("option", "pageIndex", e), t._refreshCounter(), t._clearCss(), i = { last: s, index: t.currentIdx, toImg: t.images[t.currentIdx] }, t._trigger("afterTransition", null, i) }, n.prototype._clearCss = function () { this.current.css({ position: "", visibility: "" }) }, n.prototype._resetState = function () { var e = this; e._stopAnimation(), e.isPlaying && e.progressBar && (e.progressBar.stop(), e.progressBar.css({ width: "0%" })) }, n.prototype._stopAnimation = function () { var e = this, t; t = e.content.find(".ui-effects-wrapper"), t.length && t.stop(!0, !0), e.current.stop(!0, !0), e.last.stop(!0, !0) }, n.prototype.count = function () { return this._count }, n.prototype._wijdestroy = function () { var e = this, n = e.options.wijCSS; e.frame.unwrap().remove(), e.options.thumbnails ? t[e.namespace][e.thumbWidgetName] && (e.thumbs[e.thumbWidgetName]("destroy"), e.element.find("li").unbind().removeClass(n.stateActive).filter("." + s).removeClass(s), e.thumbs.children("ul").unwrap().unwrap()) : (e.pager && e.pager.length && e.pager.remove(), e.element.find("ul").css({ display: "" })), e.pointer && e.pointer.remove(), e.element.removeClass([r, n.widget, n.content, n.cornerAll].join(" ")), e.disabledDiv && (e.disabledDiv.remove(), e.disabledDiv = null) }, n.prototype.destroy = function () { this._wijdestroy(), t.Widget.prototype.destroy.apply(this) }, n.prototype.show = function (e) { var t = this; t._resetState(), t._show(e) }, n.prototype.next = function () { var e = this, t; e._resetState(), t = e.currentIdx + 1, t < e._count && e._show(t) }, n.prototype.previous = function () { var e = this, t; e._resetState(), t = e.currentIdx - 1, t >= 0 && e._show(t) }, n.prototype.play = function () { this._play() }, n.prototype._play = function (e) { var t = this, n = t.options; if (t.isPlaying || n.disabled) return; if (n.interval === 0) return t.pause(); if (e) { t.isPlaying = !0; return } if (n.showTimer && t.progressBar) t.progressBar.css({ width: "0%" }), t.playPauseBtn.children("span:eq(0)").removeClass(n.wijCSS.iconPlay).addClass(n.wijCSS.iconPause), t.progressBar.animate({ width: "100%" }, n.interval, null, function () { t._show(t.currentIdx + 1) }); else { if (t.timeout) return; t.timeout = window.setTimeout(function () { t.timerCount <= 1 && t.next(), t.timerCount-- }, n.interval), t.timerCount++ } t.isPlaying = !0 }, n.prototype.pause = function () { var e = this, t = e.options; if (t.showTimer && e.progressBar) e.progressBar.stop(), e.progressBar.css({ width: "0%" }), e.playPauseBtn.children("span:eq(0)").removeClass(t.wijCSS.iconPause).addClass(t.wijCSS.iconPlay); else { if (e.timeout === null) return; window.clearTimeout(e.timeout), e.timeout = null } e.isPlaying = !1 }, n.prototype.add = function (e, n) { var r = this, i, s, o; if (typeof e == "string") i = t(e), o = r._initLi(i); else if (e.jquery) i = e, o = r._initLi(i); else { if (!t.isPlainObject(e)) return; o = e } !n || n > r._count ? s = r._count : n < 0 ? s = 0 : s = n, r.images.splice(s, 0, o), r._count++, r.thumbs && r.thumbs[r.thumbWidgetName] && r.thumbs[r.thumbWidgetName]("add", i, n) }, n.prototype.remove = function (e) { var t = this, n; isNaN(e) || e > t._count ? n = t._count : e < 0 ? n = 0 : n = e, t.images.splice(n, 1), t._count--, t.thumbs && t.thumbs[t.thumbWidgetName] && t.thumbs[t.thumbWidgetName]("remove", e); if (t.currentIdx == e) t.current.children("img").remove(), t.last.children("img").remove(), t.picture = null, t.currentIdx = -1, t.show(e); else if (t.currentIdx > e) { var r = t.currentIdx; t.currentIdx = -1, t.show(r) } }, n.prototype._getExt = function (e) { var t, n, r = /[0-9a-z]+$/i, i = e.indexOf("?"); return i > -1 && (e = e.substring(0, i)), n = e.match(r), n && (t = n[0].toLowerCase()), t }, n.prototype._getPlayerName = function (e) { if (e.indexOf("#") === 0 || e.indexOf("#") > 0 && e.indexOf(document.location.href) === 0) return "inline"; var n = ["bmp", "gif", "jpg", "jpeg", "png"], r = ["swf"], i = ["flv", "m4v"], s = ["dv", "mov", "moov", "movie", "mp4", "avi", "mpg", "mpeg"], o = ["asf", "avi", "mpg", "mpeg", "wm", "wmv"], u = this._getExt(e); if (u) { if (t.inArray(u, n) >= 0) return "img"; if (t.inArray(u, r) >= 0) return "swf"; if (t.inArray(u, i) >= 0) return "flv"; if (t.inArray(u, o) >= 0) return "wmp"; if (t.inArray(u, s) >= 0) return "qt" } return "unknown" }, n.prototype._wrapFlash = function (e, n, r) { var i = this, s = i.options, o = r, u, a = "100%", l = "100%", c = s.flashInstall, h = s.flashVersion, p = s.flashVars, d = s.flashParams, v = i._newId(); n === "flv" && (o = s.flvPlayer, p = t.extend({ file: r, width: a, height: l, autostart: s.autoPlayMovies ? "true" : "false", controlbar: s.showMovieControls ? "bottom" : "none", backcolor: "0x000000", frontcolor: "0xCCCCCC", lightcolor: "0x557722" }, s.flashVars), d = t.extend({ autostart: s.autoPlayMovies ? "true" : "false", allowscriptaccess: "always" }, s.flashParams)), u = t("<div/>").addClass(f).appendTo(e), t("<div/>").css({ width: "100%", height: "100%", overflow: "hidden" }).attr("id", v).appendTo(u), S.flash.embedSWF(o, v, a, l, h, c, p, d) }, n.prototype._newId = function () { var e = "a|b|c|d|e|f|g|h|i|j|k|l|m|n|o|p|q|r|s|t|u|v|w|x|y|z", t = [], n = "", r; t = e.split("|"); for (r = 0; r < 16; r++) n += t[Math.round(Math.random() * 25)]; return n }, n }(e.wijmoWidget); e.wijgallery = m, m.prototype.thumbWidgetName = "wijcarousel"; var g = function () { function e() { this.wijMobileCSS = { header: "ui-header ui-bar-a", content: "ui-body-a", stateDefault: "ui-btn-up-a", stateHover: "ui-btn-down-a", stateActive: "ui-btn-down-b", iconPlay: "ui-icon-arrow-r", iconPause: "ui-icon-grid" }, this.initSelector = ":jqmData(role='wijgallery')", this.autoPlay = !1, this.scrollWithSelection = !1, this.showTimer = !0, this.interval = 5e3, this.showCaption = !0, this.showThumbnailCaptions = !1, this.data = [], this.showControls = !1, this.control = "", this.controlPosition = {}, this.showCounter = !0, this.counter = "[i] of [n]", this.showPager = !1, this.pagingPosition = {}, this.thumbnailOrientation = "horizontal", this.thumbnailDirection = "after", this.transitions = { animated: "slide", duration: 1e3, easing: null }, this.showControlsOnHover = !0, this.thumbsDisplay = 5, this.thumbsLength = 100, this.beforeTransition = null, this.afterTransition = null, this.loadCallback = null, this.showMovieControls = !1, this.autoPlayMovies = !0, this.flashParams = { bgcolor: "#000000", allowfullscreen: !0, wmode: "transparent" }, this.flashVars = {}, this.flashVersion = "9.0.115", this.flvPlayer = "player\\player.swf", this.flashInstall = "player\\expressInstall.swf", this.mode = "img" } return e }(); m.prototype.options = t.extend(!0, {}, e.wijmoWidget.prototype.options, new g), t.wijmo.registerWidget("wijgallery", m.prototype) })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { var t = jQuery; (function (e) { e._map = [], e._map[0] = "east", e.east = 0, e._map[1] = "west", e.west = 1, e._map[2] = "south", e.south = 2, e._map[3] = "north", e.north = 3 })(e.Compass || (e.Compass = {})); var n = e.Compass, r = function () { function e() { } return e.mod360 = function (t) { var n = t % 360; return t < 0 && (n += 360), n }, e.getAngle = function (t, n, r) { var i = this, s = i.distance(n, r), o = i.distance(n, t), u = i.distance(r, t), a = s * s, f = o * o, l = u * u, c = Math.acos((l - f - a) / (-2 * o * s)); return Math.round(180 / Math.PI * c) }, e.distance = function (t, n) { return Math.sqrt(Math.pow(n.x - t.x, 2) + Math.pow(n.y - t.y, 2)) }, e.log = function (t, n) { return t <= 0 ? NaN : n === 1 || n < 0 ? NaN : Math.log(t) / Math.log(n) }, e.generateValues = function (t, n, r) { var i = [], s, o; if (n > t && r > 0) { s = parseInt(((n - t) / r + 1).toString(), 10); for (o = 0; o < s; o++) i.push(t + o * r) } else r === 0 && i.push(t); return i }, e.isInRange = function (t, n, r) { return t >= n && t <= r || t <= n && t >= r }, e.paintMarker = function (t, n, r, i, s, o, u) { var a; return n === "rect" ? t.rect(r - s / 2, i - o / 2, s, o) : (u ? n === "tri" ? a = t.isoTri(r, i, s, o) : a = t.paintMarker(n, r, i, o) : a = t.paintMarker(n, r, i, s), a) }, e.formatString = function (n, r) { if (t.isFunction(r)) return r.call(this, n); if (r !== "") { var i = /\{0(?::((?:n|d|p|c)\d?))?\}/gi, s, o; if (i.test(r)) return s = r.match(i), o = "$1", r.replace(/\{0(?::(?:(?:n|d|p|c)\d?))?\}/gi, Globalize.format(n, o)) } return n }, e.getPositionByAngle = function (t, n, r, i) { var s = { x: 0, y: 0 }, o = Raphael.rad(i); return s.x = t - r * Math.cos(o), s.y = n - r * Math.sin(o), s }, e.donut = function (t, n, r, i, s, o, u) { var a = this.getPositionByAngle, f = a(n, r, i, o), l = a(n, r, i, u), c = a(n, r, s, o), h = a(n, r, s, u), p = u - o > 180, d; (u - o) % 360 !== 0 ? (d = ["M", f.x, f.y, "A", i, i, 0, +p, 1, l.x, l.y, "L", h.x, h.y, "A", s, s, 0, +p, 1, c.x, c.y, "L", f.x, f.y, "z"], t.path(d)) : t.circle(n, r, i) }, e }(); e.GaugeUtil = r, Raphael.fn.isoTri = function (e, t, r, i, s) { var o = e, u = t + i / 2, a = e + r, f = t, l = e + r, c = t + i, h; return s == n.north ? (o = e, u = t, a = e - r / 2, f = t + i, l = e + r / 2, c = t + i) : s === n.east ? (o = e - r / 2, u = t - i / 2, a = e - r / 2, f = t + i / 2, l = e + r / 2, c = t) : s === n.west && (o = e - r / 2, u = t, a = e + r / 2, f = t - i / 2, l = e + r / 2, c = t + i / 2), h = ["M", o, u, "L", a, f, "L", l, c, "z"], this.path(h.join(" ")) }; var i = function (e) { function n() { e.apply(this, arguments) } return __extends(n, e), n.prototype._create = function () { var e = this, n = e.options, r; window.wijmoApplyWijTouchUtilEvents && (t = window.wijmoApplyWijTouchUtilEvents(t)), e.element.is(":hidden") && e.element.wijAddVisibilityObserver && e.element.wijAddVisibilityObserver(function () { e.redraw(), e.element.wijRemoveVisibilityObserver && e.element.wijRemoveVisibilityObserver() }, "wijgauge"), isNaN(n.width) && e._setDefaultWidth(), isNaN(n.height) && e._setDefaultHeight(), e._setDefaultWidthHeight(), n.disabled && e.disable(), n.face && n.face.template && typeof n.face.template == "string" && window[n.face.template] && (n.face.template = window[n.face.template]), n.pointer && n.pointer.template && typeof n.pointer.template == "string" && window[n.pointer.template] && (n.pointer.template = window[n.pointer.template]), n.cap && n.cap.template && typeof n.cap.template == "string" && window[n.cap.template] && (n.cap.template = window[n.cap.template]), e.element.addClass(n.wijCSS.widget).toggleClass(n.wijCSS.stateDisabled, n.disabled); try { e.canvas = Raphael(e.element[0], n.width, n.height) } catch (i) { var s = e.element.css("display"); r = t("<div></div>").insertBefore(e.element).append(e.element), e.element.addClass("ui-helper-hidden-accessible").appendTo(t("body")), s === "none" && e.element.css("display", "block"), e.canvas = Raphael(e.element[0], n.width, n.height), e.element.appendTo(r).unwrap().removeClass("ui-helper-hidden-accessible"), s === "none" && e.element.css("display", "none") } e._autoCalculate(), e._draw() }, n.prototype._setDefaultWidth = function () { }, n.prototype._setDefaultHeight = function () { }, n.prototype._setDefaultWidthHeight = function () { var e = this, t = e.element, n = e.options, r = t.get(0).style, i = r.width, s = r.height; i !== "" && (n.width = t.width()), s !== "" && (n.height = t.height()) }, n.prototype._autoCalculate = function () { }, n.prototype._setOption = function (n, r) { var i = this, s = i.options, o = s[n]; if (n === "disabled") i._handleDisabledOption(r, i.element), e.prototype._setOption.call(this, n, r); else if (n === "value") i._trigger("beforeValueChanged", null, { newValue: r, oldValue: o }) && (e.prototype._setOption.call(this, n, r), i._set_value(r, o)), i._trigger("valueChanged", null, { newValue: r, oldValue: o }); else { e.prototype._setOption.call(this, n, r), t.isPlainObject(r) && (s[n] = t.extend({}, o, r)); if (s.radius === "auto") { i._autoCalculate(), i.redraw(); return } i["_set_" + n] && i["_set_" + n](r, o) } }, n.prototype._set_value = function (e, t) { this._setPointer() }, n.prototype._set_max = function () { this._redrawMarksAndLabels(), this._set_ranges(), this._setPointer() }, n.prototype._set_min = function () { this._redrawMarksAndLabels(), this._set_ranges(), this._setPointer() }, n.prototype._set_width = function () { this.redraw() }, n.prototype._set_height = function () { this.redraw() }, n.prototype._set_isInverted = function () { this.redraw() }, n.prototype._set_tickMajor = function () { this._redrawMarksAndLabels() }, n.prototype._set_tickMinor = function () { this._redrawMarksAndLabels() }, n.prototype._set_pointer = function () { var e = this; e.pointer && (e.pointer.wijRemove(), e.pointer = null), e._paintPointer(), e._setPointer() }, n.prototype._set_islogarithmic = function () { var e = this; e._redrawMarksAndLabels(), e._setPointer() }, n.prototype._set_logarithmicBase = function () { var e = this; e._redrawMarksAndLabels(), e._setPointer() }, n.prototype._set_labels = function () { this._redrawMarksAndLabels() }, n.prototype._set_margin = function (e, t) { e !== t && this.redraw() }, n.prototype._set_marginTop = function (e, t) { this._set_margin(e, t) }, n.prototype._set_marginBottom = function (e, t) { this._set_margin(e, t) }, n.prototype._set_marginLeft = function (e, t) { this._set_margin(e, t) }, n.prototype._set_marginRight = function (e, t) { this._set_margin(e, t) }, n.prototype._set_ranges = function () { var e = this; e._removeRanges(), e._paintRanges(), e._resetElementPosition() }, n.prototype._set_face = function () { var e = this; e.face && (e.face.wijRemove(), e.face = null, e._paintFace(), e._resetElementPosition(!0)) }, n.prototype._clearState = function () { var e = this; e.labels = [], e.majorMarks = [], e.minorMarks = [], e.face = null, e.pointer = null }, n.prototype._resetElementPosition = function (e) { var n = this; e && n.ranges && t.each(n.ranges, function (e, t) { t.toFront() }), n.majorMarks && t.each(n.majorMarks, function (e, t) { t.toFront() }), n.minorMarks && t.each(n.minorMarks, function (e, t) { t.toFront() }), n.labels && t.each(n.labels, function (e, t) { t.toFront() }), n.pointer && n.pointer.toFront(), n.cap && n.cap.toFront() }, n.prototype._redrawMarksAndLabels = function () { var e = this; e._removeMarksAndLabels(), e._drawMarksAndLabels() }, n.prototype._removeMarksAndLabels = function () { var e = this; t.each(e.labels, function (t, n) { n.wijRemove(), e.labels[t] = null }), t.each(e.majorMarks, function (t, n) { n.wijRemove(), e.majorMarks[t] = null }), t.each(e.minorMarks, function (t, n) { n.wijRemove(), e.minorMarks[t] = null }) }, n.prototype._drawMarksAndLabels = function () { var e = this; e.labels = [], e.majorMarks = [], e.minorMarks = [], e._paintMarks() }, n.prototype._handleDisabledOption = function (e, t) { var n = this; e ? (n.disabledDiv || (n.disabledDiv = n._createDisabledDiv(t)), n.disabledDiv.appendTo("body")) : n.disabledDiv && (n.disabledDiv.remove(), n.disabledDiv = null) }, n.prototype._createDisabledDiv = function (e) { var n = this, r = n.options, i = e || n.element, s = i.offset(), o = r.width || i.outerWidth(), u = r.height || i.outerHeight(), a; return a = t("<div></div>").css({ "z-index": "99999", position: "absolute", width: o, height: u, left: s.left, top: s.top }), Raphael.vml && a.addClass(r.stateDisabled).css("background-color", "#fff"), a }, n.prototype._triggerPainted = function () { return this._trigger("painted") }, n.prototype._draw = function () { var e = this, n = e.options; e.pointer = null, e._innerBbox = { width: n.width - n.marginLeft - n.marginRight, height: n.height - n.marginTop - n.marginBottom, left: n.marginLeft, top: n.marginTop }, e.face = e._paintFace(), e.ranges && e._removeRanges(), e._paintRanges(), e._drawMarksAndLabels(), e._paintPointer(), e.pointer && (e._setOffPointerValue(), e._setPointer()), t.wijraphael.clearRaphaelCache(), e._triggerPainted() }, n.prototype.redraw = function () { var e = this, t = e.options; e.element.empty(), this._clearState(), e.canvas = Raphael(e.element[0], t.width, t.height), e._draw() }, n.prototype.destroy = function () { var t = this; t._unbindEvents(t.majorMarks), t._unbindEvents(t.minorMarks), t._unbindEvents(t.labels), t.element.removeClass("ui-widget").empty(), t.disabledDiv && (t.disabledDiv.remove(), t.disabledDiv = null), e.prototype.destroy.call(this) }, n.prototype.getCanvas = function () { return this.canvas }, n.prototype._percentage = function () { var e = this, t = e.options, n = t.max, r = t.min, i = t.value; return isNaN(i) ? 0 : n === r ? 1 : (i - r) / (n - r) }, n.prototype._valueToLogical = function (e) { var t = this, n = t.options, i = n.min, s = n.max, o = n.logarithmicBase, u, a; return e < i ? 0 : s < e ? 1 : (u = (e - i) / (s - i), n.islogarithmic ? a = r.log(1 + (o - 1) * u, n.logarithmicBase) : a = u, a) }, n.prototype._logicalToValue = function (e) { var t = this, n = t.options, r = n.max, i = n.min, s; if (e < 0) return i; if (1 <= e) return r; if (!n.islogarithmic) s = e; else { if (n.logarithmicBase <= 1) return n.min; s = (Math.pow(n.logarithmicBase, e) - 1) / (n.logarithmicBase - 1) } return i + (r - i) * s }, n.prototype._bindClickEvents = function (e) { var n = this; t.each(e, function (e, r) { t(r.node).bind("click." + n.widgetName, function (e) { n._trigger("click", e, { ele: r }) }) }) }, n.prototype._unbindEvents = function (e) { var n = this; t.each(e, function (e, r) { t(r.node).unbind("." + n.widgetName) }) }, n.prototype._setOffPointerValue = function () { }, n.prototype._setPointer = function () { }, n.prototype._paintPointer = function () { }, n.prototype._paintFace = function () { }, n.prototype._paintRanges = function () { var e = this, n = e.options, r = n.ranges || []; e.ranges = [], t.each(r, function (t, n) { e._paintRange(n) }) }, n.prototype._paintRange = function (e) { }, n.prototype._removeRanges = function () { var e = this; t.each(e.ranges, function (t, n) { n.wijRemove(), e.ranges[t] = null }) }, n.prototype._paintMarks = function () { var e = this, n = e.options, i = r.generateValues, s = i(n.min, n.max, n.tickMajor.interval), o = i(n.min, n.max, n.tickMinor.interval), u = n.labels, a = u.visible; n.tickMajor.visible && t.each(s, function (t, r) { e.majorMarks.push(e._paintMark(r, n.tickMajor, !0)), a && e.labels.push(e._paintLabel(r, u)) }), n.tickMinor.visible && t.each(o, function (r, i) { var o = !1; t.each(s, function (e, t) { if (i === t) return o = !0, !1 }), o || e.minorMarks.push(e._paintMark(i, n.tickMinor, !1)) }), e._bindClickEvents(e.majorMarks), e._bindClickEvents(e.minorMarks), e._bindClickEvents(e.labels) }, n.prototype._paintMark = function (e, t, n) { }, n.prototype._paintLabel = function (e, t) { }, n }(e.wijmoWidget); e.wijgauge = i; var s = function () { function e() { this.value = 0, this.max = 100, this.min = 0, this.width = 600, this.height = 400, this.tickMajor = { position: "inside", style: { fill: "#1E395B", stroke: "none" }, factor: 2, visible: !0, marker: "rect", offset: 0, interval: 10 }, this.tickMinor = { position: "inside", style: { fill: "#1E395B", stroke: "none" }, factor: 1, visible: !1, marker: "rect", offset: 0, interval: 5 }, this.pointer = { length: 1, style: { fill: "#1E395B", stroke: "#1E395B" }, width: 8, offset: 0, shape: "tri", visible: !0, template: null }, this.islogarithmic = !1, this.logarithmicBase = 10, this.labels = { format: "", style: { fill: "#1E395B", "font-size": 12, "font-weight": "800" }, visible: !0, offset: 0 }, this.animation = { enabled: !0, duration: 2e3, easing: ">" }, this.face = { style: { fill: "270-#FFFFFF-#D9E3F0", stroke: "#7BA0CC", "stroke-width": 4 }, template: null }, this.marginTop = 0, this.marginRight = 0, this.marginBottom = 0, this.marginLeft = 0, this.ranges = [], this.isInverted = !1, this.beforeValueChanged = null, this.valueChanged = null, this.painted = null } return e }(); i.prototype.options = t.extend({}, e.wijmoWidget.prototype.options, new s) })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { var t = function (t) { function n() { t.apply(this, arguments) } return __extends(n, t), n.prototype._setDefaultWidth = function () { var e = this.options; e.width = e.orientation === "horizontal" ? 310 : 70 }, n.prototype._setDefaultHeight = function () { var e = this.options; e.height = e.orientation === "horizontal" ? 70 : 310 }, n.prototype._set_orientation = function () { var e = this; e._setDefaultWidth(), e._setDefaultHeight(), e.markBbox = null, e.redraw() }, n.prototype._set_xAxisLocation = function () { this.redraw() }, n.prototype._set_xAxisLength = function () { this.redraw() }, n.prototype._set_yAxisLocation = function () { this.redraw() }, n.prototype._clearState = function () { t.prototype._clearState.call(this), this.markBbox && (this.markBbox = null) }, n.prototype._create = function () { t.prototype._create.call(this), this.element.addClass(this.options.wijCSS.linearGauge) }, n.prototype._paintLabel = function (t, n) { var r = this, i = r.options, s = n.format, o = n.style, u = n.offset, a = t, f = r.options.tickMajor, l = f.position || "inside", c, h, p, d; return s !== "" && (a = e.GaugeUtil.formatString(t, s)), p = r._getMarkerBbox(), d = r._getLabelBBox(a), c = r._valueToPoint(t, 0), i.orientation === "horizontal" ? (l === "inside" ? c.y = p.y - d.height : c.y = p.y + p.height + d.height / 2, c.y += u) : (l === "inside" ? c.x = p.x - d.width / 2 : c.x = p.x + p.width + d.width / 2, c.x += u), h = r.canvas.text(c.x, c.y, a), h.attr(o), $.wijraphael.addClass($(h.node), i.wijCSS.linearGaugeLabel), h }, n.prototype._getLabelBBox = function (e) { var t = this, n = t.options, r, i; return r = t.canvas.text(0, 0, e), r.attr(n.gaugeLableStyle), i = r.wijGetBBox(), r.remove(), i }, n.prototype._getMarkerBbox = function () { var e = this, t = e.options, n = t.tickMajor, r; return e.markBbox || (r = e._paintMark(0, n), e.markBbox = r.wijGetBBox(), r.remove()), e.markBbox }, n.prototype._paintMark = function (t, n, r) { var i = this, s = i.options, o = n.marker || "rect", u = o === "rect" ? 5 : 2, a = i._valueToPoint(t, 0), f = n.position || "inside", l = n.offset || 0, c = r ? 2 : 1, h, p, d = $.extend({}, n.style); return h = u * n.factor, $.isFunction(o) ? o.call(i, i.canvas, a, s) : (o === "cross" && (d.stroke = d.fill), s.orientation === "horizontal" ? p = e.GaugeUtil.paintMarker(i.canvas, o, a.x, a.y, c, h, !0) : p = e.GaugeUtil.paintMarker(i.canvas, o, a.x, a.y, h, c), p.attr(d), $.wijraphael.addClass($(p.node), s.wijCSS.linearGaugeMarker), i._applyPosition(p, f, l, t), p) }, n.prototype._applyPosition = function (e, t, n, r) { var i = 0, s = 0, o = this, u = o.options.orientation === "horizontal", a = e.wijGetBBox(); switch (t) { case "inside": u ? s -= a.width / 2 + n : i -= a.width / 2 + n; break; case "outside": u ? s += a.width / 2 + n : i += a.width / 2 + n; break; case "center": u ? s -= n : i -= n; break; default: } e.attr("transform", "t" + i + "," + s) }, n.prototype._paintFace = function () { var e = this, t, n = e.options, r = e._innerBbox.width, i = e._innerBbox.height, s = e._innerBbox.left, o = e._innerBbox.top, u = { width: r, height: i, x: s, y: o, canvas: e.canvas }; return n.face && n.face.template && $.isFunction(n.face.template) ? n.face.template.call(e, u) : (t = e.canvas.rect(s, o, r, i, 5), n.face && n.face.style && t.attr(n.face.style), $.wijraphael.addClass($(t.node), n.wijCSS.linearGaugeFace), t) }, n.prototype._paintPointer = function () { var t = this, n = t.options, r = t._valueToPoint(n.min, 0), i = t._innerBbox.width, s = t._innerBbox.height, o = t._innerBbox.left, u = t._innerBbox.top, a = n.pointer, f, l, c, h; if (!a.visible) return; h = n.orientation === "horizontal" ? s : i, c = h * a.offset, l = h * a.length, a.template && $.isFunction(a.template) ? f = a.template.call(t.canvas, r, $.extend({}, n.pointer, { offset: c, length: l, gaugeBBox: t._innerBbox })) : (n.orientation === "horizontal" ? a.shape === "rect" ? f = t.canvas.rect(r.x - a.width / 2, s - l - c + u, a.width, l) : f = t.canvas.isoTri(r.x, s - l - c + u, a.width, l, e.Compass.north) : a.shape === "rect" ? f = t.canvas.rect(i - l - c + o, r.y - a.width / 2, l, a.width) : f = t.canvas.isoTri(i - l - c + o, r.y - a.width / 2, l, a.width), f.attr(a.style)), $.wijraphael.addClass($(f.node), n.wijCSS.linearGaugePointer), t.pointer = f }, n.prototype._setPointer = function () { var e = this, n = e.options; if (!e.pointer) return; t.prototype._setPointer.call(this), e._setLinearPointer(n.value) }, n.prototype._setLinearPointer = function (e) { var t = this, n = t.options, r = t._valueToPoint(n.min, 0), i = t._valueToPoint(e, 0), s = n.animation, o = { x: 0, y: 0 }; n.orientation === "horizontal" ? o.x = i.x - r.x : o.y = i.y - r.y, s.enabled ? t.pointer.stop().wijAnimate({ transform: "t" + o.x + "," + o.y }, s.duration, s.easing) : t.pointer.attr("transform", "t" + o.x + "," + o.y) }, n.prototype._minScreenPoint = function (e) { var t = this, n = t.options, r = t._innerBbox.width, i = t._innerBbox.height, s = t._innerBbox.left, o = t._innerBbox.top, u = n.yAxisLocation + e; return n.orientation === "horizontal" ? { x: r * n.xAxisLocation + s, y: i * u + o } : { x: r * u + s, y: i * (1 - n.xAxisLocation) + o } }, n.prototype._maxScreenPoint = function (e) { var t = this, n = t.options, r = t._innerBbox.width, i = t._innerBbox.height, s = t._innerBbox.left, o = t._innerBbox.top, u = n.yAxisLocation + e, a = n.xAxisLocation + n.xAxisLength; return n.orientation === "horizontal" ? { x: r * a + s, y: i * u + o } : { x: r * u + s, y: i * (1 - a) + o } }, n.prototype._paintRange = function (e) { var t = this, n = t.options, r = isNaN(e.startValue) ? 0 : e.startValue, i = isNaN(e.endValue) ? 0 : e.endValue, s = isNaN(e.startWidth) ? isNaN(e.width) ? 0 : e.width : e.startWidth, o = isNaN(e.endWidth) ? isNaN(e.width) ? 0 : e.width : e.endWidth, u = e.startDistance || 0, a = e.endDistance || 0, f, l; r !== i && (i > r ? (f = Math.max(r, n.min), l = Math.min(n.max, i)) : (f = Math.max(n.min, i), l = Math.min(n.max, r)), t._drawRange(f, l, u, a, s, o, e)) }, n.prototype._drawRange = function (e, t, n, r, i, s, o) { var u = this, a = u.options, f = a.orientation, l = u._innerBbox.width, c = u._innerBbox.height, h = u._innerBbox.left, p = u._innerBbox.top, d = u._valueToPoint(e, 0), v = u._valueToPoint(t, 0), m, g, y, b, w, E; f === "horizontal" ? (w = i * c, E = s * c, n !== 0 && (d.y = n * c + p), r !== 0 && (v.y = r * c + p), m = { x: d.x, y: d.y - w }, g = { x: v.x, y: v.y - E }) : (w = i * l, E = s * l, n !== 0 && (d.x = n * l + h), r !== 0 && (v.x = r * l + h), m = { x: d.x - w, y: d.y }, g = { x: v.x - E, y: v.y }), y = ["M", d.x, d.y, "L", v.x, v.y, "L", g.x, g.y, "L", m.x, m.y, "Z"], b = u.canvas.path(y.concat(" ")), b.attr(o.style), $.wijraphael.addClass($(b.node), a.wijCSS.linearGaugeRange), u.ranges.push(b) }, n.prototype._valueToPoint = function (e, t) { var n = this, r = n.options, i = r.isInverted, s, o, u; return r.max === r.min ? { x: 0, y: 0 } : (s = n._valueToLogical(e), o = n._minScreenPoint(t), u = n._maxScreenPoint(t), i ? { x: o.x * s + u.x * (1 - s), y: o.y * s + u.y * (1 - s) } : { x: o.x * (1 - s) + u.x * s, y: o.y * (1 - s) + u.y * s }) }, n }(e.wijgauge); e.wijlineargauge = t, t.prototype.widgetEventPrefix = "wijlineargauge"; var n = function () { function e() { this.initSelector = ":jqmData(role='wijlineargauge')", this.wijCSS = { linearGauge: "wijmo-wijlineargauge", linearGaugeLabel: "wijmo-wijlineargauge-label", linearGaugeMarker: "wijmo-wijlineargauge-mark", linearGaugeFace: "wijmo-wijlineargauge-face", linearGaugePointer: "wijmo-wijlineargauge-pointer", linearGaugeRange: "wijmo-wijlineargauge-range" }, this.orientation = "horizontal", this.xAxisLocation = .1, this.xAxisLength = .8, this.yAxisLocation = .5, this.width = "auto", this.height = "auto", this.pointer = { length: .5, width: 4, offset: 0, visible: !0, template: null, shape: "tri", style: { fill: "#1E395B", stroke: "#1E395B" } }, this.marginLeft = 5, this.marginTop = 5, this.marginRight = 5, this.marginBottom = 5 } return e }(); t.prototype.options = $.extend(!0, {}, e.wijgauge.prototype.options, new n), $.wijmo.registerWidget("wijlineargauge", t.prototype) })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { var t = 180, n = 9, r = 5, i = function (i) { function s() { i.apply(this, arguments) } return __extends(s, i), s.prototype._create = function () { var e = this; i.prototype._create.call(this), e.element.addClass(this.options.wijCSS.radialGauge) }, s.prototype._set_radius = function () { var e = this; e._redrawMarksAndLabels(), e.pointer.wijRemove(), e._paintPointer(), e._setPointer() }, s.prototype._set_startAngle = function () { var e = this; e._redrawMarksAndLabels(), e._setPointer() }, s.prototype._set_sweepAngle = function (e) { var t = this; e > 360 && (t.options.endAngle = 360), t._redrawMarksAndLabels(), t._setPointer() }, s.prototype._set_width = function () { var e = this; e._autoCalculate(), i.prototype._set_width.call(this) }, s.prototype._set_height = function () { var e = this; e._autoCalculate(), i.prototype._set_height.call(this) }, s.prototype._set_origin = function () { var e = this; e._autoCalculate() }, s.prototype._set_cap = function () { var e = this; e.pointer.wijRemove(), e._paintPointer(), e._setPointer() }, s.prototype._clearState = function () { i.prototype._clearState.call(this), this.markBbox = null }, s.prototype._valueToAngleIncludeOffset = function (n) { return e.GaugeUtil.mod360(this._valueToAngle(n) + t) }, s.prototype._valueToAngle = function (e) { var t = this, n = t._valueToLogical(e); return t._logicalToAngle(n) }, s.prototype._angleToValue = function (e) { var t = this, n = t._angleToLogical(e); return t._logicalToValue(n) }, s.prototype._logicalToAngle = function (e) { var t = this, n = t.options, r = n.startAngle, i = n.sweepAngle, s = n.isInverted; return s ? r * e + (r + i) * (1 - e) : r * (1 - e) + (r + i) * e }, s.prototype._angleToLogical = function (t) { var n = this, r = n.options, i = r.startAngle, s = r.isInverted, o = e.GaugeUtil.mod360(t - i), u = r.sweepAngle, a, f; return u === 0 || o === 0 ? s ? 1 : 0 : (u < 0 && (o = 360 - o, u = -u), a = o - u, a > 0 ? (f = 360 - o, a < f ? 1 : 0) : s ? 1 - o / u : o / u) }, s.prototype._generatePoints = function (e, t, i, s) { var o = this, u = o.options.isInverted, a = parseInt((n + n * (Math.abs(parseInt((t - e).toString(), 10)) / (n * r))).toString(), 10), f = [], l, c, h, p, d; for (d = 0; d < a; d++) l = d / (a - 1), c = i + (s - i) * l, p = e + (t - e) * l, h = o._angleToValue(p), f.push(o._valueToPoint(h, c)); return f }, s.prototype._valueToPoint = function (e, t) { var n = this, r = n._valueToAngleIncludeOffset(e) * Math.PI / 180, i = t; return { x: i * Math.cos(r), y: i * Math.sin(r) } }, s.prototype._pointToValue = function (t) { var n = e.GaugeUtil.mod360(Math.atan2(t.x, -t.y) * 180 / Math.PI); return this._angleToValue(n) }, s.prototype._radiusScreen = function (e) { var t = this, n = t.options; return Math.max(n.radius * e, 0) }, s.prototype._autoCalculate = function () { var t = this, n = t.options, r = n.width, i = n.height, s, o, u, a = e.GaugeUtil.formatString(n.max, n.labels.format), f = 0, l, c = i - n.marginTop - n.marginBottom, h = r - n.marginLeft - n.marginRight; t.centerPoint = { x: n.marginLeft + h * n.origin.x, y: n.marginTop + c * n.origin.y }, t.radius = n.radius, n.radius === "auto" && (t.faceRadius = Math.min(h, c) / 2, l = t._getFaceBorder(), t.faceRadius -= l, s = t._getMarkerbbox(n.tickMajor).width, o = t._getMarkerbbox(n.tickMinor).width, u = t._getLabelBBox(a).width, n.tickMajor.position === "center" ? (f -= s / 2, f -= u) : n.tickMajor.position === "outside" && (f -= s, f -= u), n.tickMinor.position === "center" ? f = Math.min(f, -o / 2) : n.tickMinor.position === "outside" && (f = Math.min(f, -o)), t.radius = t.faceRadius + f, n.tickMajor.position !== "inside" && (t.faceRadius += f)) }, s.prototype._getFaceBorder = function () { var e = this, t = e._paintFace(), n = t.attr("stroke-width") || 1; return t.type === "set" && (n = t[0].attr("stroke-width") || 1), t.wijRemove(), n }, s.prototype._getMaxRangeWidth = function () { var e = this, t = e.options, n = 0; return $.each(t.ranges, function (e, t) { n = Math.max(n, t.width || 0), n = Math.max(n, t.startWidth || 0), n = Math.max(n, t.endWidth || 0) }), n }, s.prototype._getMarkerbbox = function (e) { var t = this, n = t._paintMarkEle(e), r = n.wijGetBBox(); return n.wijRemove(), { width: r.width, height: r.height } }, s.prototype._paintMark = function (e, t, n) { var r = this, i, s = t.position || "inside", o = t.offset || 0; return i = r._paintMarkEle(t), i.attr(t.style), $.wijraphael.addClass($(i.node), r.options.wijCSS.radialGaugeMarker), $(i.node).data("value", e), r._applyAlignment(i, s, o), r._setMarkValue(e, i), i }, s.prototype._applyAlignment = function (e, t, n) { if (!e) return; var r = e.wijGetBBox(), i = r.width / 2, s = 0; switch (t) { case "outside": s -= i + n; break; case "inside": s += i + n } e.transform("t" + s + "," + 0) }, s.prototype._paintMarkEle = function (t) { var n = this, r = n.options, i = { x: n.centerPoint.x - n.radius, y: n.centerPoint.y }, s = t.marker || "circle", o = s === "rect" ? 5 : 2, u = 2, a, f = t.style["stroke-width"] || 0; if (s === "tri" || s === "invertedTri") o = 5, u = 3; return s === "cross" && (t.style.fill = t.style.stroke || t.style.fill), isNaN(i.x) && (i.x = 0), a = o * t.factor, u += f * 2, a += f * 2, $.isFunction(s) ? s.call(n, n.canvas, i, r) : e.GaugeUtil.paintMarker(n.canvas, s, i.x, i.y, a, u) }, s.prototype._setMarkValue = function (e, t) { var n = this, r = n._valueToAngle(e); t.transform(Raphael.format("r{0},{1},{2}...", r, n.centerPoint.x, n.centerPoint.y)) }, s.prototype._paintLabel = function (t, n) { var r = this, i = r._valueToAngle(t), s = n.format, o = n.style, u = n.offset, a = t.toString(), f = r.options.tickMajor, l = f.position || "inside", c, h, p, d, v; s !== "" && (a = e.GaugeUtil.formatString(t, s)), p = r._getMarkerBbox(), v = r._getLabelBBox(a); switch (l) { case "inside": d = p.x + p.width + v.width / 2; break; case "outside": d = p.x - v.width / 2; break; default: d = p.x - v.width / 2 } return d = r.centerPoint.x - d + u, c = e.GaugeUtil.getPositionByAngle(r.centerPoint.x, r.centerPoint.y, d, i), h = r.canvas.text(c.x, c.y, a), h.attr(o), $.wijraphael.addClass($(h.node), r.options.wijCSS.radialGaugeLabel), h }, s.prototype._getLabelBBox = function (e) { var t = this, n = t.options, r, i; return r = t.canvas.text(0, 0, e), r.attr(n.gaugeLableStyle), i = r.wijGetBBox(), r.wijRemove(), i }, s.prototype._getMarkerBbox = function () { var e = this, t = e.options, n = t.tickMajor, r; return e.markBbox || (r = e._paintMarkEle(n), e._applyAlignment(r, n.position, n.offset || 0), e.markBbox = r.wijGetBBox(), r.wijRemove()), e.markBbox }, s.prototype._paintFace = function () { var e = this, t = e.options, n = Math.min(t.width, t.height) / 2, r, i; return e.faceRadius && (n = e.faceRadius), t.face && t.face.template && $.isFunction(t.face.template) ? (i = { canvas: e.canvas, r: n, origin: { x: e.centerPoint.x, y: e.centerPoint.y } }, t.face.template.call(e, i)) : (r = e.canvas.circle(e.centerPoint.x, e.centerPoint.y, n), t.face && t.face.style && r.attr(t.face.style), $.wijraphael.addClass($(r.node), t.wijCSS.radialGaugeFace), r) }, s.prototype._paintPointer = function () { var e = this, t = e.options, n = t.pointer, r = e.radius * n.length, i = { x: e.centerPoint.x - r + n.offset * e.radius, y: e.centerPoint.y - n.width / 2 }, s; if (!n.visible) return; t.cap && t.cap.behindPointer && t.cap.visible && e._paintCap(), n.template && $.isFunction(n.template) ? s = n.template.call(e.canvas, i, $.extend({}, n, { length: r })) : (n.shape === "rect" ? s = e.canvas.rect(i.x - n.width / 2, i.y, r, n.width) : s = e.canvas.isoTri(i.x - n.width / 2, i.y, r, n.width), s.attr(n.style)), e.pointer = s, $.wijraphael.addClass($(s.node), t.wijCSS.radialGaugePointer), (!t.cap || !t.cap.behindPointer) && t.cap.visible && e._paintCap() }, s.prototype._paintCap = function () { var e = this, t = e.options, n = t.cap, r; return n && n.template && $.isFunction(n.template) ? (r = { canvas: e.canvas, origin: { x: e.centerPoint.x, y: e.centerPoint.y } }, e.cap = n.template.call(e, r), e.cap) : (e.cap = e.canvas.circle(e.centerPoint.x, e.centerPoint.y, n.radius), n && n.style && e.cap.attr(n.style), $.wijraphael.addClass($(e.cap.node), t.wijCSS.radialGaugeCap), e.cap) }, s.prototype._paintRange = function (e) { var t = this, n = t.options, r = isNaN(e.startValue) ? 0 : e.startValue, i = isNaN(e.endValue) ? 0 : e.endValue, s = isNaN(e.startWidth) ? isNaN(e.width) ? 0 : e.width : e.startWidth, o = isNaN(e.endWidth) ? isNaN(e.width) ? 0 : e.width : e.endWidth, u = e.startDistance || 1, a = e.endDistance || 1, f, l; r !== i && (i > r ? (f = Math.max(r, n.min), l = Math.min(n.max, i)) : (f = Math.max(n.min, i), l = Math.min(n.max, r)), u *= t.radius, a *= t.radius, t._drawRange(f, l, u, a, s, o, e)) }, s.prototype._drawRange = function (e, t, n, r, i, s, o) { var u = this, a = u._valueToAngle(e), f = u._valueToAngle(t), l = u._generatePoints(a, f, i + n, s + r), c = u._generatePoints(a, f, n, r), h, p, d = ""; $.each(l, function (e, t) { e === 0 ? d += "M" + Math.round(t.x + u.centerPoint.x) + " " + Math.round(t.y + u.centerPoint.y) : d += "L" + (t.x + u.centerPoint.x) + " " + Math.round(t.y + u.centerPoint.y) }); for (h = c.length - 1; h >= 0; h--) d += "L" + Math.round(c[h].x + u.centerPoint.x) + " " + Math.round(c[h].y + u.centerPoint.y); d += "Z", p = u.canvas.path(d), p.attr(o.style), u.ranges.push(p), $.wijraphael.addClass($(p.node), u.options.wijCSS.radialGaugeRange) }, s.prototype._setOffPointerValue = function () { var e = this, t = e._valueToAngle(0); e.pointer.transform(Raphael.format("r{0},{1},{2}", t, e.centerPoint.x, e.centerPoint.y)) }, s.prototype._setPointer = function () { var e = this, t = e.options, n = e._valueToAngle(t.value), r = t.animation; if (!e.pointer) return; i.prototype._setPointer.call(this), r.enabled ? e.pointer.stop().wijAnimate({ transform: "r" + n + "," + e.centerPoint.x + "," + e.centerPoint.y }, r.duration, r.easing) : e.pointer.transform(Raphael.format("r{0},{1},{2}", n, e.centerPoint.x, e.centerPoint.y)) }, s }(e.wijgauge); e.wijradialgauge = i, i.prototype.widgetEventPrefix = "wijradialgauge"; var s = function () { function e() { this.initSelector = ":jqmData(role='wijradialgauge')", this.wijCSS = { radialGauge: "wijmo-wijradialgauge", radialGaugeLabel: "wijmo-wijradialgauge-label", radialGaugeMarker: "wijmo-wijradialgauge-mark", radialGaugeFace: "wijmo-wijradialgauge-face", radialGaugePointer: "wijmo-wijradialgauge-pointer", radialGaugeCap: "wijmo-wijradialgauge-cap", radialGaugeRange: "wijmo-wijradialgauge-range" }, this.radius = "auto", this.startAngle = 0, this.sweepAngle = 180, this.pointer = { length: .8, style: { fill: "#1E395B", stroke: "#1E395B" }, width: 8, offset: .15, shape: "tri", visible: !0, template: null }, this.origin = { x: .5, y: .5 }, this.labels = { format: "", style: { fill: "#1E395B", "font-size": 12, "font-weight": "800" }, offset: 30, visible: !0 }, this.tickMinor = { position: "inside", offset: 30, style: { fill: "#1E395B" }, visible: !0, factor: 1, marker: "rect", interval: 5 }, this.tickMajor = { position: "inside", offset: 27, style: { fill: "#1E395B", stroke: "#1E395B", "stroke-width": 1 }, visible: !0, interval: 10, factor: 2, marker: "rect" }, this.cap = { radius: 15, style: { fill: "#1E395B", stroke: "#1E395B" }, behindPointer: !1, visible: !0, template: null }, this.face = { style: { fill: "r(0.9, 0.60)#FFFFFF-#D9E3F0", stroke: "#7BA0CC", "stroke-width": 4 }, template: null } } return e }(); i.prototype.options = $.extend(!0, {}, e.wijgauge.prototype.options, new s), $.wijmo.registerWidget("wijradialgauge", i.prototype) })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; var t = jQuery, n = "wijlightbox"; !window.S && window.swfobject && (window.S = { flash: window.swfobject }); var r = function (e) { function n() { e.apply(this, arguments) } return __extends(n, e), n.prototype._keyDownHandler = function (e) { var t = this.options, n = this, r = n.getKeyCodeEnum(); if (e.keyCode && e.keyCode === r.ESCAPE) { n._isFullSize() ? n._toggleFullSize() : t.closeOnEscape && n._close(), e.preventDefault(); return } if (t.keyNav && e.keyCode) switch (e.keyCode) { case r.LEFT: case r.DOWN: n.back(), e.preventDefault(); break; case r.RIGHT: case r.UP: n.next(), e.preventDefault(); break; case r.HOME: t.groupItems.length > 0 && n.show(0), e.preventDefault(); break; case r.END: t.groupItems.length > 0 && n.show(t.groupItems.length - 1), e.preventDefault() } }, n.prototype.getKeyCodeEnum = function () { if (t.ui && t.ui.keyCode) return t.ui.keyCode; if (t.mobile && t.mobile.keyCode) return t.mobile.keyCode; throw "keyCode object is not found" }, n.prototype._create = function () { var e = this.options, n = this; window.wijmoApplyWijTouchUtilEvents && (t = window.wijmoApplyWijTouchUtilEvents(t)), e.groupItems || (e.groupItems = []), this._defaults = { transAnimation: { animated: "fade", duration: 400, easing: "linear" }, resizeAnimation: { animated: "sync", duration: 400 }, textShowOption: { duration: 300, easing: "linear" }, textHideOption: { duration: 300, easing: "linear" } }, this._parse(), this.container = t("<div/>").addClass("wijmo-wijlightbox " + e.wijCSS.widget + " wijmo-wijlightbox-controls-" + e.controlsPosition).css("z-index", e.zIndex).attr({ tabIndex: -1, role: "dialog" }).bind("keydown.wijlightbox", t.proxy(n, "_keyDownHandler")).appendTo(document.body).hide(), this.frame = t("<div></div>").addClass(["wijmo-wijlightbox-frame", e.wijCSS.content, e.wijCSS.cornerAll, e.wijCSS.helperClearFix].join(" ")).appendTo(this.container), this.content = t("<div></div>").addClass("wijmo-wijlightbox-content").appendTo(this.frame), e.activeIndex === undefined ? (typeof e.activeIndex != "number" && e.cookie && (e.activeIndex = parseInt(n._cookie(), 10)), e.activeIndex = e.activeIndex || (e.groupItems.length ? 0 : -1)) : e.activeIndex === null && (e.activeIndex = -1), e.activeIndex = e.activeIndex >= 0 && e.groupItems[e.activeIndex] || e.activeIndex < 0 ? e.activeIndex : 0, this._initClickBehavior(), this._createTimerBar(), this._createDialogButtons(), this._createCtrlButtons(), this._createText(), this._createCounter(), this._refreshCounter(), this.toolBox && this.toolBox.find(".wijmo-wijlightbox-toolbox-button").bind({ mouseover: function () { n._addState("hover", t(this)) }, mouseout: function () { n._removeState("hover", t(this)) }, mousedown: function () { n._addState("active", t(this)) }, mouseup: function () { n._removeState("active", t(this)) } }), this._groupMode() && this._createNavButtons(), this._initHoverBehavior(), this.container.width(this.frame.outerWidth()) }, n.prototype.destroy = function () { var e = this.options, n = this; return this._hideWaiting(), this._hideOverlay(), e.cookie && this._cookie(null, e.cookie), this.container.remove(), t.Widget.prototype.destroy.apply(n, arguments), n }, n.prototype._setOption = function (e, n) { t.Widget.prototype._setOption.apply(this, arguments); switch (e) { case "groupItems": this.options.activeIndex >= n.length ? this.show(n.length - 1) : this.options.activeIndex < 0 && n.length ? this.show(0) : this.show(this.options.activeIndex); break; case "activeIndex": this.show(n); break; case "textPosition": this._resetText(); break; case "clickPause": this._initClickBehavior(); break; case "showNavButtons": this._createNavButtons(); break; case "showControlsOnHover": this._initHoverBehavior() } }, n.prototype._initClickBehavior = function () { var e = this.options, n = this; this.content.unbind("click"), e.clickPause ? this._groupMode() && this.content.click(function () { n[n.isPlaying() ? "stop" : "play"]() }) : this._groupMode() && this.content.click(function (r) { if (n.isPlaying()) return !1; var i = t.extend({}, t(this).offset(), { width: t(this).outerWidth(!0), height: t(this).outerHeight(!0) }); r.pageX >= i.left && r.pageX < i.left + i.width / 2 ? n.backBtn.hasClass(e.wijCSS.stateDisabled) || n.back() : n.nextBtn.hasClass(e.wijCSS.stateDisabled) || n.next() }) }, n.prototype._initHoverBehavior = function () { var e = this.options, t = this; this.frame.unbind(".wijlightbox"), e.showControlsOnHover && this.frame.bind({ "mouseenter.wijlightbox": function () { if (t.container.data("moving.wijlightbox")) return !1; t._showAccessories(!0) }, "mouseleave.wijlightbox": function () { if (t.container.data("moving.wijlightbox")) return !1; t._hideAccessories(!0) }, "mousemove.wijlightbox": function () { t.container.data("moving.wijlightbox") === !1 && t.container.data("accessvisible.wijlightbox") === !1 && t.frame.trigger("mouseenter") } }) }, n.prototype._getPlugins = function () { var e = this.container.data("plugins.wijlightbox"), n, r, i; return e || (e = {}, window.navigator.plugins && window.navigator.plugins.length ? (n = [], t.each(window.navigator.plugins, function (e, t) { n.push(t.name) }), n = n.join(","), i = n.indexOf("Flip4Mac") > -1, e = { fla: n.indexOf("Shockwave Flash") > -1, qt: n.indexOf("QuickTime") > -1, wmp: !i && n.indexOf("Windows Media") > -1, f4m: i }) : (r = function (e) { var t; try { t = new ActiveXObject(e) } catch (n) { } return !!t }, e = { fla: r("ShockwaveFlash.ShockwaveFlash"), qt: r("QuickTime.QuickTime"), wmp: r("wmplayer.ocx"), f4m: !1 }), this.container.data("plugins.wijlightbox", e)), e }, n.prototype._sanitizeSelector = function (e) { return e.replace(/:/g, "\\:") }, n.prototype._getFragmentId = function (e) { var n = /^#.+/, r = t(e).attr("href") || "", i = r.split("#")[0], s = t("base")[0]; return i && (i === window.location.toString().split("#")[0] || s && i === s.attributes.href) && (r = e.hash, e.href = r), n.test(r) ? this._sanitizeSelector(r) : "" }, n.prototype._parseLink = function (e) { var n = this, r = this.options, i = t(e), s = { href: undefined, player: undefined, img: undefined, gallery: undefined }, o, u, a, f, l = ["href", "player", "title", "alt", "height", "width", "gallery", "wijvideosrc"]; if (i.length > 0 && i[0].tagName.toLowerCase() === "a") { o = i.attr("rel"), t.each(l, function (e, t) { s[t] = i.attr(t) || "" }); if (!s.href) return; s.player || (s.player = r.player || n._getPlayerName(s.href)), u = i.find("img"), u && u.length === 0 && (u = i), u && u.length >= 1 && (t.each(["title", "alt"], function (e, t) { s[t] = u.attr(t) || s[t] }), s.img = u), o && (a = o.match(/\[(.*?)\]/), a && (s.gallery = a[1] || s.gallery), t.each(o.split(";"), function (e, t) { var n = t.match(/\s*([a-z_]*?)\s*=\s*(.+)\s*/); n && (s[n[1]] = n[2]) })), s.player === "inline" && (s.href = n._getFragmentId(e)), s.gallery ? (f = r.groupItems.length, r.groupItems[f] = s, i.bind({ click: function (e) { return e.stopPropagation(), e.preventDefault(), r.disabled || n._open(u, f), !1 } })) : i.bind({ click: function (e) { return e.stopPropagation(), e.preventDefault(), r.disabled || n._open(u, s), !1 } }) } }, n.prototype._parse = function () { var e = this; this._parseLink(this.element), this.element.find('a[rel^="wijlightbox"], a[rel^="lightbox"]').each(function (t, n) { e._parseLink(n) }) }, n.prototype._showAccessories = function (e) { this.container.data("accessvisible.wijlightbox", !0), this._showNavButtons(e), this._showToolboxButtons(e), this._showCounter(e) }, n.prototype._hideAccessories = function (e) { this.container.data("accessvisible.wijlightbox", !1), this._hideNavButtons(e), this._hideToolboxButtons(e), this._hideCounter(e) }, n.prototype._groupMode = function () { var e = this.options; return e.groupItems && e.groupItems.length > 1 }, n.prototype._resetText = function () { this._removeText(), this._createText() }, n.prototype._createText = function (e) { var n = this, r = n.options, i, s, o, u, a; if (r.textPosition === "none") return; if (this.container.find(".wijmo-wijlightbox-text").length) return; i = r.textPosition.toLowerCase(), s = t("<div></div>").addClass("wijmo-wijlightbox-text wijmo-wijlightbox-text-" + i + " " + r.wijCSS.content + " " + r.wijCSS.helperClearFix), u = t("<h3></h3>").addClass("wijmo-wijlightbox-title wijmo-wijlightbox-title-" + i + " " + r.wijCSS.helperClearFix).appendTo(s), a = t("<p></p>").addClass("wijmo-wijlightbox-detail wijmo-wijlightbox-detail-" + i + " " + r.wijCSS.helperClearFix).appendTo(s); if (r.textPosition === "inside") s.addClass(r.wijCSS.content + " " + r.wijCSS.helperClearFix).width(this.frame.width()).appendTo(this.frame); else if (r.textPosition === "outside") s.addClass([r.wijCSS.content, r.wijCSS.cornerAll, r.wijCSS.helperClearFix].join(" ")).width(this.frame.width()).appendTo(this.container); else if (r.textPosition === "overlay" || r.textPosition === "titleOverlay") o = t("<div></div>").addClass("wijmo-wijlightbox-mask wijmo-wijlightbox-mask-" + i + " " + r.wijCSS.helperClearFix).width(this.frame.width()).appendTo(this.frame), s.width(this.frame.width()).appendTo(this.frame), r.textPosition === "titleOverlay" && s.bind({ mouseenter: function () { o.stop(), s.stop(); var e = u.outerHeight(!0) + a.outerHeight(!0), i = t.extend({}, n._defaults.textShowOption, r.textShowOption, { queue: !1 }); o.animate({ height: e }, i), s.animate({ height: e }, i) }, mouseleave: function () { o.stop(), s.stop(); var e = u.height(), i = t.extend({}, n._defaults.textHideOption, r.textHideOption, { queue: !1 }); o.animate({ height: e }, i), s.animate({ height: e }, i) } }); this._refreshText(e) }, n.prototype._removeText = function () { this.container.find(".wijmo-wijlightbox-text,.wijmo-wijlightbox-mask").remove() }, n.prototype._getActiveItem = function () { var e = this.options; return e.groupItems && e.groupItems.length && e.activeIndex >= 0 && e.activeIndex < e.groupItems.length ? e.groupItems[e.activeIndex] : null }, n.prototype._refreshText = function (e) { var n = this, r = this.options, i, s, o, u, a; if (r.textPosition === "none") return; i = this.container.data("item.wijlightbox") || this._getActiveItem(); if (!i) return; s = this.container.find(".wijmo-wijlightbox-text"), o = this.container.find(".wijmo-wijlightbox-title"), u = this.container.find(".wijmo-wijlightbox-detail"), a = this.container.find(".wijmo-wijlightbox-mask"), a.stop(), s.stop(), o.html(i.title), u.html(i.alt), r.textPosition === "outside" && s.width(this.frame.width()); var f = o.outerHeight(!0), l = u.outerHeight(!0), c = t.extend({}, n._defaults.textShowOption, r.textShowOption, { queue: !1 }); if (r.textPosition === "overlay" || r.textPosition === "titleOverlay") { var h = f + (r.textPosition === "overlay" ? l : 0); s.height(0), a.height(0), s.animate({ height: h }, c), a.animate({ height: h }, c) } else e ? s.height(f + l) : (s.height(0), s.animate({ height: f + l }, c)) }, n.prototype._addState = function (e, t) { t.is(":not(." + this.options.wijCSS.stateDisabled + ")") && t.addClass("ui-state-" + e) }, n.prototype._removeState = function (e, t) { t.removeClass("ui-state-" + e) }, n.prototype._createNavButtons = function () { var e = this, n = this.options; if (!n.showNavButtons || !this._groupMode()) { this._removeNavButtons(); return } this.backBtn || (this.backBtn = t("<a href='#'/>").addClass("wijmo-wijlightbox-button wijmo-wijlightbox-button-prev " + n.wijCSS.stateDefault + " " + (n.controlsPosition === "inside" ? n.wijCSS.cornerRight : n.wijCSS.cornerLeft)).append("<span class='" + n.wijCSS.icon + " " + n.wijCSS.iconArrowLeft + "'></span>").hide().appendTo(this.frame).bind({ click: function () { return t(this).hasClass(n.wijCSS.stateDisabled) || e.back(), !1 }, mouseover: function () { e._addState("hover", t(this)) }, mouseout: function () { e._removeState("hover", t(this)) }, mousedown: function () { e._addState("active", t(this)) }, mouseup: function () { e._removeState("active", t(this)) } })), this.nextBtn || (this.nextBtn = t("<a href='#'/>").addClass("wijmo-wijlightbox-button wijmo-wijlightbox-button-next " + n.wijCSS.stateDefault + " " + (n.controlsPosition === "inside" ? n.wijCSS.cornerLeft : n.wijCSS.cornerRight)).append("<span class='" + n.wijCSS.icon + " " + n.wijCSS.iconArrowRight + "'></span>").hide().appendTo(this.frame).bind({ click: function () { return t(this).hasClass(n.wijCSS.stateDisabled) || e.next(), !1 }, mouseover: function () { e._addState("hover", t(this)) }, mouseout: function () { e._removeState("hover", t(this)) }, mousedown: function () { e._addState("active", t(this)) }, mouseup: function () { e._removeState("active", t(this)) } })) }, n.prototype._removeNavButtons = function () { this.backBtn && (this.backBtn.remove(), this.backBtn = undefined), this.nextBtn && (this.nextBtn.remove(), this.nextBtn = undefined) }, n.prototype._refreshNavButtons = function () { var e = this.options, t; this.backBtn && (t = e.activeIndex === 0 ? "addClass" : "removeClass", this.backBtn[t](e.wijCSS.stateDisabled)), this.nextBtn && (t = e.activeIndex >= e.groupItems.length - 1 ? "addClass" : "removeClass", this.nextBtn[t](e.wijCSS.stateDisabled)) }, n.prototype._showNavButtons = function (e) { if (this.isPlaying()) return; this.container.find(".wijmo-wijlightbox-button").stop(!0, !0).fadeIn(e ? 600 : 0, function () { t(this).css("opacity", "") }) }, n.prototype._hideNavButtons = function (e) { this.container.find(".wijmo-wijlightbox-button").stop(!0, !0).fadeOut(e ? 600 : 0) }, n.prototype._createToolbox = function () { this.toolBox || (this.toolBox = t("<div></div>").addClass("wijmo-wijlightbox-toolbox").appendTo(this.frame)) }, n.prototype._showToolboxButtons = function (e) { this.container.find(".wijmo-wijlightbox-toolbox-button").stop(!0, !0).fadeIn(e ? 600 : 0, function () { t(this).css("opacity", "") }) }, n.prototype._hideToolboxButtons = function (e) { this.container.find(".wijmo-wijlightbox-toolbox-button").stop(!0, !0).fadeOut(e ? 600 : 0) }, n.prototype._createCtrlButtons = function () { var e = this, n = this.options, r = n.wijCSS; if (!n.ctrlButtons || n.ctrlButtons.length === 0 || !this._groupMode()) { this._removeCtrlButtons(); return } this._createToolbox(); var i = n.ctrlButtons.split("|"); i.length === 1 && i[0] === n.ctrlButtons && (i = n.ctrlButtons.split(",")), t.each(i, function (i, s) { s = t.trim(s), s === "play" && !this.playBtn ? e.playBtn = t("<a href='#'/>").addClass(["wijmo-wijlightbox-toolbox-button", " wijmo-wijlightbox-toolbox-button-play ", r.stateDefault, r.cornerAll].join(" ")).append("<span class='" + r.icon + " " + r.iconPlay + "'></span>").hide().click(function () { return e.isPlaying() ? e.stop() : (n.activeIndex >= n.groupItems.length - 1 && e.show(0), e.play()), !1 }) : s === "stop" && !this.stopBtn && (e.stopBtn = t("<a href='#'/>").addClass(["wijmo-wijlightbox-toolbox-button", "wijmo-wijlightbox-toolbox-button-stop", r.stateDefault, r.stateDisabled, r.cornerAll].join(" ")).append("<span class='" + r.icon + " " + r.iconStop + "'></span>").hide().click(function () { return e.isPlaying() && (e.stop(), e.show(0)), !1 })) }), this.stopBtn && this.stopBtn.appendTo(this.toolBox), this.playBtn && this.playBtn.appendTo(this.toolBox) }, n.prototype._removeCtrlButtons = function () { this.playBtn && (this.playBtn.remove(), this.playBtn = undefined), this.stopBtn && (this.stopBtn.remove(), this.stopBtn = undefined) }, n.prototype._refreshCtrlButtons = function () { var e = this.options.wijCSS; if (this.playBtn) { var t = this.playBtn.find("." + e.icon); t && (t.removeClass(e.iconPause + " " + e.iconPlay), t.addClass(this.isPlaying() ? e.iconPause : e.iconPlay)) } this.stopBtn && this.stopBtn[this.isPlaying() ? "removeClass" : "addClass"](e.stateDisabled) }, n.prototype._createDialogButtons = function () { var e = this, n = this.options, r; if (!n.dialogButtons || n.dialogButtons.length === 0) { this._removeDialogButtons(); return } this._createToolbox(), r = n.dialogButtons.split("|"), r.length === 1 && r[0] === n.dialogButtons && (r = n.dialogButtons.split(",")), t.each(r, function (r, i) { i = t.trim(i), i === "close" && !this.closeBtn ? e.closeBtn = t("<a href='#'/>").addClass("wijmo-wijlightbox-toolbox-button wijmo-wijlightbox-toolbox-button-close " + n.wijCSS.stateDefault + " " + n.wijCSS.cornerAll).append("<span class='" + n.wijCSS.icon + " " + n.wijCSS.iconClose + "'></span>").hide().click(function () { return e._close(), !1 }) : i === "fullSize" && !this.fullBtn && (e.fullBtn = t("<a href='#'/>").addClass("wijmo-wijlightbox-toolbox-button wijmo-wijlightbox-toolbox-button-fullsize " + n.wijCSS.stateDefault + " " + n.wijCSS.cornerAll).append("<span class='" + n.wijCSS.icon + " " + n.wijCSS.iconArrow4Diag + "'></span>").hide().click(function () { return e._toggleFullSize(), !1 })) }), this.closeBtn && this.closeBtn.appendTo(this.toolBox), this.fullBtn && this.fullBtn.appendTo(this.toolBox), this.btnSep || (this.btnSep = t("<a href='#'/>").addClass("wijmo-wijlightbox-toolbox-separator").appendTo(this.toolBox)) }, n.prototype._removeDialogButtons = function () { this.closeBtn && (this.closeBtn.remove(), this.closeBtn = undefined), this.fullBtn && (this.fullBtn.remove(), this.fullBtn = undefined) }, n.prototype._refreshDialogButtons = function () { var e = this.options.wijCSS; if (this.fullBtn) { var t = this.fullBtn.find("." + e.icon); t && (t.removeClass(e.iconArrow4Diag + " " + e.iconNewWin), t.addClass(this._isFullSize() ? e.iconNewWin : e.iconArrow4Diag)) } }, n.prototype._createTimerBar = function () { var e = this, n = e.options; if (!n.showTimer || !e._groupMode()) { e._removeTimerBar(); return } e._createToolbox(), e.timerBar || (e.timerBar = t("<div></div>").addClass("wijmo-wijlightbox-timerbar " + n.wijCSS.content + " ui-priority-secondary " + n.wijCSS.cornerAll).appendTo(e.toolBox), e.timerMeter = t("<div></div>").addClass("wijmo-wijlightbox-timermeter ui-progressbar-value " + n.wijCSS.content + " " + n.wijCSS.cornerAll).appendTo(e.toolBox)) }, n.prototype._removeTimerBar = function () { this.timerMeter && (this.timerMeter.remove(), this.timerMeter = undefined), this.timerBar && (this.timerBar.remove(), this.timerBar = undefined) }, n.prototype._createCounter = function () { var e = this, n = e.options; if (!n.showCounter || !e._groupMode()) { e._removeCounter(); return } e.counter || (e.counter = t("<div></div>").addClass("wijmo-wijlightbox-counter " + n.wijCSS.stateDefault + " " + (n.controlsPosition === "inside" ? n.wijCSS.cornerTL : n.wijCSS.cornerAll)).hide().appendTo(e.frame)) }, n.prototype._removeCounter = function () { this.counter && (this.counter.remove(), this.counter = undefined) }, n.prototype._refreshCounter = function (e) { var n = this, r = this.options, i = ""; if (!this.counter || !this._groupMode()) return; this.counter.empty(); if (r.showCounter && r.groupItems.length > 1 && this.counter) { e === undefined && (e = r.activeIndex); var s = r.groupItems.length; if (r.counterType === "sequence") { var o = 0, u = s, a = parseInt(r.counterLimit, 10) || 0; if (a >= 2 && a < s) { var f = Math.floor(a / 2); o = Math.min(u - a, Math.max(o, e - f)), u = Math.min(u, o + a) } while (o !== u) t("<a></a>").addClass("wijmo-wijlightbox-counter-item " + r.wijCSS.content + " " + r.wijCSS.stateDefault + (o === e ? " wijmo-wijlightbox-counter-active " + r.wijCSS.stateActive : "")).text((++o).toString()).appendTo(this.counter); this.counter.find("a").click(function (e, r) { return t(this).hasClass("wijmo-wijlightbox-counter-active") ? !1 : (n.show(parseInt(t(this).text(), 10) - 1), !1) }) } else { var l = r.counterFormat || "[i] of [n]"; i = l.replace("[i]", e + 1), i = i.replace("[n]", s), t("<span></span>").text(i).appendTo(this.counter) } } }, n.prototype._showCounter = function (e) { this.container.find(".wijmo-wijlightbox-counter").stop(!0, !0).fadeIn(e ? 600 : 0, function () { t(this).css("opacity", "") }) }, n.prototype._hideCounter = function (e) { this.container.find(".wijmo-wijlightbox-counter").stop(!0, !0).fadeOut(e ? 600 : 0) }, n.prototype._cookie = function (e, n) { var r = this.cookie || (this.cookie = this.options.cookie.name); return t.cookie.apply(null, [r].concat(t.makeArray(arguments))) }, n.prototype._showOverlay = function () { if (this.container.data("overlay.wijlightbox")) return; this.container.data("overlay.wijlightbox", new t.wijmo.wijlightbox.overlay(this)) }, n.prototype._hideOverlay = function () { var e = this.container.data("overlay.wijlightbox"); if (!e) return; e.close(), this.container.removeData("overlay.wijlightbox") }, n.prototype._hasOverlay = function () { return this.container.hasData("overlay.wijlightbox") }, n.prototype._showWaiting = function () { if (this.container.data("waiting.wijlightbox")) return; this.container.data("waiting.wijlightbox", new t.wijmo.wijlightbox.overlay(this, !0)) }, n.prototype._hideWaiting = function () { var e = this.container.data("waiting.wijlightbox"); if (!e) return; e.close(), this.container.removeData("waiting.wijlightbox") }, n.prototype._hasWaiting = function () { return this.container.hasData("waiting.wijlightbox") }, n.prototype._getUrl = function (e) { var t = this.options, n = typeof e == "string" ? e : e.href, r = t.rootUrl; return r && r.length > 0 && (r.indexOf("//") === -1 && (r = window.location.protocol + "//" + window.location.host + (r.startsWith("/") ? "" : "/") + r), r.substr(r.length - 1, 1) !== "/" && (r += "/"), n = r + (n.substr(0, 1) === "/" ? n.substr(1) : n)), n }, n.prototype._preload = function () { var e = this.options, t; for (t = Math.max(0, e.activeIndex) ; t < Math.min(e.activeIndex + 5, e.groupItems.length) ; t++) e.groupItems[t].image || (e.groupItems[t].image = new Image, e.groupItems[t].image.src = this._getUrl(e.groupItems[t])) }, n.prototype._slideAnimate = function (e, n, r) { var i = ["position", "top", "bottom", "left", "right", "width", "height"], s = t.setMode(n, e.mode || "show"), o = s === "show", u = e.direction || "left", a = u === "up" || u === "down" ? "top" : "left", f = u === "up" || u === "left", l, c = {}; t.save(n, i), n.show(), l = e.distance || n[a === "top" ? "outerHeight" : "outerWidth"](!0), t.createWrapper(n).css({ overflow: "hidden" }), o && n.css(a, f ? isNaN(l) ? parseInt("-" + l) : -l : l), c[a] = (o ? f ? "+=" : "-=" : f ? "-=" : "+=") + l, n.animate(c, { queue: !1, duration: e.duration, easing: e.easing, complete: function () { s === "hide" && n.hide(), t.restore(n, i), t.removeWrapper(n), r() } }) }, n.prototype._slideTo = function (e, n, r, i, s) { var o = this.options, u = this, a = e.getElement(), f, l, c, h, p, d, v, m; a.parent().is(".wijmo-wijlightbox-aniwrapper") ? f = a.parent() : (f = t.createWrapper(a).css({ overflow: "hidden" }), f.removeClass("ui-effects-wrapper"), f.addClass("wijmo-wijlightbox-aniwrapper")), f.parent().is(".wijmo-wijlightbox-aniwrapper") ? l = f.parent() : (l = t.createWrapper(f).css({ overflow: "hidden" }), l.removeClass("ui-effects-wrapper"), l.addClass("wijmo-wijlightbox-aniwrapper")), c = o.slideDirection || "horizontal", h = a.outerWidth(), p = a.outerHeight(), c === "horizontal" ? (a.width(h).css("float", i ? "left" : "right"), f.width(2 * h).css({ left: i ? 0 : -1 * h, position: "absolute" })) : (a.height(p), f.width(h).css({ top: i ? 0 : -1 * p, position: "absolute" }).height(2 * p)), n.appendTo(f), d = n.getElement(), c === "horizontal" ? d.width(h).css("float", i ? "left" : "right") : d.height(p), this.container.data("animating.wijlightbox", !0), v = function () { a = f.children(":last"); while (a.parent().is(".wijmo-wijlightbox-aniwrapper")) a.parent().replaceWith(a); a.css({ "float": "", width: "", height: "" }), o.autoSize && !u._isFullSize() ? u._resize(s) : (t.isFunction(s) && s.apply(u), u._refreshText()) }, m = { mode: "hide", direction: c === "horizontal" ? i ? "left" : "right" : i ? "up" : "down", easing: r.easing, distance: c === "horizontal" ? h : p, duration: r.duration }, t.effects ? f.effect("slide", m, v) : u._slideAnimate(m, f, v) }, n.prototype._moveFrom = function (e, n, r) { var i = this, s = this.options, o; t.isFunction(n) ? (r = n, n = t.extend({}, i._defaults.resizeAnimation, s.resizeAnimation)) : n = t.extend({}, i._defaults.resizeAnimation, s.resizeAnimation, n), i._removeText(); if (n.animated === "none" || n.duration <= 0) { i._createText(), t.isFunction(r) && r.apply(i), this.container.data("moving.wijlightbox", !1); return } o = t.extend({ width: i.frame.width(), height: i.frame.height() }, i.container.offset()), i.frame.width(e.width).height(e.height), i.container.css({ left: e.left, top: e.top, width: i.frame.outerWidth(), position: "absolute", opacity: "" }), i._moveTo(o, n, function () { i.frame.width(o.width), i.container.width(i.frame.outerWidth()), i._createText(), i.container.data("moving.wijlightbox", !1), t.isFunction(r) && r.apply(i) }) }, n.prototype._moveTo = function (e, n, r) { var i = this, s = this.options; t.isFunction(n) ? (r = n, n = t.extend({}, i._defaults.resizeAnimation, s.resizeAnimation)) : n = t.extend({}, i._defaults.resizeAnimation, s.resizeAnimation, n); var o = n.duration / 2, u = n.animated, a = i._isOpen(), f = u === "wh" ? { left: e.left, top: undefined } : { top: e.top }, l = u === "wh" ? { top: e.top, left: undefined } : { left: e.left }, c = u === "wh" ? { width: e.width, height: undefined } : { height: e.height }, h = u === "wh" ? { height: e.height, width: undefined } : { width: e.width }; if (u === "wh" || u === "hw") { a && i.container.animate(f, { duration: o, easing: n.easing, queue: !0 }), i.frame.animate(c, { duration: o, easing: n.easing, complete: function () { a && i.container.animate(l, { duration: o, easing: n.easing, queue: !0 }), i.frame.animate(h, { duration: o, easing: n.easing, complete: function () { i.container.data("moving.wijlightbox", !1), t.isFunction(r) && r.apply(i) } }) } }); return } a && i.container.animate({ left: e.left, top: e.top }, { duration: n.duration, easing: n.easing, queue: !0 }), i.frame.animate({ width: e.width, height: e.height, opacity: 1 }, { duration: n.duration, easing: n.easing, complete: function () { i.container.data("moving.wijlightbox", !1), t.isFunction(r) && r.apply(i) } }) }, n.prototype.show = function (e) { return this._show(e), this }, n.prototype._resize = function (e) { var n = this, r = t.extend({}, n.container.offset(), { width: n.frame.width(), height: n.frame.height() }); n._size(), n._isOpen() && n._position(), n._moveFrom(r, e) }, n.prototype._onAfterShow = function () { var e = this, t = this.options, n; e._refreshNavButtons(), e.container.data("animating.wijlightbox", !1), t.modal || e._hideOverlay(), n = { index: t.activeIndex, item: t.groupItems[t.activeIndex] }, e._trigger("show", null, n), e._startTimer() }, n.prototype._show = function (e, n, r) { var i = this, s = this.options, o, u; if (this.container.data("showing.wijlightbox")) return o = [function () { i._show(e, n, r) }], this.container.queue("showqueue", o), this; u = s.activeIndex; if (!t.isPlainObject(e)) { u = e; if (u < 0 || u >= s.groupItems.length) return this; e = s.groupItems[u] } e && this.container.data("item.wijlightbox", e), this._groupMode() && this._preload(), t.isFunction(n) && (r = n, n = undefined), r || (r = i._onAfterShow); var a = { index: u, item: e }; if (i._trigger("beforeShow", null, a) === !1) return this; this.container.data("showing.wijlightbox", !0); var f = function () { t.isFunction(r) && r.apply(i), i.container.data("showing.wijlightbox", !1), i.container.dequeue("showqueue"), i.container.clearQueue("showqueue") }; i._refreshCounter(u); var l = this.container.data("player.wijlightbox"), c, h = function () { i.container.data("playerwidth.wijlightbox", c.width), i.container.data("playerheight.wijlightbox", c.height); var e = t.extend({}, i._defaults.transAnimation, s.transAnimation); if (s.activeIndex === u || e.animated === "none" || e.duration <= 0 || !i._isOpen()) { s.activeIndex = u, l && l.remove(), c.appendTo(i.content), i._refreshText(), f(); return } s.cookie && i._cookie(s.activeIndex, s.cookie); if (e.animated === "slide") n = n === undefined ? u > s.activeIndex : n, i._slideTo(l, c, e, n, f), s.activeIndex = u; else { s.activeIndex = u; var r = function () { c && (c.appendTo(i.content, !0), c.fadeIn(e.duration, f)) }; t.browser.msie && i.frame.trigger("mouseleave"); var o = function () { l && l.remove(), s.autoSize && !i._isFullSize() ? i._resize(r) : (r(), i._refreshText()) }; l ? l.fadeOut(e.duration * .4, o) : o() } }; return c = this._createPlayer(e, h), this }, n.prototype.next = function () { var e = this.options; if (!this._groupMode()) return !1; var t = e.activeIndex + 1; return e.loop && (t %= e.groupItems.length), t < e.groupItems.length ? (this._show(t, !0), !0) : !1 }, n.prototype.back = function () { var e = this.options; if (!this._groupMode()) return !1; var t = e.activeIndex - 1; return e.loop && (t = t < 0 ? e.groupItems.length - 1 : t), t >= 0 ? (this._show(t, !1), !0) : !1 }, n.prototype.adjustPosition = function () { this._position() }, n.prototype.isPlaying = function () { return !!this.container.data("playing.wijlightbox") }, n.prototype._startTimer = function () { if (!this.isPlaying() || !this._groupMode()) return; var e = this.options, t = this, n; e.showTimer === !0 ? (this.timerMeter || this._createTimerBar(), n = this.timerBar.width(), t.timerMeter.width("0"), t.timerMeter.animate({ width: n }, e.delay, null, function () { t.isPlaying() && !t.next() && t.stop() })) : window.setTimeout(function () { t.isPlaying() && !t.next() && t.stop() }, e.delay) }, n.prototype.play = function () { if (!this._groupMode()) return !1; this.container.data("playing.wijlightbox") || this.container.data("playing.wijlightbox", !0), this._refreshCtrlButtons(), this._hideNavButtons(), this._startTimer() }, n.prototype.stop = function () { this.container.removeData("playing.wijlightbox"), this._refreshCtrlButtons(), this._removeTimerBar() }, n.prototype._size = function (e, n) { var r = this.options, i = r.width, s = r.height, o = r.autoSize ? this.container.data("playerwidth.wijlightbox") || i : i, u = r.autoSize ? this.container.data("playerheight.wijlightbox") || s : s, a, f = u / o; if (typeof e == "boolean") n = e; else if (t.isPlainObject(e) && "width" in e && "height" in e) i = e.width, s = e.height; else { a = this.container.data("player.wijlightbox"), r.autoSize && a && a.name === "img" && (o > i && (o = i, u = Math.round(i * f)), u > s && (u = s, o = Math.round(s / f))), i = o, s = u; if (n) return { width: i, height: s } } this.frame.width(i).height(s), this.container.width(this.frame.outerWidth(!0)) }, n.prototype._position = function () { var e = this.options, n = [], r = [0, 0], i, s = e.position; if (s) { if (typeof s == "string" || typeof s == "object" && "0" in s) n = s.split ? s.split(" ") : [s[0], s[1]], n.length === 1 && (n[1] = n[0]), t.each(["left", "top"], function (e, t) { +n[e] === n[e] && (r[e] = n[e], n[e] = t) }), s = { my: n.join(" "), at: n.join(" "), offset: r.join(" ") }; s = t.extend({}, e.position, s) } i = this.container.is(":visible"), i || this.container.show(), this.container.css({ top: 0, left: 0 }).position(s), i || this.container.hide() }, n.prototype._getRelRect = function (e) { var n; return e && (t.isPlainObject(e) && "left" in e && "top" in e && "width" in e && "height" in e ? n = t.merge({}, e) : e = t(e), e.jquery && e.length && (n = t.extend({}, e.offset(), { width: e.width(), height: e.height() }))), n }, n.prototype._close = function (e) { var n = this.options, r = this, i, s, o; if (!this._isOpen()) return; s = { rel: e }; if (!1 === this._trigger("beforeClose", null, s)) return; e = s.rel, !e && this._groupMode() && (e = n.groupItems[n.activeIndex].img), this.container.data("moving.wijlightbox", !0), this._hideAccessories(!1), this._hideWaiting(), this._hideOverlay(), this.stop(), o = function () { r._removePlayer(), r.container.hide(), r._trigger("close"), r.container.unbind("keypress.wijlightbox"), r.container.removeData("open.wijlightbox").removeData("rect.wijlightbox").removeData("moving.wijlightbox").removeData("fullsize.wijlightbox"), t(document).unbind("keydown.wijlightbox").unbind("click.wijlightbox") }, i = this._getRelRect(e), i || this.container.data("rect.wijlightbox") && (i = this.container.data("rect.wijlightbox")), this._removeText(); if (i) { this._moveTo(i, { animated: "sync", duration: 200 }, o); return } return o.call(), this }, n.prototype._isOpen = function () { return !!this.container.data("open.wijlightbox") }, n.prototype._open = function (e, n) { if (this._isOpen()) return; var r = this.options, i = this; this.toolBox && (this._isFullSize() ? this.toolBox.css({ top: "2px", right: "4px" }) : this.toolBox.css({ top: "", right: "" })); var s = function () { r.modal && i._showOverlay(), r.showControlsOnHover ? this._hideAccessories(!1) : this._showAccessories(!1); var n = i._getRelRect(e); i.container.css("opacity", 0), i.container.show(), i._size(), i._createText(!0), i._refreshText(!0), i._position(), i.container.data("open.wijlightbox", !0); if (e && n) i.container.data("rect.wijlightbox", n), i._moveFrom(n, { animated: "sync" }); else { var s = t.extend({}, i._defaults.transAnimation, r.transAnimation); s.animated === "fade" ? (i.container.hide(), i.container.fadeIn(s.duration, function () { i._createText() })) : i._createText(), this.container.data("moving.wijlightbox", !1) } t(document).bind("keydown.wijlightbox", t.proxy(i, "_keyDownHandler")).bind("click.wijlightbox", function (e) { var n = e.target || e.srcElement; i._isOpen() && !!r.closeOnOuterClick && n !== i.container.get(0) && t(n).parents().index(i.container) < 0 && i._close() }), r.autoPlay && this.play(), i._refreshNavButtons(), i._refreshDialogButtons(); var u = { index: r.activeIndex, item: r.groupItems[r.activeIndex] }; i._trigger("show", null, u), i._trigger("open") }; return this.container.data("moving.wijlightbox", !0), this._show(n, !0, s), this }, n.prototype._getWinRect = function () { var e = t(window); return t.extend({ width: e.width(), height: e.height() }, e.offset() || { left: 2, top: 2 }) }, n.prototype._resizeHandler = function () { var e = this; e._removeText(), e._size(e._getWinRect()), e._createText() }, n.prototype._isFullSize = function () { return !!this.container.data("fullsize.wijlightbox") }, n.prototype._toggleFullSize = function () { var e = this, n = t(window); if (!e._isOpen()) return; if (this._isFullSize()) e.toolBox && e.toolBox.css({ top: "", right: "" }), this.container.data("fullsize.wijlightbox", !1), n.unbind("resize.wijlightbox", t.proxy(this, "_resizeHandler")), e._resize(function () { e._adjustPlayerSize(e.content.innerWidth(), e.content.innerHeight()) }); else { this.container.data("fullsize.wijlightbox", !0), n.bind("resize.wijlightbox", t.proxy(this, "_resizeHandler")); var r = e._getWinRect(), i = this.frame.borderSize(); r.width -= i.width, r.height -= i.height, e._removeText(), e._moveTo(r, { animated: "sync" }, function () { e.toolBox && e.toolBox.css({ top: "2px", right: "4px" }), e.frame.width(r.width), e.container.width(e.frame.outerWidth()), e._createText(), e._adjustPlayerSize(e.content.innerWidth(), e.content.innerHeight()) }) } this._refreshDialogButtons() }, n.prototype._getExt = function (e) { var t, n, r = /[0-9a-z]+$/i, i = e.indexOf("?"); return i > -1 && (e = e.substring(0, i)), n = e.match(r), n && (t = n[0].toLowerCase()), t }, n.prototype._getPlayerName = function (e) { if (e.indexOf("#") === 0 || e.indexOf("#") > 0 && e.indexOf(document.location.href) === 0) return "inline"; var n = ["bmp", "gif", "jpg", "jpeg", "png"], r = ["swf"], i = ["flv", "m4v"], s = ["dv", "mov", "moov", "movie", "mp4", "avi", "mpg", "mpeg"], o = ["asf", "avi", "mpg", "mpeg", "wm", "wmv"], u = ["mp4", "mpg", "mpeg", "ogg", "ogv"], a = this._getExt(e); if (a) { if (t.inArray(a, n) >= 0) return "img"; if (t.inArray(a, r) >= 0) return "swf"; if (t.inArray(a, i) >= 0) return "flv"; if (t.inArray(a, o) >= 0) return "wmp"; if (t.inArray(a, s) >= 0) return "qt"; if (t.inArray(a, u) >= 0) return "wijvideo" } return "iframe" }, n.prototype._adjustPlayerSize = function (e, t) { var n = this.container.data("player.wijlightbox"); n && n.adjustSize && n.adjustSize(e, t) }, n.prototype._removePlayer = function () { var e = this.container.data("player.wijlightbox"); e && (e.remove(), this.container.data("player.wijlightbox", null)) }, n.prototype._createPlayer = function (e, n, r) { var i = e.player; if (!t.isFunction(t.wijmo.wijlightbox[i])) throw "unknown player " + i; var s = this, o = !1, u, a = function () { o = !0, this._hideWaiting(), t.isFunction(n) && window.setTimeout(function () { n.apply(s) }, 1) }, f = function () { this._hideWaiting(), t.isFunction(r) && r.apply(s) }; return u = new t.wijmo.wijlightbox[i](this, e, a, f), this.container.data("player.wijlightbox", u), window.setTimeout(function () { o === !1 && s._showWaiting() }, 200), u }, n }(e.wijmoWidget); e.wijlightbox = r; var i = function () { function e() { this.wijMobileCSS = { header: "ui-header ui-bar-a", content: "ui-body-c", stateDefault: "ui-btn-up-a", stateHover: "ui-btn-down-a", stateActive: "ui-btn-down-a", iconPlay: "ui-icon-arrow-r", iconPause: "ui-icon-grid" }, this.initSelector = ":jqmData(role='wijlightbox')", this.textPosition = "overlay", this.width = 600, this.height = 400, this.autoSize = !0, this.player = "", this.groupItems = [], this.rootUrl = "", this.ctrlButtons = "", this.dialogButtons = "close", this.counterType = "default", this.counterFormat = "[i] of [n]", this.counterLimit = 10, this.showCounter = !0, this.showNavButtons = !0, this.showTimer = !1, this.controlsPosition = "inside", this.showControlsOnHover = !0, this.clickPause = !1, this.keyNav = !1, this.modal = !1, this.position = { my: "center", at: "center", of: window, collision: "fit", using: function (e) { var n = t(this).css(e).offset().top; n < 0 && t(this).css("top", e.top - n) } }, this.zIndex = 1e3, this.closeOnEscape = !0, this.closeOnOuterClick = !0, this.autoPlay = !1, this.delay = 2e3, this.loop = !0, this.cookie = null, this.transAnimation = { animated: "fade", duration: 400, easing: "linear" }, this.slideDirection = "horizontal", this.resizeAnimation = { animated: "sync", duration: 400 }, this.textShowOption = { duration: 300, easing: "linear" }, this.textHideOption = { duration: 300, easing: "linear" }, this.showMovieControls = !0, this.autoPlayMovies = !0, this.flashParams = { bgcolor: "#000000", allowfullscreen: !0 }, this.flashVars = {}, this.flashVersion = "9.0.115", this.flvPlayer = "player\\player.swf", this.flashInstall = "player\\expressInstall.swf", this.beforeShow = null, this.show = null, this.open = null, this.beforeClose = null, this.close = null } return e }(); r.prototype.options = t.extend(!0, {}, e.wijmoWidget.prototype.options, new i), t.wijmo.registerWidget("wijlightbox", r.prototype), t.extend(t.wijmo.wijlightbox, { img: function (e, n, r, i) { this.name = "img", this.lightbox = e, this.item = n, this.url = this.lightbox._getUrl(n); var s = this; t("<img></img>").css({ width: "auto", height: "auto", display: "none" }).appendTo(document.body).bind({ load: function () { var i = t(this); s.width = n.width ? parseInt(n.width, 10) : i.width(), s.height = n.height ? parseInt(n.height, 10) : i.height(), i.remove(), r && t.isFunction(r) && r.apply(e) }, error: function () { t(this).remove(), i && t.isFunction(i) && i.apply(e) } }).attr("src", this.url) }, swf: function (e, n, r, i) { this.name = "swf"; var s = e.options; this.id = "flashhost", this.lightbox = e, this.item = n, this.url = this.lightbox._getUrl(n), this.width = n.width ? parseInt(n.width, 10) : s.width, this.height = n.height ? parseInt(n.height, 10) : s.height, r && t.isFunction(r) && r.apply(e) }, iframe: function (e, n, r, i) { this.name = "swf", this.lightbox = e, this.item = n, this.url = this.lightbox._getUrl(n), n.width && (this.width = parseInt(n.width, 10)), n.height && (this.height = parseInt(n.height, 10)), this.$iframe = t("<iframe></iframe>").addClass("wijmo-wijlightbox-iframe").attr({ frameborder: "0", marginwidth: "0", marginheight: "0", scrolling: "auto", allowtransparency: "true" }).hide().appendTo(e.content).bind("load", function () { r && t.isFunction(r) && r.apply(e) }).attr("src", this.url) }, inline: function (e, n, r, i) { this.name = "inline"; var s = e.options, o = s.wijCSS, u = "wijmo-wijlightbox-frame " + o.content; " " + o.cornerAll + " " + o.helperClearFix, this.lightbox = e, this.item = n, this.width = n.width ? parseInt(n.width, 10) : s.width; if (n.height) this.height = parseInt(n.height, 10); else { var a = t(this.item.href).clone().show().append('<br clear="all" />').wrap('<div class="wijmo-wijlightbox ' + o.widget + '">' + '<div class="' + u + '">' + '<div class="' + u + '">' + '<div class="wijmo-wijlightbox-content"> ' + "</div></div></div></div>").appendTo(document.body).width(this.width); this.height = a.outerHeight(!0) + 10, a.unwrap(), a.remove() } r && t.isFunction(r) && r.apply(e) }, flv: function (e, n, r, i) { this.name = "flv"; var s = e.options; this.id = "flvhost", this.lightbox = e, this.item = n, this.url = this.lightbox._getUrl(n); var o = 20; this.width = n.width ? parseInt(n.width, 10) : s.width, this.height = n.height ? parseInt(n.height, 10) : s.height, s.showMovieControls && (this.height += o), r && t.isFunction(r) && r.apply(e) }, wmp: function (e, n, r, i) { var s = e.options, o; this.name = "wmp", this.id = "wmphost", this.lightbox = e, this.item = n, this.url = this.lightbox._getUrl(n), o = t.browser.msie ? 70 : 45, this.width = n.width ? parseInt(n.width, 10) : s.width, this.height = n.height ? parseInt(n.height, 10) : s.height, s.showMovieControls && (this.height += o), r && t.isFunction(r) && r.apply(e) }, qt: function (e, n, r, i) { var s = e.options, o = 16; this.name = "qt", this.id = "qthost", this.lightbox = e, this.item = n, this.url = this.lightbox._getUrl(n), this.width = n.width ? parseInt(n.width, 10) : s.width, this.height = n.height ? parseInt(n.height, 10) : s.height, s.showMovieControls && (this.height += o), r && t.isFunction(r) && r.apply(e) }, wijvideo: function (e, n, r, i) { var s = e.options; this.name = "wijvideo", this.id = "wijvideohost", this.lightbox = e, this.item = n, this.url = this.lightbox._getUrl(n), this.wijvideosrc = !n.wijvideosrc || n.wijvideosrc === "" ? null : this.lightbox._getUrl(n.wijvideosrc), this.width = n.width ? parseInt(n.width, 10) : s.width, this.height = n.height ? parseInt(n.height, 10) : s.height, r && t.isFunction(r) && r.apply(e) } }), t.extend(t.wijmo.wijlightbox.img.prototype, { appendTo: function (e, n) { this.$element = t("<img></img>").addClass("wijmo-wijlightbox-image").attr("src", this.url), n && this.$element.hide(), this.lightbox.options.transAnimation && this.lightbox.options.transAnimation.animated == "fade" ? (e.children().length && e.empty(), this.$element.prependTo(e)) : this.$element.appendTo(e) }, remove: function () { this.$element && this.$element.remove() }, fadeOut: function (e, t) { this.$element && this.$element.fadeOut(e, t) }, fadeIn: function (e, t) { this.$element && this.$element.fadeIn(e, t) }, getElement: function () { return this.$element } }), t.extend(t.wijmo.wijlightbox.swf.prototype, { appendTo: function (e) { this.$container = t("<div/>").css({ width: "100%", height: "100%", overflow: "hidden" }).attr("id", this.id).appendTo(e); var n = this.lightbox.options, r = n.flashInstall, i = n.flashVersion, s = n.flashVars, o = n.flashParams; S.flash.embedSWF(this.item.href, this.id, "100%", "100%", i, r, s, o) }, remove: function () { S.flash.expressInstallCallback(), S.flash.removeSWF(this.id), this.$container.remove() }, fadeOut: function (e, t) { this.$container && this.$container.fadeOut(e, t) }, fadeIn: function (e, t) { this.$container && this.$container.fadeIn(e, t) }, getElement: function () { return this.$container } }), t.extend(t.wijmo.wijlightbox.iframe.prototype, { appendTo: function (e, t) { t || this.$iframe.show() }, remove: function () { this.$iframe && this.$iframe.remove() }, fadeOut: function (e, t) { this.$iframe && this.$iframe.fadeOut(e, t) }, fadeIn: function (e, t) { this.$iframe && this.$iframe.fadeIn(e, t) }, getElement: function () { return this.$iframe } }), t.extend(t.wijmo.wijlightbox.inline.prototype, { appendTo: function (e, n) { this.$element = t(this.item.href).clone().appendTo(e), n || this.$element.show() }, remove: function () { this.$element && this.$element.remove() }, fadeOut: function (e, t) { this.$element && this.$element.fadeOut(e, t) }, fadeIn: function (e, t) { this.$element && this.$element.fadeIn(e, t) }, getElement: function () { return this.$element } }), t.extend(t.wijmo.wijlightbox.flv.prototype, { appendTo: function (e) { this.$container = t("<div/>").css({ width: "100%", height: "100%", overflow: "hidden" }).attr("id", this.id).appendTo(e); var n = this.lightbox.options, r = "100%", i = "100%", s = n.flvPlayer, o = n.flashInstall, u = n.flashVersion, a = t.extend({ file: this.url, width: r, height: i, autostart: n.autoPlayMovies ? "true" : "false", controlbar: n.showMovieControls ? "bottom" : "none", backcolor: "0x000000", frontcolor: "0xCCCCCC", lightcolor: "0x557722" }, n.flashVars), f = t.extend({ autostart: n.autoPlayMovies ? "true" : "false", allowscriptaccess: "always" }, n.flashParams); S.flash.embedSWF(s, this.id, r, i, u, o, a, f) }, remove: function () { S.flash.expressInstallCallback(), S.flash.removeSWF(this.id), this.$container.remove() }, fadeOut: function (e, t) { this.$container && this.$container.fadeOut(e, t) }, fadeIn: function (e, t) { this.$container && this.$container.fadeIn(e, t) }, getElement: function () { return this.$container } }), t.extend(t.wijmo.wijlightbox.wmp.prototype, { appendTo: function (e) { this.$container = t("<div/>").css({ width: "100%", height: "100%", overflow: "hidden" }).appendTo(e); var n = this.lightbox.options, r = '<object id="' + this.id + '" name="' + this.id + '" height="' + this.height + '" width="' + this.width + '"', i = { autostart: n.autoPlayMovies ? 1 : 0, url: undefined, uimode: undefined, showcontrols: undefined }, s; t.browser.msie ? (r += ' classid="clsid:6BF52A52-394A-11d3-B153-00C04F79FAA6"', i.url = this.url, i.uimode = n.showMovieControls ? "full" : "none") : (r += ' type="video/x-ms-wmv"', r += ' data="' + this.url + '"', i.showcontrols = n.showMovieControls ? 1 : 0), r += ">"; for (s in i) r += '<param name="' + s + '" value="' + i[s] + '">'; r += "</object>", this.$container.html(r) }, remove: function () { if (t.browser.msie) try { window[this.id].controls.stop(), window[this.id].URL = "movie" + now() + ".wmv", window[this.id] = function () { } } catch (e) { } this.$container.remove() }, fadeOut: function (e, t) { this.$container && this.$container.fadeOut(e, t) }, fadeIn: function (e, t) { this.$container && this.$container.fadeIn(e, t) }, getElement: function () { return this.$container } }), t.extend(t.wijmo.wijlightbox.qt.prototype, { appendTo: function (e, n) { this.$container = t("<div/>").css({ width: "100%", height: "100%", overflow: "hidden" }).appendTo(e); var r = this.lightbox.options, i = r.autoPlayMovies ? "true" : "false", s = r.showMovieControls ? "true" : "false", o = "<object", u = { id: this.id, name: this.id, width: this.width, height: this.height, kioskmode: "true", classid: undefined, codebase: undefined, type: undefined, data: undefined }, a, f; t.browser.msie ? (u.classid = "clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B", u.codebase = "http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0") : (u.type = "video/quicktime", u.data = this.url); for (a in u) o += " " + a + '="' + u[a] + '"'; o += ">"; var l = { src: this.url, scale: "aspect", controller: s, autoplay: i }; for (f in l) o += '<param name="' + f + '" value="' + l[f] + '">'; o += "</object>", n && e.hide(), this.$container.html(o), n && e.show() }, remove: function () { try { document[this.id].Stop(), document[this.id] = null } catch (e) { } this.$container.remove() }, fadeOut: function (e, t) { t.call(); return }, fadeIn: function (e, t) { t.call(); return }, getElement: function () { return this.$container } }), t.extend(t.wijmo.wijlightbox.wijvideo.prototype, { appendTo: function (e) { var n = this.lightbox.options; this.$container = t("<video/>").css({ overflow: "hidden" }).attr({ width: this.width, height: this.height, autoPlay: n.autoPlayMovies ? "true" : "false", controls: n.showMovieControls ? "controls" : "" }).appendTo(e), !this.url || t("<source/>").attr({ src: this.url }).appendTo(this.$container), !this.wijvideosrc || t("<source/>").attr({ src: this.wijvideosrc }).appendTo(this.$container), this.$container.wijvideo({ fullScreenButtonVisible: !1 }) }, remove: function () { this.$container.remove() }, fadeOut: function (e, t) { this.$container && this.$container.fadeOut(e, t) }, fadeIn: function (e, t) { this.$container && this.$container.fadeIn(e, t) }, getElement: function () { return this.$container }, adjustSize: function (e, t) { this.$container.wijvideo("setWidth", e), this.$container.wijvideo("setHeight", t) } }), t.extend(t.wijmo.wijlightbox, { overlay: function (e, n) { this.mask = t("<div></div>").addClass(e.options.wijCSS.overlay + " wijmo-wijlightbox-overlay" + (n ? " wijmo-wijlightbox-waitingoverlay" : "")).appendTo(document.body).css({ width: this.width(), height: this.height() }).bind("click", function () { return e._close(), !1 }), t.fn.bgiframe && this.mask.bgiframe(); if (n) { this.mask.css("z-index", this.zIndex); var r = t("<div></div>").addClass("wijmo-wijlightbox-waiting").css("z-index", this.zIndex + 1).appendTo(this.mask); r.css({ left: (this.mask.width() - r.width()) / 2, top: (this.mask.height() - r.height()) / 2 }) } t(window).bind("resize.wijlightbox-overlay", t.proxy(this, "resize")), window.setTimeout(function () { var e; this.mask && (e = t.wijmo.wijlightbox.overlay, t(document).bind(e.events, function (n) { if (t(n.target).zIndex() < e.zIndex) return !1 })) }, 1) } }), t.extend(t.wijmo.wijlightbox.overlay.prototype, { mask: null, zIndex: 1e3, events: t.map("focus,mousedown,mouseup,keydown,keypress,click".split(","), function (e) { return e + ".wijlightbox-overlay" }).join(" "), close: function () { t(document).unbind(".wijlightbox-overlay"), t(window).unbind(".wijlightbox-overlay"), this.mask.remove(), this.mask = undefined }, height: function () { var e, n; return t.browser.msie && parseInt(t.browser.version) < 7 ? (e = Math.max(document.documentElement.scrollHeight, document.body.scrollHeight), n = Math.max(document.documentElement.offsetHeight, document.body.offsetHeight), e < n ? t(window).height() : e) : t(document).height() }, width: function () { var e, n; return t.browser.msie && parseInt(t.browser.version) < 7 ? (e = Math.max(document.documentElement.scrollWidth, document.body.scrollWidth), n = Math.max(document.documentElement.offsetWidth, document.body.offsetWidth), e < n ? t(window).width() : e) : t(document).width() }, resize: function () { this.mask && this.mask.css({ width: this.width(), height: this.height() }) } }) })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { var t = function (t) { function n() { t.apply(this, arguments) } return __extends(n, t), n.prototype._create = function () { var e = this, n = e.options, r = e._getDefFill(), i = n.seriesStyles; $.each(n.seriesList, function (e, t) { if (t.type === "bar") return $.extend(!0, n.axis, { x: { compass: "west" }, y: { compass: "south" } }), !0; t.type === "pie" && t.pieSeriesList && (t.data = t.pieSeriesList) }), $.extend(!0, { compass: "east" }, n.hint), n.is100Percent && (n.is100Percent = !1), n.yAxes && $.isArray(n.yAxes) && n.yAxes.length > 0 && (n.axis.y = n.yAxes), e._handleChartStyles(), i = n.seriesStyles, $.each(n.seriesList, function (t, n) { if (e._isStockSeries(n)) { var r = i[t], s = n.type, o = r.fill, u = $.extend({}, r); r && (r.highLow || (r.highLow = u), s === "hloc" ? (r.open || (r.open = u), r.close || (r.close = u)) : (r.fallingClose || (r.fallingClose = u), r.raisingClose || (r.raisingClose = u))) } }), n.seriesStyles = i, e._isContainsStock() && (e.isContainsStock = !0, e._handleXData()), t.prototype._create.call(this), e.chartElement.addClass(n.wijCSS.compositechart) }, n.prototype._setOption = function (e, n) { e !== "is100Percent" && t.prototype._setOption.call(this, e, n) }, n.prototype._supportStacked = function () { return !0 }, n.prototype.destroy = function () { var e = this, n = e.chartElement, r = n.data("fields"), i = r && r.aniBarsAttr; n.removeClass(e.options.wijCSS.compositechart), t.prototype.destroy.call(this), e._destroyRaphaelArray(i), n.data("fields", null) }, n.prototype._isBarChart = function () { return !0 }, n.prototype._clearChartElement = function () { var e = this, n = e.options, r = e.chartElement, i = r.data("fields"); i && i.allElements && ($.each(i.allElements, function (t, n) { t === "scatters" && n.length && $.each(n, function (e, t) { t.length && ($.each(t, function (e, n) { n && n.remove && n.remove(), t[e] = null }), n[e] = null) }), e._destroyRaphaelArray(n) }), i.allElements = null), t.prototype._clearChartElement.call(this), i && i.ctracers && (i.ctracers = null), e.element.removeData("plotInfos"), n.seriesTransition.enabled || i && i.aniBarsAttr && (i.aniBarsAttr = null) }, n.prototype._bindData = function () { var e = this, t = e.options, n = t.dataSource, r = t.seriesList, i = t.data, s; $.each(r, function (t, r) { var o = r.data, u, a, f, l = r.dataSource || n, c = r.type, h, p, d, v = []; l && o && (c === "pie" ? (h = o.label, p = o.value, d = o.offset, h && h.bind && (h = e._getBindData(l, h.bind)), p && p.bind && (p = e._getBindData(l, p.bind)), d && d.bind && (d = e._getBindData(l, d.bind)), h && $.isArray(h) && h.length && p && $.isArray(p) && p.length && ($.each(p, function (e, t) { var n, r = 0; e >= 0 && e < h.length && (n = h[e]), d && $.isArray(p) && d.length && e >= 0 && e < d.length && (r = typeof d[e] == "undefined" ? 0 : d[e]), v.push({ data: t, label: n, offset: r, legendEntry: !0 }) }), r.data = v)) : (u = o.x, a = o.y, f = o.y1, u && u.bind ? o.x = e._getBindData(l, u.bind) : i && i.x && i.x.bind && (s === undefined && (s = e._getBindData(l, i.x.bind)), o.x = s), a && a.bind && (o.y = e._getBindData(l, a.bind)), f && f.bind && (o.y1 = e._getBindData(l, f.bind)))) }) }, n.prototype.getElement = function (e, t, n) { var r = this.chartElement, i = r.data("fields"), s = i.chartElements; switch (e) { case "bar": case "column": return s.bars[t]; case "line": case "area": return s.paths[t]; case "linemarkers": return s.markersSet[t]; case "pie": return this._getPie(s, t, n) } return null }, n.prototype._getPie = function (e, t, n) { if (n !== undefined) return e["sectors" + n] ? e["sectors" + n][t] : null; var r = []; return $.each(e, function (e, t) { /sectors/.test(e) && e !== "sectors" && $.each(t, function (e, t) { r.push(t) }) }), r.length === 0 && (r = e.sectors), r[t] }, n.prototype._paintLegendIcon = function (e, n, r, i, s, o, u, a, f, l) { var c = this, h = this.options, p = f.type, d, v, m = 3, g = !1, y, b; return p === "line" || p === "area" || p === "spline" || p === "bezier" ? (d = c.canvas.path(Raphael.format("M{0},{1}L{2},{3}", e, n + i / 2, e + r, n + i / 2)), s && (h.legend.size && h.legend.size.height && (m = h.legend.size.height), d.attr($.extend(!0, {}, s, { "stroke-width": m }))), g = !0, f.markers && f.markers.visible && (y = f.markers.type, b = f.markerStyle, b = $.extend({ fill: s.stroke, stroke: s.stroke, opacity: 1 }, b), s["stroke-dasharray"] && d.attr({ "stroke-width": 1, "stroke-dasharray": s["stroke-dasharray"] }), y || (y = "circle"), v = this.canvas.paintMarker(y, e + r / 2, n + i / 2, 3), $.wijraphael.addClass($(v.node), Raphael.format("{0} {1} {2}", h.wijCSS.legend, h.wijCSS.legendDot, h.wijCSS.canvasObject)), v.attr(b), $(v.node).data("index", u).data("legendIndex", o), this.legendDots[o] = v)) : p === "scatter" ? (b = f.markerStyle, y = f.markerType, b = $.extend({ fill: s.stroke, stroke: s.stroke, opacity: 1 }, b), y || (y = "circle"), d = c.canvas.paintMarker(y, e + r / 2, n + i / 2, 3), d.attr(b), f.visible === !1 && ($(l.node).data("dotOpacity", d.attr("opacity") || 1), d.attr("opacity", .3)), g = !0) : p === "bubble" ? (b = f.markerStyle, b = $.extend({ fill: s.stroke, stroke: s.stroke, opacity: 1 }, b), f.markers && (y = f.markers.type), y || (y = "circle"), d = c.canvas.paintMarker(y, e + r / 2, n + i / 2, Math.min(r, i) / 2), d.attr(b), g = !0) : d = t.prototype._paintLegendIcon.call(this, e, n, r, i, s, o, u, a, f, l), g && ($.wijraphael.addClass($(d.node), a), $(d.node).data("legendIndex", o).data("index", u), c.legendIcons.push(d)), d }, n.prototype._showHideStockSeries = function (e, t) { $.each(e, function (e, n) { n.hl && n.hl[t](), n.o && n.o[t](), n.c && n.c[t](), n.path && n.path[t](), n.h && n.h[t](), n.l && n.l[t](), n.oc && n.oc[t]() }) }, n.prototype._showSerieEles = function (e) { var t = e.type, n = e.eles, r = this.options.showChartLabels, i; switch (t) { case "pie": n.sector && (n.sector.show(), n.sector.shadow && n.sector.shadow.show(), n.sector.tracker && n.sector.tracker.show()), n.label && n.label.show(); break; case "line": case "spline": case "bezier": case "area": n.markers && $.each(n.markers, function (e, t) { i = $(t.node).data("wijchartDataObj"); if (i && i.lineSeries && i.lineSeries.markers && !i.lineSeries.markers.visible) return !0; t.show() }), n.dcl && $.each(n.dcl, function (e, t) { r && t.show() }), n.path && (i = $(n.path.node).data("wijchartDataObj"), i.visible && (n.path.show(), n.path.shadow && n.path.shadow.show(), n.path.area && n.path.area.show(), n.path.tracker && n.path.tracker.show(), $(n.path.node).data("wijchartDataObj") && $(n.path.node).data("wijchartDataObj").virtualMarkers && $.each($(n.path.node).data("wijchartDataObj").virtualMarkers, function (e, t) { t.visible = !0 }))); break; case "bar": case "column": $.each(n, function (e, t) { t.bar && (t.bar.show(), t.bar.shadow && t.bar.shadow.show(), t.bar.tracker && t.bar.tracker.show(), $(t.bar.node).data("wijchartDataObj") && ($(t.bar.node).data("wijchartDataObj").visible = !0)), t.dcl && t.dcl.show(), t.animatedBar && !t.animatedBar.removed && t.animatedBar.show() }); break; case "scatter": $.each(n, function (e, t) { t.show(), t.label && t.label.show(), $(t.element).data("wijchartDataObj") && ($(t.element).data("wijchartDataObj").visible = !0) }); break; case "hloc": case "hl": case "candlestick": this._showHideStockSeries(n, "show"); break; case "bubble": $.each(n, function (e, t) { t.bubble && (t.bubble.show(), t.bubble.tracker && t.bubble.tracker.show()), t.dcl && t.dcl.show(), t.symbol && t.symbol.show() }) } }, n.prototype._hideSerieEles = function (e) { var t = e.type, n = e.eles; switch (t) { case "pie": n.sector && (n.sector.hide(), n.sector.shadow && n.sector.shadow.hide(), n.sector.tracker && n.sector.tracker.hide()), n.label && n.label.hide(); break; case "line": case "spline": case "bezier": case "area": n.markers && $.each(n.markers, function (e, t) { t.hide() }), n.dcl && $.each(n.dcl, function (e, t) { t.hide() }), n.path && (n.path.hide(), n.path.shadow && n.path.shadow.hide(), n.path.area && n.path.area.hide(), n.path.tracker && n.path.tracker.hide(), $(n.path.node).data("wijchartDataObj") && $(n.path.node).data("wijchartDataObj").virtualMarkers && $.each($(n.path.node).data("wijchartDataObj").virtualMarkers, function (e, t) { t.visible = !1 })); break; case "bar": case "column": $.each(n, function (e, t) { t.bar && (t.bar.hide(), t.bar.shadow && t.bar.shadow.hide(), t.bar.tracker && t.bar.tracker.hide(), $(t.bar.node).data("wijchartDataObj") && ($(t.bar.node).data("wijchartDataObj").visible = !1)), t.dcl && t.dcl.hide(), t.animatedBar && !t.animatedBar.removed && t.animatedBar.hide() }); break; case "scatter": $.each(n, function (e, t) { t.hide(), t.label && t.label.hide(), $(t.element).data("wijchartDataObj") && ($(t.element).data("wijchartDataObj").visible = !1) }); break; case "hloc": case "hl": case "candlestick": this._showHideStockSeries(n, "hide"); break; case "bubble": $.each(n, function (e, t) { t.bubble && (t.bubble.hide(), t.bubble.tracker && t.bubble.tracker.hide()), t.dcl && t.dcl.hide(), t.symbol && t.symbol.hide() }) } }, n.prototype._indicatorLineShowing = function (e) { var n; t.prototype._indicatorLineShowing.call(this, e), $.each(e, function (e, t) { n = t.type, n === "column" || n === "bar" ? t.bar.attr(t.hoverStyle) : n === "marker" ? t.marker.attr(t.markerHoverStyle) : n === "scatter" && (t.dot.attr(t.hoverStyle), t.dot.scale(1.5, 1.5)) }) }, n.prototype._removeIndicatorStyles = function (e) { var t; $.each(e, function (e, n) { t = n.type, t === "column" || t === "bar" ? n.bar.attr(n.style) : t === "marker" ? (n.marker.attr(n.markerStyle), n.marker.transform("s1")) : t === "scatter" && (n.dot.attr(n.style), n.dot.scale(1, 1)) }) }, n.prototype._paintTooltip = function () { var e = this, n = e.chartElement, r = n.data("fields") || {}, i = r.ctracers || []; t.prototype._paintTooltip.call(this), e.tooltip && $.each(i, function (t, n) { n.trackers && n.trackers.length && t === 0 && e.tooltip.setOptions({ relatedElement: n.trackers[0] }) }) }, n.prototype._isContainsStock = function () { var e = !1, t = this, n = t.options, r = n.seriesList; return $.each(r, function (t, n) { var r = n.type; if (r === "hloc" || r === "hl" || r === "candlestick") return e = !0, !1 }), e }, n.prototype._handleXData = function () { }, n.prototype._isStockSeries = function (e) { var t = e.type; return t === "hloc" || t === "hl" || t === "candlestick" }, n.prototype._paintChartArea = function () { var e = this, n = e.options, r = n.data; if (e._isSeriesDataEmpty()) return; $.each(n.seriesList, function (t, n) { var r = n.data; e._isStockSeries(n) && (r.y = [].concat(r.high).concat(r.low)) }), t.prototype._paintChartArea.call(this), $.each(n.seriesList, function (t, n) { e._isStockSeries(n) && delete n.data.y }) }, n.prototype._isSeriesDataEmpty = function () { var e = this, t = e.options.seriesList; return !t || t.length === 0 ? !0 : ($.each(t, function (e, t) { var n = t.type; if (n === "hloc" || n === "candlestick") { if (!t.data || !t.data.x || !t.data.high || !t.data.low || !t.data.open || !t.data.close) return !0 } else if (n === "hl") { if (!t.data || !t.data.x || !t.data.high || !t.data.low) return !0 } else { if (n === "pie" && (!t.data || !t.label || t.label.length === 0)) return !0; if (!t.data || (!t.data.x || !t.data.y) && !t.data.xy) return !0 } }), !1) }, n.prototype._validateSeriesData = function (e) { var t = this.options.type, n = e.data; if (t === "hl") { if (n.x === undefined && n.high === undefined && n.low === undefined) return !1 } else if (n.x === undefined && n.high === undefined && n.low === undefined && n.open === undefined && n.close === undefined) return !1; return !0 }, n.prototype._isStockChart = function () { return this.isContainsStock ? !0 : !1 }, n.prototype._calculateStockParameters = function (e, t) { if (e.id === "x") { var n = t.unitMinor, r = t.autoMin, i = t.autoMax, s = this._getStockAdjustment(e); this.timeUtil && this.timeUtil.getCount && (e.max = this.timeUtil.getCount() - 1), s === 0 ? s = n : n < s && n !== 0 && (s = Math.floor(s / n) * n), r && (e.min -= s), i && (e.max += s), this._calculateMajorMinor(t, e) } }, n.prototype._getStockAdjustment = function (e) { var t = this, n = t.options, r = e.max, i = e.min, s, o = n.seriesList; return $.each(o, function (e, t) { s ? s = Math.max(t.data.x.length) : s = t.data.x.length }), (r - i) / s }, n.prototype._calculateMajorMinor = function (n, r) { var i = this, s = i.options, o = r.bounds || i.canvasBounds, u = n.autoMajor, a = n.autoMinor, f = r.max, l = r.min, c = r.isTime, h = r.tinc, p = r.annoFormatString, d = null, v = null, m = null, g = null, y = null, b = null, w = null, E = null, S = null, x = f - l, T = 0, N = 0, C = 0, k = 0; if (!i.isContainsStock) { t.prototype._calculateMajorMinor.call(this, n, r); return } if (u) { S = $.extend(!0, {}, s.textStyle, n.textStyle, n.labels.style); if (r.id === "x") l < 0 && (l = 0), f > i.timeUtil.getCount() - 1 && (f = i.timeUtil.getCount() - 1), f = i.timeUtil.getOATime(f), l = i.timeUtil.getOATime(l), i.formatString ? p = i.formatString : (p = p || e.ChartDataUtil.getTimeDefaultFormat(f, l), i.formatString = p), d = Globalize.format($.fromOADate(f), p, i._getCulture()), v = Globalize.format($.fromOADate(l), p, i._getCulture()), y = i._text(-1e3, -1e3, d).attr(S), b = i._text(-1e3, -1e3, v).attr(S), m = y.wijGetBBox(), g = b.wijGetBBox(), y.wijRemove(), y = null, b.wijRemove(), b = null; else { w = e.ChartDataUtil.nicePrecision(x), E = w + 1; if (E < 0 || E > 15) E = 0; y = i._text(-1e3, -1e3, $.round(f, E).toString()).attr(S), b = i._text(-1e3, -1e3, $.round(l, E).toString()).attr(S), m = y.wijGetBBox(), g = b.wijGetBBox(), y.wijRemove(), y = null, b.wijRemove(), b = null } m.width < g.width && (m.width = g.width), m.height < g.height && (m.height = g.height), i._isVertical(n.compass) ? (N = o.endY - o.startY - r.vOffset - r.axisTextOffset, k = N / m.height, Number.POSITIVE_INFINITY === k ? C = 0 : C = parseInt(k.toString(), 10)) : (T = o.endX - o.startX - r.vOffset - r.axisTextOffset, k = T / m.width, Number.POSITIVE_INFINITY === k ? C = 0 : C = parseInt(k.toString(), 10)), k = x, C > 0 && (x /= C, r.tprec = e.ChartDataUtil.nicePrecision(x), k = e.ChartDataUtil.niceNumber(2 * x, -w, !0), k < x && (k = e.ChartDataUtil.niceNumber(x, -w + 1, !1)), k < x && (k = e.ChartDataUtil.niceTickNumber(x))), n.unitMajor = k } a && n.unitMajor && !isNaN(n.unitMajor) && (n.unitMinor = n.unitMajor / 2) }, n.prototype._getTickText = function (e) { var t = this, n = t.formatString; return t.isContainsStock ? Globalize.format(t.timeUtil.getTime(e), n, t._getCulture()) : e }, n.prototype._AdjustAxisBounds = function (t, n) { var r = this, i = r.options, s, o, u, a, f = t.max, l = t.min, c = f - l, h = e.ChartDataUtil.nicePrecision(c), p = h + 1, d = t.bounds, v = $.extend(!0, {}, i.textStyle, n.textStyle, n.labels.style); s = r._text(-1e3, -1e3, $.round(f, p).toString()).attr(v), o = r._text(-1e3, -1e3, $.round(l, p).toString()).attr(v), u = s.wijGetBBox(), a = o.wijGetBBox(), t.isStartAxis || (d.startY += a.height), t.isLastAxis || (d.endY -= u.height / 2) }, n.prototype._initYAxisHeight = function () { var e = this, t = e.options, n = t.axis, r = n.y, i = e.canvasBounds, s = i.endX - i.startX, o = i.endY - i.startY, u = e.axisInfo, a = u.y, f = 0, l = -1, c = 0, h; $.isArray(r) && ($.each(r, function (e, t) { t.height && !isNaN(t.height) ? f += t.height : t.height === "auto" && (l = e), a[e].height = t.height }), l > -1 && (a[l].height = o - f), $.each(a, function (t, n) { var s = n.height; if (s === undefined) return !0; s > 0 && (n.isPartAxis = !0, n.isLastAxis = parseInt(t) === r.length - 1, n.isStartAxis = parseInt(t) === 0), h ? n.bounds = { startY: h.endY, endY: h.endY + s } : n.bounds = { startY: i.startY, endY: i.startY + s }, n.bounds.startX = i.startX, n.bounds.endX = i.endX, e._AdjustAxisBounds(n, r[t]), n.bounds && (h = $.extend({}, n.bounds)) })) }, n.prototype._getDataExtreme = function (e) { var n = this; return n._initYAxisHeight(), t.prototype._getDataExtreme.call(this, e) }, n.prototype._paintPlotArea = function () { var t = this, n = t.options, r = "seriesList", i = "seriesStyles", s = "seriesHoverStyles", o = n[i], u = n[s], a = t.canvasBounds, f = {}, l = 0, c = -1, h = [], p = $.isArray(n.axis.y), d = { canvas: t.canvas, tooltip: t.tooltip, bounds: a, widgetName: t.widgetName, seriesTransition: n.seriesTransition, showChartLabels: n.showChartLabels, textStyle: n.textStyle, chartLabelStyle: n.chartLabelStyle, chartLabelFormatString: n.chartLabelFormatString, shadow: n.shadow, hint: n.hint, animation: n.animation, disabled: n.disabled, culture: t._getCulture(), widget: this, wijCSS: n.wijCSS, mouseDown: function (e, n) { t._trigger("mouseDown", e, n) }, mouseUp: function (e, n) { t._trigger("mouseUp", e, n) }, mouseOver: function (e, n) { t._trigger("mouseOver", e, n) }, mouseOut: function (e, n) { t._trigger("mouseOut", e, n) }, mouseMove: function (e, n) { t._trigger("mouseMove", e, n) }, click: function (e, n) { t._trigger("click", e, n) } }, v = t.chartElement.data("fields"), m, g, y, b = t._isContainsStock(); v && (v.ctracers = []), b && t._handleXData(), $.each(n[r], function (e, t) { var a = t.type, h = {}, d = a, v = {}, m = $.extend({}, o[l]), g = $.extend({}, u[l]), y = t.yAxis; if (!a || a.length === 0) return !0; if (d === "spline" || d === "bezier") d = "line"; h = f[d], h || (a === "pie" ? h = [] : h = {}, f[d] = h, t.hint && (h.hint = t.hint, n.hint.content || (n.hint.content = t.hint.content), n.hint.title || (n.hint.title = t.hint.title))); if (a === "pie") return $.each(t.data, function (t, n) { m = $.extend({}, o[l]), g = $.extend({}, u[l]), v[r] || (v[r] = []), v[i] || (v[i] = []), v[s] || (v[s] = []), n.pieID = e + 1, v[r].push(n), v[i].push(m), v[s].push(g), c === -1 && (c = l), l++ }), v.sIndex = c, v.radius = t.radius, v.center = t.center, v.label = t.label, c = -1, h.push(v), !0; a === "column" ? h.horizontal = !1 : a === "bar" ? h.horizontal = !0 : a === "spline" ? t.fitType = "spline" : a === "bezier" && (t.fitType = "bezier"), d === "stock" && t.data.high && t.data.low && (t.data.y = [].concat(t.data.high).concat(t.data.low)), p && (h.yAxis = y || 0); if (a === "line" || a === "spline" || a === "bezier") delete m.fill, delete g.fill; h[r] || (h[r] = []), h[i] || (h[i] = []), h[s] || (h[s] = []), a === "scatter" && (h.showChartLabels = n.showChartLabels, t.showChartLabels !== undefined && (h.showChartLabels = t.showChartLabels)), t.sIndex = l, h[r].push(t), h[i].push(m), h[s].push(g), l++ }), $.each(f, function (r, i) { var s = i.yAxis, o = n.chartLabel; s !== undefined && t.axisInfo.y[s].bounds && (d.bounds = t.axisInfo.y[s].bounds); switch (r) { case "pie": var u; $.each(i, function (n, i) { var s = i.center, o = i.radius || 50, u = s ? { startX: s.x - o, startY: s.y - o, endX: s.x + o, endY: s.y + o } : { startX: a.startX + 10, startY: a.startY + 10, endX: a.startX + 10 + 2 * o, endY: a.startY + 10 + 2 * o }; m = $.extend(!0, {}, d, { bounds: u, radius: o }, i), y = new e.PieChartRender(t.chartElement, m), y.render(), t.chartElement.data("fields").aniSectorAttrs = null, t.chartElement.data("fields").aniLabelAttrs = null, t._savechartData(r, i.sIndex) }); break; case "bar": case "column": m = $.extend(!0, {}, d, { stacked: n.stacked, axis: n.axis, clusterOverlap: n.clusterOverlap, clusterWidth: n.clusterWidth, clusterSpacing: n.clusterSpacing, is100Percent: n.is100Percent, clusterRadius: n.clusterRadius, isYTime: t.axisInfo.y[0].isTime, isXTime: t.axisInfo.x.isTime, yAxisInfo: t.axisInfo.y, yAxisIndex: s }, i), y = new e.BarChartRender(t.chartElement, m), y.render(), h = [], $.each(i.seriesList, function (e, t) { h.push(t.sIndex) }), t._savechartData(r, h); break; case "line": case "spline": case "bezier": case "area": g = t._getyAxisGroup(i), $.each(g, function (i, s) { t.aniPathsAttr || (t.aniPathsAttr = []), m = $.extend(!0, {}, d, { axis: n.axis, isXTime: t.axisInfo.x.isTime, isYTime: t.axisInfo.y[0].isTime, type: r === "area" ? "area" : "line", hole: n.hole }, s), m.aniPathsAttr = t.aniPathsAttr, m.chartLabelEles = t.chartLabelEles, m.axis.y = n.axis.y[i] || n.axis.y, m.extremeValue = { txx: t.extremeValue.txx, txn: t.extremeValue.txn, tyx: t.extremeValue.y[i].tyx, tyn: t.extremeValue.y[i].tyn }, y = new e.LineChartRender(t.chartElement, m), y.render(), h = [], $.each(s.seriesList, function (e, t) { h.push(t.sIndex) }), t._savechartData(r, h, !0) }); break; case "scatter": g = t._getyAxisGroup(i), $.each(g, function (i, s) { m = $.extend(!0, {}, d, { axis: n.axis, isXTime: t.axisInfo.x.isTime, isYTime: t.axisInfo.y[0].isTime, zoomOnHover: n.zoomOnHover }, s), m.axis.y = n.axis.y[i] || n.axis.y, y = new e.ScatterChartRender(t.chartElement, m), y.render(), h = [], $.each(s.seriesList, function (e, t) { h.push(t.sIndex) }), t._savechartData(r, h) }); break; case "hloc": case "hl": case "candlestick": break; case "bubble": g = t._getyAxisGroup(i), o || (o = { visible: n.showChartLabels, style: n.chartLabelStyle }), $.each(g, function (i, s) { m = $.extend(!0, {}, d, { axis: n.axis, isXTime: t.axisInfo.x.isTime, isYTime: t.axisInfo.y[0].isTime, xAxisInfo: t.axisInfo.x, yAxisInfo: t.axisInfo.y, chartLabel: o, minimumSize: n.minimumSize || 5, maximumSize: n.maximumSize || 20, sizingMethod: n.sizingMethod || "diameter" }, s), m.axis.y = n.axis.y[i] || n.axis.y, m.yAxisInfo = t.axisInfo.y[i] || t.axisInfo.y[0], y = new e.BubbleChartRender(t.chartElement, m), y.render(), h = [], $.each(s.seriesList, function (e, t) { h.push(t.sIndex) }), t._savechartData(r, h) }) } }), t.chartElement.data("fields").seriesEles = null, t._bindtooltip() }, n.prototype._savechartData = function (e, t, n) { var r = this, i = r.chartElement.data("fields"), s = i.seriesEles, o = i.allElements || {}, u, a = t; $.isArray(a) && (a = 0), $.each(s, function (n, i) { $.isArray(t) ? (r.seriesEles[t[a]] = { eles: i, type: e }, a++) : (r.seriesEles[a] = { eles: i, type: e }, a++) }), n || (u = i.ctracers || [], u.push({ trackers: i.trackers, type: e }), i.ctracers = u), i && i.chartElements && $.each(i.chartElements, function (e, t) { r._copyElements(o, e, t) }), i.allElements = o }, n.prototype._copyElements = function (e, t, n) { var r; n && $.isArray(n) ? (r = e[t] || [], e[t] = r.concat(n)) : n && (r = e[t] || [], r.concat([n])) }, n.prototype._getyAxisGroup = function (e) { var t = {}; return $.each(e.seriesList, function (n, r) { var i = r.yAxis || 0; t[i] || (t[i] = { seriesList: [], seriesStyles: [], seriesHoverStyles: [] }), t[i].seriesList.push(r), t[i].seriesStyles.push(e.seriesStyles[n]), t[i].seriesHoverStyles.push(e.seriesHoverStyles[n]) }), t }, n.prototype._bindtooltip = function () { var e = this, t = e.widgetName, n = e.chartElement.data("fields"); n && n.ctracers && $.each(n.ctracers, function (e, t) { var n = t.type; n !== "hloc" && t.trackers && t.trackers.toFront() }), e.chartElement.delegate(".linetracker, .wijchart-canvas-marker, .bartracker, .pietracker, .wijscatterchart, .bubbletracker", "mouseover." + t, $.proxy(e._tooltipMouseOver, e)), e.chartElement.delegate(".linetracker, .wijchart-canvas-marker, .bartracker, .pietracker, .wijscatterchart, .bubbletracker", "mouseout." + t, $.proxy(e._tooltipMouseOut, e)), e.chartElement.delegate(".linetracker, .wijchart-canvas-marker, .bartracker, .pietracker, .wijscatterchart, .bubbletracker", "mousemove." + t, $.proxy(e._tooltipMouseMove, e)) }, n.prototype._tooltipMouseOver = function (e) { var t = e.target, n = this, r = n.tooltip, i = n.options.hint, s = null, o = i.title, u = i.content, a = i.style, f = $.isFunction(o), l = $.isFunction(u), c, h, p, d; p = $(n.canvas.canvas.parentNode).offset(); if (n.indicatorLine) return; $(t).data("owner") && (t = $(t).data("owner")), t = $(t), c = t.data("wijchartDataObj"); if (n.tooltip) { s = r.getOptions(); if (f || l) f && (s.title = $.proxy(o, c)), l && (s.content = $.proxy(u, c)); if (c.type === "line" || c.type === "marker") { c.type === "marker" && (c = c.lineSeries); if (c.path.removed) return; if (n.hoverLine !== c || n.hoverLine === null) n.isNewLine = !0, n.hoverLine && (n.hoverLine.path.removed || (n.hoverLine.path.wijAttr(n.hoverLine.lineStyle), n.hoverPoint && !n.hoverPoint.isSymbol && (n.hoverPoint.marker.wijAttr(n.hoverPoint.markerStyle), n.hoverPoint.marker.transform("s1")))), c.lineHoverStyle && c.path.wijAttr(c.lineHoverStyle), n.hoverLine = c, n.hoverPoint = null, n.hoverVirtualPoint = null } else c.type === "scatter" || i.relativeTo === "element" ? (n._clearHoverState(), c.type === "scatter" ? h = c.dot.getBBox() : t[0] && t[0].raphael && t[0].raphaelid && (d = n.canvas.getById(t[0].raphaelid), d && (h = d.getBBox())), s.style.stroke = a.stroke || t.attr("stroke"), h && n.tooltip.showAt({ x: h.x + h.width / 2, y: h.y }, e)) : (n._clearHoverState(), s.style.stroke = a.stroke || t.attr("stroke"), n.tooltip.showAt({ x: e.pageX - p.left, y: e.pageY - p.top }, e)) } }, n.prototype._tooltipMouseMove = function (e) { var t = this, n = e.target, r, i = t.options.hint, s = $(t.canvas.canvas.parentNode).offset(); $(n).data("owner") && (n = $(n).data("owner")), n = $(n), r = n.data("wijchartDataObj"), t.tooltip && !this.indicatorLine && r.type !== "line" && r.type !== "marker" && r.type !== "scatter" && i.relativeTo !== "element" && t.tooltip.showAt({ x: e.pageX - s.left, y: e.pageY - s.top }, e) }, n.prototype._tooltipMouseOut = function (e) { var t = this, n = e.target, r; $(n).data("owner") && (n = $(n).data("owner")), n = $(n), r = n.data("wijchartDataObj"), r.type !== "line" && r.type !== "marker" && !t.indicatorLine && t.tooltip && t.tooltip.hide() }, n.prototype._mouseMoveInsidePlotArea = function (e, n) { var r = this, i = r.tooltip, s = r.options.hint, o, u, a = 0, f, l, c, h, p = null, d = null, v = null, m = s.title, g = s.content, y = $.isFunction(m), b = $.isFunction(g), w = 0, E; i && (v = i.getOptions()); if (r.hoverLine && !r.indicatorLine) { E = r.hoverLine, r.isNewLine && (s.enable && i && i.hide(), r.isNewLine = !1), o = E.lineMarkers, u = E.virtualMarkers, a = -1, f = { x: 0, y: 0 }; if (o && o.length) { $.each(o, function (e, t) { if (t.removed) return !0; var r = t.wijGetBBox(), i = r.x + r.width / 2, s = Math.abs(i - n.left); if (e === 0 || s < w) w = s, a = e, f = { x: i, y: r.y + r.height / 2 } }); if (r.hoverPoint && r.hoverPoint.index === a) return; if (a > -1) { if (o[a].removed) return; l = $(o[a].node).data("wijchartDataObj"), l && (r.hoverPoint && !r.hoverPoint.isSymbol && (r.hoverPoint.removed || (r.hoverPoint.marker.wijAttr(r.hoverPoint.markerStyle), r.hoverPoint.marker.transform("s1"))), l.isSymbol || l.marker.removed || l.marker.wijAttr(l.markerHoverStyle)), r.hoverPoint = l, r.hoverVirtualPoint = u[a] } } else { $.each(u, function (e, t) { var r = Math.abs(t.x - n.left); if (e === 0 || r < w) w = r, a = e, f = { x: t.x, y: t.y } }); if (r.hoverVirtualPoint && r.hoverVirtualPoint.index === a) return; a > -1 && (r.hoverPoint = null, r.hoverVirtualPoint = u[a]) } if (i) { d = r.hoverVirtualPoint, c = d.valX, h = d.valY; if (y || b) y && (v.title = function () { var e = { pointIndex: a, lineIndex: E.index, x: c, y: h, label: E.label, data: d, fmt: m }, t = $.proxy(e.fmt, e), n = t(); return n }), b && (v.content = function () { var e = { pointIndex: a, lineIndex: E.index, x: c, y: h, label: E.label, data: d, fmt: g }, t = $.proxy(e.fmt, e), n = t(); return n }); p = $.extend({ stroke: E.path.attr("stroke") }, s.style), v.style.stroke = p.stroke, i.showAt(f) } } t.prototype._mouseMoveInsidePlotArea.call(this, e, n) }, n.prototype._mouseDownInsidePlotArea = function (e, n) { t.prototype._mouseDownInsidePlotArea.call(this, e, n), this._clearHoverState(!0) }, n.prototype._mouseMoveOutsidePlotArea = function (e, n) { var r = this; r._clearHoverState(), t.prototype._mouseMoveOutsidePlotArea.call(this, e, n) }, n.prototype._clearHoverState = function (e) { var t = this, n = t.tooltip, r = t.options.hint; t.hoverLine && (r.enable && n && !e && n.hide(), t.hoverLine.path.removed || (t.hoverLine.path.wijAttr(t.hoverLine.lineStyle), t.hoverPoint && !t.hoverPoint.isSymbol && (t.hoverPoint.marker.wijAttr(t.hoverPoint.markerStyle), t.hoverPoint.marker.transform("s1")))), t.hoverLine = null, t.hoverPoint = null, t.hoverVirtualPoint = null }, n.prototype._getTooltipText = function (e, t) { return "" }, n.prototype._calculateParameters = function (e, n) { var r = this, i = !1, s, o; t.prototype._calculateParameters.call(this, e, n); if (r.isContainsStock) { r._calculateStockParameters(e, n); return } $.each(r.options.seriesList, function (e, t) { if (t.type === "column" || t.type === "bar") return i = !0, !1 }); if (!i) return; e.id === "x" && (s = n.unitMinor, o = r._getBarAdjustment(e), o === 0 ? o = s : s < o && s !== 0 && (o = Math.floor(o / s) * s), e.min -= o, e.max += o, r._calculateMajorMinor(n, e)) }, n.prototype._getBarAdjustment = function (e) { var t = 0, n = this.options, r = e.max, i = e.min, s = 0; return $.each(n.seriesList, function (e, n) { if (n.type === "pie") return !0; if (n.data.x === undefined || n.data.y === undefined) return !0; s = n.data.x.length, t < s && (t = s) }), t > 1 ? (r - i) / t * n.clusterWidth * .0125 : t === 1 ? (i === 0 && r === 1 && (i = -1, e.min = i), (r - i) * .0125) : 0 }, n }(e.wijchartcore); e.wijcompositechart = t, t.prototype.widgetEventPrefix = "wijcompositechart"; var n = function () { function e() { this.initSelector = ":jqmData(role='wijcompositechart')", this.wijCSS = { compositechart: "wijmo-wijcompositechart", barLabel: "wijbarchart-label", barElement: "wijbarchart", barTracker: "bartracker", bubbleElement: "wijbubblechart-bubble", bubbleTracker: "bubbletracker", bubbleLabel: "wijbubblechart-label", bubbleSymbol: "wijbubblechart-symbol", scatterElement: "wijscatterchart", pieLabel: "wijpiechart-label", pieElement: "wijpiechart", pieTracker: "pietracker", lineLabel: "wijlinechart-label", lineElement: "wijlinechart", areaElement: "wijlinechart-area", lineTracker: "linetracker", canvasMarker: "wijchart-canvas-marker" }, this.stacked = !1, this.clusterOverlap = 0, this.clusterWidth = 85, this.clusterRadius = 0, this.clusterSpacing = 0, this.seriesList = [], this.animation = { enabled: !0, duration: 400, easing: ">" }, this.seriesTransition = { enabled: !0, duration: 400, easing: ">" }, this.mouseDown = null, this.mouseUp = null, this.mouseOver = null, this.mouseOut = null, this.mouseMove = null, this.click = null } return e }(); t.prototype.options = $.extend(!0, {}, e.wijchartcore.prototype.options, new n), $.wijmo.registerWidget("wijcompositechart", t.prototype) })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; var t = jQuery, n = "wijdatepager", r = function (e) { function n() { e.apply(this, arguments) } return __extends(n, e), n.prototype._setOption = function (e, n) { t.wijmo.widget.prototype._setOption.apply(this, arguments); switch (e) { case "culture": this.options.culture = n, this._initBackground(); break; case "selectedDate": this.options.selectedDate = n, this._initBackground(); break; case "disabled": n ? this._disable() : this._enable(); break; case "viewType": this.options.viewType = n, this._initBackground(); break; case "nextTooltip": this.element.find(".wijmo-wijdatepager-increment").attr("title", n); break; case "prevTooltip": this.element.find(".wijmo-wijdatepager-decrement").attr("title", n) } return this }, n.prototype._disable = function () { this.element.addClass(this.options.wijCSS.stateDisabled), this.element.find(".wijmo-wijdatepager-decrement").button("option", "disabled", !0), this.element.find(".wijmo-wijdatepager-increment").button("option", "disabled", !0) }, n.prototype._enable = function () { this.element.removeClass(this.options.wijCSS.stateDisabled), this.element.find(".wijmo-wijdatepager-decrement").button("option", "disabled", !1), this.element.find(".wijmo-wijdatepager-increment").button("option", "disabled", !1) }, n.prototype._create = function () { var e = this.options, n, r, i; window.wijmoApplyWijTouchUtilEvents && (t = window.wijmoApplyWijTouchUtilEvents(t)), e.selectedDate || (e.selectedDate = new Date), this._dtpagernamespacekey = "dtpager" + (new Date).getTime(), this.element.addClass("wijmo-wijdatepager " + e.wijCSS.widget + " ui-helper-clearfix"), n = t.proxy(this.invalidate, this), t(window).bind("resize." + this._dtpagernamespacekey, n), this.element.disableSelection && this.element.disableSelection(), this.element.append(t('<a class="wijmo-wijdatepager-decrement"><span>' + e.prevTooltip + "</span></a>")).append('<div class="wijmo-wijdatepager-container ' + e.wijCSS.content + '">' + '<div class="wijmo-wijdatepager-pages"></div>' + "</div>" + '<a class="wijmo-wijdatepager-increment"><span>' + e.nextTooltip + "</span></a>"), t.wijmo.widget.prototype._create.apply(this, arguments), r = this.element.find(".wijmo-wijdatepager-decrement"), i = this.element.find(".wijmo-wijdatepager-increment"), t.mobile == null ? (r.button({ icons: { primary: "ui-icon-triangle-1-w" }, text: !1 }), i.button({ icons: { primary: "ui-icon-triangle-1-e" }, text: !1 })) : (r.html(""), r.attr("data-icon", "arrow-l"), r.button({ text: !1 }), i.html(""), i.attr("data-icon", "arrow-r"), i.button({ text: !1 })), r.click(t.proxy(this.goLeft, this)), i.click(t.proxy(this.goRight, this)), this._initBackground(), e.disabled && this._disable() }, n.prototype.destroy = function () { this.element.removeClass("wijmo-wijdatepager"), t(window).unbind("." + this._dtpagernamespacekey) }, n.prototype.refresh = function () { this.invalidate() }, n.prototype.invalidate = function () { var e, n = this.options.selectedDate, r, i = this.element.find(".wijmo-wijdatepager-container"), s = this.element.find(".wijmo-wijdatepager-decrement"), o = this.element.find(".wijmo-wijdatepager-increment"), u = this.element.innerWidth(), a = s.is(":visible") ? s.outerWidth(!0) : 0, f = o.is(":visible") ? o.outerWidth(!0) : 0, l, c, h; e = this.element.find(".wijmo-wijdatepager-pagelabel." + this._getDateClass(n)), e.length !== 1 ? e = t(this.element.find(".wijmo-wijdatepager-pagelabel")[this._index]) : (r = this.element.find(".wijmo-wijdatepager-pagelabel").index(e), this._index = r), this.element.find(".wijmo-wijdatepager-pagelabel." + this.options.wijCSS.stateActive).removeClass(this.options.wijCSS.stateActive), e.addClass(this.options.wijCSS.stateActive), i.css("left", a), this.element.removeClass("wijmo-wijdatepager-width-smallest wijmo-wijdatepager-width-small wijmo-wijdatepager-width-medium wijmo-wijdatepager-width-normal"), u < 300 ? this.element.addClass("wijmo-wijdatepager-width-smallest") : u < 475 ? this.element.addClass("wijmo-wijdatepager-width-small") : u < 600 ? this.element.addClass("wijmo-wijdatepager-width-medium") : this.element.addClass("wijmo-wijdatepager-width-normal"), i.outerWidth(u - a - f), t.browser.msie && parseInt(t.browser.version, 10) <= 7 && (l = this.element.find(".wijmo-wijdatepager-pages"), c = l.find(".wijmo-wijdatepager-pagelabel"), h = Math.round(l.width() / this._datesDef.length) - (c.outerWidth(!0) - c.width()), c.width(h)) }, n.prototype.goLeft = function (e) { var t = this.options; if (t.disabled) return; this._setSelectedIndex(this._index - 1, !0); if (e) return e.preventDefault(), !1 }, n.prototype.goRight = function () { var e = this.options; if (e.disabled) return; this._setSelectedIndex(this._index + 1) }, n.prototype._getCulture = function (e) { return typeof e == "undefined" && (e = null), Globalize.findClosestCulture(e || this.options.culture) }, n.prototype._isRTL = function () { return !!this._getCulture().isRTL }, n.prototype._initBackground = function (e, n) { typeof e == "undefined" && (e = !1), typeof n == "undefined" && (n = !1); var r, i, s, o, u, a, f = this, l; if (this._isInAnimate) return; this._index = 0, this._datesDef = this._getDatesDefinition(), this._min = 0, this._max = this._datesDef.length - 1, r = ""; for (i = 0; i < this._datesDef.length; i += 1) r += '<div class="wijmo-wijdatepager-pagelabel' + (i === 0 ? " wijmo-wijdatepager-pagelabel-first" : "") + (this._datesDef[i].range ? " wijmo-wijdatepager-pagerange" : "") + (this._datesDef[i].header ? " wijmo-wijdatepager-pageheader ui-state-highlight" : "") + (i === this._datesDef.length - 1 ? " wijmo-wijdatepager-pagelabel-last" : "") + " " + this._getDateClass(this._datesDef[i].d) + '">' + this._datesDef[i].l + "</div>"; o = this.element.find(".wijmo-wijdatepager-pages"), e ? (this._isInAnimate = !0, s = o.clone(!0), o.html(r), u = o.find(".wijmo-wijdatepager-pagelabel"), n ? (s.insertAfter(o), a = t(u[this._index]).offset().left, o.css("opacity", 0).css("left", -s.outerWidth(!0)).stop().animate({ left: "0px", opacity: 100 }), s.css("left", 0).stop().animate({ left: s.outerWidth(!0) + "px", opacity: 0 }, function () { s.remove(), f._isInAnimate = !1, f.invalidate() })) : (s.insertBefore(o), a = t(u[this._index]).offset().left, o.css("opacity", 0).css("left", s.outerWidth(!0)).stop().animate({ left: "0px", opacity: 100 }), s.stop().animate({ left: "-" + s.outerWidth(!0) + "px", opacity: 0 }, function () { s.remove(), f._isInAnimate = !1, f.invalidate() }))) : (o.html(r), this.invalidate()), u = o.find(".wijmo-wijdatepager-pagelabel"), u.hover(t.proxy(this._pagelabelHover, this), t.proxy(this._pagelabelHout, this)), u.bind("mousedown", t.proxy(this._pagelabelMouseDown, this)), u.click(t.proxy(function (e) { var n = t(e.target), r; r = this.element.find(".wijmo-wijdatepager-pagelabel").index(n), this._setSelectedIndex(r) }, this)) }, n.prototype._getDateClass = function (e) { return "c1dt" + e.getFullYear() + "_" + e.getMonth() + "_" + e.getDate() }, n.prototype._addDays = function (e, t) { return new Date(e.getFullYear(), e.getMonth(), e.getDate() + t) }, n.prototype._getDatesDefinition = function () { var e = this.options, t = e.viewType.toLowerCase(), n, r, i, s, o, u = [], a = e.selectedDate; switch (t) { case "week": i = new Date(a.getFullYear(), a.getMonth(), -6), n = e.firstDayOfWeek - i.getDay(), Math.abs(n) > 6 && (n = i.getDay() - e.firstDayOfWeek), i = this._addDays(i, n), o = new Date(a.getFullYear(), a.getMonth() + 1, 7), n = 0; while (i < o || i.getMonth() === a.getMonth()) s = this._addDays(i, 7), u.push({ l: this._formatString(this.localizeString("weekViewLabelFormat", "{0:MMM dd}-{1:dd}"), i, this._addDays(i, 6)), d: i, d2: this._addDays(i, 6) }), a >= i && a <= s && (this._index = n), i = s, n += 1; break; case "month": r = new Date(a.getFullYear() - 1, 0, 1), u.push({ l: r.getFullYear(), d: r, range: !0 }), r = new Date(a.getFullYear(), 0, 1), u.push({ l: r.getFullYear(), d: r, header: !0 }); for (n = 0; n < 12; n += 1) r = new Date(a.getFullYear(), n, 1), u.push({ l: this._formatString(this.localizeString("monthViewLabelFormat", "{0:MMM}"), r), d: r }), s = new Date(a.getFullYear(), n + 1, 1), a >= r && a <= s && (this._index = n + 2); r = new Date(a.getFullYear() + 1, 0, 1), u.push({ l: r.getFullYear(), d: r, range: !0 }); break; default: r = new Date(a.getFullYear(), a.getMonth(), 0), u.push({ l: Globalize.format(r, "MMM", this._getCulture()), d: r, range: !0 }), r = new Date(a.getFullYear(), a.getMonth(), 1), u.push({ l: Globalize.format(r, "MMM", this._getCulture()), d: r, header: !0 }), i = r, n = 2; while (i.getMonth() === a.getMonth()) s = new Date(i.getFullYear(), i.getMonth(), i.getDate() + 1), u.push({ l: this._formatString(this.localizeString("dayViewLabelFormat", "{0:d }"), i), d: i }), a >= i && a <= s && (this._index = n), i = s, n += 1; r = new Date(a.getFullYear(), a.getMonth() + 1, 1), u.push({ l: Globalize.format(r, "MMM", this._getCulture()), d: r, range: !0 }) } return u }, n.prototype._setSelectedIndex = function (e, t) { typeof t == "undefined" && (t = !1); var n = this.options, r; if (n.disabled) return; if (e >= this._min && e <= this._max) { this._dragActivated && this._showTooltip(e); if (this._index !== e) { if (this._datesDef[e].header) { if (!t) return; e -= 1 } this._index = e, r = this._datesDef[e].d, n.selectedDate = r, this._max > 2 && this._index === 0 ? this._initBackground(!0, !0) : this._index === this._max ? (n.viewType === "week" && (n.selectedDate = new Date(n.selectedDate.getFullYear(), n.selectedDate.getMonth(), n.selectedDate.getDate() + 7)), this._initBackground(!0, !1), n.selectedDate = r) : this.invalidate(), this._trigger("selectedDateChanged", null, { selectedDate: n.selectedDate }) } } }, n.prototype._pagelabelHover = function (e) { var n = t(e.target), r = this.options; if (n.hasClass("wijmo-wijdatepager-pageheader")) return; n.addClass(r.wijCSS.stateHover) }, n.prototype._showTooltip = function (e) { var n = this.options, r = this._datesDef[e], i = n.viewType, s, o = this.element.find(".wijmo-wijdatepager-pagelabel")[e]; this._tooltip || (this._tooltip = t('<div class="wijmo-wijdatepager-tooltip"><div class="wijmo-wijdatepager-tooltip-inner"></div><div class="wijmo-wijdatepager-triangle"></div></div>'), this.element.append(this._tooltip), this._tooltip.wijpopup()), s = ""; switch (i) { case "week": r.d.getMonth() !== r.d2.getMonth() ? s = this._formatString(this.localizeString("weekViewTooltip2MonthesFormat", "{0:MMMM d} - {1:MMMM d, yyyy}"), r.d, r.d2) : s = this._formatString(this.localizeString("weekViewTooltipFormat", "{0:MMMM d} - {1:d, yyyy}"), r.d, r.d2); break; case "month": s = this._formatString(this.localizeString("monthViewTooltipFormat", "{0:MMMM yyyy}"), r.d); break; default: s = this._formatString(this.localizeString("dayViewTooltipFormat", "{0:dddd, MMMM d, yyyy}"), r.d) } t.ui && (this._tooltip.wijpopup("show", { of: o, my: "center bottom", at: "center top", offset: "-10 -10" }), this._tooltip.find(".wijmo-wijdatepager-tooltip-inner").html(s)) }, n.prototype._hideTooltip = function () { this._tooltip.wijpopup("hide") }, n.prototype._pagelabelHout = function (e) { t(e.target).removeClass(this.options.wijCSS.stateHover) }, n.prototype._pagelabelMouseDown = function (e) { this._dragActivated = !1; if (this.options.disabled) return; e.preventDefault(); var n = t(e.target), r; if (n.hasClass("wijmo-wijdatepager-pageheader")) return; r = this.element.find(".wijmo-wijdatepager-pagelabel").index(n), this._dragActivated = !0, this._setSelectedIndex(r), this._mouseDownTimeFix20555 = (new Date).getTime(), this._startClientX = e.pageX, this._startInd = r, t(document).bind("mousemove." + this._dtpagernamespacekey, t.proxy(this._pageindicatorMouseMove, this)), t(document).bind("mouseup." + this._dtpagernamespacekey, t.proxy(this._pageindicatorMouseUp, this)) }, n.prototype._detectLeftButton = function (e) { return e.originalEvent && (e = e.originalEvent), "buttons" in e ? e.buttons === 1 : "which" in e ? e.which === 1 : e.button === 1 }, n.prototype._pageindicatorMouseMove = function (e) { if (!this._detectLeftButton(e)) { this._pageindicatorMouseUp(); return } e.preventDefault(); if (this._isInAnimate) return; var t = this.element.find(".wijmo-wijdatepager-pagelabel")[this._startInd], n, r; if (!t) return; n = t.offsetLeft + Math.round(t.offsetWidth / 2) + (e.pageX - this._startClientX), r = this._findClosesPageIndexByPos(n); if (this._prevMoveInd === r) return; this._prevMoveInd = r; if (this._mouseDownTimeFix20555 + 150 > (new Date).getTime()) return; r !== -1 && r !== this._index && this._setSelectedIndex(r) }, n.prototype._pageindicatorMouseUp = function () { this._dragActivated = !1, t(document).unbind("." + this._dtpagernamespacekey), this._hideTooltip() }, n.prototype._findClosesPageIndexByPos = function (e) { var t = this.element.find(".wijmo-wijdatepager-pages").find(".wijmo-wijdatepager-pagelabel"), n; for (n = 0; n < t.length; n += 1) if (t[n].offsetLeft < e && t[n].offsetLeft + t[n].offsetWidth > e) return n; return -1 }, n.prototype.localizeString = function (e, t) { var n = this.options; return n.localization && n.localization[e] ? n.localization[e] : t }, n.prototype._formatString = function (e, t, n, r) { var i, s = arguments, o, u, a = this; if (s.length <= 1) return Globalize.format(s); typeof e == "string" && typeof window[e] == "function" && (e = window[e]); if (typeof e == "function") { u = []; for (o = 1; o < s.length; o += 1) u[o - 1] = s[o]; return e.apply(this, u) } return i = new RegExp("\\{(\\d+)(?:,([-+]?\\d+))?(?:\\:([^(^}]+)(?:\\(((?:\\\\\\)|[^)])+)\\)){0,1}){0,1}\\}", "g"), e.replace(i, function (e, t, n, r, i) { return e = s[Number(t) + 1], r ? Globalize.format(e, r, a._getCulture()) : e }) }, n }(e.wijmoWidget); e.wijdatepager = r; var i = function () { function e() { this.wijMobileCSS = { header: "ui-header ui-bar-a", content: "ui-body ui-body-c", stateDefault: "ui-btn-up-c" }, this.initSelector = ":jqmData(role='wijdatepager')", this.culture = "", this.localization = null, this.firstDayOfWeek = 0, this.selectedDate = null, this.viewType = "day", this.nextTooltip = "right", this.prevTooltip = "left" } return e }(); r.prototype.options = t.extend(!0, {}, e.wijmoWidget.prototype.options, new i), t.wijmo.registerWidget(n, r.prototype) })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; function r(e) { return new Date(e.getFullYear(), e.getMonth(), e.getDate()) } function i() { var e, t, n; e = ""; for (n = 0; n < 32; n += 1) { if (n === 8 || n === 12 || n === 16 || n === 20) e += "-"; t = Math.floor(Math.random() * 16).toString(16).toUpperCase(), e += t } return e } function l(e, t, n) { a ? (f = amplify.store("wijevcal_tables1"), f || (f = {}), f[e] || (f[e] = { fields: t }, amplify.store("wijevcal_tables1", f), amplify.store("wijevcal_tbl_" + e, {})), n && n()) : s && s.transaction(function (r) { r.executeSql("SELECT COUNT(*) FROM " + e, [], function () { n && n() }, function (r, i) { r.executeSql("CREATE TABLE " + e + " " + t, [], n, n) }) }) } function c(e, t, n, r) { var i = { rowsAffected: 0, rows: new Array }, o, u, l, c, h, p, d, v, m, g, y, b, w, E; t || (t = []), i.rows.item || (i.rows.item = function (e) { return this[e] }); if (a) try { l = new RegExp("(SELECT) *(.*) *FROM (\\w+)"), c = new RegExp("(INSERT OR REPLACE|INSERT) *(.*) *INTO *(\\w*) *\\(([\\w|,| ]*)\\)"), h = new RegExp("(DELETE) *(.*) *FROM (\\w+) *(\\w*)WHERE (\\w+)='*([^']+)"); if (e.match(c)) { p = c.exec(e); if (p && p.length > 1) { d = p[3], v = f[d], m = amplify.store("wijevcal_tbl_" + d); if (m) { y = p[4].split(","), o = {}; for (u = 0; u < y.length; u += 1) y[u] && (u === 0 && (m[t[u]] = o), b = y[u].replace(" ", ""), o[b] = t[u]) } amplify.store("wijevcal_tbl_" + d, m) } } else if (e.match(l)) { p = l.exec(e); if (p && p.length > 1) { d = p[3], v = f[d], m = amplify.store("wijevcal_tbl_" + d); if (m) { w = e.replace(l, ""); if (w.toUpperCase().indexOf(" WHERE ") === 0) { w = w.substr(7), E = w.split(" OR "); for (u = 0; u < E.length; u += 1) E[u] = E[u].split("="), w = E[u][1], w.indexOf("'") === 0 ? (w = w.substring(1, w.length - 1), E[u][1] = w) : E[u][1] = parseFloat(w) } for (g in m) if (m.hasOwnProperty(g)) { o = m[g]; if (o) if (E) for (u = 0; u < E.length; u += 1) o[E[u][0]] === E[u][1] && i.rows.push(o); else i.rows.push(o) } } } } else e.match(h) && (p = h.exec(e), p && p.length > 1 && (d = p[3], v = f[d], m = amplify.store("wijevcal_tbl_" + d), m && m[p[6]] && delete m[p[6]], amplify.store("wijevcal_tbl_" + d, m))); n && n(i) } catch (S) { r && r(S) } else { if (!s) { r("Local data storage not found."); return } s.transaction(function (i) { i.executeSql(e, t, function (e, t) { n && n(t) }, function (e, t) { r && r(t.message); return }) }) } } var t = jQuery, n = "wijevcal", s, o = "C1EventsCalendarDB", u = "1.1", a = !1, f, h = function (e) { function n() { e.apply(this, arguments), this._dynIdCounter = 0 } return __extends(n, e), n.prototype._setOption = function (e, n) { var i = this.options; switch (e) { case "dataSource": i.dataSource = n, this._bindDataView(); break; case "eventsData": i.eventsData = n, i.appointments = n, this._onEventsDataChanged(); break; case "appointments": i.eventsData = n, i.appointments = n, this._onEventsDataChanged(); break; case "culture": i.culture = n, this.element.find(".wijmo-wijdatepager").wijdatepager("option", "culture", i.culture), this._editEventDialog && this._editEventDialog.find(".wijmo-wijinput-date").wijinputdate("option", "culture", i.culture), this.element.find(".wijmo-wijcalendar").wijcalendar("option", "culture", i.culture), this._redrawActiveView(); break; case "disabled": i.disabled !== n && (i.disabled = n, this._ensureDisabled()); break; case "enableLogs": i.enableLogs = n, this._initLogPanel(); break; case "selectedDate": n && (n = r(n), i.selectedDates[0].getTime() !== n.getTime() && (i.selectedDates[0] = n, this._onSelectedDatesChanged())); return; case "selectedDates": n && (i.selectedDates = n, this._onSelectedDatesChanged()); return; case "statusBarVisible": i.statusBarVisible = n, this._initStatusbar(), this.invalidate(); return; case "headerBarVisible": i.headerBarVisible = n, this._initHeaderbar(), this.invalidate(); return; case "navigationBarVisible": i.navigationBarVisible = n, this._initNavigationbar(), this.invalidate(); return; case "rightPaneVisible": i.rightPaneVisible = n, this._initRightPane(), this.invalidate(); return; case "timeInterval": i.timeInterval !== n && (i.timeInterval = n, this._redrawActiveView()); break; case "timeIntervalHeight": i.timeIntervalHeight !== n && (i.timeIntervalHeight = n, this._redrawActiveView()); break; case "timeRulerInterval": i.timeRulerInterval !== n && (i.timeRulerInterval = n, this._redrawActiveView()); break; case "viewType": i.viewType !== n && (i.viewType = n, this._onViewTypeChanged()); break; default: } t.wijmo.widget.prototype._setOption.apply(this, arguments) }, n.prototype._ensureDisabled = function () { var e = this.options; if (e.disabled) { this.element.addClass(e.wijCSS.stateDisabled); try { this.element.find(".wijmo-wijcalendar").wijcalendar("option", "disabled", !0), this.element.find(".wijmo-wijsuperpanel").wijsuperpanel("option", "disabled", !0), this.element.find(".wijmo-wijdatepager").wijdatepager("option", "disabled", !0), t().buttonset && this.element.find(".ui-buttonset").buttonset("option", "disabled", !0), this.element.find(".wijmo-wijev-today.ui-button").button("option", "disabled", !0) } catch (n) { this.log(n, "error") } this._unbindEvents() } else { this.element.removeClass(e.wijCSS.stateDisabled); try { this.element.find(".wijmo-wijcalendar").wijcalendar("option", "disabled", !1), this.element.find(".wijmo-wijsuperpanel").wijsuperpanel("option", "disabled", !1), this.element.find(".wijmo-wijdatepager").wijdatepager("option", "disabled", !1), t().buttonset && this.element.find(".ui-buttonset").buttonset("option", "disabled", !1), this.element.find(".wijmo-wijev-today.ui-button").button("option", "disabled", !1) } catch (n) { this.log(n, "error") } this._bindEvents(), this._updateTitleText() } }, n.prototype._onViewTypeChanged = function () { this._renderActiveView(), this._updateTitleText(), this._trigger("viewTypeChanged", null, this.options.viewType), this.element.find(".wijmo-wijev-datepager").wijdatepager("option", "viewType", this.options.viewType) }, n.prototype._onSelectedDatesChanged = function () { var e = this.options; e.selectedDate = e.selectedDates[0], this.element.find(".wijmo-wijev-datepager").wijdatepager("option", "selectedDate", e.selectedDate), this._trigger("selectedDatesChanged", null, { selectedDates: e.selectedDates }), this._renderActiveView(), this._updateTitleText() }, n.prototype._updateHeaderTitleText = function () { var e = this.options, t = e.titleFormat, n = e.selectedDates[0], r = e.selectedDates[e.selectedDates.length - 1]; if (t[e.viewType]) t = t[e.viewType]; else { if (t[e.viewType] === !1) { this.element.find(".wijmo-wijev-view .wijmo-wijev-header-title").hide(); return } t = t.toString() } e.viewType === "list" && (r = this._addDays(n, 14)), this.element.find(".wijmo-wijev-view .wijmo-wijev-header-title").show().html(this._formatString(t, n, r)) }, n.prototype._updateTitleText = function () { var e = this.options, n = e.selectedDates[0], r = e.selectedDates[e.selectedDates.length - 1], i = new Date, s = !1; s = this._compareDayDates(n, i) === 0 || n < i && r > i, t.mobile == null && this.element.find(".wijmo-wijev-navigationbar .wijmo-wijev-today").button("option", "disabled", s), this._updateHeaderTitleText() }, n.prototype.localizeString = function (e, t) { var n = this.options; return n.localization && n.localization[e] ? n.localization[e] : t }, n.prototype._create = function () { window.wijmoApplyWijTouchUtilEvents && (t = window.wijmoApplyWijTouchUtilEvents(t)), t.isFunction(window.wijmoASPNetParseOptions) && window.wijmoASPNetParseOptions(this.options); var e, n, r = this.options; r.colors || (r.colors = ["red", "darkorchid", "green", "blue", "cornflowerblue", "yellow", "bronze"]), this.wijevcalnamespacekey || (this.wijevcalnamespacekey = "wijevcal" + (new Date).getTime()), this.element[0].id || (this.element[0].id = "wijevcal_dynid_" + (new Date).getTime()), this._uidPref = this.element[0].id + "evcdynid", this.element.addClass("wijmo-wijevcal wijmo-wijev " + r.wijCSS.widget + " ui-helper-reset " + r.wijCSS.stateDefault), t('<div class="wijmo-wijev-headerbar ui-widget-header ui-corner-top"><fieldset class="wijmo-wijev-tools"><input id="' + this._uidPref + '_daybtn" name="viewselection"' + ' type="radio" class="wijmo-wijev-day" />' + '<label for="' + this._uidPref + '_daybtn">' + this.localizeString("buttonDayView", "Day") + "</label>" + '<input id="' + this._uidPref + '_weekbtn" name="viewselection"' + ' type="radio" class="wijmo-wijev-week" />' + '<label for="' + this._uidPref + '_weekbtn">' + this.localizeString("buttonWeekView", "Week") + "</label>" + '<input id="' + this._uidPref + '_monthbtn" name="viewselection"' + ' type="radio" class="wijmo-wijev-month" />' + '<label for="' + this._uidPref + '_monthbtn">' + this.localizeString("buttonMonthView", "Month") + "</label>" + '<input id="' + this._uidPref + '_listbtn" name="viewselection"' + ' type="radio" class="wijmo-wijev-list" />' + '<label for="' + this._uidPref + '_listbtn">' + this.localizeString("buttonListView", "List") + "</label>" + "</fieldset>" + "</div>").appendTo(this.element), t('<div class="wijmo-wijev-view-container"><div class="wijmo-wijev-leftpane wijmo-wijev-viewdetails ' + r.wijCSS.content + ' wijmo-wijev-day-details">' + '<div class="wijmo-wijev-leftpane-inner">' + '<div class="wijmo-wijev-daycalendar"></div>' + '<div class="wijmo-wijev-monthday-container">' + '<div class="wijmo-wijev-monthday-label">...</div>' + '<div class="wijmo-wijev-fulldate-label">' + this.localizeString("activityLoading", "Loading...") + "</div>" + '<div class="wijmo-wijev-year-label">...</div>' + "</div>" + '<div class="wijmo-wijev-agenda-container ' + r.wijCSS.content + " " + r.wijCSS.cornerAll + " ui-helper-clearfix" + '"></div>' + "</div>" + "</div>" + '<div class="wijmo-wijev-leftpane wijmo-wijev-viewdetails ' + r.wijCSS.content + ' wijmo-wijev-list-details">' + '<div class="wijmo-wijev-leftpane-inner">' + '<div class="wijmo-wijev-agenda-container ' + r.wijCSS.content + " " + r.wijCSS.cornerAll + ' ui-helper-clearfix">&nbsp;' + "</div>" + "</div>" + "</div>" + '<div class="wijmo-wijev-rightpane">' + "&nbsp;</div>" + "</div>").appendTo(this.element), t('<div class="wijmo-wijev-loading-modal-frame"></div><div class="wijmo-wijev-loading"><div class="wijmo-wijev-loading-text">' + this.localizeString("activityLoading", "Loading...") + "</div></div>").appendTo(this.element), t('<div class="wijmo-wijev-navigationbar ui-widget-header ui-corner-bottom ui-helper-clearfix"><a class="wijmo-wijev-today">' + this.localizeString("buttonToday", "today") + "</a>" + '<div class="wijmo-wijev-datepager">' + "</div>" + "</div>").appendTo(this.element), t('<div class="wijmo-wijev-statusbar ui-widget-header ui-corner-bottom"></div>').appendTo(this.element), e = this.element.find(".wijmo-wijev-navigationbar"), n = this.element.find(".wijmo-wijev-headerbar .wijmo-wijev-tools"), e.find(".wijmo-wijev-today").button({ text: this.localizeString("buttonToday", "today") }).click(t.proxy(this._onTodayClick, this)), this.element.find(".wijmo-wijev-datepager").wijdatepager({ selectedDate: r.selectedDate, localization: r.datePagerLocalization, culture: r.culture, viewType: r.viewType, nextTooltip: this.localizeString("navigatorBarNextTooltip", "right"), prevTooltip: this.localizeString("navigatorBarPrevTooltip", "left"), firstDayOfWeek: r.firstDayOfWeek, selectedDateChanged: t.proxy(function (e, t) { this.goToDate(t.selectedDate) }, this) }), t.mobile == null ? (n.find(".wijmo-wijev-day").button(), n.find(".wijmo-wijev-week").button(), n.find(".wijmo-wijev-month").button(), n.find(".wijmo-wijev-list").button(), n.buttonset()) : (n.attr("data-role", "controlgroup"), n.attr("data-type", "horizontal"), n.parent().trigger("create"), n.controlgroup("refresh")), n.find(".wijmo-wijev-day").click(t.proxy(this._onDayViewClick, this)), n.find(".wijmo-wijev-week").click(t.proxy(this._onWeekViewClick, this)), n.find(".wijmo-wijev-month").click(t.proxy(this._onMonthViewClick, this)), n.find(".wijmo-wijev-list").click(t.proxy(this._onListViewClick, this)), this.showLoadingLabel() }, n.prototype.showLoadingLabel = function (e, t) { e === !1 ? this.element.find(".wijmo-wijev-loading-text").hide() : (this.element.find(".wijmo-wijev-loading-text").show(), e || (e = this.localizeString("activityLoading", "Loading..."))), (t === undefined || t === !0) && this.element.find(".wijmo-wijev-loading-modal-frame").show(), this.element.find(".wijmo-wijev-loading").show(), this.element.find(".wijmo-wijev-loading-text").html(e) }, n.prototype.hideLoadingLabel = function () { this.element.find(".wijmo-wijev-loading-modal-frame").hide(), this.element.find(".wijmo-wijev-loading").hide() }, n.prototype._init = function () { var e = this.options; e.selectedDates && e.selectedDates.length > 0 ? e.selectedDate = e.selectedDates[0] = r(e.selectedDates[0]) : e.selectedDate ? (e.selectedDate = r(e.selectedDate), e.selectedDates || (e.selectedDates = []), e.selectedDates[0] = e.selectedDate) : (e.selectedDate = r(new Date), e.selectedDates = [e.selectedDate]), e.disabled && this.element.addClass(e.wijCSS.stateDisabled), this._initHeaderbar(), this._initNavigationbar(), this._initStatusbar(), this._initRightPane(), e.fullScreen && this._onFullScreenModeChanged(e.fullScreen), this._initLogPanel(), this._initLocalDataStorage(), this.element.ajaxError(jQuery.proxy(this._onAjaxError, this)), t(window).bind("resize." + this.wijevcalnamespacekey, t.proxy(this._onWindowResize, this)), this._renderActiveView(), this._bindDataView() }, n.prototype._onFullScreenModeChanged = function (e) { }, n.prototype._isDataViewLoaded = function (e) { return e && (e.isLoaded() || e.count() > 0) }, n.prototype._isDataview = function (e) { if (e && typeof e == "object" && !t.isArray(e)) return !0 }, n.prototype._getDataViewInst = function () { return this.element.data("wijdataview") }, n.prototype._bindDataView = function () { var e = this.options, t = e.dataSource, t, n = this; !t && this._getDataViewInst() && (t = this._getDataViewInst(), t = e.dataSource = t), t && this._isDataview(t) ? this._isDataViewLoaded(t) ? (this._dataView = t, this._setOption("eventsData", t.toArray())) : t.element.bind("dataloaded", function () { n._dataView = t, n._setOption("eventsData", t.toArray()) }) : this._dataView = null }, n.prototype._initLocalDataStorage = function () { try { if (window.amplify && window.amplify.store) try { f = amplify.store("wijevcal_tables1"), a = !0, this.log("Using amplify.store for the local data storage") } catch (e) { this.log("amplify.store exception:" + e), this._loadData(); return } else { if (!window.openDatabase) { this.log(this.localizeString("logCouldntOpenLocalStorage", "Couldn't open built-in local data storage. Please, add amplify.store references.")), this._loadData(); return } try { s = window.openDatabase(o, u, "Wijmo Events Calendar Offline DB", 2e5) } catch (n) { this.log("web sql database error: " + n), this._loadData(); return } if (!s) { this.log("Failed to open the database on disk. This is probably because the version was bad or there is not enough space left in this domain's quota"), this._loadData(); return } this.log("Using Web SQL Database for the local data storage.") } l("calendars", "(id TEXT PRIMARY KEY, name TEXT, location TEXT, description TEXT, color TEXT, tag TEXT)"), l("events", "(id TEXT PRIMARY KEY, calendar TEXT, subject TEXT, location TEXT, start TIMESTAMP, end TIMESTAMP, description TEXT, color TEXT, allday INTEGER, properties TEXT, tag TEXT)", t.proxy(this._loadData, this)) } catch (r) { this.log("local datastorage initialization error:" + r) } }, n.prototype._initStatusbar = function () { var e = this.element.find(".wijmo-wijev-statusbar"); if (!this.options.statusBarVisible) { e.hide(); return } e.show(); if (this.statusbarEventsAdded) return !0; this.statusbarEventsAdded = !0 }, n.prototype._initHeaderbar = function () { var e = this.element.find(".wijmo-wijev-headerbar"); if (!this.options.headerBarVisible) { e.hide(); return } e.show() }, n.prototype._initNavigationbar = function () { var e = this.element.find(".wijmo-wijev-navigationbar"); if (!this.options.navigationBarVisible) { e.hide(); return } e.show() }, n.prototype._initRightPane = function () { var e = this.element.find(".wijmo-wijev-rightpane"); if (!this.options.rightPaneVisible) { e.hide(); return } e.show() }, n.prototype._initLogPanel = function () { this.options.enableLogs ? (this._createLogPanel(), this.log = this._log) : (this.logDialog && this.logDialog.wijdialog("close"), this.log = function () { }) }, n.prototype._handleServerError = function (e) { return e && e.toString().indexOf("error:") === 0 ? (this.status(e.toString(), "error"), !0) : !1 }, n.prototype._loadData = function () { var e = this.options, n = this, r, i, s, o, u, a, f, l, h, p; this.showLoadingLabel(), p = function (e) { n.hideLoadingLabel() }, e.calendars = [], u = this._calendarsById = {}, l = function (t) { if (!t) return; if (typeof t == "string") { if (n._handleServerError(t)) { p(t); return } try { t = n._jsonParse(t) } catch (i) { n.status("Unable to parse received calendars data. " + i, "error"); return } } t.calendars && t.calendars.length && (t = t.calendars); for (r = 0; r < t.length; r += 1) s = n._cloneObj(t[r]), s.prevData = n._cloneObj(s), e.calendars.push(s), u[s.id] = s; n._onCalendarsChanged() }, e.dataStorage.loadCalendars ? e.dataStorage.loadCalendars(l, p) : e.webServiceUrl ? t.getJSON(e.webServiceUrl + "?clientId=" + this.element[0].id + "&command=loadCalendars" + "&calendars=" + e.calendars, l) : c("SELECT * FROM calendars", [], function (t) { for (r = 0, i = t.rows.length; r < i; r += 1) s = n._cloneObj(t.rows.item(r)), s.prevData = n._cloneObj(s), e.calendars.push(s), u[s.id] = s; n._onCalendarsChanged() }, p), this._dataView ? e.eventsData = this._dataView.toArray() : e.eventsData = [], this._eventsDataById ? a = this._eventsDataById : a = this._eventsDataById = {}, h = function (e) { if (!e) return; if (typeof e == "string") { if (n._handleServerError(e)) { p(e); return } try { e = n._jsonParse(e) } catch (t) { n.log("Unable to parse received calendars data. " + t); return } } e.events && e.events.length && (e = e.events); for (r = 0; r < e.length; r += 1) o = n._readEventData(e[r]), n._storeEventWithSort(o); n._onEventsDataChanged(), n._onInitialized() }; if (e.dataStorage.loadEvents) e.dataStorage.loadEvents(e.visibleCalendars, h, p); else if (e.webServiceUrl) t.ajax({ url: e.webServiceUrl + "?clientId=" + this.element[0].id + "&command=loadEvents&timestamp=" + (new Date).getTime(), dataType: "text", cache: !1, contentType: "application/json; charset=utf-8", type: "POST", success: h, error: p }); else { if (this._dataView) { this._onInitialized(); return } f = "SELECT * FROM events where "; for (r = 0; r < e.visibleCalendars.length; r += 1) r > 0 && (f += " OR "), f += "calendar='" + e.visibleCalendars[r] + "'"; c(f, [], function (e) { for (r = 0, i = e.rows.length; r < i; r += 1) o = n._readEventData(e.rows.item(r)), n._storeEventWithSort(o); n._onEventsDataChanged(), n._onInitialized() }, p) } }, n.prototype._onInitialized = function () { this._ensureDisabled(), this.hideLoadingLabel(), this._trigger("initialized") }, n.prototype._readEventData = function (e) { var t = this._cloneObj(e); return t.start = new Date(t.start), t.end = new Date(t.end), typeof t.allday == "string" && (t.allday === "false" && (t.allday = !1), t.allday === "true" && (t.allday = !0)), t.start.getTime() >= t.end.getTime() && (t.end = this._addMinutes(t.start, this.options.timeInterval)), this._deSerializeProperties(t.properties, t), t.prevData = this._cloneObj(t), t }, n.prototype._prepareEventsForView = function () { this._eventsView = this.getOccurrences() }, n.prototype._cloneObj = function (e) { var t = {}, n; for (n in e) e.hasOwnProperty(n) && (t[n] = e[n]); return t }, n.prototype._onDayViewClick = function () { var e = this.options; e.viewType !== "day" && (e.viewType = "day", this._onViewTypeChanged()), e.selectedDates = [e.selectedDate], this._onSelectedDatesChanged() }, n.prototype._onWeekViewClick = function () { var e = this.options, t, n, r; e.viewType !== "week" && (e.viewType = "week", this._onViewTypeChanged()), t = e.selectedDate, r = e.firstDayOfWeek - t.getDay(), Math.abs(r) > 6 && (r = t.getDay() - e.firstDayOfWeek), t = this._addDays(t, r), e.selectedDates = []; for (r = 0; r < 7; r += 1) n = this._addDays(t, r), e.selectedDates.push(n); this._onSelectedDatesChanged() }, n.prototype._onMonthViewClick = function () { var e = this.options; e.viewType !== "month" && (e.viewType = "month", this._onViewTypeChanged()) }, n.prototype._onListViewClick = function () { var e = this.options; e.viewType !== "list" && (e.viewType = "list", this._onViewTypeChanged()), e.selectedDates = [e.selectedDate], this._onSelectedDatesChanged() }, n.prototype._ensureEditCalendarDialogCreated = function () { var e = this.options, n, r = {}; this._editCalendarDialog || (n = e.editCalendarTemplate, n || (n = "<p><label>" + this.localizeString("labelCalendarName", "Calendar name") + "</label>" + '<input type="text" class="wijmo-wijev-name" value=""> ' + '<div class="wijmo-wijev-color-button">' + '<div class="wijmo-wijev-color ui-wijmo-wijev-event-color-default">&nbsp;</div>' + "</div>" + "</p>" + "<p><label>" + this.localizeString("labelLocation", "Location") + "</label>" + '<input type="text" class="wijmo-wijev-location" value=""></p>' + "<p><label>" + this.localizeString("labelDescription", "Description") + '</label><textarea class="wijmo-wijev-description" /></p>'), this._editCalendarDialog = t('<div class="wijmo-wijev-editcalendar-dialog">' + n + "</div>"), this.element.append(this._editCalendarDialog), r[this.localizeString("buttonSave", "Save")] = t.proxy(function () { try { var e = this._validateAndReadCalendarDialogFields(this._editCalendarDialog); e.prevData ? this.updateCalendar(e) : this.addCalendar(e), this._editCalendarDialog.wijdialog("close") } catch (t) { alert(t) } }, this), this._editCalendarDialog.wijdialog({ autoOpen: !0, height: 340, width: 440, modal: !0, title: this.localizeString("titleEditCalendar", "Edit calendar"), buttons: r, captionButtons: { pin: { visible: !1 }, refresh: { visible: !1 }, toggle: { visible: !1 }, minimize: { visible: !1 }, maximize: { visible: !1 } } }), this._editCalendarDialog.find(".wijmo-wijev-name, .wijmo-wijev-location, .wijmo-wijev-description").wijtextbox(), this._editCalendarDialog.find(".wijmo-wijev-color-button").button({ icons: { primary: "ui-icon-triangle-1-s" } }).click(t.proxy(this._onColorButtonClick, { dlg: this._editCalendarDialog, self: this }))) }, n.prototype._ensureEditEventDialogCreated = function () { var e = this.options, n; this._editEventDialog || (n = this.options.editEventDialogTemplate, n || (n = '<div class="wijmo-wijev-event-dialog ' + this.options.wijCSS.content + " " + e.wijCSS.cornerAll + '">' + '<ul class="wijmo-wijev-brief-content">' + "<li><label>" + this.localizeString("labelName", "name") + "</label>" + '<input type="text" name="subject" class="wijmo-wijev-subject" value="">' + '<div class="wijmo-wijev-color-button">' + '<div class="wijmo-wijev-color ui-wijmo-wijev-event-color-default">&nbsp;</div>' + "</div>" + "</li>" + '<li><label for="' + this._uidPref + '_alldaybtn">' + this.localizeString("labelAllDay", "all-day") + "</label>" + '<input type="checkbox" class="wijmo-wijev-allday" id="' + this._uidPref + '_alldaybtn" />' + "</li>" + "<li><label>" + this.localizeString("labelStarts", "Starts") + "</label>" + '<input type="text" class="wijmo-wijev-start" value="">' + '<input type="text" class="wijmo-wijev-start-time" value="">' + "</li>" + "<li><label>" + this.localizeString("labelEnds", "Ends") + "</label>" + '<input type="text" class="wijmo-wijev-end" value="">' + '<input type="text" class="wijmo-wijev-end-time" value="">' + "</li>" + "</ul>" + '<ul class="wijmo-wijev-detailed-content ' + e.wijCSS.cornerAll + '">' + "<li><label>" + this.localizeString("labelLocation", "Location") + "</label>" + '<input type="text" class="wijmo-wijev-location" value=""></li>' + "<li><label>" + this.localizeString("labelRepeat", "Repeat") + "</label>" + '<select class="wijmo-wijev-repeat">' + '<option value="none">' + this.localizeString("repeatNone", "None") + "</option>" + '<option value="daily">' + this.localizeString("repeatDaily", "Every Day") + "</option>" + '<option value="workdays">' + this.localizeString("repeatWorkDays", "Work days") + "</option>" + '<option value="weekly">' + this.localizeString("repeatWeekly", "Every Week") + "</option>" + '<option value="monthly">' + this.localizeString("repeatMonthly", "Every Month") + "</option>" + '<option value="yearly">' + this.localizeString("repeatYearly", "Every Year") + "</option>" + "</select></li>" + "<li><label>" + this.localizeString("labelCalendar", "Calendar") + "</label>" + '<select class="wijmo-wijev-calendar"></select></li>' + '<li class="wijmo-wijev-description-item"><label>' + this.localizeString("labelDescription", "Description") + "</label>" + '<textarea class="wijmo-wijev-description" /></li>' + "</ul>" + '<div class="footer">' + '<a href="#" class="wijmo-wijev-delete">' + this.localizeString("buttonDelete", "Delete") + "</a>" + '<a href="#" class="wijmo-wijev-save">' + this.localizeString("buttonOK", "OK") + "</a>" + '<a href="#" class="wijmo-wijev-cancel">' + this.localizeString("buttonCancel", "Cancel") + "</a>" + "</div>" + '<div class="wijmo-wijev-angle"></div>' + "</div>"), this._editEventDialog = t(n), this.element.append(this._editEventDialog), this._editEventDialog.find(".wijmo-wijev-color-button").button({ icons: { primary: "ui-icon-triangle-1-s" } }).click(t.proxy(this._onColorButtonClick, { dlg: this._editEventDialog, self: this })), this._editEventDialog.find(".wijmo-wijev-delete").button().click(t.proxy(function () { this.deleteEvent(this._editEventDialog.appt), this._editEventDialog.wijpopup("hide") }, this)), this._editEventDialog.find(".wijmo-wijev-cancel").button().click(t.proxy(function (e) { this._editEventDialog.wijpopup("hide"), e.preventDefault() }, this)), this._editEventDialog.find(".wijmo-wijev-start").width(114).wijinputdate({ culture: this.options.culture, titleFormat: this.localizeString("calendarTitleFormat", "MMMM yyyy"), toolTipFormat: this.localizeString("calendarToolTipFormat", "dddd, MMMM dd, yyyy"), nextTooltip: this.localizeString("calendarNextTooltip", "Next"), prevTooltip: this.localizeString("calendarPrevTooltip", "Previous"), showTrigger: !0, dateFormat: "d", dateChanged: t.proxy(function (e, t) { var n = this._editEventDialog.find(".wijmo-wijev-end").wijinputdate("option", "date"); t.date > n && this._editEventDialog.find(".wijmo-wijev-end").wijinputdate("option", "date", t.date) }, this) }), this._editEventDialog.find(".wijmo-wijev-start-time").width(80).wijinputdate({ culture: this.options.culture, titleFormat: this.localizeString("calendarTitleFormat", "MMMM yyyy"), toolTipFormat: this.localizeString("calendarToolTipFormat", "dddd, MMMM dd, yyyy"), nextTooltip: this.localizeString("calendarNextTooltip", "Next"), prevTooltip: this.localizeString("calendarPrevTooltip", "Previous"), dateFormat: "t", dateChanged: t.proxy(function (e, t) { var n = this._editEventDialog.find(".wijmo-wijev-end-time").wijinputdate("option", "date"), r = this._editEventDialog.find(".wijmo-wijev-start").wijinputdate("option", "date"); t.date.getDate() !== r.getDate() && (t.date.setDate(r.getDate()), this._editEventDialog.find(".wijmo-wijev-start-time").wijinputdate("option", "date", t.date)), t.date > n && this._editEventDialog.find(".wijmo-wijev-end-time").wijinputdate("option", "date", t.date) }, this) }), this._editEventDialog.find(".wijmo-wijev-end").width(114).wijinputdate({ culture: this.options.culture, titleFormat: this.localizeString("calendarTitleFormat", "MMMM yyyy"), toolTipFormat: this.localizeString("calendarToolTipFormat", "dddd, MMMM dd, yyyy"), nextTooltip: this.localizeString("calendarNextTooltip", "Next"), prevTooltip: this.localizeString("calendarPrevTooltip", "Previous"), showTrigger: !0, dateFormat: "d", dateChanged: t.proxy(function (e, t) { var n = this._editEventDialog.find(".wijmo-wijev-start").wijinputdate("option", "date"); t.date < n && this._editEventDialog.find(".wijmo-wijev-start").wijinputdate("option", "date", t.date) }, this) }), this._editEventDialog.find(".wijmo-wijev-end-time").width(80).wijinputdate({ culture: this.options.culture, titleFormat: this.localizeString("calendarTitleFormat", "MMMM yyyy"), toolTipFormat: this.localizeString("calendarToolTipFormat", "dddd, MMMM dd, yyyy"), nextTooltip: this.localizeString("calendarNextTooltip", "Next"), prevTooltip: this.localizeString("calendarPrevTooltip", "Previous"), dateFormat: "t" }), this._editEventDialog.find(".wijmo-wijev-allday").wijcheckbox().change(t.proxy(this._eventDialogEnsureTimePartState, this)), this._editEventDialog.find(".wijmo-wijev-subject,.wijmo-wijev-location,.wijmo-wijev-description").wijtextbox(), this._editEventDialog.find(".wijmo-wijev-save").button().click(t.proxy(function (e) { try { var t = this._validateAndReadApptDialogFields(this._editEventDialog); t.prevData ? this.updateEvent(t) : this.addEvent(t), this._editEventDialog.wijpopup("hide") } catch (n) { alert(n) } }, this)), this._editEventDialog.wijpopup({ autoHide: !0, hiding: t.proxy(function (e) { this._colorMenu && this._colorMenu.wijpopup("hide"), this.element.find(".wijmo-wijev-dayview .ui-selected").removeClass("ui-selected") }, this), shown: t.proxy(function (e) { var t = this; this._dropDownInitialized ? (this._editEventDialog.find(".wijmo-wijev-calendar").wijdropdown("refresh"), this._editEventDialog.find(".wijmo-wijev-repeat").wijdropdown("refresh")) : (this._editEventDialog.find(".wijmo-wijev-calendar").wijdropdown().bind("change", function (e) { var n = t._calendarsById[this.value]; n && n.color ? t._addColorClass(t._editEventDialog.find(".wijmo-wijev-color"), n.color) : t._editEventDialog.appt && t._editEventDialog.appt.color && t._addColorClass(t._editEventDialog.find(".wijmo-wijev-color"), t._editEventDialog.appt.color) }), this._editEventDialog.find(".wijmo-wijev-repeat").wijdropdown().bind("change", function (e) { var n = this.value, r = t._editEventDialog.appt; switch (n) { case "none": r.recurrenceState = null, r.recurrencePattern = null; break; case "daily": r.recurrenceState = "master", r.recurrencePattern = { parentRecurrenceId: r.id, recurrenceType: "daily" }; break; case "workdays": r.recurrenceState = "master", r.recurrencePattern = { parentRecurrenceId: r.id, recurrenceType: "workdays" }; break; case "weekly": r.recurrenceState = "master", r.recurrencePattern = { parentRecurrenceId: r.id, recurrenceType: "weekly" }; break; case "monthly": r.recurrenceState = "master", r.recurrencePattern = { parentRecurrenceId: r.id, recurrenceType: "monthly" }; break; case "yearly": r.recurrenceState = "master", r.recurrencePattern = { parentRecurrenceId: r.id, recurrenceType: "yearly" }; break; case "custom": alert("show custom recurrence pattern.") } }), this._dropDownInitialized = !0), this._onEditEventDialogShown(this._editEventDialog, this._editEventDialog.appt), this._editEventDialog.find(".wijmo-wijev-subject").focus(), this._updateEditEventPopupCallout() }, this) })) }, n.prototype._updateEditEventPopupCallout = function () { if (this._editEventDialog && this._editEventDialog._arrowTarget) { var e = this._editEventDialog, n = t(e._arrowTarget), r = n.offset(), i = e.offset(), s; r.left === i.left ? e.removeClass("wijmo-wijev-rightangle").removeClass("wijmo-wijev-leftangle") : r.left < i.left ? e.removeClass("wijmo-wijev-rightangle").addClass("wijmo-wijev-leftangle") : e.removeClass("wijmo-wijev-leftangle").addClass("wijmo-wijev-rightangle"), s = Math.round(r.top - i.top + n.outerHeight(!0) / 2), this._editEventDialog.find(".wijmo-wijev-angle").css("top", s) } }, n.prototype._onColorButtonClick = function () { var e = this.self, n = this.dlg, r, i = e.options, s = i.colors, o = ""; if (s && s.length > 0) for (r = 0; r < s.length; r += 1) o += '<span class="wijmo-wijev-listcolor wijmo-wijev-event-color-' + s[r] + '">&nbsp;</span>'; n._colorMenu || (n._colorMenu = t('<div class="wijmo-wijev-color-menu ' + i.wijCSS.content + " " + i.wijCSS.cornerAll + '"></div>'), n.append(n._colorMenu), n._colorMenu.wijpopup({ autoHide: !0 })), n._colorMenu.html(o), n._colorMenu.find(".wijmo-wijev-listcolor").click(t.proxy(function (e) { this._addColorClass(n.find(".wijmo-wijev-color"), this._readColorFromClass(t(e.target), "default")), n._colorMenu.wijpopup("hide") }, e)), n._colorMenu.wijpopup("show", { of: n.find(".wijmo-wijev-color-button"), my: "left top", at: "left bottom" }) }, n.prototype._validateAndReadCalendarDialogFields = function (e) { var t = e.cal || {}; t.name = e.find(".wijmo-wijev-name").val(), t.location = e.find(".wijmo-wijev-location").val(), t.description = e.find(".wijmo-wijev-description").val(), t.color = this._readColorFromClass(e.find(".wijmo-wijev-color"), t.color || "default"); if (!t.name) throw "Calendar name can not be empty"; return t }, n.prototype._validateAndReadApptDialogFields = function (e) { var t = e.appt, n, i, s, o, u; n = r(e.find(".wijmo-wijev-start").wijinputdate("option", "date")), i = r(e.find(".wijmo-wijev-end").wijinputdate("option", "date")), s = e.find(".wijmo-wijev-start-time").wijinputdate("option", "date"), o = e.find(".wijmo-wijev-end-time").wijinputdate("option", "date"); if (n.getTime() === i.getTime() && s.getTime() > o.getTime()) throw this.localizeString("messageEndOccursBeforeStart", "The end date you entered occurs before the start date."); return t.subject = e.find(".wijmo-wijev-subject").val(), t.location = e.find(".wijmo-wijev-location").val(), t.start = n, t.end = i, e.find(".wijmo-wijev-allday").length > 0 && (t.allday = e.find(".wijmo-wijev-allday")[0].checked), t.allday ? t.start.getTime() >= t.end.getTime() && (t.end = this._addMinutes(t.start, this.options.timeInterval)) : (t.start = new Date(t.start.getFullYear(), t.start.getMonth(), t.start.getDate(), s.getHours(), s.getMinutes(), s.getSeconds()), t.end = new Date(t.end.getFullYear(), t.end.getMonth(), t.end.getDate(), o.getHours(), o.getMinutes(), o.getSeconds())), t.calendar = e.find(".wijmo-wijev-calendar").val(), t.description = e.find(".wijmo-wijev-description").val(), t.color = this._readColorFromClass(e.find(".wijmo-wijev-color"), t.color), u = t.recurrencePattern, u && t.recurrenceState === "master" && (u.startTime = t.start, u.endTime = t.end, u.patternStartDate = t.start), t }, n.prototype._bindApptToDialog = function (e) { if (!e) return; var t = this._editEventDialog, n, r; t.appt = e, t.find(".wijmo-wijev-subject").val(e.subject || ""), t.find(".wijmo-wijev-location").val(e.location || ""); try { t.find(".wijmo-wijev-start").wijinputdate("option", "date", e.start), t.find(".wijmo-wijev-start-time").wijinputdate("option", "date", e.start), t.find(".wijmo-wijev-end").wijinputdate("option", "date", e.end), t.find(".wijmo-wijev-end-time").wijinputdate("option", "date", e.end) } catch (i) { alert("[e0001a] wijinputdate/wijtextselection firefox error\n" + i) } t.find(".wijmo-wijev-allday").length > 0 && (t.find(".wijmo-wijev-allday")[0].checked = e.allday), t.find(".wijmo-wijev-allday").wijcheckbox("refresh"), this._fillCalendarsSelect(t.find(".wijmo-wijev-calendar"), e.calendar), this._loadRepeatValue(e, t.find(".wijmo-wijev-repeat")), t.find(".wijmo-wijev-description").val(e.description || ""), e.prevData ? t.find(".wijmo-wijev-delete").show() : t.find(".wijmo-wijev-delete").hide(), t.find(".wijmo-wijev-calendar").length > 0 && (n = this._calendarsById[t.find(".wijmo-wijev-calendar")[0].value]), r = e.color, !r && n && n.color && (r = n.color), this._addColorClass(t.find(".wijmo-wijev-color"), r), this._eventDialogEnsureTimePartState() }, n.prototype._onEditEventDialogShown = function (e, t) { t.recurrenceState === "exception" ? e.find(".wijmo-wijev-repeat").wijdropdown("option", "disabled", !0) : e.find(".wijmo-wijev-repeat").wijdropdown("option", "disabled", !1) }, n.prototype._eventDialogEnsureTimePartState = function () { var e = this._editEventDialog; e.find(".wijmo-wijev-allday").length > 0 && (e.find(".wijmo-wijev-allday")[0].checked ? (e.find(".wijmo-wijev-start-time").wijinputdate("option", "disabled", !0), e.find(".wijmo-wijev-end-time").wijinputdate("option", "disabled", !0)) : (e.find(".wijmo-wijev-start-time").wijinputdate("option", "disabled", !1), e.find(".wijmo-wijev-end-time").wijinputdate("option", "disabled", !1))) }, n.prototype._loadRepeatValue = function (e, t) { var n = "none"; if (e.recurrencePattern) switch (e.recurrencePattern.recurrenceType) { case "daily": n = "daily"; break; case "workdays": n = "workdays"; break; case "weekly": n = "weekly"; break; case "monthly": n = "monthly"; break; case "yearly": n = "yearly"; break; default: n = "custom" } t.val(n) }, n.prototype._addColorClass = function (e, t) { var n, r = new RegExp("wijmo-wijev-event-color-(\\w+)\\s*"); e.length > 0 && (n = e[0].className, e[0].className = n.replace(r, ""), e.addClass("wijmo-wijev-event-color-" + (t || "default"))) }, n.prototype._readColorFromClass = function (e, t) { var n = new RegExp("wijmo-wijev-event-color-(\\w+)\\s*"), r; if (e.length > 0) { r = n.exec(e[0].className); if (r && r.length > 1) return r[1] } return t }, n.prototype._fillCalendarsSelect = function (e, t) { var n = "", r = this.options, i, s, o, u = r.calendars.slice(0), a = r.visibleCalendars; if (a && a.length > 0) for (i = 0; i < a.length; i += 1) { o = !1; for (s = 0; s < u.length; s += 1) u[s].name === a[i] && (o = !0); o || u.push({ id: a[i], name: a[i] }) } if (u.length === 0) { e.html(""); return } for (i = 0; i < u.length; i += 1) n += '<option value="' + u[i].id + '">' + u[i].name + "</option>"; e.html(n).val(t) }, n.prototype._bindCalendarToDialog = function (e) { if (!e) return; var t = this._editCalendarDialog; t.cal = e, t.find(".wijmo-wijev-name").val(e.name || ""), t.find(".wijmo-wijev-location").val(e.location || ""), t.find(".wijmo-wijev-description").val(e.description || ""), this._addColorClass(t.find(".wijmo-wijev-color"), e.color) }, n.prototype._onTodayClick = function () { return this.goToday(), !1 }, n.prototype._bindEvents = function () { this._eventsAttached || (t(this.element).on("click." + this.wijevcalnamespacekey, ".wijmo-wijev-appointment", t.proxy(this._onAppointmentClick, this)), t(this.element).on("mousedown." + this.wijevcalnamespacekey, ".wijmo-wijev-dayview .wijmo-wijev-appointment", t.proxy(this._onDayViewAppointmentMouseDown, this)), t(this.element).on("mousedown." + this.wijevcalnamespacekey, ".wijmo-wijev-monthview .wijmo-wijev-appointment", t.proxy(this._onMonthViewAppointmentMouseDown, this)), t(this.element).on("click." + this.wijevcalnamespacekey, ".wijmo-wijev-dayview .wijmo-wijev-timeinterval", t.proxy(this._onDayViewTimeIntervalClick, this)), t(this.element).on("click." + this.wijevcalnamespacekey, ".wijmo-wijev-dayview .wijmo-wijev-allday-cell", t.proxy(this._onDayViewAllDayCellClick, this)), t(this.element).on("click." + this.wijevcalnamespacekey, ".wijmo-wijev-monthview .wijmo-wijev-monthcellheader", t.proxy(this._onMonthViewDayLabelClick, this)), t(this.element).on("click." + this.wijevcalnamespacekey, ".wijmo-wijev-monthview .wijmo-wijev-monthcell-showmore", t.proxy(this._onMonthViewDayLabelClick, this)), t(this.element).on("click." + this.wijevcalnamespacekey, ".wijmo-wijev-weekview .wijmo-wijev-daylabel", t.proxy(this._onMonthViewDayLabelClick, this)), t(this.element).on("click." + this.wijevcalnamespacekey, ".wijmo-wijev-monthview .wijmo-wijev-monthcell", t.proxy(this._onMonthViewCellClick, this)), this._eventsAttached = !0) }, n.prototype._unbindEvents = function () { this._eventsAttached && (t(this.element).off("mousedown." + this.wijevcalnamespacekey), t(this.element).off("click." + this.wijevcalnamespacekey), this._eventsAttached = !1) }, n.prototype.destroy = function () { var e = this.options; this.element.removeClass("wijmo-wijev wijmo-wijevcal " + e.wijCSS.widget + " ui-helper-reset"), t(window).unbind("resize." + this.wijevcalnamespacekey), this._unbindEvents(), t.wijmo.widget.prototype.destroy.apply(this, arguments) }, n.prototype.deleteCalendar = function (e, n, r) { var i, s = this.options.calendars, o = e.id || e, u = !1, a, f, l, h = this; for (i = 0; i < s.length; i += 1) if (s[i].id === o) { u = !0, e = s[i]; if (!this._trigger("beforeDeleteCalendar", null, { data: e })) return !1; delete this._calendarsById[e.id], s.splice(i, 1); break } if (!u) for (i = 0; i < s.length; i += 1) if (s[i].name === o) { u = !0, e = s[i]; if (!this._trigger("beforeDeleteCalendar", null, { data: e })) return !1; delete this._calendarsById[e.id], s.splice(i, 1); break } if (!u) return this.status("Calendar with id/name '" + o + "' not found."), !1; this.showLoadingLabel(this.localizeString("activityDeletingCalendar", "Deleting calendar...")), a = function (t) { h.status("Calendar '" + e.name + "' deleted."), h._onCalendarsChanged(), h.hideLoadingLabel(), n && n(t) }, f = function (t) { h.status("Unable to delete calendar '" + e.name + "': " + t), h.hideLoadingLabel(), r && r(t) }; if (this.options.dataStorage.deleteCalendar) this.options.dataStorage.deleteCalendar(e, a, f); else if (this.options.webServiceUrl) { try { l = this._jsonStringify(e) } catch (p) { this.status("Unable to prepare calendar data for server. " + p, "error"), f("Unable to prepare calendar data for server. " + p); return } t.ajax({ url: this.options.webServiceUrl + "?clientId=" + this.element[0].id + "&command=deleteCalendar&timestamp=" + (new Date).getTime(), dataType: "text", contentType: "application/json; charset=utf-8", type: "POST", data: "jsonData=" + l, success: a, error: f }) } else c("DELETE FROM calendars WHERE id='" + e.id + "'", [], a, f) }, n.prototype.addCalendar = function (e, n, r) { var i, s, o, u = this; if (!this._trigger("beforeAddCalendar", null, { data: e, prevData: e.prevData || {} })) { if (e.prevData) for (s in e.prevData) e.prevData.hasOwnProperty(s) && (e[s] = e.prevData[s]); return !1 } e.id || (this._dynIdCounter || (this._dynIdCounter = 0), this._dynIdCounter += 1, e.id = "dynid" + this._dynIdCounter + "ts" + (new Date).getTime()), this.showLoadingLabel(this.localizeString("activityCreatingCalendar", "Creating calendar...")), i = function (t) { if (u._handleServerError(t)) { o(t); return } u._readUpdatedServerDataIfAny(t, e), u._calendarsById[e.id] ? u.status("Calendar '" + e.name + "' added.") : (u.options.calendars.push(e), u._calendarsById[e.id] = e, u.status("Calendar '" + e.name + "' added.")), e.prevData = u._cloneObj(e), u._onCalendarsChanged(), u.hideLoadingLabel(), n && n(t) }, o = function (t) { u.status("Unable to add calendar '" + e.name + "': " + t), u.hideLoadingLabel(), r && r(t) }; if (this.options.dataStorage.addCalendar) this.options.dataStorage.addCalendar(e, i, o); else if (this.options.webServiceUrl) { try { s = this._jsonStringify(e) } catch (a) { this.status("Unable prepare calendar data for server." + a, "error"), o("Unable to prepare calendar data for server." + a); return } t.ajax({ url: this.options.webServiceUrl + "?clientId=" + this.element[0].id + "&command=addCalendar&timestamp=" + (new Date).getTime(), dataType: "text", contentType: "application/json; charset=utf-8", type: "POST", data: "jsonData=" + s, success: i, error: o }) } else c("INSERT OR REPLACE INTO calendars (id, name, location, description, color, tag) VALUES(?,?,?,?,?,?);", [e.id, e.name, e.location, e.description, e.color, e.tag], i, o) }, n.prototype.updateCalendar = function (e, n, r) { var i, s, o, u = this; if (!this._trigger("beforeUpdateCalendar", null, { data: e, prevData: e.prevData || {} })) { if (e.prevData) for (s in e.prevData) e.prevData.hasOwnProperty(s) && (e[s] = e.prevData[s]); return !1 } e.id || (this._dynIdCounter || (this._dynIdCounter = 0), this._dynIdCounter += 1, e.id = "dynid" + this._dynIdCounter + "ts" + (new Date).getTime()), this.showLoadingLabel(this.localizeString("activityUpdatingCalendar", "Updating calendar...")), i = function (t) { if (u._handleServerError(t)) { o(t); return } u._readUpdatedServerDataIfAny(t, e), u._calendarsById[e.id] ? u.status("Calendar '" + e.name + "' updated.") : (u.options.calendars.push(e), u._calendarsById[e.id] = e, u.status("Calendar '" + e.name + "' added.")), e.prevData = u._cloneObj(e), u._onCalendarsChanged(), u.hideLoadingLabel(), n && n(t) }, o = function (t) { u.status("Unable to update calendar '" + e.name + "': " + t), u.hideLoadingLabel(), r && r(t) }; if (this.options.dataStorage.updateCalendar) this.options.dataStorage.updateCalendar(e, i, o); else if (this.options.webServiceUrl) { try { s = this._jsonStringify(e) } catch (a) { this.status("Unable prepare calendar data for server. " + a, "error"), o("Unable to prepare calendar data for server. " + a); return } t.ajax({ url: this.options.webServiceUrl + "?clientId=" + this.element[0].id + "&command=updateCalendar&timestamp=" + (new Date).getTime(), dataType: "text", contentType: "application/json; charset=utf-8", type: "POST", data: "jsonData=" + s, success: i, error: o }) } else c("INSERT OR REPLACE INTO calendars (id, name, location, description, color, tag) VALUES(?,?,?,?,?,?);", [e.id, e.name, e.location, e.description, e.color, e.tag], i, o) }, n.prototype.addEvent = function (e, n, r) { var s, o, u, a = this; if (!this._trigger("beforeAddEvent", null, { data: e, prevData: e.prevData || {} })) { if (e.prevData) for (u in e.prevData) e.prevData.hasOwnProperty(u) && (e[u] = e.prevData[u]); return !1 } e.id || (this._dynIdCounter || (this._dynIdCounter = 0), this._dynIdCounter += 1, e.id = i()), e.calendar || (e.calendar = "Default"), this.showLoadingLabel(this.localizeString("activityCreatingEvent", "Creating event...")), o = function (t) { a.hideLoadingLabel(), a.status("Unable to add event '" + e.subject + "': " + t, "error"); if (e.prevData) for (u in e.prevData) e.prevData.hasOwnProperty(u) && (e[u] = e.prevData[u]); r && r(t) }, s = function (t) { if (a._handleServerError(t)) { o(t); return } a._readUpdatedServerDataIfAny(t, e), !a._eventsDataById[e.id] || e.recurrenceState === "exception" ? (a._storeEventWithSort(e), a.status("Event '" + e.subject + "' added.")) : a.status("Event '" + e.subject + "' added."), e.prevData = a._cloneObj(e), a._onEventsDataChanged(), a.hideLoadingLabel(), n && n(t) }; if (this.options.dataStorage.addEvent) this.options.dataStorage.addEvent(e, s, o); else if (this.options.webServiceUrl) { try { u = this._jsonStringify(e) } catch (f) { this.status("Unable prepare event data for server. " + f, "error"), o("Unable to prepare event data for server. " + f); return } t.ajax({ url: this.options.webServiceUrl + "?clientId=" + this.element[0].id + "&command=addEvent&timestamp=" + (new Date).getTime(), dataType: "text", contentType: "application/json; charset=utf-8", type: "POST", data: "jsonData=" + u, success: s, error: o }) } else c("INSERT OR REPLACE INTO events (id, calendar, subject, location, start, end, description, color, allday, properties, tag) VALUES(?,?,?,?,?,?,?,?,?,?,?);", [e.id, e.calendar, e.subject, e.location, e.start.getTime(), e.end.getTime(), e.description, e.color, e.allday, this._serializeProperties(e), e.tag], s, o) }, n.prototype._storeEventWithSort = function (e) { var t = this.options.eventsData, n, r; this._eventsDataById[e.id] = e; for (n = 0, r = t.length; n < r; n += 1) { if (t[n].start > e.start) { t.splice(n, 0, e); return } if (t[n].start.getTime() === e.start.getTime() && t[n].subject > e.subject) { t.splice(n, 0, e); return } } t.push(e) }, n.prototype._readUpdatedServerDataIfAny = function (e, t) { var n = null, r; if (typeof e == "string" && e.indexOf("update:") === 0) { e = e.toString().substr("update:".length); try { n = this._jsonParse(e) } catch (i) { this.status("Unable to read updated server data. " + i, "warning") } if (n) for (r in n) n[r] && (t[r] = n[r]) } }, n.prototype.updateEvent = function (e, n, r) { var i, s, o, u = this; if (!this._trigger("beforeUpdateEvent", null, { data: e, prevData: e.prevData || {} })) { if (e.prevData) for (o in e.prevData) e.prevData.hasOwnProperty(o) && (e[o] = e.prevData[o]); return this._updateAppointmentVisual(e), !1 } e.calendar || (e.calendar = "Default"), this.showLoadingLabel(this.localizeString("activityUpdatingEvent", "Updating event...")), s = function (t) { u.hideLoadingLabel(), u.status("Unable to update event '" + e.subject + "': " + t, "error"); if (e.prevData) for (o in e.prevData) e.prevData.hasOwnProperty(o) && (e[o] = e.prevData[o]); u._updateAppointmentVisual(e), r && r(t) }; if (!e.id) { s("id is empty"); return } if (e.recurrenceState === "exception" || e.recurrenceState === "occurrence") { if (!this._eventsDataById[e.parentRecurrenceId]) { s("Unable to find master event for event with id:" + e.id); return } if (e.recurrenceState === "occurrence") return this.log(this._formatString("[updateEvent->addEvent] recurrenceState for event {0} changed to 'exception'.", e.id)), e.recurrenceState = "exception", this.addEvent(e, n, r) } i = function (t) { if (u._handleServerError(t)) { s(t); return } u._readUpdatedServerDataIfAny(t, e), u._eventsDataById[e.id] ? u.status("Event '" + e.subject + "' updated.") : (u._storeEventWithSort(e), u.status("Event '" + e.subject + "' added.")), e.prevData = u._cloneObj(e), u._onEventsDataChanged(), u.hideLoadingLabel(), n && n(t) }; if (this.options.dataStorage.updateEvent) this.options.dataStorage.updateEvent(e, i, s); else if (this.options.webServiceUrl) { try { o = this._jsonStringify(e) } catch (a) { this.status("Unable prepare event data for server. " + a, "error"), s("Unable to prepare event data for server. " + a); return } t.ajax({ url: this.options.webServiceUrl + "?clientId=" + this.element[0].id + "&command=updateEvent&timestamp=" + (new Date).getTime(), dataType: "text", contentType: "application/json; charset=utf-8", type: "POST", data: "jsonData=" + o, success: i, error: s }) } else c("INSERT OR REPLACE INTO events (id, calendar, subject, location, start, end, description, color, allday, properties, tag) VALUES(?,?,?,?,?,?,?,?,?,?,?);", [e.id, e.calendar, e.subject, e.location, e.start.getTime(), e.end.getTime(), e.description, e.color, e.allday, this._serializeProperties(e), e.tag], i, s) }, n.prototype._serializeProperties = function (e) { var t = "", n = {}; n.parentRecurrenceId = e.parentRecurrenceId, n.recurrenceState = e.recurrenceState, n.recurrencePattern = e.recurrencePattern, n.color = e.color, n.allday = e.allday; try { t = this._jsonStringify(n) } catch (r) { this.status("Unable save additional event properties. " + r, "error") } return t }, n.prototype._deSerializeProperties = function (e, t) { var n = {}, r; if (e) { if (typeof e == "string") try { n = this._jsonParse(e) } catch (i) { this.status("Unable to load additional event properties. " + i, "error"); return } else n = e; n.parentRecurrenceId && (t.parentRecurrenceId = n.parentRecurrenceId), n.recurrenceState && (t.recurrenceState = n.recurrenceState), n.recurrencePattern && (t.recurrencePattern = n.recurrencePattern), n.color && (t.color = n.color), n.allday && (t.allday = n.allday) } t && t.recurrencePattern && (r = t.recurrencePattern, r.patternStartDate = r.patternStartDate ? new Date(r.patternStartDate) : r.patternStartDate, r.startTime = r.startTime ? new Date(r.startTime) : r.startTime, r.endTime = r.endTime ? new Date(r.endTime) : r.endTime, r.startTime.getTime() >= r.endTime.getTime() && (r.endTime = this._addMinutes(r.startTime, this.options.timeInterval))) }, n.prototype._jsonStringify = function (e) { var t; if (window.__JSONC1) t = window.__JSONC1.stringify(e); else { if (!window.JSON) throw "JSON not found."; t = JSON.stringify(e) } return t }, n.prototype._jsonParse = function (e) { var t, n, r; if (window.__JSONC1) t = window.__JSONC1.parse(e); else { if (!window.JSON) throw "JSON variable not found."; n = /^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/, r = /^\/Date\((d|-|.*)\)\/$/, t = window.JSON.parse(e, function (e, t) { if (typeof t == "string") { var i = n.exec(t), s; if (i) return new Date(Date.UTC(+i[1], +i[2] - 1, +i[3], +i[4], +i[5], +i[6])); i = r.exec(t); if (i) return s = i[1].split(/[-,.]/), new Date(+s[0]) } return t }) } return t }, n.prototype.getOccurrences = function (e, t) { var n = this.options, r = n.eventsData, i, s, o, u, a, f, l, c, h = 100, p, d, v, m = [], g = [], y = [], b = {}; this._eventsDataById || (this._eventsDataById = {}); for (a = 0, l = r.length; a < l; a += 1) { i = r[a], this._eventsDataById[i.id] = i; if (i.recurrenceState === "master") { u = i.recurrencePattern, u.removedOccurrences && (y = y.concat(u.removedOccurrences)), c = u.occurrences || h, p = u.patternStartDate || i.start, d = u.startTime || i.start, v = u.endTime || i.end; switch (u.recurrenceType) { case "daily": for (f = 0; f < c; f += 1) s = this._cloneObj(i), s.parentRecurrenceId = i.id, s.recurrenceState = "occurrence", s.start = this._setTime(this._addDays(p, f), d), s.end = this._setTime(s.start, v, d), s.recurrencePattern = null, this._testIsEventInTimeInterval(s, e, t) && (s.id = this._formatString("{0}_OCCR_{1:yyyy_MM_dd}", i.id, s.start), b[s.id] = s); break; case "workdays": for (f = 0; f < c; f += 1) { s = this._cloneObj(i), s.parentRecurrenceId = i.id, s.recurrenceState = "occurrence", s.start = this._setTime(this._addDays(p, f), d); if (s.start.getDay() === 0 || s.start.getDay() === 6) continue; s.end = this._setTime(s.start, v, d), s.recurrencePattern = null, this._testIsEventInTimeInterval(s, e, t) && (s.id = this._formatString("{0}_OCCR_{1:yyyy_MM_dd}", i.id, s.start), b[s.id] = s) } break; case "weekly": for (f = 0; f < c; f += 1) s = this._cloneObj(i), s.parentRecurrenceId = i.id, s.recurrenceState = "occurrence", s.start = this._setTime(this._addDays(p, f * 7), d), s.end = this._setTime(s.start, v, d), s.recurrencePattern = null, this._testIsEventInTimeInterval(s, e, t) && (s.id = this._formatString("{0}_OCCR_{1:yyyy_MM_dd}", i.id, s.start), b[s.id] = s); break; case "monthly": for (f = 0; f < c; f += 1) s = this._cloneObj(i), s.parentRecurrenceId = i.id, s.recurrenceState = "occurrence", s.start = this._setTime(new Date(p), d), s.start.setMonth(s.start.getMonth() + f), s.end = this._setTime(s.start, v, d), s.recurrencePattern = null, this._testIsEventInTimeInterval(s, e, t) && (s.id = this._formatString("{0}_OCCR_{1:yyyy_MM_dd}", i.id, s.start), b[s.id] = s); break; case "yearly": for (f = 0; f < c; f += 1) s = this._cloneObj(i), s.parentRecurrenceId = i.id, s.recurrenceState = "occurrence", s.start = this._setTime(new Date(p), d), s.start.setYear(s.start.getFullYear() + f), s.end = this._setTime(s.start, v, d), s.recurrencePattern = null, this._testIsEventInTimeInterval(s, e, t) && (s.id = this._formatString("{0}_OCCR_{1:yyyy_MM_dd}", i.id, s.start), b[s.id] = s); break; case "monthlyNth": break; case "yearlyNth": } } else this._testIsEventInTimeInterval(i, e, t) && (i.recurrenceState === "exception" ? g.push(i) : i.recurrenceState === "removed" ? (y.push(i.id), this.log("[warning] Seems we found removed event inside events storage, id:" + i.id)) : m.push(i)) } for (a = 0, l = g.length; a < l; a += 1) o = g[a], b[o.id] && delete b[o.id], m.push(o), this._eventsDataById[o.id] = o; for (a = 0, l = y.length; a < l; a += 1) b[y[a]] && delete b[y[a]]; for (a in b) s = b[a], m.push(s), this._eventsDataById[s.id] = s; return m }, n.prototype._testIsEventInTimeInterval = function (e, t, n) { return !t || !n ? !0 : e.start < n && e.end > t ? !0 : !1 }, n.prototype.deleteEvent = function (e, n, r) { e.id && (e = e.id); var i = this._eventsDataById[e], s, o, u, a, f = this, l, h; if (!this._trigger("beforeDeleteEvent", null, { data: i })) return !1; this.showLoadingLabel(this.localizeString("activityDeletingEvent", "Deleting event...")), a = function (e) { f.status("Unable to delete event '" + (i ? i.subject : "undefined") + "': " + e), f.hideLoadingLabel(), r && r(e) }; if (i.recurrenceState === "exception" || i.recurrenceState === "occurrence") { h = this._eventsDataById[i.parentRecurrenceId]; if (h) { this.log(this._formatString("[deleteEvent] removing {0} with id {1}. Updating master event with id {2}", i.recurrenceState, i.id, h.id)), h.recurrencePattern.removedOccurrences || (h.recurrencePattern.removedOccurrences = []), h.recurrencePattern.removedOccurrences.push(i.id), this.updateEvent(h, n, r); if (i.recurrenceState === "occurrence") { this.log("No need to delete occurrence from store. Master event should be updated."); return } } else if (i.recurrenceState !== "exception") return a("Unable to find master event with id " + i.parentRecurrenceId), !1 } i.recurrenceState === "master", u = function (t) { if (f._handleServerError(t)) { a(t); return } if (f._eventsDataById[i.id]) { o = f.options.eventsData; for (s = 0; s < o.length; s += 1) o[s].id === e && o.splice(s, 1); delete f._eventsDataById[i.id], f.status("Event '" + i.subject + "' deleted.") } else f.status("Event '" + i.subject + "' deleted."); i.prevData = f._cloneObj(i), f._onEventsDataChanged(), f.hideLoadingLabel(), n && n(t) }; if (this.options.dataStorage.deleteEvent) this.options.dataStorage.deleteEvent(i, u, a); else if (this.options.webServiceUrl) { try { l = this._jsonStringify(i) } catch (p) { this.status("Unable prepare event data for server. " + p, "error"), a("Unable prepare event data for server. " + p); return } t.ajax({ url: this.options.webServiceUrl + "?clientId=" + this.element[0].id + "&command=deleteEvent&timestamp=" + (new Date).getTime(), dataType: "text", contentType: "application/json; charset=utf-8", type: "POST", data: "jsonData=" + l, success: u, error: a }) } else c("DELETE FROM events WHERE id='" + e + "'", [], u, a) }, n.prototype.beginUpdate = function () { this._isUpdating = !0, this.showLoadingLabel("Updating...") }, n.prototype.endUpdate = function () { this._isUpdating = !1, this._pendingRedrawActiveView && this._redrawActiveView(), this.hideLoadingLabel() }, n.prototype.goToEvent = function (e) { e.id && (e = e.id); var t = this.options, n, r = this.findEventById(e); switch (t.viewType) { case "day": case "week": case "list": n = this.element.find(".wijmo-wijev-dayview .wijmo-wijev-daycolumn ." + this._eventIdToCssClass(e)), n.length > 0 ? this.element.find(".wijmo-wijev-scrollpanel").wijsuperpanel("scrollChildIntoView", n) : (this._dayViewScrollToEvent = r, this.goToDate(r.start)); break; case "month": this.goToDate(r.start) } }, n.prototype.isAllDayEvent = function (e) { var t = e; return e.id || (t = this.findEventById(e)), t.allday ? (t.end.getTime() - t.start.getTime()) / 864e5 >= 1 ? !0 : !0 : !1 }, n.prototype.goToDate = function (e) { e = r(e); var t = this.options, n = e.getDay(), i, s, o, u, a, f = t.selectedDates; if (f && f.length > 0) { if (this._isContainsDayDate(f, e)) return; a = f[0], o = Date.UTC(e.getFullYear(), e.getMonth(), e.getDate()), u = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate()), s = (o - u) / 864e5; if (t.viewType === "week") for (i = 0; i < f.length; i += 1) if (f[i].getDay() === n) { s -= i; break } for (i = 0; i < f.length; i += 1) f[i] = this._addDays(f[i], s); this._onSelectedDatesChanged() } else t.selectedDates = [e], this._onSelectedDatesChanged() }, n.prototype.goToTime = function (e) { var t = this.element.find(".wijmo-wijev-daycolumn .wijmo-wijev-timeinterval:first-child"), n = this.element.find(".wijmo-wijev-daycolumn .wijmo-wijev-timeinterval:last-child"), r = t.position().top, i = n.position().top + n.height(), s, o, u; u = 86400, o = e.getHours() * 60 * 60 + e.getMinutes() * 60, s = (i - r) * o / u + r, this.element.find(".wijmo-wijev-scrollpanel").wijsuperpanel("vScrollTo", s) }, n.prototype.goToday = function () { this.goToDate(new Date) }, n.prototype.goLeft = function () { var e, t = this.options, n = t.viewType, r = t.selectedDates; n === "month" ? this.goToDate(this._addMonths(r[0], -1)) : (e = -7, r.length === 1 && (e = -1), this.goToDate(this._addDays(r[0], e))) }, n.prototype.goRight = function () { var e, t = this.options, n = t.viewType, r = t.selectedDates; n === "month" ? this.goToDate(this._addMonths(r[0], 1)) : (e = 7, r.length === 1 && (e = 1), this.goToDate(this._addDays(r[0], e))) }, n.prototype.refresh = function () { this.invalidate() }, n.prototype.invalidate = function () { var e = this.options; switch (e.viewType.toLowerCase()) { case "list": case "day": case "week": this._invalidateDayView(); break; case "month": this._invalidateMonthView(); break; default: } }, n.prototype.showEditCalendarDialog = function (e) { var t = this.options, n = t.calendars, r; if (!e) e = { name: "", description: "", location: "", color: "" }; else if (!e.name) for (r = 0; r < n.length; r += 1) if (n[r].name === e) { e = n[r]; break } this._ensureEditCalendarDialogCreated(), this._bindCalendarToDialog(e), this._editCalendarDialog.wijdialog("open") }, n.prototype.showEditEventDialog = function (e, n, r) { var i = this.options, s, o, u, a = n ? t(n) : r ? t(r.target) : null; this._ensureEditEventDialogCreated(), this.element.find(".wijmo-wijev-dayview .ui-selected").removeClass("ui-selected"), a && a.hasClass("wijmo-wijev-daylabel") && (a = a.parent(".wijmo-wijev-allday-cell")), e ? (this._editEventDialog._arrowTarget = a, e.recurrenceState === "occurrence" && (s = this._eventsDataById[e.parentRecurrenceId], window.confirm(this._formatString(this.localizeString("promptOpenOccurrenceFormat", "{2}  is recurring event. Do you want to open only this occurrence?"), e.start, e.end, e.subject, e.location)) || (e = s))) : (e = { subject: this.localizeString("textNewEvent", "New event") }, e.isNewEvent = !0, a && a.length > 0 ? (this._editEventDialog._arrowTarget = a, a.addClass("ui-selected"), o = a.parent(".wijmo-wijev-daycolumn"), o.length < 1 && (o = a.parent(".wijmo-wijev-dayheadercolumn")), o = o[0], a.hasClass("wijmo-wijev-allday-cell") ? e.allday = !0 : a.hasClass("wijmo-wijev-monthcellcontainer") ? (o = a[0], e.allday = !0) : e.allday = !1, o && (u = this._parseDateFromClass(o.className, e.allday ? null : a[0].className), e.start = u, e.allday ? e.end = this._addMinutes(e.start, 1440) : e.end = this._addMinutes(e.start, i.timeInterval))) : (e.start = new Date(i.selectedDates[0]), e.end = this._addMinutes(e.start, i.timeInterval))), this._trigger("beforeEditEventDialogShow", null, { data: e, targetCell: a }) && (this._bindApptToDialog(e), this._editEventDialog.wijpopup("show", { of: a, my: "left center", at: "right center", offset: (a && r ? Math.round(r.offsetX - a.width()) : 10) + " 0", collision: "fit" })) }, n.prototype._renderActiveView = function () { var e = this.options, n = this.element.find(".wijmo-wijev-headerbar .wijmo-wijev-tools"); this.element.find(".wijmo-wijev-view").hide(), this.element.find(".wijmo-wijev-viewdetails").hide(), this.element.find(".wijmo-wijev-" + e.viewType.toLowerCase() + "-details").show(); switch (e.viewType.toLowerCase()) { case "day": case "week": case "list": this.element.find(".wijmo-wijev-view.wijmo-wijev-dayview").show(), this._renderDayView(); break; case "month": this.element.find(".wijmo-wijev-view.wijmo-wijev-monthview").show(), this._renderMonthView(); break; default: } n.find(".wijmo-wijev-" + e.viewType.toLowerCase())[0].checked = !0, t().buttonset && n.buttonset("refresh") }, n.prototype._redrawActiveView = function () { if (this._isUpdating) { this._pendingRedrawActiveView = !0; return } switch (this.options.viewType.toLowerCase()) { case "day": case "week": this._clearDayViewCache(), this._templateDayColumn = null } this._renderActiveView() }, n.prototype._getDayColumnDates = function (e) { var t = this.options, n = t.selectedDates, r, i, s; n || (n = [new Date]); if (t.viewType === "week") { r = t.selectedDate || n[0], s = t.firstDayOfWeek - r.getDay(), Math.abs(s) > 6 && (s = r.getDay() - t.firstDayOfWeek), r = this._addDays(r, s), n = []; for (s = 0; s < 7; s += 1) i = this._addDays(r, s), n.push(i) } return e && (t.selectedDates = n), n }, n.prototype._renderDayView = function () { var e = this.options, n = 0, r = 1440, i, s, o, u = this._getDayColumnDates(!0), a, f, l, c, h = new Date, p, d = !1, v = this.element.find(".wijmo-wijev-dayview"), m, g, y, b = 0, w; v.length === 0 && (v = t('<div class="wijmo-wijev-view wijmo-wijev-dayview ' + e.wijCSS.content + '">' + '<h3 class="wijmo-wijev-header-title">title' + "</h3>" + '<div class="wijmo-wijev-dayview-inner">' + '<div class="wijmo-wijev-headercontainer">' + '<div class="wijmo-wijev-sizer">' + '<div class="wijmo-wijev-gmtlabel">' + this.localizeString("labelAllDay", "all-day") + "</div>" + "</div>" + "</div>" + '<div class="wijmo-wijev-scrollpanel">' + '<div class="wijmo-wijev-scrollcontent">' + '<div class="wijmo-wijev-timeruler">' + '<div class="wijmo-wijev-currenttime-indicator">' + '<div class="wijmo-wijev-currenttime-indicator-arrow ui-state-error"></div>' + '<div class="wijmo-wijev-currenttime-indicator-line ui-state-error"></div>' + "</div>" + "</div>" + "</div>" + "</div>" + "</div>" + "</div>"), v.appendTo(this.element.find(".wijmo-wijev-view-container")), this.element.find(".wijmo-wijev-scrollpanel").wijsuperpanel({ hScroller: { scrollBarVisibility: "hidden" }, animationOptions: { disabled: !0 } })), v.removeClass("wijmo-wijev-weekview wijmo-wijev-listview"), v.addClass("wijmo-wijev-" + e.viewType.toLowerCase() + "view"), m = this.element.find(".wijmo-wijev-headercontainer"), g = this.element.find(".wijmo-wijev-scrollcontent"), y = g.find(".wijmo-wijev-timeruler"); if (!this._templateDayColumn) { y.find(".wijmo-wijev-timerulerinterval").remove(), i = '<div class="wijmo-wijev-daycolumn">', w = !0; while (n < r) s = "wijmo-wijev-timeinterval " + e.wijCSS.content + " wijmo-wijev-minute-" + n, w && (s += " wijmo-wijev-oddrow"), w = !w, o = "wijmo-wijev-timerulerinterval " + e.wijCSS.content + " wijmo-wijev-minute-" + n, i += '<div class="' + s + '" style="height: ' + e.timeIntervalHeight + 'px"></div>', n += e.timeInterval, b += e.timeInterval, b >= e.timeRulerInterval && (s += " wijmo-wijev-timeinterval-hourstart", o += " wijmo-wijev-timerulerinterval-hourstart", y.append(t('<div class="' + o + '" style="height:' + b / e.timeInterval * e.timeIntervalHeight + 'px">' + this._formatString(e.timeRulerFormat, new Date(h.getFullYear(), h.getMonth(), h.getDate(), 0, n - b)) + "</div>")), b = 0); i += "</div>", this._templateDayColumn = t(i), this._templateDayHeader = t('<div class="wijmo-wijev-dayheadercolumn ' + e.wijCSS.content + '">' + '<div class="wijmo-wijev-allday-cell ' + e.wijCSS.content + '">' + '<div class="wijmo-wijev-daylabel">3 Monday</div>' + "</div>" + "</div>") } m.find(".wijmo-wijev-dayheadercolumn").remove(), g.find(".wijmo-wijev-daycolumn").remove(); for (a = 0, p = u.length; a < p; a += 1) c = u[a], f = this._getCachedDayHeader(c), l = this._getCachedDayColumn(c), f ? (f = t(f), f.find(".wijmo-wijev-daylabel").html(this._formatDayHeaderDate(c))) : (f = this._templateDayHeader.clone(!0), l = this._templateDayColumn.clone(!0), f.addClass(this._dayDateToCssClass(c)), f.find(".wijmo-wijev-daylabel").html(this._formatDayHeaderDate(c)), l.addClass(this._dayDateToCssClass(c)), d ? d = !1 : (l.addClass("wijmo-wijev-leftborder"), f.addClass("wijmo-wijev-leftborder")), this._compareDayDates(c, h) === 0 && (l.addClass("wijmo-wijev-today ui-state-highlight"), l.addClass("wijmo-wijev-leftborder"), l.addClass("wijmo-wijev-rightborder"), f.addClass("wijmo-wijev-today").find(".wijmo-wijev-allday-cell").addClass("ui-state-highlight"), f.addClass("wijmo-wijev-leftborder"), f.addClass("wijmo-wijev-rightborder"), d = !0), a === p - 1 && (l.addClass("wijmo-wijev-rightborder"), f.addClass("wijmo-wijev-rightborder"))), m.append(f), g.append(l); this._invalidateDayView(), this._renderDayViewAppointments() }, n.prototype._getCachedDayHeader = function (e) { var t = null; return this._dayViewCache && this._dayViewCache[e] && (t = this._dayViewCache[e].h), t }, n.prototype._getCachedDayColumn = function (e) { var t = null; return this._dayViewCache && this._dayViewCache[e] && (t = this._dayViewCache[e].c), t }, n.prototype._storeDayCache = function (e, t, n) { this._dayViewCache || (this._dayViewCache = {}), this._dayViewCache[e] = { h: t, c: n } }, n.prototype._clearViewsCache = function () { this._clearDayViewCache(), this._clearListViewCache() }, n.prototype._clearDayViewCache = function () { this._dayViewCache = {} }, n.prototype._clearListViewCache = function () { var e = this.element.find(".wijmo-wijev-list-details .wijmo-wijev-agenda-container .wijmo-wijsuperpanel-templateouterwrapper"); e.data("wijevcal_agenda_initialized", !1), e.data("wijevcal_agenda_loadedeventscount", 0) }, n.prototype._invalidateDayView = function (e) { var n = this.element.find(".wijmo-wijev-headercontainer"), r = this.element.find(".wijmo-wijev-scrollcontent"), i = r.find(".wijmo-wijev-timeruler"), s = n.find(".wijmo-wijev-dayheadercolumn"), o = r.find(".wijmo-wijev-daycolumn"), u = this.element.find(".wijmo-wijev-view .wijmo-wijev-header-title"), a, f, l, c, h, p, d, v = i.outerWidth(), m, g, y, b, w; this._updateHeaderTitleText(), a = u.is(":visible") ? u.outerHeight(!0) : 0, this._invalidateView(), this._maxAllDayEventCount || (this._maxAllDayEventCount = 0), c = n.find(".wijmo-wijev-dayheadercolumn .wijmo-wijev-appointment").outerHeight(!0), c || (c = 17), h = n.find(".wijmo-wijev-daylabel").outerHeight(!0), p = 0; for (m = 0; m < s.length; m += 1) d = t(s[m]).find(".wijmo-wijev-allday-cell .wijmo-wijev-appointment").length, d > p && (p = d); l = c * p + h + c, n.outerHeight(l + Math.round(c / 2)), n.find(".wijmo-wijev-allday-cell").outerHeight(l), f = this.element.find(".wijmo-wijev-view").innerWidth(), g = f - v, g -= 18, y = this.element.find(".wijmo-wijev-view").innerHeight() - n.outerHeight(!0) - a, b = Math.floor(g / o.length), n.outerWidth(f), r.outerWidth(f), s.outerWidth(b), o.outerWidth(b), this._invalidateCurrentTimeIndicator(), w = this.element.find(".wijmo-wijev-scrollpanel"), w.outerWidth(f), w.outerHeight(y), w.wijsuperpanel("refresh"); switch (this.options.viewType.toLowerCase()) { case "day": this._updateDayViewDetails(); break; case "list": this._updateListViewDetails() } }, n.prototype._updateDayViewDetails = function () { var e = this.options, n = e.selectedDate, r = this.element.find(".wijmo-wijev-leftpane"), i = r.find(".wijmo-wijev-agenda-container"); this._dayViewDetailsInit || (this._dayViewDetailsInit = !0, this.element.find(".wijmo-wijev-day-details .wijmo-wijev-daycalendar").wijcalendar({ culture: e.culture, titleFormat: this.localizeString("calendarTitleFormat", "MMMM yyyy"), toolTipFormat: this.localizeString("calendarToolTipFormat", "dddd, MMMM dd, yyyy"), showTitle: !1, showOtherMonthDays: !1, showWeekNumbers: !1, selectionMode: { day: !0, days: !1 }, selectedDatesChanged: t.proxy(function (t, n) { n.dates && !e.disabled && this.goToDate(n.dates[0]) }, this), nextTooltip: this.localizeString("calendarNextTooltip", "Next"), prevTooltip: this.localizeString("calendarPrevTooltip", "Previous") }), this.element.find(".wijmo-wijev-day-details .wijmo-wijev-agenda-container").wijsuperpanel()), this.element.find(".wijmo-wijev-day-details .wijmo-wijev-daycalendar").wijcalendar("option", "displayDate", n).wijcalendar("unSelectAll").wijcalendar("selectDate", n), this.element.find(".wijmo-wijev-day-details .wijmo-wijev-daycalendar").wijcalendar("refresh"), this.element.find(".wijmo-wijev-day-details .wijmo-wijev-monthday-label").html(n.getDate()), this.element.find(".wijmo-wijev-day-details .wijmo-wijev-fulldate-label").html(this._formatString(this.localizeString("dayDetailsLabelFulldateFormat", "{0:dddd, MMMM d}"), n)), this.element.find(".wijmo-wijev-day-details .wijmo-wijev-year-label").html(this._formatString(this.localizeString("dayDetailsLabelYearFormat", "{0:yyyy}"), n)), this._updateAgendaList(this.element.find(".wijmo-wijev-day-details  .wijmo-wijev-agenda-container"), n, n, !1) }, n.prototype._listViewAgendaScrolled = function () { var e = this.element.find(".wijmo-wijev-list-details .wijmo-wijev-agenda-container"), n = e.wijsuperpanel("option", "vScroller"), r, i = n.scrollValue, s = n.scrollMax - n.scrollLargeChange * 2; i >= s && (r = e.find(".wijmo-wijsuperpanel-templateouterwrapper"), r.data("wijevcal_agenda_loadnextpage") && (r.data("wijevcal_agenda_loadnextpage", !1), r.find(".wijmo-wijev-agenda-more-events").show().html(this.localizeString("agendaLoadingMoreEvents", "Loading more events...")), this._renderAgendaEventsTimeoutId && (clearTimeout(this._renderAgendaEventsTimeoutId), this._renderAgendaEventsTimeoutId = null), this._renderAgendaEventsTimeoutId = setTimeout(t.proxy(function () { this._renderAgendaEventsTimeoutId = null, this._renderAgendaEvents(r, null, null, !0), r.find(".wijmo-wijev-agenda-more-events").remove() }, this), 100))) }, n.prototype._updateListViewDetails = function () { this._listViewDetailsInit || (this._listViewDetailsInit = !0, this.element.find(".wijmo-wijev-list-details .wijmo-wijev-agenda-container").wijsuperpanel({ scrolled: t.proxy(this._listViewAgendaScrolled, this) })), this._updateAgendaList(this.element.find(".wijmo-wijev-list-details  .wijmo-wijev-agenda-container"), null, null, !0) }, n.prototype._updateAgendaList = function (e, t, n, r) { var i = this.element.find(".wijmo-wijev-leftpane"), s = e; e.outerHeight(i.innerHeight() - e[0].offsetTop), s.find(".wijmo-wijsuperpanel-templateouterwrapper").length > 0 && (s = s.find(".wijmo-wijsuperpanel-templateouterwrapper")); if (r && s.data("wijevcal_agenda_initialized")) { s.parents(".wijmo-wijsuperpanel").wijsuperpanel("refresh"); return } s.data("wijevcal_agenda_initialized", !0), s.data("wijevcal_agenda_loadedeventscount", 0), s.html(""), this._renderAgendaEvents(s, t, n, r) }, n.prototype._renderAgendaEvents = function (e, n, i, s) { var o = this._eventsView, u, a, f, l, c = 0, h, p = "", d = "", v = null, m = null, g = this.options, y, b, w = 100, E = e.data("wijevcal_agenda_loadedeventscount"); n && (v = r(n), m = this._addDays(r(i), 1), l = (m.getTime() - v.getTime()) / 864e5); if (o) { f = o.length < w + E || !s ? o.length : w + E, e.data("wijevcal_agenda_loadedeventscount", f); if (!v) { d = ""; for (a = E; a < f; a += 1) { u = o[a]; if (a === E || y.getDate() !== u.start.getDate()) y = u.start, a !== 0 && (p += '<ul class="wijmo-wijev-agenda-list">' + d + "</ul>", p += "</div>"), p += '<div class="wijmo-wijev-agenda-day-container ' + this._dayDateToCssClass(y) + '">', s && (p += this._renderAgendaDayHeader(y)), d = ""; d += this._renderAgendaAppointmentVisual(u), h += 1, a === f - 1 && (p += '<ul class="wijmo-wijev-agenda-list">' + d + "</ul>", p += "</div>", f < o.length ? (p += '<div class="wijmo-wijev-agenda-more-events">', p += this._formatString(this.localizeString("agendaMoreEventsFormat", "More events ({0})..."), o.length - f), p += "<div>", e.data("wijevcal_agenda_loadnextpage", !0)) : e.data("wijevcal_agenda_loadnextpage", !1)) } } else while (c < l) { y = this._addDays(v, c), y = new Date(y.getFullYear(), y.getMonth(), y.getDate()), b = new Date(y.getFullYear(), y.getMonth(), y.getDate(), 23, 59, 59), h = 0, d = ""; for (a = E; a < f; a += 1) u = o[a], u.start < m && u.end > v && u.start < b && u.start >= y && (d += this._renderAgendaAppointmentVisual(u), h += 1); d !== "" && (p += '<div class="wijmo-wijev-agenda-day-container ' + this._dayDateToCssClass(y) + '">', s && (p += this._renderAgendaDayHeader(y)), p += '<ul class="wijmo-wijev-agenda-list">' + d + "</ul>", p += "</div>"), c += 1 } t(p).appendTo(e) } e.on("click", ".wijmo-wijev-agenda-event", t.proxy(this._onAgendaEventClick, this)).hover(function () { t(this).addClass(g.wijCSS.stateHover) }, function () { t(this).removeClass(g.wijCSS.stateHover).removeClass(g.wijCSS.stateActive) }).mousedown(function () { t(this).addClass(g.wijCSS.stateActive) }).mouseup(function () { t(this).removeClass(g.wijCSS.stateActive) }), e.parents(".wijmo-wijsuperpanel").wijsuperpanel("refresh") }, n.prototype._renderAgendaDayHeader = function (e) { var t = '<div class="wijmo-wijev-agenda-header ui-widget-header"><div class="wijmo-wijev-weekday">' + this._formatString("{0:dddd}", e) + "</div>" + '<div class="wijmo-wijev-date">' + this._formatString(this.localizeString("agendaHeaderFullDateFormat", "{0:MMMM d, yyyy}"), e) + "</div>" + "</div>"; return t }, n.prototype._onAgendaEventClick = function (e) { var n = t(e.target); n.hasClass("wijmo-wijev-agenda-event") || (n = n.parent(".wijmo-wijev-agenda-event")), n.length > 0 && this.goToEvent(this._parseEventIdFromClass(n[0].className)) }, n.prototype._renderAgendaAppointmentVisual = function (e) { var t = '<li class="wijmo-wijev-agenda-event ' + this._dayDateToCssClass(e.start) + " " + this._eventIdToCssClass(e.id) + " " + this.options.wijCSS.stateDefault + ' ui-helper-clearfix">' + '<div class="wijmo-wijev-agenda-event-color ' + "wijmo-wijev-event-color-" + (e.color || "default") + '">' + "<div></div>" + "</div>" + '<div class="wijmo-wijev-agenda-event-title">' + e.subject + "</div>" + '<div class="wijmo-wijev-agenda-event-time">' + (this.isAllDayEvent(e) ? this.localizeString("labelAllDay", "all-day") : this._formatString(this.localizeString("agendaTimeFormat", "{0:hh:mm tt} to {1:hh:mm tt}"), e.start, e.end)) + "</div>" + "</li>"; return t }, n.prototype._invalidateCurrentTimeIndicator = function () { var e = this.element.find(".wijmo-wijev-timeruler .wijmo-wijev-currenttime-indicator"), t = new Date, n = this.options; t = t.getMinutes() + t.getHours() * 60, e.css("top", t / n.timeInterval * n.timeIntervalHeight) }, n.prototype._onEventsDataChanged = function () { this._clearViewsCache(), this._prepareEventsForView(), this._renderActiveView(), this._trigger("eventsDataChanged", null, { eventsData: this.options.eventsData }) }, n.prototype._onCalendarsChanged = function () { this._trigger("calendarsChanged", null, { calendars: this.options.calendars }) }, n.prototype._renderDayViewAppointments = function () { var e = this._eventsView, n, r, i, s, o, u = this.element.find(".wijmo-wijev-headercontainer"), a = this.element.find(".wijmo-wijev-scrollcontent"), f = u.find(".wijmo-wijev-dayheadercolumn"), l = a.find(".wijmo-wijev-daycolumn"), c, h, p = this.options, d = this._getDayColumnDates(), v = d[0], m, g, y, b, w, E, S, x, T, N = []; m = d[d.length - 1], m = new Date(m.getFullYear(), m.getMonth(), m.getDate(), 23, 59, 59); if (e) for (i = 0, o = d.length; i < o; i += 1) if (!l[i]._cached) { c = d[i], c = new Date(c.getFullYear(), c.getMonth(), c.getDate()), h = new Date(c.getFullYear(), c.getMonth(), c.getDate(), 23, 59, 59); for (r = 0, s = e.length; r < s; r += 1) n = e[r], n.start < m && n.end > v && n.start < h && n.end > c && (this.isAllDayEvent(n) ? (g = !0, y = t(this._getAllDayEventMarkup(n)), t(f[i]).find(".wijmo-wijev-allday-cell").append(y)) : (b = n.start, w = n.end, b < c && (b = c), w > h && (w = h), E = (b - c) / 1e3 / 60, S = (w - c) / 1e3 / 60, x = Math.round(E * p.timeIntervalHeight / p.timeInterval), T = Math.round(S * p.timeIntervalHeight / p.timeInterval), y = t(this._getEventMarkup(n)), y.css("top", x), y.outerHeight(T - x), t(l[i]).append(y))); this._storeDayCache(d[i], f[i], l[i]), l[i]._cached = !0, N.push(l[i]) } else N.push(l[i]); this._dayColumnsToResolve = N, this._dayColumnResolveIdx = 0, this._resolveDayApptConflictsTimeout || (clearTimeout(this._resolveDayApptConflictsTimeout), this._resolveDayApptConflictsTimeout = null), this._resolveDayApptConflictsTimeout = setTimeout(t.proxy(this._resolveDayViewAppointmentConflictsCb1, this), 1), g && this._invalidateDayView(!0), this._dayViewScrollToEvent && (y = this.element.find(".wijmo-wijev-dayview .wijmo-wijev-daycolumn ." + this._eventIdToCssClass(this._dayViewScrollToEvent.id)), y.length > 0 && this.element.find(".wijmo-wijev-scrollpanel").wijsuperpanel("scrollChildIntoView", y)) }, n.prototype._getAllDayEventMarkup = function (e) { return '<div class="wijmo-wijev-appointment ' + this._eventIdToCssClass(e.id) + '">' + '<div class="' + " wijmo-wijev-colordot wijmo-wijev-event-color-" + (e.color || "default") + '"></div>' + '<div class="wijmo-wijev-event-title">' + e.subject + "</div>" + "</div>" }, n.prototype._getEventMarkup = function (e) { return '<div class="wijmo-wijev-appointment wijmo-wijev-event-color-' + (e.color || "default") + " " + this._eventIdToCssClass(e.id) + '">' + '<div class="wijmo-wijev-content"><div class="wijmo-wijev-title">' + this._formatString(this.options.eventTitleFormat, e.start, e.end, e.subject, e.location, "", e.description) + "</div></div>" + '<div class="wijmo-wijev-resizer">' + '<div class="ui-icon ui-icon-grip-solid-horizontal">' + "&nbsp;</div></div>" + "</div>" }, n.prototype._resolveDayViewAppointmentConflictsCb1 = function () { this._resolveDayApptConflictsTimeout = null; if (!this._dayColumnsToResolve || this._dayColumnResolveIdx >= this._dayColumnsToResolve.length) return; this._resolveDayViewAppointmentConflicts(this._dayColumnsToResolve[this._dayColumnResolveIdx]), this._dayColumnResolveIdx = this._dayColumnResolveIdx + 1, setTimeout(t.proxy(this._resolveDayViewAppointmentConflictsCb1, this), 1) }, n.prototype._resolveDayViewAppointmentConflicts = function (e) { var n = t(e).find(".wijmo-wijev-appointment"), r = [], i, s, o, u, a, f, l, c; for (s = 0, f = n.length; s < f; s += 1) { u = n[s]; for (o = 0; o < f; o += 1) o !== s && (a = n[o], u.offsetTop < a.offsetTop + a.offsetHeight && u.offsetTop + u.offsetHeight > a.offsetTop && (r[s] || (r[s] = [u]), r[s].push(a))) } for (s = 0, f = r.length; s < f; s += 1) { i = r[s]; if (i) { u = i[0], l = i.length, u.style.width = Math.ceil(100 / l) + "%", i.sort(this._sortOffsetTop); for (o = 0; o < l; o += 1) u = i[o], c = Math.floor(100 * o / l), u.style.marginLeft = c + "%", u.style.zIndex = c } } }, n.prototype._sortOffsetTop = function (e, t) { return e.offsetTop < t.offsetTop ? -1 : e.offsetTop > t.offsetTop ? 1 : 0 }, n.prototype._onDayViewTimeIntervalClick = function (e) { if (this.options.readOnly) return; this.showEditEventDialog(null, e.target, e) }, n.prototype._onDayViewAllDayCellClick = function (e) { if (this.options.readOnly) return; var n = t(e.target); if (n.hasClass("wijmo-wijev-appointment") || n.parents(".wijmo-wijev-appointment").length > 0) return; if (n.hasClass("wijmo-wijev-daylabel") || n.parents(".wijmo-wijev-daylabel").length > 0) return; this.showEditEventDialog(null, e.target, e) }, n.prototype._onMonthViewDayLabelClick = function (e) { var n = t(e.target).parents(".wijmo-wijev-monthcellcontainer"), r = this.options, i; n.length < 1 && (n = t(e.target).parents(".wijmo-wijev-dayheadercolumn")), n[0] && (i = this._parseDateFromClass(n[0].className), r.viewType !== "day" && (r.viewType = "day", this._onViewTypeChanged()), r.selectedDates = [new Date(i)], this._onSelectedDatesChanged()) }, n.prototype._onMonthViewCellClick = function (e) { var n = t(e.target).parent(".wijmo-wijev-monthcellcontainer"); if (this.options.readOnly) return; if (n.length < 1) return; this.showEditEventDialog(null, n, e) }, n.prototype._onAppointmentClick = function (e) { var n = t(e.target), r; if (this.options.readOnly) return; if (this._apptDragResizeFlag) return; n.hasClass("wijmo-wijev-appointment") || (n = n.parents(".wijmo-wijev-appointment")), n.length > 0 && (r = this.findEventById(n[0].className), this.showEditEventDialog(r, n, e)) }, n.prototype.findEventById = function (e) { var t; if (e) { t = e.indexOf("apptid_"), t !== -1 && (e = this._parseEventIdFromClass(e)); if (this._eventsDataById) return this._eventsDataById[e] } return null }, n.prototype._onMonthViewAppointmentMouseDown = function (e) { if (this.options.readOnly) return; var n = t(e.target), r = n.hasClass("wijmo-wijev-appointment") ? n : n.parents(".wijmo-wijev-appointment"); e.preventDefault(), this.__targetAppt = r, t(document).bind("mouseup.tmp_wijevcal", t.proxy(this._onMonthViewAppointmentMouseUp, this)), this.element.find(".wijmo-wijev-monthview .wijmo-wijev-monthcellcontainer").bind("mouseover.tmp_wijevcal", t.proxy(this._onMonthViewCellMouseOver, this)) }, n.prototype._onDayViewAppointmentMouseDown = function (e) { if (this.options.readOnly) return; var n = t(e.target), r = n.hasClass("wijmo-wijev-appointment") ? n : n.parents(".wijmo-wijev-appointment"), i = n.hasClass("wijmo-wijev-resizer") || n.parents(".wijmo-wijev-resizer").length > 0; if (this.options.disabled) return; this._isApptResize = i, e.preventDefault(), this._isApptResize ? (this.__startApptH = r[0].offsetHeight, this.__startApptY = r[0].offsetTop) : this.__startApptY = r[0].offsetTop, this.__startClientY = e.clientY, this.__targetAppt = r, t(document).bind("mousemove.tmp_wijevcal", t.proxy(this._onDayViewAppointmentMouseMove, this)), t(document).bind("mouseup.tmp_wijevcal", t.proxy(this._onDayViewAppointmentMouseUp, this)), t(this.element).find(".wijmo-wijev-dayview .wijmo-wijev-daycolumn").bind("mouseover.tmp_wijevcal", t.proxy(this._onDayViewColumnMouseOver, this)), t(this.element).find(".wijmo-wijev-dayview .wijmo-wijev-allday-cell").bind("mouseover.tmp_wijevcal", t.proxy(this._onDayViewAllDayMouseOver, this)) }, n.prototype._onDayViewAppointmentMouseMove = function (e) { e.preventDefault(); var t = e.clientY - this.__startClientY, n, r = this.options, i, s; e.ctrlKey || (t = Math.round(t / r.timeIntervalHeight) * r.timeIntervalHeight), t !== 0 && !this._apptDragResizeFlag && (this._apptDragResizeFlag = !0, this.__targetAppt.addClass("wijmo-wijev-dragging"), this.__targetAppt.css("width", "100%").css("margin-left", "0").css("z-index", "1000")), this._apptDragResizeFlag && (this._isApptResize ? (i = this.__startApptH + t, i < 0 ? (i = Math.abs(i), n = this.__startApptY - i, n >= 0 && (this.__targetAppt.css("height", i), this.__targetAppt.css("top", n))) : this.__targetAppt.css("height", i)) : (n = this.__startApptY + t, n < 0 && (n = 0), this.__targetAppt.css("top", n), s = this.__targetAppt.offset().top, this.element.find(".wijmo-wijev-scrollpanel").wijsuperpanel("scrollChildIntoView", this.__targetAppt), this.__startApptY = this.__startApptY - (this.__targetAppt.offset().top - s)), this._onApptVisualDargOrResize(this.__targetAppt, this.findEventById(this.__targetAppt[0].className))) }, n.prototype._onDayViewAppointmentMouseUp = function (e) { this.__targetAppt && this.__targetAppt.removeClass("wijmo-wijev-dragging"), t(document).unbind(".tmp_wijevcal"), t(this.element).find(".wijmo-wijev-dayview .wijmo-wijev-daycolumn").unbind(".tmp_wijevcal"), t(this.element).find(".wijmo-wijev-dayview .wijmo-wijev-allday-cell").unbind(".tmp_wijevcal"); if (this._apptDragResizeFlag || this._apptMovedFlag) { var n = this.findEventById(this.__targetAppt[0].className); this._onApptVisualDargOrResize(this.__targetAppt, n), this._apptMovedFlag = !1, this._movedFromTimeInervalApptElem = null, this.updateEvent(n), window.setTimeout(t.proxy(function () { this.__targetAppt && !this.__targetAppt.hasClass("wijmo-wijev-dragging") && (this._apptDragResizeFlag = !1, this._resolveDayViewAppointmentConflicts(this.__targetAppt.parents(".wijmo-wijev-daycolumn"))) }, this), 1) } }, n.prototype._updateAppointmentVisual = function (e) { var t = this.element.find(".wijmo-wijev-dayview ." + this._eventIdToCssClass(e.id)), n = this.options, i, s, o, u, a, f, l, c; t.length === 1 && (this._addColorClass(t, e.color), t.find(".wijmo-wijev-title").html(this._formatString(n.eventTitleFormat, e.start, e.end, e.subject, e.location, "", e.description)), a = r(e.start), i = (e.start - a) / 1e3 / 60, s = (e.end - a) / 1e3 / 60, o = Math.round(i * n.timeIntervalHeight / n.timeInterval), u = Math.round(s * n.timeIntervalHeight / n.timeInterval), t.css("top", o), t.css("height", u - o), f = this._dayDateToCssClass(a), t.parents(".wijmo-wijev-daycolumn." + f).length !== 1 && (l = t[0].parentNode, c = this.element.find(".wijmo-wijev-daycolumn." + f), l.removeChild(t[0]), t.appendTo(c))) }, n.prototype._onApptVisualDargOrResize = function (e, t) { var n = this.options, i = e[0].offsetTop, s = i + e[0].offsetHeight, o, u, a, f, l, c, h, p; e.parents(".wijmo-wijev-dayheadercolumn").length > 0 ? p = e.parents(".wijmo-wijev-dayheadercolumn")[0] : p = e.parents(".wijmo-wijev-daycolumn")[0], h = this._parseDateFromClass(p.className, null), o = Math.round(i * n.timeInterval / n.timeIntervalHeight), u = Math.round(s * n.timeInterval / n.timeIntervalHeight), a = new Date(o * 60 * 1e3 + h.getTime()), f = new Date(u * 60 * 1e3 + h.getTime()), t && (this._isApptResize ? l = f : (c = t.end.getTime() - t.start.getTime(), l = new Date(a.getTime() + c)), t.allday = e.parents(".wijmo-wijev-dayheadercolumn").length > 0, t.start = a, t.end = l, e.find(".wijmo-wijev-title").html(this._formatString(n.eventTitleFormat, t.start, t.end, t.subject, t.location, "", t.description)), !this._isApptResize && l.getTime() !== f.getTime() && e.css("height", Math.round((t.end - r(t.start)) / 1e3 / 60 * n.timeIntervalHeight / n.timeInterval) - Math.round((t.start - r(t.start)) / 1e3 / 60 * n.timeIntervalHeight / n.timeInterval))) }, n.prototype._onDayViewColumnMouseOver = function (e) { var n = t(e.target).parents(".wijmo-wijev-daycolumn"), r = this.__targetAppt.parents(".wijmo-wijev-daycolumn"); if (n.length < 1) return; if (r.length < 1) { r = this.__targetAppt.parents(".wijmo-wijev-dayheadercolumn"); if (r.length < 1) return; this._movedFromTimeInervalApptElem ? (this.__targetAppt.replaceWith(this._movedFromTimeInervalApptElem), this.__targetAppt = t(this._movedFromTimeInervalApptElem), this._movedFromTimeInervalApptElem = null) : this.__targetAppt.html(this._getEventMarkup(this.findEventById(this.__targetAppt[0].className))) } n[0].className !== r[0].className && (this.__targetAppt[0].parentNode.removeChild(this.__targetAppt[0]), this._resolveDayViewAppointmentConflicts(r), this.__targetAppt.appendTo(n), this._apptMovedFlag = !0) }, n.prototype._onMonthViewCellMouseOver = function (e) { var n = t(e.target), r = n.hasClass("wijmo-wijev-monthcellcontainer") ? n : n.parents(".wijmo-wijev-monthcellcontainer"), i = this.__targetAppt.parents(".wijmo-wijev-monthcellcontainer"); if (r.length < 1 || i.length < 1) return; r[0].className !== i[0].className && (this.__targetAppt[0].parentNode.removeChild(this.__targetAppt[0]), this.__targetAppt.appendTo(r.find(".wijmo-wijev-monthcell")), this.__targetApptChanged = !0) }, n.prototype._onMonthViewAppointmentMouseUp = function () { var e, n = this.__targetAppt.parents(".wijmo-wijev-monthcellcontainer")[0], i = this._parseDateFromClass(n.className, null), s; t(document).unbind(".tmp_wijevcal"), this.element.find(".wijmo-wijev-monthview .wijmo-wijev-monthcellcontainer").unbind(".tmp_wijevcal"), this.__targetApptChanged && (this.__targetApptChanged = !1, e = this.findEventById(this.__targetAppt[0].className), s = (i.getTime() - r(e.start).getTime()) / 864e5, e.start = this._addDays(e.start, s), e.end = this._addDays(e.end, s), this.updateEvent(e)) }, n.prototype._onDayViewAllDayMouseOver = function (e) { var n = t(e.target).parents(".wijmo-wijev-dayheadercolumn"), r = this.__targetAppt.parents(".wijmo-wijev-daycolumn"), i; if (n.length < 1) return; r.length > 0 ? (i = t(this._getAllDayEventMarkup(this.findEventById(this.__targetAppt[0].className))), this._movedFromTimeInervalApptElem = this.__targetAppt[0].cloneNode(!0), this.__targetAppt.replaceWith(i), this.__targetAppt = i) : r = this.__targetAppt.parents(".wijmo-wijev-dayheadercolumn"); if (r.length < 1) return; n[0].className !== r[0].className && (this.__targetAppt[0].parentNode.removeChild(this.__targetAppt[0]), this._resolveDayViewAppointmentConflicts(r), this.__targetAppt.appendTo(t(n).find(".wijmo-wijev-allday-cell")), this._apptMovedFlag = !0) }, n.prototype._renderMonthView = function () { var e = this.options, n = e.selectedDate, r = e.firstDayOfWeek, i = !1, s = !1, o, u, a, f = new Date, l, c, h = !1, p, d = ["", "", "", "", "", "", ""], v, m, g = this.element.find(".wijmo-wijev-view.wijmo-wijev-monthview"), y, b = e.dayHeaderFormat, w = e.firstRowDayHeaderFormat; n || (n = new Date), u = new Date(n.getFullYear(), n.getMonth(), 1); while (u.getDay() !== r) u = this._addDays(u, -1); a = new Date(n.getFullYear(), n.getMonth(), this._daysInMonth(n.getMonth(), n.getFullYear())), o = u, l = 0, c = 0; while (o < a || l < 7) { o > a && (a = o), v = "", p = "wijmo-wijev-monthcellcontainer " + e.wijCSS.content + " " + this._dayDateToCssClass(o), s = o.getMonth() !== n.getMonth(), s && (p += " wijmo-wijev-othermonth"), h ? h = !1 : (p += " wijmo-wijev-leftborder", l === 6 && (p += " wijmo-wijev-rightborder")), i = this._compareDayDates(o, f) === 0, i && (p += " wijmo-wijev-today", p += " wijmo-wijev-rightborder", h = !0), v += '<div class="' + p + '">', v += '<div class="wijmo-wijev-monthcellheader', s && (v += " ui-priority-secondary"), i && (v += " ui-state-highlight"), v += '">', i && (v += '<span class="wijmo-wijev-todaylabel">' + this.localizeString("labelToday", "Today") + "</span>"), c === 0 ? v += this._formatString(w, o) : v += this._formatString(b, o), v += "</div>", v += '<div class="wijmo-wijev-monthcell', s && (v += " ui-priority-secondary"), i && (v += " ui-state-highlight"), v += '"></div>', v += "</div>", d[l] = d[l] + v, l += 1, o = this._addDays(o, 1); if (l > 6) { if (o > a) break; l = 0, c += 1 } } g.length === 0 && (g = t('<div class="wijmo-wijev-view wijmo-wijev-monthview ' + e.wijCSS.content + '">' + '<h3 class="wijmo-wijev-header-title">title' + "</h3>" + '<div class="wijmo-wijev-monthview-inner">' + "</div>" + "</div>"), g.appendTo(this.element.find(".wijmo-wijev-view-container"))), y = g.find(".wijmo-wijev-monthview-inner"), y.find(".wijmo-wijev-monthcolumn").remove(), o = u; for (m = 0; m < 7; m += 1) y.append('<div class="wijmo-wijev-monthcolumn">' + d[m] + "</div>"), o = this._addDays(o, 1); this._invalidateMonthView(), this._renderMonthViewAppointments() }, n.prototype._invalidateMonthView = function () { var e = this.element.find(".wijmo-wijev-monthview"), n = e.find(".wijmo-wijev-monthview-inner"), r = e.find(".wijmo-wijev-monthcolumn"), i = e.find(".wijmo-wijev-monthcellcontainer"), s = this.element.find(".wijmo-wijev-monthview .wijmo-wijev-header-title"), o, u, a, f, l, c, h, p; this._invalidateView(); if (r.length < 1) return; o = e.innerWidth(), u = e.innerHeight() - s.outerHeight(!0), n.outerWidth(o), n.outerHeight(u), o -= n.outerWidth(!0) - n.innerWidth(), u -= n.outerHeight(!0) - n.innerHeight(), a = Math.floor(o / r.length), r.outerWidth(a), p = o - a * r.length, p > 0 && t(r[r.length - 1]).outerWidth(a + p), h = t(r[0]).find(".wijmo-wijev-weekdayname").outerHeight(!0), h || (h = 0), f = Math.floor((u - h) / t(r[0]).find(".wijmo-wijev-monthcellcontainer").length), i.height(f), l = t(i[0]).find(".wijmo-wijev-monthcellheader").outerHeight(!0), c = f - l, i.find(".wijmo-wijev-monthcell").outerHeight(c) }, n.prototype._renderMonthViewAppointments = function () { var e = this._eventsView, n, r, i, s, o, u = this.element.find(".wijmo-wijev-monthcellcontainer"), a, f, l, c; if (e) for (i = 0, o = u.length; i < o; i += 1) { a = u[i], f = this._parseDateFromClass(a.className), l = new Date(f.getFullYear(), f.getMonth(), f.getDate(), 23, 59, 59); for (r = 0, s = e.length; r < s; r += 1) n = e[r], n.start < l && n.end > f && (c = t('<div class="wijmo-wijev-appointment ' + this._eventIdToCssClass(n.id) + '">' + '<div class="' + " wijmo-wijev-colordot wijmo-wijev-event-color-" + (n.color || "default") + '"></div>' + '<div class="wijmo-wijev-event-title">' + n.subject + "</div>" + "</div>"), t(a).find(".wijmo-wijev-monthcell").append(c)) } u.find(".wijmo-wijev-monthcell").each(t.proxy(function (e, n) { var r = t(n), i = r.find(".wijmo-wijev-appointment"), s = r.outerHeight(), o = i.outerHeight(), u = i.length * o, a = 0; u > s && (i.each(function (e, t) { e * o + o > s && (t.style.display = "none", a += 1) }), a > 0 && r.find(".wijmo-wijev-monthcell-showmore").length < 1 && r.append(t('<div class="wijmo-wijev-monthcell-showmore">' + this._formatString(this.localizeString("monthCellMoreEventsFormat", "{0}  more..."), a) + "</div>"))) }, this)) }, n.prototype.log = function (e, t) { }, n.prototype._log = function (e, n) { var r; this.logPanel && (r = new Date, this.logPanel.prepend(t('<span class="' + (n ? n : "wijmo-wijev-information") + '">' + "[" + r.getHours() + ":" + r.getMinutes() + ":" + r.getSeconds() + "] " + e + "</span><br/>"))) }, n.prototype._createLogPanel = function () { if (!this.logPanel) { this.logDialog = t('<div title="Log"><div class="wijmo-wijev-log"></div></div>'), this.logDialog.appendTo(this.element); var e = {}; e[this.localizeString("buttonClearAll", "Clear All")] = function () { t(this).find(".wijmo-wijev-log").html("") }, e[this.localizeString("buttonClose", "Close")] = function () { t(this).wijdialog("close") }, this.logPanel = this.logDialog.wijdialog({ captionButtons: {}, buttons: e, width: 600, height: 420, position: ["right", "top"] }).find(".wijmo-wijev-log") } this.logDialog.wijdialog("open") }, n.prototype.status = function (e, t) { this.element.find(".wijmo-wijev-statusbar").html("<span class='" + (t ? t : "wijmo-wijev-status") + "'>" + e + "</span>"), this.log(e, t ? t : "wijmo-wijev-status") }, n.prototype._invalidateView = function () { var e = this.element.find(".wijmo-wijev-rightpane"), n = this.element.find(".wijmo-wijev-leftpane"), r = this.element.find(".wijmo-wijev-headerbar"), i = this.element.find(".wijmo-wijev-navigationbar"), s = this.element.find(".wijmo-wijev-statusbar"), o = this.element.find(".wijmo-wijev-view-container"), u = this.element.find(".wijmo-wijev-view"), a, f, l, c, h, p, d, v, m, g; a = this.element.innerWidth() - (o.outerWidth(!0) - o.innerWidth()), f = this.element.innerHeight() - (o.outerHeight(!0) - o.innerHeight()), l = r.is(":visible") ? r.outerHeight(!0) : 0, c = i.is(":visible") ? i.outerHeight(!0) : 0, h = s.is(":visible") ? s.outerHeight(!0) : 0, o.outerWidth(a), o.outerHeight(f - l - c - h), v = 0; for (g = 0; g < n.length; g += 1) t(n[g]).is(":visible") && (v += t(n[g]).outerWidth()); m = e.is(":visible") ? e.outerWidth() : 0, p = f - l - c - h, d = a - m - v - 1, u.outerHeight(p), u.outerWidth(d), r.outerWidth(d + v), i.outerWidth(this.element.innerWidth()), s.outerWidth(d + v + m), n.outerHeight(f - l - c - h), e.outerHeight(f + 100), this.element.find(".wijmo-wijev-datepager").wijdatepager("refresh") }, n.prototype._daysInMonth = function (e, t) { var n = new Date(t, e + 1, 0); return n.getDate() }, n.prototype._addMinutes = function (e, t) { return new Date(e.getFullYear(), e.getMonth(), e.getDate(), e.getHours(), e.getMinutes() + t) }, n.prototype._addDays = function (e, t) { return new Date(e.getFullYear(), e.getMonth(), e.getDate() + t, e.getHours(), e.getMinutes(), e.getSeconds(), e.getMilliseconds()) }, n.prototype._setTime = function (e, t, n) { var r; return e = new Date(e), e.setHours(t.getHours()), e.setMinutes(t.getMinutes()), e.setSeconds(t.getSeconds()), e.setMilliseconds(t.getMilliseconds()), n && (r = Math.floor((t.getTime() - n.getTime()) / 864e5), r > 0 && (e = this._addDays(e, r))), e }, n.prototype._addMonths = function (e, t) { return new Date(e.getFullYear(), e.getMonth() + t, e.getDate()) }, n.prototype._compareDayDates = function (e, t) { return e = new Date(e.getFullYear(), e.getMonth(), e.getDate()), t = new Date(t.getFullYear(), t.getMonth(), t.getDate()), e < t ? -1 : e > t ? 1 : 0 }, n.prototype._dayDateToCssClass = function (e) { return "wijmo-wijev-date_" + e.getFullYear() + "_" + e.getMonth() + "_" + e.getDate() }, n.prototype._parseDateFromClass = function (e, t, n) { var r, i, s, o = new RegExp("wijmo-wijev-minute-(\\d+)\\s"), u = new RegExp("wijmo-wijev-date_(\\d+_\\d+_\\d+)\\s"); return e ? (s = u.exec(e + " ")[1].split("_"), r = new Date(parseInt(s[0], 10), parseInt(s[1], 10), parseInt(s[2], 10)), t && (i = o.exec(t + " "), i && (i = parseInt(i[1], 10), r.setMinutes(i))), r) : n || null }, n.prototype._eventIdToCssClass = function (e) { return "apptid_" + e }, n.prototype._parseEventIdFromClass = function (e) { var t = "", n, r; return n = new RegExp("apptid_(\\S+)"), r = n.exec(e), r && r.length > 1 && (t = r[1]), t }, n.prototype._isContainsDayDate = function (e, t) { var n; if (!e) return !1; for (n = 0; n < e.length; n += 1) if (this._compareDayDates(e[n], t) === 0) return !0 }, n.prototype._formatString = function (e, t, n, r, i, s, o, u) { var a, f = arguments, l, c, h = this; if (f.length <= 1) return Globalize.format(f); typeof e == "string" && (e === "_formatWeekTitle" ? e = this._formatWeekTitle : e === "_formatMonthTitle" ? e = this._formatMonthTitle : typeof window[e] == "function" && (e = window[e])); if (typeof e == "function") { c = []; for (l = 1; l < f.length; l += 1) c[l - 1] = f[l]; return e.apply(this, c) } return a = new RegExp("\\{(\\d+)(?:,([-+]?\\d+))?(?:\\:([^(^}]+)(?:\\(((?:\\\\\\)|[^)])+)\\)){0,1}){0,1}\\}", "g"), e.replace(a, function (e, t, n, r, i) { return e = f[Number(t) + 1], r ? Globalize.format(e, r, h._getCulture()) : e }) }, n.prototype._formatMonthTitle = function (e) { return this._formatString(this.localizeString("monthViewHeaderFormat", "{0:MMMM yyyy}"), e) }, n.prototype._formatWeekTitle = function (e, t) { return e.getMonth() !== t.getMonth() ? this._formatString(this.localizeString("weekViewHeaderFormat2Months", "{0:MMMM} - {1:MMMM yyyy}"), e, t) : this._formatString(this.localizeString("weekViewHeaderFormat", "{0:MMMM yyyy}"), e) }, n.prototype._formatDayHeaderDate = function (e) { var t = this.options, n = t.viewType.toLowerCase(), r = this.options.dayViewHeaderFormat; if (r[n]) r = r[n]; else if (!r[n]) return ""; return this._formatString(r, e) }, n.prototype._getCulture = function (e) { return Globalize.findClosestCulture(e || this.options.culture) }, n.prototype._isRTL = function () { return !!this._getCulture().isRTL }, n.prototype._onAjaxError = function (e, t, n, r) { t ? (this.status("Ajax error " + t.status + " (" + t.statusText + ")", "error"), this.log("Error, requested url: " + n.url, "error"), t.responseText && this.log("Error, response text: " + t.responseText, "error")) : (this.status("Ajax error detected.", "error"), this.log("Error, requested url: " + n.url, "error")) }, n.prototype._onWindowResize = function () { this.invalidate() }, n }(e.wijmoWidget); e.wijevcal = h; var p = function () { function e() { this.wijMobileCSS = { header: "ui-header ui-bar-a", content: "ui-body ui-body-c", stateDefault: "ui-btn-up-c" }, this.initSelector = ":jqmData(role='wijevcal')", this.culture = "", this.localization = null, this.datePagerLocalization = null, this.readOnly = !1, this.webServiceUrl = "", this.colors = null, this.dataStorage = { addEvent: null, updateEvent: null, deleteEvent: null, loadEvents: null, addCalendar: null, updateCalendar: null, deleteCalendar: null, loadCalendars: null }, this.dataSource = null, this.eventsData = [], this.appointments = [], this.calendars = [], this.disabled = !1, this.editCalendarTemplate = "", this.enableLogs = !1, this.eventTitleFormat = "{2}", this.titleFormat = { day: !1, week: "_formatWeekTitle", month: "_formatMonthTitle", list: !1 }, this.firstDayOfWeek = 0, this.headerBarVisible = !0, this.navigationBarVisible = !0, this.rightPaneVisible = !1, this.selectedDate = null, this.selectedDates = null, this.statusBarVisible = !1, this.timeInterval = 30, this.timeIntervalHeight = 15, this.timeRulerInterval = 60, this.timeRulerFormat = "{0:h tt}", this.dayHeaderFormat = "{0:d }", this.firstRowDayHeaderFormat = "{0:ddd d}", this.dayViewHeaderFormat = { day: "all-day events", week: "{0:d dddd}", list: "{0:d dddd}" }, this.viewType = "day", this.visibleCalendars = new Array("Default"), this.calendarsChanged = null, this.initialized = null, this.selectedDatesChanged = null, this.viewTypeChanged = null, this.beforeEditEventDialogShow = null, this.beforeAddEvent = null, this.beforeUpdateEvent = null, this.beforeDeleteEvent = null, this.beforeAddCalendar = null, this.beforeUpdateCalendar = null, this.beforeDeleteCalendar = null, this.eventsDataChanged = null } return e }(); h.prototype.options = t.extend(!0, {}, e.wijmoWidget.prototype.options, new p), t.wijmo.registerWidget(n, h.prototype) })(wijmo || (wijmo = {}));;
var __extends = this.__extends || function (e, t) { function n() { this.constructor = e } n.prototype = t.prototype, e.prototype = new n }, wijmo; (function (e) { "use strict"; function l() { return document.location.hash.match(/^#\w+=/) } var t = jQuery, n = "wijappview", r = { menu: "menu", content: "content", header: "header", footer: "footer", page: "appviewpage" }, i = { adjusted: n + "-adjusted" }, s = "", o = !1; t.fn.findRole = function (e) { return this.find(":jqmData(role='" + e + "')") }; var u = function (e) { function u() { e.apply(this, arguments), this._updatingUrl = !1 } return __extends(u, e), u.prototype._appViewCSS = function () { return this.options.wijCSS.wijappview }, u.prototype._initMenu = function () { this._menuDiv = this.element.findRole(r.menu); if (!this._menuDiv.length) throw "A DIV with data-role='" + r.menu + "' not found!"; this._linkList = this._menuDiv.find("ul"); if (!this._linkList.length) throw "Invalid markup. Link list not found"; this._menuDiv.addClass(this._appViewCSS().menu) }, u.prototype._initPages = function (e, n) { var r = this._pageStore, i = this._appViewCSS(); e.each(function () { var e = t(this).addClass(i.page), r = e.attr("id"), s = n; r && (s += "#" + r), e.attr("data-url", s) }) }, u.prototype._initPageContainer = function () { var e = this._appViewCSS(), n = this._pageStore; this._pageContainer = t("<div/>").addClass(e.pageContainer).prependTo(this.element); var i = this.element.findRole(r.page); this._initPages(i, this._documentUrl), i.each(function (e) { n.push(t(this).clone()), e > 0 && t(this).remove() }), this._firstPage = i.first().addClass(e.pageActive).appendTo(this._pageContainer), this._initCurrentPage() }, u.prototype._getUrl = function (e) { var n = e.is("form") ? "action" : "href", r = e.attr(n); return !r || r === "#" ? null : (t.mobile.path.isRelativeUrl(r) && e.parents(":jqmData(url)").each(function (e, n) { var i = t(n).jqmData("url"); if (i && t.mobile.path.isAbsoluteUrl(i)) return r = t.mobile.path.makeUrlAbsolute(r, i), !1 }), r) }, u.prototype._hijackLinks = function (e) { var r = this; e.on("click." + n, "a, .ui-btn", function (e) { if (e.isDefaultPrevented()) return; var n = r._findClosestLink(e.target); if (!n || t(n).jqmData("appviewpage") === !1) return; var i = r._getUrl(t(n)); i && (e.preventDefault(), e.stopPropagation(), r.changePage(i)) }) }, u.prototype._hijackForms = function (e) { var r = this; e.on("submit." + n, "form", function (e) { if (e.isDefaultPrevented()) return; var n = t(e.currentTarget), i = n.closest("." + r._appViewCSS().page); if (!t.mobile.ajaxEnabled || n.is(":jqmData(ajax='false')") || !n.jqmHijackable().length) return; var s = n.attr("method"), o = n.attr("target"), u = r._getUrl(n); e.preventDefault(), e.stopPropagation(), r.changePage(u, { type: s && s.length && s.toLowerCase() || "get", data: n.serialize(), reloadPage: !0 }) }) }, u.prototype._initNavigation = function () { var e = this; this._onPopStateScoped = this._onPopStateScoped || t.proxy(this._onPopState, this), t(window).bind("popstate." + n, this._onPopStateScoped), t(window).bind("appviewpagehashchange." + n, function () { return e._navigateToCurrentLocation() }), this._onNavigateScoped = this._onNavigateScoped || t.proxy(this._onNavigate, this), t(t.mobile.pageContainer).bind("navigate." + n, this._onNavigateScoped) }, u.prototype._create = function () { this._pageStore = [], this._documentUrl = this._removePageUrlParam(location.href), this.element.attr("data-url", this._documentUrl), this.element.addClass(this._appViewCSS().outerDiv), this._initMenu(), this._initPageContainer(), this._hijackLinks(this.element), this._hijackForms(this.element), this._initNavigation(), this._navigateToCurrentLocation() }, u.prototype.destroy = function () { e.prototype.destroy.call(this); var r = "." + n; this.element.unbind(r), t(window).unbind(r), t(t.mobile.pageContainer).unbind(r) }, u.prototype._initCurrentPage = function () { var e = this._appViewCSS(), t = this.activePage(); t.findRole(r.content).addClass(e.content); var n = t.findRole(r.header).addClass(e.header), i = n.jqmData("position"), s = !i || i === "fixed"; s && n.addClass("ui-header-fixed"), this.element.toggleClass(e.withFixedHeader, s) }, u.prototype._findClosestLink = function (e) { while (e && (typeof e.nodeName != "string" || e.nodeName.toLowerCase() !== "a")) e = e.parentNode; return e }, u.prototype._clickHandler = function (e) { var n = t(e.currentTarget), r = n.is("li") ? n.jqmData("url") : n.is("a") ? n.attr("href") : null; if (!r) return; e.preventDefault(), e.stopPropagation(), this.changePage(r) }, u.prototype._inheritAttribute = function (e, t, n) { e.attr(n) && !t.attr(n) && t.attr(n, e.attr(n)) }, u.prototype.loadPage = function (e, n) { var i = this; e = e || ""; var s = t.Deferred(), o = t.mobile.path, u = t.extend({}, this.options.settings, n), a = !e || e.charAt(0) === "#", f = null, l = null, c = this._makeAbsoluteUrl(e); if (u.data) switch (u.type) { case "get": c = o.addSearchParams(c, u.data), u.data = undefined; break; case "post": u.reloadPage = !0 } var h = t.Event("pagebeforeload"), p = { url: e, absUrl: c, dataUrl: c, deferred: s, options: u }; this._trigger(h.type, h, p); if (h.isDefaultPrevented()) return s.promise(); if (!t.mobile.allowCrossDomainPages && !o.isSameDomain(o.parseLocation(), c)) return s.reject(c, n), s.promise(); var d = c && o.getFilePath(c).replace(/#.+/, ""), v = t.ajax({ url: d, type: u.type, data: u.data, dataType: "html", success: function (e, u, a) { function g(e) { return o.isAbsoluteUrl(e) || /^(\w+:|#|\/)/.test(e) ? null : o.makeUrlAbsolute(e, d) } var h = t("<div></div>"), v = new RegExp("(<[^>]+\\bdata-" + t.mobile.ns + "role=[\"']?" + r.page + "[\"']?[^>]*>)"), m = new RegExp("\\bdata-" + t.mobile.ns + "url=[\"']?([^\"'>]*)[\"']?"); t.browser.msie && parseFloat(t.browser.version) <= 7 && (e = e.replace(/<a[^>]+href=['"][^'"]+['"]/g, function (e) { return e.replace(/href=['"]([^'"]+)['"]/, function (e, t) { return t = g(t) || t, "href='" + t + "'" }) })), h.get(0).innerHTML = e; var y = h.findRole(r.page); y.length || (y = t("<div/>").attr("data-role", r.page).html(e.split(/<\/?body[^>]*>/gmi)[1])); var b = e.match(/<title[^>]*>([^<]*)/) && RegExp.$1; b && ~b.indexOf("&") && (b = t("<div>" + b + "</div>").text()), y.each(function (e, n) { n = t(n), n.attr("data-external-page", !0), !n.jqmData("title") && b && n.attr("data-title", b); var r = o.get(d); n.find("[src], [href]").each(function () { var e = t(this).is("[href]") ? "href" : t(this).is("[src]") ? "src" : "action", n = g(t(this).attr(e)); n && t(this).attr(e, n) }) }), i._initPages(y, d), f = y.filter(function () { return t(this).jqmData("url") === c }), f.length || (f = y.first()), p.xhr = a, p.textStatus = u, p.page = f, p.allPages = y, i._trigger("pageload", null, p), y.each(function (e, n) { i._pageStore.push(t(n).clone()) }), s.resolve(c, n, f, l) }, error: function (e, r, o) { p.xhr = e, p.textStatus = r, p.errorThrown = o; var u = t.Event("pageloadfailed"); i._trigger(u.type, u, p); if (u.isDefaultPrevented()) return; s.reject(c, n) } }); return s.fail(function () { v.abort() }), s }, u.prototype.activePage = function () { return this._pageContainer.children("." + this._appViewCSS().pageActive).first() }, u.prototype.isMenuUrl = function (e) { var n = this; return e = e.toLowerCase(), this._menuDiv.find("a").is(function () { return n._getUrl(t(this)).toLowerCase() === e }) }, u.prototype.showLoading = function () { t.mobile.loading("show") }, u.prototype.hideLoading = function () { t.mobile.loading("hide") }, u.prototype.changePage = function (e, n) { var s = this; n = t.extend({ updateUrl: !0 }, n); var u = { toPage: e, options: n }; this._curRequest && this._curRequest.state() === "pending" && this._curRequest.rejectWith && this._curRequest.rejectWith(this, [e, n, !0]); if (typeof e == "string") { var a = this.activePage().data("url"), f = this._makeAbsoluteUrl(e); this._updateUIBeforeChange(f), this.showLoading(), this._curRequest = this.loadPage(e, n).always(function () { s.hideLoading(), s._curRequest = null }).done(function (e, t, n, r) { s._updateUIAfterChange(f), s.changePage(n, t) }).fail(function (e, t, n) { n || s._updateUI(a), s._trigger("pagechangefailed", null, u) }); return } var l = t.Event("pagebeforechange"); this._trigger(l.type, l, u); if (l.isDefaultPrevented()) return; var c = e.jqmData("url"), h = null; this._updateUI(c), c && (h = this._makeRelative(c), h != null && (h = this._makeRelative(h))); var p = e.jqmData("title"), d = e.findRole("header"), v = this._appViewCSS(); !d.length && p && (d = t("<div data-role='header'/>").append(t("<h2/>").text(p)).prependTo(e)); if (d.length && !d.jqmData(i.adjusted)) { d.jqmData(i.adjusted, !0); var m = this._firstPage.findRole(r.header); m && this._inheritAttribute(m, d, "data-position"), this.isMenuUrl(c) && !d.find("a[data-icon=back]").length && t("<a/>").attr({ href: this._documentUrl, "data-icon": "back" }).text("Back").prependTo(d) } p && (document.title = p), this._pageContainer.children().removeClass(v.pageActive), e.addClass(v.pageActive).appendTo(this._pageContainer.empty()), this._initCurrentPage(); if (n.updateUrl || o) this._updateUrl(c, h, document.title), o = !1; e.jqmData("page", t.mobile.activePage.jqmData("page")).trigger("pagecreate").trigger(this.widgetEventPrefix + "pageinit", u), this._trigger("pagechange", null, u) }, u.prototype._updateUIBeforeChange = function (e) { var n = this, r = e === this._documentUrl, i = this._linkList.find("li"), s = this._appViewCSS().menuItemActive; if (r) i.removeClass(s); else { var o = i.filter(function () { var r = n._getUrl(t(this).find("a")); return r && r.toLowerCase() === e.toLowerCase() }); o.length && !o.hasClass(s) && (i.removeClass(s), o.addClass(s)) } }, u.prototype._updateUIAfterChange = function (e) { var t = this._appViewCSS(), n = e === this._documentUrl; this.element.toggleClass(t.inPage, !n) }, u.prototype._updateUI = function (e) { this._updateUIBeforeChange(e), this._updateUIAfterChange(e) }, u.prototype._changePageIfDifferent = function (e, t) { var n = typeof e == "string" ? e : e.jqmData("url"); this.activePage().jqmData("url") !== n && this.changePage(e, t) }, u.prototype._onNavigate = function (e) { var t = new RegExp("^#?" + this.options.urlParamName + "="); (history.state && history.state.wijappview || document.location.hash.match(t)) && e.preventDefault() }, u.prototype._removePageUrlParam = function (e) { return e.replace(/\#.*$/, "") }, u.prototype._addUrl = function (e) { var t = this.options.urlParamName, n = this._removePageUrlParam(location.href); return e && (n += "#" + t + "=" + e), n }, u.prototype._makeRelative = function (e) { var n = t.mobile.path.parseLocation(), r = e; if (e) { var i = n.domain + n.directory; e.substr(0, n.hrefNoHash.length) === n.hrefNoHash ? r = e.substr(n.hrefNoHash.length) : e.substr(0, i.length) === i && (r = e.substr(i.length)) } return r }, u.prototype._makeAbsoluteUrl = function (e) { var n = t.mobile.path, r = this.activePage(), i = n.makeUrlAbsolute(r.jqmData("url") || this._documentUrl, this._documentUrl); return e && n.makeUrlAbsolute(e, i) }, u.prototype._onPopState = function (e) { if (this._updatingUrl) return; history.state && history.state.wijappview ? this._changePageIfDifferent(history.state.absUrl || this._firstPage, { updateUrl: !1 }) : this._navigateToCurrentLocation() }, u.prototype._navigateToCurrentLocation = function () { var e = new RegExp("#" + this.options.urlParamName + "=(.+)"), n = e.exec(location.href) || s && e.exec(s), r = n ? t.mobile.path.makeUrlAbsolute(n[1], this._documentUrl) : this._firstPage; s = "", this._changePageIfDifferent(r, { updateUrl: !1 }) }, u.prototype._updateUrl = function (e, n, r) { this._updatingUrl = !0; try { t.mobile.urlHistory.ignoreNextHashChange = !0, document.location.hash = e === this._documentUrl ? "" : this.options.urlParamName + "=" + n } finally { this._updatingUrl = !1 } }, u }(e.wijmoWidget); e.wijappview = u; var a = "wijmo-wijappview", f = a + "-"; u.prototype.options = t.extend({}, e.wijmoWidget.prototype.options, { urlParamName: "appviewpage", loadSettings: { type: "GET", data: undefined, reloadPage: !1, showLoadMsg: !1, loadMsgDelay: 50 }, wijCSS: { wijappview: { outerDiv: a, inPage: f + "in-page", menu: f + "menu", menuItemActive: "ui-btn-down-b", page: f + "page", pageActive: f + "page-active", pageContainer: f + "page-container", content: f + "content", header: f + "header", withFixedHeader: f + "with-fixed-header" } } }), t.mobile && (t.wijmo.registerWidget(n, u.prototype), t(window).bind("hashchange", function (e) { l() && (e.stopImmediatePropagation(), t(window).trigger("appviewpagehashchange")) }), l() && (s = document.location.hash, t(window).bind("pagecontainercreate", function () { document.location.hash = "", o = !0 }))) })(wijmo || (wijmo = {}));